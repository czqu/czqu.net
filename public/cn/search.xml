<?xml version="1.0" ?>
  <search>
    <entry>
      
      
      <title>RemoteFingerUnlock API Documentation</title>
      
      
      <link href="/posts/2167915263/"/>
      
      
      <url>/posts/2167915263/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="Remote-Unlock-API-Documentation"><a href="#Remote-Unlock-API-Documentation" class="headerlink" title="Remote Unlock  API Documentation"></a>Remote Unlock  API Documentation</h1><p><strong>Version:</strong> 1.0</p><p>This document is the official API reference for the Remote Unlock Module. It provides detailed information for all available endpoints, including authentication methods, request parameters, and expected response formats.</p><ul><li><strong>Terms of Service:</strong> <a href="https://rfu.czqu.net/">https://rfu.czqu.net</a></li></ul><h2 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a><strong>Disclaimer</strong></h2><p>The information provided by this [Website/Document/Service/Product] (hereinafter “the Service”) is for general informational purposes only. All information is provided in good faith, however, we make no representation or warranty of any kind, express or implied, regarding the accuracy, adequacy, validity, reliability, availability, or completeness of any information on the Service.</p><p>Under no circumstance shall we have any liability to you for any loss or damage of any kind incurred as a result of the use of the Service or reliance on any information provided on the Service. Your use of the Service and your reliance on any information on the Service is solely at your own risk.</p><p>The Service may contain (or you may be sent through the Service) links to other websites or content belonging to or originating from third parties. Such external links are not investigated, monitored, or checked for accuracy, adequacy, validity, reliability, availability, or completeness by us.</p><p>The content provided by this Service does not constitute professional advice of any kind (including but not limited to legal, financial, medical, or other professional advice). All content is for informational purposes only. Before taking any action based upon such information, we strongly encourage you to consult with the appropriate professionals. We do not provide any kind of professional advice.</p><hr><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Base-URL"><a href="#Base-URL" class="headerlink" title="Base URL"></a>Base URL</h3><p>The base URL for all API requests is as follows:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:2091/api/v1</span><br></pre></td></tr></tbody></table></figure><h3 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h3><p>Most endpoints in this API require authentication via an API key. Please include the <code>Authorization</code> field in the HTTP request header.</p><ul><li><strong>Type:</strong> <code>apiKey</code></li><li><strong>Header Field Name:</strong> <code>Authorization</code></li><li><strong>Format:</strong> <code>Authorization: Bearer &lt;YOUR_API_KEY&gt;</code></li></ul><blockquote><p><strong>Note:</strong> <code>&lt;YOUR_API_KEY&gt;</code> needs to be replaced with the actual authentication token you obtained upon login or from the system configuration. All endpoints that require authentication must carry this header, otherwise, a <code>401 Unauthorized</code> error will be returned.</p></blockquote><h3 id="Common-Response-Format"><a href="#Common-Response-Format" class="headerlink" title="Common Response Format"></a>Common Response Format</h3><p>All API responses follow a unified data structure to facilitate standardized client-side processing.</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"code"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"msg"</span><span class="punctuation">:</span> <span class="string">"success"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"data"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"request_id"</span><span class="punctuation">:</span> <span class="string">"unique-request-id-string"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><ul><li><code>code</code>: A status code. <code>0</code> usually indicates success, while other non-zero values represent different types of errors.</li><li><code>msg</code>: A brief description of the response, such as “success” or a specific error message.</li><li><code>data</code>: The actual data payload returned, which can be an object, an array, or null.</li><li><code>request_id</code>: A unique identifier for this request, which can be used for troubleshooting.</li></ul><hr><h2 id="API-Endpoint-Details"><a href="#API-Endpoint-Details" class="headerlink" title="API Endpoint Details"></a>API Endpoint Details</h2><h3 id="PC-Control"><a href="#PC-Control" class="headerlink" title="PC Control"></a>PC Control</h3><h4 id="POST-control-pc-action"><a href="#POST-control-pc-action" class="headerlink" title="POST /control-pc/{action}/"></a><code>POST /control-pc/{action}/</code></h4><p>Controls the computer to perform a specified action, such as shutdown, standby, or lock.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li><li><strong>Description:</strong> Controls the computer based on the <code>action</code> parameter. The <code>shutdown</code> and <code>standby</code> actions can also include a delay time.</li></ul><p><strong>Path Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Enum Values</th><th>Description</th></tr></thead><tbody><tr><td><code>action</code></td><td>string</td><td>Yes</td><td><code>shutdown</code>, <code>standby</code>, <code>lock</code></td><td>The type of action to perform. Respectively: shutdown, standby, lock.</td></tr></tbody></table><p><strong>Query Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>delay</code></td><td>string</td><td>Yes</td><td>The delay time in seconds before execution. Only valid when <code>action</code> is <code>shutdown</code> or <code>standby</code>.</td></tr><tr><td><code>shutdown_type</code></td><td>string</td><td>No</td><td>The type of shutdown. Only effective when <code>action=shutdown</code>. For example, it can be specified as “force” or “hybrid” (see below for available values).</td></tr></tbody></table><table><thead><tr><th>shutdown_type</th><th>Description</th></tr></thead><tbody><tr><td>0</td><td>No operation</td></tr><tr><td><strong>General</strong></td><td></td></tr><tr><td>1</td><td>Log off the current user</td></tr><tr><td>2</td><td>Force close all applications and shut down</td></tr><tr><td>3</td><td>Force close all applications and restart</td></tr><tr><td><strong>Windows Only</strong></td><td></td></tr><tr><td>4</td><td>Shut down but do not power off</td></tr><tr><td>5</td><td>Restart the computer</td></tr><tr><td>6</td><td>Force close all applications</td></tr><tr><td>7</td><td>Shut down and power off</td></tr><tr><td>8</td><td>Restart applications</td></tr><tr><td>9</td><td>Hybrid shutdown</td></tr><tr><td>10</td><td>Force close applications, shut down, and power off</td></tr><tr><td>11</td><td>Restart the computer and restart applications</td></tr><tr><td>12</td><td>Force close applications, restart, and restart applications</td></tr><tr><td>13</td><td>Shut down without powering off, then restart applications after shutdown</td></tr><tr><td>14</td><td>Hybrid shutdown and force close applications</td></tr><tr><td>15</td><td>Hybrid shutdown and restart applications</td></tr><tr><td>16</td><td>Hybrid shutdown, force close applications, and restart applications</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: The command was sent successfully.</li><li><code>400 Bad Request</code>: Invalid action type (<code>action</code> is not in the enum list).</li><li><code>500 Internal Server Error</code>: Failed to execute the action, possibly due to insufficient permissions or other system errors.</li></ul><hr><h3 id="System"><a href="#System" class="headerlink" title="System"></a>System</h3><h4 id="GET-info"><a href="#GET-info" class="headerlink" title="GET /info"></a><code>GET /info</code></h4><p>Gets basic information about the software, such as its version.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li></ul><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Successfully retrieved information.</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><h4 id="GET-info-check-update"><a href="#GET-info-check-update" class="headerlink" title="GET /info/check_update"></a><code>GET /info/check_update</code></h4><p>Checks if there are any available updates for the system.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li><li><strong>Description:</strong> Returns details of the latest available update, including the version number, update URL, and release notes.</li></ul><p><strong>Query Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td><code>lang</code></td><td>string</td><td>No</td><td><code>en</code></td><td>Specifies the language for the update information.</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Successfully retrieved update information.</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><h4 id="GET-info-language"><a href="#GET-info-language" class="headerlink" title="GET /info/language"></a><code>GET /info/language</code></h4><p>Gets the currently configured system language.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>❌</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Not Required</li></ul><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Successfully retrieved the language setting.</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><h4 id="PATCH-info-language"><a href="#PATCH-info-language" class="headerlink" title="PATCH /info/language"></a><code>PATCH /info/language</code></h4><p>Sets the system language.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>❌</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Not Required</li></ul><p><strong>Query Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td><code>lang</code></td><td>string</td><td>No</td><td><code>en</code></td><td>The target language to set.</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Language successfully set.</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><h4 id="GET-logs-module"><a href="#GET-logs-module" class="headerlink" title="GET /logs/{module}"></a><code>GET /logs/{module}</code></h4><p>Gets a real-time stream of system logs.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li><li><strong>Description:</strong> This endpoint establishes a long-lived connection to push system logs in real-time. The connection will remain open until closed by the client or an error occurs.</li></ul><p><strong>Path Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>module</code></td><td>string</td><td>Yes</td><td>Specifies which module’s logs to retrieve. In this document, the value must be <code>service</code>.</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Starts pushing the log stream (<code>Content-Type: text/event-stream</code>).</li><li><code>400 Bad Request</code>: An invalid module was specified.</li><li><code>500 Internal Server Error</code>: Internal server error, e.g., the log buffer is unavailable.</li></ul><hr><h3 id="Power-Saving"><a href="#Power-Saving" class="headerlink" title="Power Saving"></a>Power Saving</h3><h4 id="POST-power-saving"><a href="#POST-power-saving" class="headerlink" title="POST /power-saving"></a><code>POST /power-saving</code></h4><p>Enables, disables, or sets power-saving mode to auto.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li><li><strong>Description:</strong> This function first writes the setting to the database. If the write is successful, it then applies the setting to the system. The value in the database will be updated even if the system application fails.</li></ul><p><strong>Query Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td><code>mode</code></td><td>string</td><td>No</td><td><code>auto</code></td><td>Power saving mode. Possible values are <code>enable</code>, <code>disable</code>, or <code>auto</code>.</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Power saving mode set successfully.</li><li><code>400 Bad Request</code>: Invalid request parameters.</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><h4 id="GET-power-saving-status"><a href="#GET-power-saving-status" class="headerlink" title="GET /power-saving/status"></a><code>GET /power-saving/status</code></h4><p>Gets the current status of the power-saving mode.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li></ul><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Successfully retrieved the power-saving mode status.</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><hr><h3 id="Network-Interfaces"><a href="#Network-Interfaces" class="headerlink" title="Network Interfaces"></a>Network Interfaces</h3><h4 id="GET-interface"><a href="#GET-interface" class="headerlink" title="GET /interface"></a><code>GET /interface</code></h4><p>Gets a list of active network interfaces.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li><li><strong>Description:</strong> Returns a list of all active network interfaces on the current device, based on the specified IP version (IPv4 or IPv6).</li></ul><p><strong>Query Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Default Value</th><th>Enum Values</th><th>Description</th></tr></thead><tbody><tr><td><code>type</code></td><td>string</td><td>No</td><td><code>4</code></td><td><code>4</code>, <code>6</code></td><td>IP protocol version. <code>4</code> for IPv4, <code>6</code> for IPv6.</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Successfully returned the list of network interfaces.</li><li><code>400 Bad Request</code>: Incorrect request parameters.</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><h4 id="GET-interface-ip"><a href="#GET-interface-ip" class="headerlink" title="GET /interface/{ip}"></a><code>GET /interface/{ip}</code></h4><p>Gets the MAC address corresponding to an IP address.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li></ul><p><strong>Path Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>ip</code></td><td>string</td><td>Yes</td><td>The IP address to query.</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Successfully retrieved the MAC address.</li><li><code>400 Bad Request</code>: Invalid request format (e.g., invalid IP address).</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><h4 id="GET-interface-ip-all"><a href="#GET-interface-ip-all" class="headerlink" title="GET /interface/{ip}/all"></a><code>GET /interface/{ip}/all</code></h4><p>Gets complete interface information for an IP address.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required</li></ul><p><strong>Path Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>ip</code></td><td>string</td><td>Yes</td><td>The IP address to query.</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Successfully retrieved interface information.</li><li><code>400 Bad Request</code>: Invalid request format.</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><hr><h3 id="User-Authentication-amp-Operations"><a href="#User-Authentication-amp-Operations" class="headerlink" title="User Authentication &amp; Operations"></a>User Authentication &amp; Operations</h3><h4 id="POST-login"><a href="#POST-login" class="headerlink" title="POST /login"></a><code>POST /login</code></h4><p>User login.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Required (This might refer to basic client authentication to exchange for a longer-lived token)</li><li><strong>Description:</strong> Authenticates using a username and password. On success, it returns a JWT (JSON Web Token) to be used for subsequent authenticated API requests.</li></ul><p><strong>Request Body</strong></p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"username"</span><span class="punctuation">:</span> <span class="string">"your_username"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"password"</span><span class="punctuation">:</span> <span class="string">"your_password"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><ul><li><strong>Schema:</strong> <code>LoginRequest</code></li></ul><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Authentication successful. The <code>data</code> field of the response will contain the JWT Token.</li><li><code>400 Bad Request</code>: Invalid request parameters (e.g., empty username or password).</li><li><code>500 Internal Server Error</code>: Internal server error.</li></ul><h4 id="POST-unlock"><a href="#POST-unlock" class="headerlink" title="POST /unlock"></a><code>POST /unlock</code></h4><p>Unlock your computer.</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>❌</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Not Required</li><li><strong>Description:</strong> Sends the computer’s username and password to perform the unlock operation.</li></ul><p><strong>Request Body</strong></p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"username"</span><span class="punctuation">:</span> <span class="string">"your_pc_username"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"password"</span><span class="punctuation">:</span> <span class="string">"your_pc_password"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><ul><li><strong>Schema:</strong> <code>PcUserInfo</code></li></ul><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Unlock successful.</li><li><code>400 Bad Request</code>: Invalid request format.</li><li><code>500 Internal Server Error</code>: Internal error (e.g., incorrect username or password, unlock failed).</li></ul><hr><h3 id="Miscellaneous"><a href="#Miscellaneous" class="headerlink" title="Miscellaneous"></a>Miscellaneous</h3><h4 id="GET-ping"><a href="#GET-ping" class="headerlink" title="GET /ping"></a><code>GET /ping</code></h4><p>Service health check (Ping).</p><ul><li><strong>Authentication:</strong> <span class="github-emoji"><span>❌</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Not Required</li><li><strong>Description:</strong> Used to check if the service is running correctly, or the status of specific sub-services (like WebSocket).</li></ul><p><strong>Query Parameters</strong></p><table><thead><tr><th>Parameter Name</th><th>Type</th><th>Required</th><th>Enum Values</th><th>Description</th></tr></thead><tbody><tr><td><code>type</code></td><td>string</td><td>No</td><td><code>ws</code>, <code>pairing</code></td><td>The type of probe. <code>ws</code> might be for testing the WebSocket service, <code>pairing</code> for the pairing service.</td></tr></tbody></table><p><strong>Responses</strong></p><ul><li><code>200 OK</code>: Service is OK.</li><li><code>500 Internal Server Error</code>: Service is not available.</li></ul><hr><h2 id="Data-Models-Definitions"><a href="#Data-Models-Definitions" class="headerlink" title="Data Models (Definitions)"></a>Data Models (Definitions)</h2><h3 id="LoginRequest"><a href="#LoginRequest" class="headerlink" title="LoginRequest"></a><code>LoginRequest</code></h3><p>The credentials object used for user login.</p><table><thead><tr><th>Field Name</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>username</code></td><td>string</td><td>Yes</td><td>Username</td></tr><tr><td><code>password</code></td><td>string</td><td>Yes</td><td>Password</td></tr></tbody></table><h3 id="PcUserInfo"><a href="#PcUserInfo" class="headerlink" title="PcUserInfo"></a><code>PcUserInfo</code></h3><p>The user information object used to unlock the computer.</p><table><thead><tr><th>Field Name</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>username</code></td><td>string</td><td>No</td><td>The computer’s username</td></tr><tr><td><code>password</code></td><td>string</td><td>No</td><td>The computer’s login password</td></tr></tbody></table><h3 id="ResponseData"><a href="#ResponseData" class="headerlink" title="ResponseData"></a><code>ResponseData</code></h3><p>The common data structure for all API responses.</p><table><thead><tr><th>Field Name</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>code</code></td><td>integer</td><td>Business status code, <code>0</code> indicates success</td></tr><tr><td><code>data</code></td><td>object</td><td>The actual returned data</td></tr><tr><td><code>msg</code></td><td>string</td><td>A message providing details</td></tr><tr><td><code>request_id</code></td><td>string</td><td>The unique ID for this request</td></tr></tbody></table>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> RemoteFingerUnlock </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> RemoteFingerUnlock </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Install a Specific Version of Docker on CentOS</title>
      
      
      <link href="/posts/3776602279/"/>
      
      
      <url>/posts/3776602279/</url>
      
      
        
      <content type="html"><![CDATA[<p>Docker is a popular containerization technology that allows you to quickly create, deploy, and run applications. However, sometimes you may need to install a specific version of Docker instead of the latest version. In this article, we’ll walk you through the steps to install a specific version of Docker on CentOS.</p><h3 id="Step-1-Install-Necessary-Packages"><a href="#Step-1-Install-Necessary-Packages" class="headerlink" title="Step 1: Install Necessary Packages"></a>Step 1: Install Necessary Packages</h3><p>First, you need to install some necessary packages, including <code>yum-utils</code>, <code>device-mapper-persistent-data</code>, and <code>lvm2</code>. These packages will help you configure Docker storage drivers and LVM volumes.</p><p>You can install these packages using the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></tbody></table></figure><h3 id="Step-2-Add-Docker-Repository"><a href="#Step-2-Add-Docker-Repository" class="headerlink" title="Step 2: Add Docker Repository"></a>Step 2: Add Docker Repository</h3><p>Next, you need to add the Docker repository. You can add the Docker repository to your CentOS system using the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></tbody></table></figure><p>Alternatively, if you’re in China, you can use the Aliyun mirror by running the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></tbody></table></figure><p>This will add the YUM repository configuration file for the Docker repository.</p><h3 id="Step-3-Update-YUM-Cache"><a href="#Step-3-Update-YUM-Cache" class="headerlink" title="Step 3: Update YUM Cache"></a>Step 3: Update YUM Cache</h3><p>Once the Docker repository has been added to the system, you need to update the YUM cache to be able to install packages from the repository. You can update the YUM cache using the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></tbody></table></figure><h3 id="Step-4-Install-Specific-Version-of-Docker"><a href="#Step-4-Install-Specific-Version-of-Docker" class="headerlink" title="Step 4: Install Specific Version of Docker"></a>Step 4: Install Specific Version of Docker</h3><p>Finally, you can install the specific version of Docker that you need using the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span><br></pre></td></tr></tbody></table></figure><p>Where <code>&lt;VERSION_STRING&gt;</code> is the version number of the Docker version you want to install. For example, if you want to install Docker version 20.10.8, you can use the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce-20.10.8 docker-ce-cli-20.10.8 containerd.io</span><br></pre></td></tr></tbody></table></figure><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>In this article, we’ve shown you how to install a specific version of Docker on CentOS. By following these four simple steps, you can successfully install the Docker version you need and start using Docker for containerized development and deployment. If you encounter any issues, please refer to the official Docker documentation or community support.</p><p><a href="https://docs.docker.com/engine/install/centos/#install-using-the-repository">Install Docker Engine on CentOS | Docker Documentation</a></p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Get Log4j Log File Path in Java</title>
      
      
      <link href="/posts/735037507/"/>
      
      
      <url>/posts/735037507/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Log4j is one of the widely used logging tools on the Java platform. It allows configuration of logging output to various destinations, such as console, file, and database. In real-world applications, it is often necessary to obtain the file path of the Log4j log file for viewing, analysis, and processing purposes. In this blog, we will discuss a method to obtain the Log4j log file path using Java code.</p><h1 id="Code-example"><a href="#Code-example" class="headerlink" title="Code example"></a>Code example</h1><p>In Log4j, a Logger instance can be used to get all of its Appenders using the getAppenders() method. An Appender is an abstract class with several concrete subclasses, such as ConsoleAppender, FileAppender, and RollingFileAppender. The FileAppender and RollingFileAppender subclasses are used to output logs to a file.</p><p>To obtain the file path of a RollingFileAppender instance, we can traverse all the Appenders of a Logger instance, and check each Appender instance to see if it is a RollingFileAppender instance. If we find one, we can then obtain the file path by calling the getFileName() method of the RollingFileAppender instance.</p><p>Here is an example code snippet that demonstrates this process:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.Appender;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.appender.RollingFileAppender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Log4jUtils</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getLogPath</span><span class="params">(Logger logger)</span> {</span><br><span class="line">        Map&lt;String, Appender&gt; appenderMap = ((org.apache.logging.log4j.core.Logger) logger).getAppenders();</span><br><span class="line">        <span class="keyword">if</span> (appenderMap == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (Appender appender : appenderMap.values()) {</span><br><span class="line">            <span class="keyword">if</span> (appender <span class="keyword">instanceof</span> RollingFileAppender) {</span><br><span class="line">                <span class="keyword">return</span> ((RollingFileAppender) appender).getFileName();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger(Log4jUtils.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">logPath</span> <span class="operator">=</span> getLogPath(logger);</span><br><span class="line">        System.out.println(logPath);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In this code, we first cast the Logger instance to the org.apache.logging.log4j.core.Logger type and then call the getAppenders() method to get all the Appenders. We then traverse each Appender instance and check if it is an instance of RollingFileAppender. If we find one, we obtain its file path by calling the getFileName() method.</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p> In this blog, we have discussed a method to obtain the file path of a Log4j log file using Java code. By traversing the Appenders of a Logger instance and checking if it is a RollingFileAppender instance, we can obtain its file path. This method can be useful for viewing, analyzing, and processing Log4j log files.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
            
        <tag> Java </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Execute JavaScript Code and Functions in Java</title>
      
      
      <link href="/posts/2250085940/"/>
      
      
      <url>/posts/2250085940/</url>
      
      
        
      <content type="html"><![CDATA[<p>JavaScript is a popular scripting language used for developing dynamic and interactive web pages. While JavaScript is primarily used in web development, it can also be used in other areas such as server-side scripting, desktop applications, and mobile apps. In this blog, we will explore how to execute JavaScript code and functions in Java.</p><p>To execute JavaScript code in Java, we can use the ScriptEngine class provided by the Java API. The ScriptEngine class is used to execute scripts written in various languages, including JavaScript. Here is a sample code that demonstrates how to execute JavaScript code in Java:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaScriptExecutor</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// Create a ScriptEngineManager object</span></span><br><span class="line">        <span class="type">ScriptEngineManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the JavaScript engine</span></span><br><span class="line">        <span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span> manager.getEngineByName(<span class="string">"javascript"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// Execute JavaScript code</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">"var a = 1 + 2; a;"</span>;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> engine.eval(script);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Print the result</span></span><br><span class="line">            System.out.println(result);</span><br><span class="line">        } <span class="keyword">catch</span> (ScriptException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In this example, we create a ScriptEngineManager object and get the JavaScript engine using the getEngineByName method. Then we execute the JavaScript code using the eval method of the ScriptEngine class and store the result in an Object variable. Finally, we print the result to the console.</p><p>To execute JavaScript functions in Java, we can define the function in JavaScript code and then call it from our Java code using the ScriptEngine class. Here is a sample code that demonstrates how to execute JavaScript functions in Java:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaScriptFunctionExecutor</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// Create a ScriptEngineManager object</span></span><br><span class="line">        <span class="type">ScriptEngineManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the JavaScript engine</span></span><br><span class="line">        <span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span> manager.getEngineByName(<span class="string">"javascript"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// Define a JavaScript function</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">"function add(a, b) { return a + b; }"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Execute the JavaScript function and get the result</span></span><br><span class="line">            engine.eval(script);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> engine.eval(<span class="string">"add(1, 2)"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Print the result</span></span><br><span class="line">            System.out.println(result);</span><br><span class="line">        } <span class="keyword">catch</span> (ScriptException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In this example, we define a JavaScript function called add that takes two arguments and returns their sum. Then we execute the function using the eval method of the ScriptEngine class and store the result in an Object variable. Finally, we print the result to the console.</p><p>In conclusion, the ScriptEngine class provided by the Java API allows us to execute JavaScript code and functions in Java. By leveraging the power of both languages, we can create more powerful and dynamic applications.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
            
        <tag> Java </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to make braised pork trotters</title>
      
      
      <link href="/posts/1037676127/"/>
      
      
      <url>/posts/1037676127/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>Braised pork trotters are a beloved dish in many Asian cuisines. It’s a rich, flavorful, and comforting dish that’s perfect for cold days or for any occasion. In this recipe, we’ll go through the steps of making a simple and delicious braised pork trotters dish.</p></blockquote><h1 id="Ingredients"><a href="#Ingredients" class="headerlink" title="Ingredients"></a>Ingredients</h1><ul><li>4 pork trotters</li><li>10g ginger slices</li><li>50ml Shaoxing wine</li><li>50ml light soy sauce</li><li>25ml dark soy sauce</li><li>20g rock sugar</li><li>2 star anise</li><li>1 piece cinnamon bark</li><li>2 bay leaves</li><li>Salt to taste</li><li>Water</li></ul><h1 id="Instructions"><a href="#Instructions" class="headerlink" title="Instructions"></a>Instructions</h1><ol><li>Clean the pork trotters: Rinse the pork trotters under cold water to remove any dirt or debris. Then, blanch the trotters in boiling water for a few minutes to get rid of any impurities. After that, rinse the trotters under cold water again.</li><li>Boil the pork trotters: In a large pot, add the pork trotters, ginger slices, and Shaoxing wine. Cover the trotters with enough water and bring it to a boil over high heat. Once the water boils, reduce the heat to low and let the pork trotters simmer for 10 minutes. Skim off any foam that rises to the surface.</li><li>Add the seasoning: Add the light soy sauce, dark soy sauce, rock sugar, star anise, cinnamon bark, and bay leaves. Stir the ingredients to combine, and bring the mixture to a boil again.</li><li>Simmer the pork trotters: Once the mixture boils, reduce the heat to low and let the pork trotters simmer for 2 hours, or until the meat is tender and falls off the bone. Add salt to taste.</li><li>Let the pork trotters cool: Turn off the heat and let the pork trotters cool in the pot. This will help them absorb more flavor.</li><li>Serve: Once the pork trotters are cool, remove them from the pot and place them on a plate. You can serve them with steamed rice or your favorite vegetables.</li></ol><h1 id="Tips-for-Making-Braised-Pork-Trotters"><a href="#Tips-for-Making-Braised-Pork-Trotters" class="headerlink" title="Tips for Making Braised Pork Trotters"></a>Tips for Making Braised Pork Trotters</h1><ul><li>For a richer and thicker sauce, you can add cornstarch or potato starch to the sauce.</li><li>You can also add other ingredients like garlic, scallions, or dried mushrooms to the pot for additional flavor.</li><li>If you don’t have Shaoxing wine, you can substitute it with dry sherry or rice wine.</li></ul><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Braised pork trotters are a classic dish that’s hearty, flavorful, and easy to make. This dish is perfect for any occasion, and it’s sure to impress your family and friends. Follow this recipe and enjoy a delicious and satisfying meal!</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Recipe </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Life </tag>
        
            
            
        <tag> Recipe </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Retrieve User Addresses in a Spring Boot Application</title>
      
      
      <link href="/posts/1268933518/"/>
      
      
      <url>/posts/1268933518/</url>
      
      
        
      <content type="html"><![CDATA[<p>When building a web application, it’s often necessary to retrieve the IP address of the user who is accessing the application. This information can be useful for various purposes, such as security, analytics, and customization. In this tutorial, we will explore how to retrieve both IPv4 and IPv6 addresses of a user in a Spring Boot application.</p><h2 id="Retrieving-User-IP-Address"><a href="#Retrieving-User-IP-Address" class="headerlink" title="Retrieving User IP Address"></a>Retrieving User IP Address</h2><p>In Spring Boot, we can retrieve the IP address of a user by injecting a <code>HttpServletRequest</code> object into our controller class and calling its <code>getRemoteAddr()</code> method. For example:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class UserController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private HttpServletRequest request;</span><br><span class="line"></span><br><span class="line">    @GetMapping("/user/ip")</span><br><span class="line">    public String getUserIP() {</span><br><span class="line">        String ipAddress = request.getRemoteAddr();</span><br><span class="line">        return ipAddress;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In the above code, we have injected a <code>HttpServletRequest</code> object using the <code>@Autowired</code> annotation and defined a <code>getUserIP()</code> method that returns the IP address of the user. The <code>getRemoteAddr()</code> method of the <code>HttpServletRequest</code> object returns the IP address of the client or the last proxy that sent the request.</p><p>However, this method may not always return the correct IP address. In some cases, the IP address may be the address of a proxy server or load balancer rather than the actual user’s IP address. To obtain the correct IP address, we can check for the <code>X-Forwarded-For</code> header, which is a standard header used by proxies to indicate the originating IP address of a client connecting to a web server through the proxy. Here’s an updated version of the code that checks for the <code>X-Forwarded-For</code> header:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/user/ip")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserIP</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">ipAddress</span> <span class="operator">=</span> request.getHeader(<span class="string">"X-Forwarded-For"</span>);</span><br><span class="line">        <span class="keyword">if</span> (ipAddress == <span class="literal">null</span> || ipAddress.isEmpty() || <span class="string">"unknown"</span>.equalsIgnoreCase(ipAddress)) {</span><br><span class="line">            ipAddress = request.getRemoteAddr();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ipAddress;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In the above code, we first check for the <code>X-Forwarded-For</code> header using the <code>getHeader()</code> method of the <code>HttpServletRequest</code> object. If the header is not present or its value is empty or “unknown”, we fall back to the <code>getRemoteAddr()</code> method to obtain the IP address.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Java Thread Context: How to Determine Whether You're in a Request Context</title>
      
      
      <link href="/posts/2685105031/"/>
      
      
      <url>/posts/2685105031/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>When developing Java web applications, it is often necessary to check whether the current thread is in a request context. A request context is a context that holds information about a single HTTP request and is typically used in web applications. In this blog post, we will explore how to determine whether the current thread is in a request context using Spring Framework’s <code>RequestContextHolder</code> class.</p><h2 id="The-RequestContextHolder-Class"><a href="#The-RequestContextHolder-Class" class="headerlink" title="The RequestContextHolder Class"></a>The RequestContextHolder Class</h2><p>The <code>RequestContextHolder</code> class is a utility class provided by Spring Framework that allows you to bind the current HTTP request and response to the current thread. It provides access to the current request and response objects and allows you to access request attributes.</p><h2 id="Checking-if-the-Current-Thread-is-in-a-Request-Context"><a href="#Checking-if-the-Current-Thread-is-in-a-Request-Context" class="headerlink" title="Checking if the Current Thread is in a Request Context"></a>Checking if the Current Thread is in a Request Context</h2><p>To check if the current thread is in a request context, we can use the <code>RequestContextHolder.getRequestAttributes()</code> method. This method returns the current request attributes associated with the current thread. If there are no request attributes associated with the current thread, it means that the current thread is not in a request context.</p><p>Here’s an example implementation of a <code>RequestContextChecker</code> class that uses <code>RequestContextHolder</code> to check if the current thread is in a request context:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestContextChecker</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isCurrentThreadInRequestContext</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">RequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="keyword">return</span> requestAttributes != <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In the code above, the <code>isCurrentThreadInRequestContext()</code> method calls <code>RequestContextHolder.getRequestAttributes()</code> to get the request attributes associated with the current thread. If there are request attributes associated with the current thread, the method returns <code>true</code>. Otherwise, it returns <code>false</code>.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this  post, we’ve seen how to check if the current thread is in a request context using Spring Framework’s <code>RequestContextHolder</code> class. By using <code>RequestContextHolder.getRequestAttributes()</code>, we can determine if the current thread is in a request context and take appropriate actions based on the result. It’s important to note that this method is only applicable to web applications that use Spring Framework. For other types of request contexts, you may need to use a different method to determine if the current thread is in a request context.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
            
        <tag> Trap </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Wireshark Basic Usage</title>
      
      
      <link href="/posts/20069/"/>
      
      
      <url>/posts/20069/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="一、Introduction"><a href="#一、Introduction" class="headerlink" title="一、Introduction"></a>一、Introduction</h2><p>Wireshark is currently one of the most widely used network packet analysis software in the world. The function of network packet analysis software is to listen to network packets and display the most detailed network packet information as much as possible. Wireshark uses Winpcap as the interface to directly exchange data packets with the network card.</p><p>The following figure shows the initial interface after successfully installing Winpcap and Wireshark:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608181205658.png" alt="image-20200608181205658"></p><p>In the initial interface of Wireshark, the fluctuating line represents the fluctuation of the information transmitted by the network card. Click the start icon in the upper left corner to enter the packet capture page shown in the following figure:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608181307861.png" alt="image-20200608181307861"></p><h2 id="二、Packet-Capture-and-Analysis"><a href="#二、Packet-Capture-and-Analysis" class="headerlink" title="二、Packet Capture and Analysis"></a>二、Packet Capture and Analysis</h2><p>This example demonstrates packet capture using the curl and ping commands.<br>Start capturing with Wireshark, and then, as shown in the following figure, use the curl and ping commands in the terminal to interact with the target address:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608173101731.png" alt="image-20200608173101731"></p><p>​                </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174203428.png" alt="image-20200608174203428"></p><blockquote><p> From the response packets of ping, we can see that we received 7 response packets. The IP address of Baidu here is 14.215.177.39.</p></blockquote><p>Returning to Wireshark, filter the packets by IP address in the filter, as shown in the following figure is the result of filtering the packets. The filter command is:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.addr ==14.215.177.39 </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608173431410.png" alt="image-20200608173431410"></p><h3 id="1-TCP-Three-Way-Handshake-Analysis"><a href="#1-TCP-Three-Way-Handshake-Analysis" class="headerlink" title="1.TCP Three-Way Handshake Analysis"></a>1.TCP Three-Way Handshake Analysis</h3><p>Viewing the packets, in the above figure, packets 1-3 are using the TCP protocol, and packet 4 is using the HTTP protocol, which is a clear sign of the TCP three-way handshake. The first three packets are the process of the TCP three-way handshake. The following figure shows the detailed packet contents of the TCP three-way handshake, which can be compared with the packet flag bits of the TCP three-way handshake.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/JSYW201709050_01100.jpg" alt="img"></p><h3 id="2-ICMP-Protocol-Analysis"><a href="#2-ICMP-Protocol-Analysis" class="headerlink" title="2.ICMP Protocol Analysis"></a>2.ICMP Protocol Analysis</h3><p>The ping command belongs to the ICMP protocol. Viewing the ICMP packets in the filtered packets, we can observe 14 packets. As mentioned earlier, 7 response packets were received for the ping destination address.</p><p>ICMP packets have two modes: request and response. See the following figure for details:：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174410800.png" alt="image-20200608174410800"></p><p><strong>The ICMP Request and Reply message formats are as follows:</strong></p><p>Request：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174514228.png" alt="image-20200608174514228"></p><p> Reply：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174532582.png" alt="image-20200608174532582"></p><blockquote><p>Type indicates the type of ICMP message, 8 for request messages and 0 for reply messages;</p><p>Code = 0;</p><p>CheckSum is the checksum from the ICMP header (starting with Type) to the end of the data (ending with the entire packet);</p><p>Identifier is the identifier set by the host, usually set to the process ID. The identifier in the response message is the same as the identifier in the original message;</p><p>Sequence Number is the sequence number set by the host, usually set to an increasing sequence starting from 0. The sequence number in the response message is the same as the sequence number in the original message;</p><p>Data is the data set by the host. The data in the response message is the same as the data in the original message;</p><p>Note: The Identifier and Sequence Number fields are divided into [BE] and [LE]. [BE] is for Linux content, and [LE] is for Windows content. Since this experiment was conducted in a Linux environment, only the [BE] content needs to be viewed.</p></blockquote><p>Request Message Header ：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174737348.png" alt="image-20200608174737348"></p><p>Reply Message Header：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174816396.png" alt="image-20200608174816396"></p><h2 id="三、Introduction-to-Wireshark-filters"><a href="#三、Introduction-to-Wireshark-filters" class="headerlink" title="三、Introduction to Wireshark filters"></a>三、Introduction to Wireshark filters</h2><p>One of the core features of Wireshark is the use of filters. There are three states for display filters: red, yellow, and green. Red means that the display filter expression is incorrect, yellow means that the filter expression can filter packets but may result in unpredictable results, and green means that the filter expression is correct.</p><p>Wireshark filters are divided into two types: display filters and capture filters. Display filters filter captured packets based on filtering rules, while capture filters only capture packets that meet the filtering rules that have been set in advance.</p><p><strong>Capture Filter：</strong></p><p>As shown in the following figure is the capture filter settings. ：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608175505369.png" alt="image-20200608175505369">  </p><p>The reason for setting a capture filter is to target situations where the network traffic is very large, such as several gigabytes per second, and most of the traffic is not the data that the analyst is interested in. In this case, a capture filter can be used to capture only the specified data. Useless data can not only interfere with analysis, but also waste storage space and copying time.</p><p><strong>Display filter：</strong></p><p>The following image shows the setting of a display filter ：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608175705185.png" alt="image-20200608175705185"></p><blockquote><p>Common syntax of display filters:</p><ol><li><p>Protocol filter, such as http, icmp, etc;</p></li><li><p>Filter by specific port: tcp.port eq 80, displays packets with port 80 whether it is a source or destination port. To filter by the source port, use tcp.srcport eq 80, and to filter by the destination port, use tcp.dstport eq 80;</p></li><li><p>Filter by source IP address: ip.src eq 192.168.1.107, and to filter by the destination, use ip.dst eq 192.168.1.107. To filter by both source and destination, use ip.addr eq 192.168.1.107. MAC address filtering follows the same logic;</p></li><li><p>Filter packets containing a specific string domain name, such as http.host contains “moe”;</p></li><li><p>Multiple filter conditions can be used together, for example, to simultaneously filter for http protocol and port 80, use http &amp;&amp; tcp.port == 80. Combination symbols include AND/&amp;&amp;, OR/||, and NOT/!;</p></li></ol><p>The syntax of capture filters is slightly different from display filters, and some examples are as follows:</p><ol><li>Filter by specific protocol: http</li><li>Filter by specific port: port 80</li><li>Filter by specific IP address: host 192.168.0.115</li><li>Filter by specific domain name: host <a href="http://www.example.com/">www.example.com</a></li></ol></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Information Security </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>The issue of SSL certificate being unable to issue due to the CNAME record pointing to Vercel affecting the CAA record.</title>
      
      
      <link href="/posts/3655275721/"/>
      
      
      <url>/posts/3655275721/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>The most drastic solution is to directly pause all DNS related to Vercel.<br>Or, first pause the resolution of the second-level domain to Vercel, that is, pause example.com-&gt;Vercel,<br>and then pause the Vercel of the affected subdomain, that is, pause a.example.com-&gt;Vercel.</p><h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>Today, Alibaba Cloud informed me that an SSL certificate for one of my domains was about to expire. As an experienced developer, I opened the Alibaba Cloud console to apply for a new certificate.</p><p>However, something strange happened. Previously, the certificate could be issued within a minute, but this time it took a long time and it still didn’t work. I decided to take a nap and try again later.</p><p>When I woke up and opened the Alibaba Cloud console, I found that it still wasn’t successful. At this point, I still suspected that it was Alibaba Cloud’s problem. So I applied again using Freessl, but it still wasn’t successful in the afternoon. The result of the test using <a href="https://myssl.com/">myssl.com</a> is as follows:</p><table><thead><tr><th align="left">Region</th><th align="left">Match</th></tr></thead><tbody><tr><td align="left">China</td><td align="left">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td></tr><tr><td align="left">Hong Kong</td><td align="left">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td></tr><tr><td align="left">United States</td><td align="left">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td></tr></tbody></table><p>I haven’t set up any CAA records! </p><p>I thought it couldn’t be a DNS cache issue, right?</p><p> But I still went to the Alibaba Cloud console to temporarily stop resolving all DNS records. As a result, it actually worked! After investigation, I found that the problem was caused by the CNAME record pointing to Vercel. How could Vercel have the permission to set CAA records for me?!</p><h3 id="Reason"><a href="#Reason" class="headerlink" title="Reason"></a>Reason</h3><p>After some searching, I finally figured out the reason, which was caused by the CAA record.</p><blockquote><p> CAA (Certificate Authority Authorization) is a new additional field that can be added to DNS records to create CAA resource records through DNS mechanism, which can limit the connection between the domain name issuing the certificate and the CA (certificate authority). Unauthorized third parties attempting to obtain SSL/TLS certificates for the domain name through other CAs will be rejected. By setting a CAA record for the domain name, website owners can authorize specific CAs to issue certificates for their domain name, thereby preventing HTTPS certificate errors and improving website security.</p></blockquote><p>An additional piece of knowledge is that CNAME records can affect CAA records：</p><p>CAA record checking continues for CNAME records pointing to a different domain. In this example, <a href="http://www.example.com/">www.example.com</a> points to <a href="http://www.example.net/">www.example.net</a>, which also has CAA records:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Example 7 / www.example.com)</span><br><span class="line">Domain   Record type  Flags  Tag      Value   </span><br><span class="line">www.example.com.   CNAME www.example.net</span><br><span class="line">www.example.net.   CAA           0      issue   ";"</span><br><span class="line"></span><br><span class="line">(Result: CAA failed)</span><br></pre></td></tr></tbody></table></figure><p>The first record redirects the CAA check to <a href="http://www.example.net/">www.example.net</a>. This CAA record can prevent any CA from issuing a certificate, so the certificate authority cannot issue a certificate for <a href="http://www.example.com/">www.example.com</a>.</p><p>If the domain being pointed to (<a href="http://www.example.net/">www.example.net</a>) does not have a CAA record, then the CAA record check will climb up to the parent domain (example.com).</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Example 8 / www.example.com)</span><br><span class="line">Domain   Record type  Flags  Tag      Value   </span><br><span class="line">www.example.com.   CNAME www.example.net</span><br><span class="line">example.com.   CAA           0      issue   "amazon.com"</span><br><span class="line"></span><br><span class="line">(Result: CAA passed)</span><br></pre></td></tr></tbody></table></figure><p>In plain language, it means that because we set a CNAME record to point to Vercel, and Vercel set a CAA record, it affected our domain’s CAA record. After using a tool to check, we confirmed that this was indeed the case.：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  "canIssue": false,</span><br><span class="line">  "status": "IssueMismatch",</span><br><span class="line">  "domain": "czqu.net",</span><br><span class="line">  "queryAt": "Sep 30, 2021 11:21:55 AM",</span><br><span class="line">  "elapsed": 1,</span><br><span class="line">  "caaRecordSet": [</span><br><span class="line">    {</span><br><span class="line">      "domain": "czqu.net",</span><br><span class="line">      "caaRecords": [</span><br><span class="line">        {</span><br><span class="line">          "issuerCritical": 0,</span><br><span class="line">          "tag": "issue",</span><br><span class="line">          "value": "letsencrypt.org",</span><br><span class="line">          "type": 257,</span><br><span class="line">          "dclass": 1,</span><br><span class="line">          "ttl": 60</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "issuerCritical": 0,</span><br><span class="line">          "tag": "issue",</span><br><span class="line">          "value": "globalsign.com",</span><br><span class="line">          "type": 257,</span><br><span class="line">          "dclass": 1,</span><br><span class="line">          "ttl": 60</span><br><span class="line">        }</span><br><span class="line">      ]</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
            
        <tag> Trap </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Fix Redmi Bluetooth Earphones with One-Sided Sound Issue</title>
      
      
      <link href="/posts/56389/"/>
      
      
      <url>/posts/56389/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p> If you’re experiencing an issue with your Bluetooth earphones where only one side has sound, you might have been searching for solutions online. Unfortunately, not all online advice is reliable. To help fellow users, I’m sharing my tested solution to this problem.</p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><ol><li><p>Unpair your earphones from your phone.</p></li><li><p>With both earphones turned on, press and hold the power button for 5 seconds until they turn off. Release the button once they turn off. (Both earphones’ lights should not be on during this process. Skip this step if your earphones are already turned off.)</p></li><li><p>Press and hold both earphones again. When the LED lights start flashing white, keep pressing until they flash red and white twice. (This step is crucial as it clears the previous configuration information on the earphones. Remember to unpair and turn off Bluetooth on your phone.)</p></li><li><p>Turn on the right earphone first and then the left. (Make sure the earphones are inside the charging case. Taking out the right earphone will automatically turn it on, so start with the right one first.)</p></li><li><p>The right earphone should start flashing quickly. When the left earphone stops flashing, the earphones are paired successfully.</p></li><li><p>Pair the earphones with your phone again through the Bluetooth settings.</p></li></ol><p>By following these steps, you should be able to fix the one-sided sound issue on your Redmi Bluetooth earphones.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Life Hacks </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Life Hacks </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>LeetCode 46. Permutations</title>
      
      
      <link href="/posts/3587124311/"/>
      
      
      <url>/posts/3587124311/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="Question"><a href="#Question" class="headerlink" title="Question:"></a>Question:</h1><p>Given an array <code>nums</code> of distinct integers, return <em>all the possible permutations</em>. You can return the answer in <strong>any order</strong>.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [1,2,3]</span><br><span class="line">Output: [[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [0,1]</span><br><span class="line">Output: [[0,1],[1,0]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [1]</span><br><span class="line">Output: [[1]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Constraints:</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 6</code></li><li><code>-10 &lt;= nums[i] &lt;= 10</code></li><li>All the integers of <code>nums</code> are <strong>unique</strong>.</li></ul><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution:"></a>Solution:</h1><p>Given an array of distinct integers nums, return all possible permutations of its elements. You can return the answer in any order.</p><p>Algorithm</p><p>The problem can be solved by recursively generating all permutations of the array. For a given array nums, the algorithm works as follows:</p><ul><li>If the length of nums is 1, return a list containing nums.</li><li>For each element in nums, generate all permutations of the remaining elements using recursion. This can be done by creating a new array without the current element, and calling the permutation function recursively with the new array.</li><li>For each permutation generated in step 2, add the current element to the beginning of the permutation.</li><li>Return the list of all permutations generated in step 3.</li></ul><p>Java Implementation</p><p>Here’s the Java implementation of the algorithm:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> {</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        permute(nums, <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length], <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">boolean</span>[] used, List&lt;Integer&gt; cur, List&lt;List&lt;Integer&gt;&gt; res)</span> {</span><br><span class="line">        <span class="keyword">if</span> (cur.size() == nums.length) {</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(cur));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) {</span><br><span class="line">            <span class="keyword">if</span> (!used[i]) {</span><br><span class="line">                cur.add(nums[i]);</span><br><span class="line">                used[i] = <span class="literal">true</span>;</span><br><span class="line">                permute(nums, used, cur, res);</span><br><span class="line">                cur.remove(cur.size() - <span class="number">1</span>);</span><br><span class="line">                used[i] = <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The permute() function takes an array nums, and returns a list of all permutations of its elements. The function uses a helper function permute() to generate the permutations recursively. The permute() function takes the following arguments:</p><ul><li>nums: the array of integers to be permuted</li><li>used: a boolean array indicating which elements of nums have already been used in the current permutation</li><li>cur: a list representing the current permutation being generated</li><li>res: the list of all permutations generated so far</li></ul><p>Python Implementation</p><p>Here’s the Python implementation of the algorithm:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">permute</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> [nums]</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            sub_res = <span class="variable language_">self</span>.permute(nums[:i] + nums[i+<span class="number">1</span>:])</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> sub_res:</span><br><span class="line">                res.append([nums[i]] + j)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></tbody></table></figure><p>The permute() function takes an array nums, and returns a list of all permutations of its elements. The function uses recursion to generate the permutations. The permute() function takes the following arguments:</p><ul><li>nums: the array of integers to be permuted</li></ul><p>Time Complexity</p><p>The time complexity of the algorithm is O(n!), where n is the length of the input array. This is because there are n! permutations of n distinct elements, and the algorithm generates each permutation once.</p><p>Space Complexity</p><p>The space complexity of the algorithm is O(n^2), where n is the length of the input array. This is because the algorithm generates n! permutations, each of which has length n. The algorithm uses additional space to store the list of permutations generated so far.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> LeetCode </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Java </tag>
        
            
            
        <tag> LeetCode </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Solutions to exercises and projects in the textbook C Programming: A Modern Approach, 2nd Edition</title>
      
      
      <link href="/posts/28638/"/>
      
      
      <url>/posts/28638/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="Chapter-2"><a href="#Chapter-2" class="headerlink" title="Chapter 2"></a>Chapter 2</h3><h4 id="Answers-to-Selected-Exercises"><a href="#Answers-to-Selected-Exercises" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] (a) The program contains one directive (<code>#include</code>) and four statements (three calls of <code>printf</code> and one <code>return</code>).</p><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Parkinson's Law:</span><br><span class="line">Work expands so as to fill the time</span><br><span class="line">available for its completion.</span><br></pre></td></tr></tbody></table></figure><p><strong>3.</strong> [was #4]</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int height = 8, length = 12, width = 10, volume;</span><br><span class="line"> </span><br><span class="line">  volume = height * length * width;</span><br><span class="line"> </span><br><span class="line">  printf("Dimensions: %dx%dx%d\n", length, width, height);</span><br><span class="line">  printf("Volume (cubic inches): %d\n", volume);</span><br><span class="line">  printf("Dimensional weight (pounds): %d\n", (volume + 165) / 166);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #6] Here’s one possible program:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, j, k;</span><br><span class="line">  float x, y, z;</span><br><span class="line"> </span><br><span class="line">  printf("Value of i: %d\n", i);</span><br><span class="line">  printf("Value of j: %d\n", j);</span><br><span class="line">  printf("Value of k: %d\n", k);</span><br><span class="line"> </span><br><span class="line">  printf("Value of x: %g\n", x);</span><br><span class="line">  printf("Value of y: %g\n", y);</span><br><span class="line">  printf("Value of z: %g\n", z);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>When compiled using GCC and then executed, this program produced the following output:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Value of i: 5618848</span><br><span class="line">Value of j: 0</span><br><span class="line">Value of k: 6844404</span><br><span class="line">Value of x: 3.98979e-34</span><br><span class="line">Value of y: 9.59105e-39</span><br><span class="line">Value of z: 9.59105e-39</span><br></pre></td></tr></tbody></table></figure><p>The values printed depend on many factors, so the chance that you’ll get exactly these numbers is small.</p><p><strong>5.</strong> [was #10] (a) is not legal because <code>100_bottles</code> begins with a digit.</p><p><strong>8.</strong> [was #12] There are 14 tokens: <code>a</code>, <code>=</code>, <code>(</code>, <code>3</code>, <code>*</code>, <code>q</code>, <code>-</code>, <code>p</code>, <code>*</code>, <code>p</code>, <code>)</code>, <code>/</code>, <code>3</code>, and <code>;</code>. </p><h4 id="Answers-to-Selected-Programming-Projects"><a href="#Answers-to-Selected-Programming-Projects" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>4.</strong> [was #8; modified]</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  float original_amount, amount_with_tax;</span><br><span class="line"> </span><br><span class="line">  printf("Enter an amount: ");</span><br><span class="line">  scanf("%f", &amp;original_amount);</span><br><span class="line">  amount_with_tax = original_amount * 1.05f;</span><br><span class="line">  printf("With tax added: $%.2f\n", amount_with_tax);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The <code>amount_with_tax</code> variable is unnecessary. If we remove it, the program is slightly shorter:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  float original_amount;</span><br><span class="line"> </span><br><span class="line">  printf("Enter an amount: ");</span><br><span class="line">  scanf("%f", &amp;original_amount);</span><br><span class="line">  printf("With tax added: $%.2f\n", original_amount * 1.05f);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>Chapter 3</strong></p><p><strong>Answers to Selected Exercises</strong></p><p><strong>2.</strong> [was #2] </p><p>(a) printf(“%-8.1e”, x);<br> (b) printf(“%10.6e”, x);<br> (c) printf(“%-8.3f”, x);<br> (d) printf(“%6.0f”, x); </p><p><strong>5.</strong> [was #8] The values of x, i, and y will be 12.3, 45, and .6, respectively.</p><p><strong>Answers to Selected Programming Projects</strong></p><p><strong>1.</strong> [was #4; modified] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int month, day, year;</p><p> printf(“Enter a date (mm/dd/yyyy): “);</p><p> scanf(“%d/%d/%d”, &amp;month, &amp;day, &amp;year);</p><p> printf(“You entered the date %d%.2d%.2d\n”, year, month, day);</p><p> return 0;</p><p>}</p><p><strong>3.</strong> [was #6; modified] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int prefix, group, publisher, item, check_digit;</p><p> printf(“Enter ISBN: “);</p><p> scanf(“%d-%d-%d-%d-%d”, &amp;prefix, &amp;group, &amp;publisher, &amp;item, &amp;check_digit);</p><p> printf(“GS1 prefix: %d\n”, prefix);</p><p> printf(“Group identifier: %d\n”, group);</p><p> printf(“Publisher code: %d\n”, publisher);</p><p> printf(“Item number: %d\n”, item);</p><p> printf(“Check digit: %d\n”, check_digit);</p><p> /* The five printf calls can be combined as follows:</p><p>   printf(“GS1 prefix: %d\nGroup identifier: %d\nPublisher code: %d\nItem number: %d\nCheck digit: %d\n”,</p><p>​      prefix, group, publisher, item, check_digit);</p><p> */</p><p> return 0;</p><p>}</p><p><strong>Chapter 4</strong></p><p><strong>Answers to Selected Exercises</strong></p><p><strong>2.</strong> [was #2] Not in C89. Suppose that i is 9 and j is 7. The value of (-i)/j could be either –1 or –2, depending on the implementation. On the other hand, the value of -(i/j) is always –1, regardless of the implementation. In C99, on the other hand, the value of (-i)/j must be equal to the value of -(i/j). </p><p><strong>9.</strong> [was #6] </p><p>(a) 63 8<br> (b) 3 2 1<br> (c) 2 -1 3<br> (d) 0 0 0 </p><p><strong>13.</strong> [was #8] The expression ++i is equivalent to (i += 1). The value of both expressions is i <em>after</em> the increment has been performed. </p><p><strong>Answers to Selected Programming Projects</strong></p><p><strong>2.</strong> [was #4] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int n;</p><p> printf(“Enter a three-digit number: “);</p><p> scanf(“%d”, &amp;n);</p><p> printf(“The reversal is: %d%d%d\n”, n % 10, (n / 10) % 10, n / 100);</p><p> return 0;</p><p>}</p><p><strong>Chapter 5</strong></p><p><strong>Answers to Selected Exercises</strong></p><p><strong>2.</strong> [was #2] </p><p>(a) 1<br> (b) 1<br> (c) 1<br> (d) 1 </p><p><strong>4.</strong> [was #4] (i &gt; j) - (i &lt; j)</p><p><strong>6.</strong> [was #12] Yes, the statement is legal. When n is equal to 5, it does nothing, since 5 is not equal to –9. </p><p><strong>10.</strong> [was #16] The output is </p><p>onetwo</p><p>since there are no break statements after the cases. </p><p><strong>Answers to Selected Programming Projects</strong></p><p><strong>2.</strong> [was #6] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int hours, minutes;</p><p> printf(“Enter a 24-hour time: “);</p><p> scanf(“%d:%d”, &amp;hours, &amp;minutes);</p><p> printf(“Equivalent 12-hour time: “);</p><p> if (hours == 0)</p><p>  printf(“12:%.2d AM\n”, minutes);</p><p> else if (hours &lt; 12)</p><p>  printf(“%d:%.2d AM\n”, hours, minutes);</p><p> else if (hours == 12)</p><p>  printf(“%d:%.2d PM\n”, hours, minutes);</p><p> else</p><p>  printf(“%d:%.2d PM\n”, hours - 12, minutes);</p><p> return 0;</p><p>}</p><p><strong>4.</strong> [was #8; modified] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int speed;</p><p> printf(“Enter a wind speed in knots: “);</p><p> scanf(“%d”, &amp;speed);</p><p> if (speed &lt; 1)</p><p>  printf(“Calm\n”);</p><p> else if (speed &lt;= 3)</p><p>  printf(“Light air\n”);</p><p> else if (speed &lt;= 27)</p><p>  printf(“Breeze\n”);</p><p> else if (speed &lt;= 47)</p><p>  printf(“Gale\n”);</p><p> else if (speed &lt;= 63)</p><p>  printf(“Storm\n”);</p><p> else</p><p>  printf(“Hurricane\n”);</p><p> return 0;</p><p>}</p><p><strong>6.</strong> [was #10] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int check_digit, d, i1, i2, i3, i4, i5, j1, j2, j3, j4, j5,</p><p>   first_sum, second_sum, total;</p><p> printf(“Enter the first (single) digit: “);</p><p> scanf(“%1d”, &amp;d);</p><p> printf(“Enter first group of five digits: “);</p><p> scanf(“%1d%1d%1d%1d%1d”, &amp;i1, &amp;i2, &amp;i3, &amp;i4, &amp;i5);</p><p> printf(“Enter second group of five digits: “);</p><p> scanf(“%1d%1d%1d%1d%1d”, &amp;j1, &amp;j2, &amp;j3, &amp;j4, &amp;j5);</p><p> printf(“Enter the last (single) digit: “);</p><p> scanf(“%1d”, &amp;check_digit);</p><p> first_sum = d + i2 + i4 + j1 + j3 + j5;</p><p> second_sum = i1 + i3 + i5 + j2 + j4;</p><p> total = 3 * first_sum + second_sum;</p><p> if (check_digit == 9 - ((total - 1) % 10))</p><p>  printf(“VALID\n”);</p><p> else</p><p>  printf(“NOT VALID\n”);</p><p> return 0;</p><p>}</p><p><strong>10.</strong> [was #14] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int grade;</p><p> printf(“Enter numerical grade: “);</p><p> scanf(“%d”, &amp;grade);</p><p> if (grade &lt; 0 || grade &gt; 100) {</p><p>  printf(“Illegal grade\n”);</p><p>  return 0;</p><p> }</p><p> switch (grade / 10) {</p><p>  case 10:</p><p>  case 9: printf(“Letter grade: A\n”);</p><p>​       break;</p><p>  case 8: printf(“Letter grade: B\n”);</p><p>​       break;</p><p>  case 7: printf(“Letter grade: C\n”);</p><p>​       break;</p><p>  case 6: printf(“Letter grade: D\n”);</p><p>​       break;</p><p>  case 5:</p><p>  case 4:</p><p>  case 3:</p><p>  case 2:</p><p>  case 1:</p><p>  case 0: printf(“Letter grade: F\n”);</p><p>​       break;</p><p> }</p><p> return 0;</p><p>}</p><h3 id="Chapter-6"><a href="#Chapter-6" class="headerlink" title="Chapter 6"></a>Chapter 6</h3><h4 id="Answers-to-Selected-Exercises-1"><a href="#Answers-to-Selected-Exercises-1" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>4.</strong> [was #10] (c) is not equivalent to (a) and (b), because <code>i</code> is incremented <em>before</em> the loop body is executed. </p><p><strong>10.</strong> [was #12] Consider the following <code>while</code> loop: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">while (…) {</span><br><span class="line">  …</span><br><span class="line">  continue;</span><br><span class="line">  …</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The equivalent code using <code>goto</code> would have the following appearance:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">while (…) {</span><br><span class="line">  …</span><br><span class="line">  goto loop_end;</span><br><span class="line">  …</span><br><span class="line">  loop_end: ;   /* null statement */</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>12.</strong> [was #14] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (d = 2; d * d &lt;= n; d++)</span><br><span class="line">  if (n % d == 0)</span><br><span class="line">    break;</span><br></pre></td></tr></tbody></table></figure><p>The <code>if</code> statement that follows the loop will need to be modified as well:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (d * d &lt;= n)</span><br><span class="line">  printf("%d is divisible by %d\n", n, d);</span><br><span class="line">else</span><br><span class="line">  printf("%d is prime\n", n);</span><br></pre></td></tr></tbody></table></figure><p><strong>14.</strong> [was #16] The problem is the semicolon at the end of the first line. If we remove it, the statement is now correct: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (n % 2 == 0)</span><br><span class="line">  printf("n is even\n");</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-1"><a href="#Answers-to-Selected-Programming-Projects-1" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>2.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int m, n, remainder;</span><br><span class="line"> </span><br><span class="line">  printf("Enter two integers: ");</span><br><span class="line">  scanf("%d%d", &amp;m, &amp;n);</span><br><span class="line"> </span><br><span class="line">  while (n != 0) {</span><br><span class="line">    remainder = m % n;</span><br><span class="line">    m = n;</span><br><span class="line">    n = remainder;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Greatest common divisor: %d\n", m);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  float commission, value;</span><br><span class="line"> </span><br><span class="line">  printf("Enter value of trade: ");</span><br><span class="line">  scanf("%f", &amp;value);</span><br><span class="line"> </span><br><span class="line">  while (value != 0.0f) {</span><br><span class="line">    if (value &lt; 2500.00f)</span><br><span class="line">      commission = 30.00f + .017f * value;</span><br><span class="line">    else if (value &lt; 6250.00f)</span><br><span class="line">      commission = 56.00f + .0066f * value;</span><br><span class="line">    else if (value &lt; 20000.00f)</span><br><span class="line">      commission = 76.00f + .0034f * value;</span><br><span class="line">    else if (value &lt; 50000.00f)</span><br><span class="line">      commission = 100.00f + .0022f * value;</span><br><span class="line">    else if (value &lt; 500000.00f)</span><br><span class="line">      commission = 155.00f + .0011f * value;</span><br><span class="line">    else</span><br><span class="line">      commission = 255.00f + .0009f * value;</span><br><span class="line"> </span><br><span class="line">    if (commission &lt; 39.00f)</span><br><span class="line">      commission = 39.00f;</span><br><span class="line"> </span><br><span class="line">    printf("Commission: $%.2f\n\n", commission);</span><br><span class="line"> </span><br><span class="line">    printf("Enter value of trade: ");</span><br><span class="line">    scanf("%f", &amp;value);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, n;</span><br><span class="line"> </span><br><span class="line">  printf("Enter limit on maximum square: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line"> </span><br><span class="line">  for (i = 2; i * i &lt;= n; i += 2)</span><br><span class="line">    printf("%d\n", i * i);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, n, start_day;</span><br><span class="line"> </span><br><span class="line">  printf("Enter number of days in month: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line">  printf("Enter starting day of the week (1=Sun, 7=Sat): ");</span><br><span class="line">  scanf("%d", &amp;start_day);</span><br><span class="line"> </span><br><span class="line">  /* print any leading "blank dates" */</span><br><span class="line">  for (i = 1; i &lt; start_day; i++)</span><br><span class="line">    printf("   ");</span><br><span class="line"> </span><br><span class="line">  /* now print the calendar */</span><br><span class="line">  for (i = 1; i &lt;= n; i++) {</span><br><span class="line">    printf("%3d", i);</span><br><span class="line">    if ((start_day + i - 1) % 7 == 0)</span><br><span class="line">      printf("\n");</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-7"><a href="#Chapter-7" class="headerlink" title="Chapter 7"></a>Chapter 7</h3><h4 id="Answers-to-Selected-Exercises-2"><a href="#Answers-to-Selected-Exercises-2" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>3.</strong> [was #4] (b) is not legal. </p><p><strong>4.</strong> [was #6] (d) is illegal, since <code>printf</code> requires a string, not a character, as its first argument. </p><p><strong>10.</strong> [was #14] <code>unsigned</code> <code>int</code>, because the <code>(int)</code> cast applies only to <code>j</code>, not <code>j</code> <code>*</code> <code>k</code>. </p><p><strong>12.</strong> [was #16] The value of <code>i</code> is converted to <code>float</code> and added to <code>f</code>, then the result is converted to <code>double</code> and stored in <code>d</code>. </p><p><strong>14.</strong> [was #18] No. Converting <code>f</code> to <code>int</code> will fail if the value stored in <code>f</code> exceeds the largest value of type <code>int</code>. </p><h4 id="Answers-to-Selected-Programming-Projects-2"><a href="#Answers-to-Selected-Programming-Projects-2" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #2] <code>short</code> <code>int</code> values are usually stored in 16 bits, causing failure at 182. <code>int</code> and <code>long</code> <code>int</code> values are usually stored in 32 bits, with failure occurring at 46341. </p><p><strong>2.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, n;</span><br><span class="line">  char ch;</span><br><span class="line"> </span><br><span class="line">  printf("This program prints a table of squares.\n");</span><br><span class="line">  printf("Enter number of entries in table: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line">  ch = getchar();</span><br><span class="line">    /* dispose of new-line character following number of entries */</span><br><span class="line">    /* could simply be getchar(); */</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt;= n; i++) {</span><br><span class="line">    printf("%10d%10d\n", i, i * i);</span><br><span class="line">    if (i % 24 == 0) {</span><br><span class="line">      printf("Press Enter to continue...");</span><br><span class="line">      ch = getchar();   /* or simply getchar(); */</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #10] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int sum = 0;</span><br><span class="line">  char ch;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a word: ");</span><br><span class="line"> </span><br><span class="line">  while ((ch = getchar()) != '\n')</span><br><span class="line">    switch (toupper(ch)) {</span><br><span class="line">      case 'D': case 'G':</span><br><span class="line">        sum += 2; break;</span><br><span class="line">      case 'B': case 'C': case 'M': case 'P':</span><br><span class="line">        sum += 3; break;</span><br><span class="line">      case 'F': case 'H': case 'V': case 'W': case 'Y':</span><br><span class="line">        sum += 4; break;</span><br><span class="line">      case 'K':</span><br><span class="line">        sum += 5; break;</span><br><span class="line">      case 'J': case 'X':</span><br><span class="line">        sum += 8; break;</span><br><span class="line">      case 'Q': case 'Z':</span><br><span class="line">        sum += 10; break;</span><br><span class="line">      default:</span><br><span class="line">        sum++; break;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  printf("Scrabble value: %d\n", sum);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #12] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  printf("Size of int: %d\n", (int) sizeof(int));</span><br><span class="line">  printf("Size of short: %d\n", (int) sizeof(short));</span><br><span class="line">  printf("Size of long: %d\n", (int) sizeof(long));</span><br><span class="line">  printf("Size of float: %d\n", (int) sizeof(float));</span><br><span class="line">  printf("Size of double: %d\n", (int) sizeof(double));</span><br><span class="line">  printf("Size of long double: %d\n", (int) sizeof(long double));</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Since the type of a <code>sizeof</code> expression may vary from one implementation to another, it’s necessary in C89 to cast <code>sizeof</code> expressions to a known type before printing them. The sizes of the basic types are small numbers, so it’s safe to cast them to <code>int</code>. (In general, however, it’s best to cast <code>sizeof</code> expressions to <code>unsigned</code> <code>long</code> and print them using <code>%lu</code>.) In C99, we can avoid the cast by using the <code>%zu</code> conversion specification.</p><h3 id="Chapter-8"><a href="#Chapter-8" class="headerlink" title="Chapter 8"></a>Chapter 8</h3><h4 id="Answers-to-Selected-Exercises-3"><a href="#Answers-to-Selected-Exercises-3" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>1.</strong> [was #4] The problem with <code>sizeof(a)</code> <code>/</code> <code>sizeof(</code><em>t</em><code>)</code> is that it can’t easily be checked for correctness by someone reading the program. (The reader would have to locate the declaration of <code>a</code> and make sure that its elements have type <em>t</em>.) </p><p><strong>2.</strong> [was #8] To use a digit <code>d</code> (in character form) as a subscript into the array <code>a</code>, we would write <code>a[d-'0']</code>. This assumes that digits have consecutive codes in the underlying character set, which is true of ASCII and other popular character sets. </p><p><strong>7.</strong> [was #10] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const int segments[10][7] = {{1, 1, 1, 1, 1, 1},</span><br><span class="line">                             {0, 1, 1},</span><br><span class="line">                             {1, 1, 0, 1, 1, 0, 1},</span><br><span class="line">                             {1, 1, 1, 1, 0, 0, 1},</span><br><span class="line">                             {0, 1, 1, 0, 0, 1, 1},</span><br><span class="line">                             {1, 0, 1, 1, 0, 1, 1},</span><br><span class="line">                             {1, 0, 1, 1, 1, 1, 1},</span><br><span class="line">                             {1, 1, 1},</span><br><span class="line">                             {1, 1, 1, 1, 1, 1, 1},</span><br><span class="line">                             {1, 1, 1, 1, 0, 1, 1}};</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-3"><a href="#Answers-to-Selected-Programming-Projects-3" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>2.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int digit_count[10] = {0};</span><br><span class="line">  int digit;</span><br><span class="line">  long n;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a number: ");</span><br><span class="line">  scanf("%ld", &amp;n);</span><br><span class="line"> </span><br><span class="line">  while (n &gt; 0) {</span><br><span class="line">    digit = n % 10;</span><br><span class="line">    digit_count[digit]++;</span><br><span class="line">    n /= 10;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf ("Digit:      ");</span><br><span class="line">  for (digit = 0; digit &lt;= 9; digit++)</span><br><span class="line">    printf("%3d", digit);</span><br><span class="line">  printf("\nOccurrences:");</span><br><span class="line">  for (digit = 0; digit &lt;= 9; digit++)</span><br><span class="line">    printf("%3d", digit_count[digit]);</span><br><span class="line">  printf("\n");</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_RATES ((int) (sizeof(value) / sizeof(value[0])))</span><br><span class="line">#define INITIAL_BALANCE 100.00</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, low_rate, month, num_years, year;</span><br><span class="line">  double value[5];</span><br><span class="line"> </span><br><span class="line">  printf("Enter interest rate: ");</span><br><span class="line">  scanf("%d", &amp;low_rate);</span><br><span class="line">  printf("Enter number of years: ");</span><br><span class="line">  scanf("%d", &amp;num_years);</span><br><span class="line"> </span><br><span class="line">  printf("\nYears");</span><br><span class="line">  for (i = 0; i &lt; NUM_RATES; i++) {</span><br><span class="line">    printf("%6d%%", low_rate + i);</span><br><span class="line">    value[i] = INITIAL_BALANCE;</span><br><span class="line">  }</span><br><span class="line">  printf("\n");</span><br><span class="line"> </span><br><span class="line">  for (year = 1; year &lt;= num_years; year++) {</span><br><span class="line">    printf("%3d    ", year);</span><br><span class="line">    for (i = 0; i &lt; NUM_RATES; i++) {</span><br><span class="line">      for (month = 1; month &lt;= 12; month++)</span><br><span class="line">        value[i] += ((double) (low_rate + i) / 12) / 100.0 * value[i];</span><br><span class="line">      printf("%7.2f", value[i]);</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #12] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_QUIZZES  5</span><br><span class="line">#define NUM_STUDENTS 5</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int grades[NUM_STUDENTS][NUM_QUIZZES];</span><br><span class="line">  int high, low, quiz, student, total;</span><br><span class="line"> </span><br><span class="line">  for (student = 0; student &lt; NUM_STUDENTS; student++) {</span><br><span class="line">    printf("Enter grades for student %d: ", student + 1);</span><br><span class="line">    for (quiz = 0; quiz &lt; NUM_QUIZZES; quiz++)</span><br><span class="line">      scanf("%d", &amp;grades[student][quiz]);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("\nStudent  Total  Average\n");</span><br><span class="line">  for (student = 0; student &lt; NUM_STUDENTS; student++) {</span><br><span class="line">    printf("%4d      ", student + 1);</span><br><span class="line">    total = 0;</span><br><span class="line">    for (quiz = 0; quiz &lt; NUM_QUIZZES; quiz++)</span><br><span class="line">      total += grades[student][quiz];</span><br><span class="line">    printf("%3d     %3d\n", total, total / NUM_QUIZZES);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("\nQuiz  Average  High  Low\n");</span><br><span class="line">  for (quiz = 0; quiz &lt; NUM_QUIZZES; quiz++) {</span><br><span class="line">    printf("%3d     ", quiz + 1);</span><br><span class="line">    total = 0;</span><br><span class="line">    high = 0;</span><br><span class="line">    low = 100;</span><br><span class="line">    for (student = 0; student &lt; NUM_STUDENTS; student++) {</span><br><span class="line">      total += grades[student][quiz];</span><br><span class="line">      if (grades[student][quiz] &gt; high)</span><br><span class="line">        high = grades[student][quiz];</span><br><span class="line">      if (grades[student][quiz] &lt; low)</span><br><span class="line">        low = grades[student][quiz];</span><br><span class="line">    }</span><br><span class="line">    printf("%3d    %3d   %3d\n", total / NUM_STUDENTS, high, low);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-9"><a href="#Chapter-9" class="headerlink" title="Chapter 9"></a>Chapter 9</h3><h4 id="Answers-to-Selected-Exercises-4"><a href="#Answers-to-Selected-Exercises-4" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int check(int x, int y, int n)</span><br><span class="line">{</span><br><span class="line">  return (x &gt;= 0 &amp;&amp; x &lt;= n - 1 &amp;&amp; y &gt;= 0 &amp;&amp; y &lt;= n - 1);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int day_of_year(int month, int day, int year)</span><br><span class="line">{</span><br><span class="line">  int num_days[] = {31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};</span><br><span class="line">  int day_count = 0, i;</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt; month; i++)</span><br><span class="line">    day_count += num_days[i-1];</span><br><span class="line"> </span><br><span class="line">  /* adjust for leap years, assuming they are divisible by 4 */</span><br><span class="line">  if (year % 4 == 0 &amp;&amp; month &gt; 2)</span><br><span class="line">    day_count++;</span><br><span class="line"> </span><br><span class="line">  return day_count + day;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Using the expression <code>year</code> <code>%</code> <code>4</code> <code>==</code> <code>0</code> to test for leap years is not completely correct. Centuries are special cases: if a year is a multiple of 100, then it must also be a multiple of 400 in order to be a leap year. The correct test is </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">year % 4 == 0 &amp;&amp; (year % 100 != 0 || year % 400 == 0)</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int digit(int n, int k)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt; k; i++)</span><br><span class="line">    n /= 10;</span><br><span class="line"> </span><br><span class="line">  return n % 10;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #8] (a) and (b) are valid prototypes. (c) is illegal, since it doesn’t specify the type of the parameter. (d) incorrectly specifies that <code>f</code> returns an <code>int</code> value in C89; in C99, omitting the return type is illegal. </p><p><strong>10.</strong> [was #10] </p><p>(a)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int largest(int a[], int n)</span><br><span class="line">{</span><br><span class="line">  int i, max = a[0];</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt; n; i++)</span><br><span class="line">    if (a[i] &gt; max)</span><br><span class="line">      max = a[i];</span><br><span class="line"> </span><br><span class="line">  return max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int average(int a[], int n)</span><br><span class="line">{</span><br><span class="line">  int i, avg = 0;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; n; i++)</span><br><span class="line">    avg += a[i];</span><br><span class="line"> </span><br><span class="line">  return avg / n;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int num_positive(int a[], int n)</span><br><span class="line">{</span><br><span class="line">  int i, count = 0;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; n; i++)</span><br><span class="line">    if (a[i] &gt; 0)</span><br><span class="line">      count++;</span><br><span class="line"> </span><br><span class="line">  return count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #12; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">double median(double x, double y, double z)</span><br><span class="line">{</span><br><span class="line">  double result;</span><br><span class="line"> </span><br><span class="line">  if (x &lt;= y)</span><br><span class="line">    if (y &lt;= z) result = y;</span><br><span class="line">    else if (x &lt;= z) result = z;</span><br><span class="line">    else result = x;</span><br><span class="line">  else {</span><br><span class="line">    if (z &lt;= y) result = y;</span><br><span class="line">    else if (x &lt;= z) result = x;</span><br><span class="line">    else result = z;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>17.</strong> [was #14] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int fact(int n)</span><br><span class="line">{</span><br><span class="line">  int i, result = 1;</span><br><span class="line"> </span><br><span class="line">  for (i = 2; i &lt;= n; i++)</span><br><span class="line">    result *= i;</span><br><span class="line"> </span><br><span class="line">  return result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>19.</strong> [was #16] The following program tests the <code>pb</code> function: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">void pb(int n);</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int n;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a number: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line"> </span><br><span class="line">  printf("Output of pb: ");</span><br><span class="line">  pb(n);</span><br><span class="line">  printf("\n");</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void pb(int n)</span><br><span class="line">{</span><br><span class="line">  if (n != 0) {</span><br><span class="line">    pb(n / 2);</span><br><span class="line">    putchar('0' + n % 2);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>pb</code> prints the binary representation of the argument <code>n</code>, assuming that <code>n</code> is greater than 0. (We also assume that digits have consecutive codes in the underlying character set.) For example: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Enter a number: 53</span><br><span class="line">Output of pb: 110101</span><br></pre></td></tr></tbody></table></figure><p>A trace of <code>pb</code>‘s execution would look like this: </p><p><code> pb(53)</code> finds that 53 is not equal to 0, so it calls<br> <code>  pb(26)</code>, which finds that 26 is not equal to 0, so it calls<br> <code>   pb(13)</code>, which finds that 13 is not equal to 0, so it calls<br> <code>    pb(6)</code>, which finds that 6 is not equal to 0, so it calls<br> <code>     pb(3)</code>, which finds that 3 is not equal to 0, so it calls<br> <code>      pb(1)</code>, which finds that 1 is not equal to 0, so it calls<br> <code>       pb(0)</code>, which finds that 0 <em>is</em> equal to 0, so it returns, causing<br> <code>      pb(1)</code> to print <code>1</code> and return, causing<br> <code>     pb(3)</code> to print <code>1</code> and return, causing<br> <code>    pb(6)</code> to print <code>0</code> and return, causing<br> <code>   pb(13)</code> to print <code>1</code> and return, causing<br> <code>  pb(26)</code> to print <code>0</code> and return, causing<br> <code> pb(53)</code> to print <code>1</code> and return. </p><h3 id="Chapter-10"><a href="#Chapter-10" class="headerlink" title="Chapter 10"></a>Chapter 10</h3><h4 id="Answers-to-Selected-Exercises-5"><a href="#Answers-to-Selected-Exercises-5" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>1.</strong> [was #2] (a) <code>a</code>, <code>b</code>, and <code>c</code> are visible.<br> (b) <code>a</code>, and <code>d</code> are visible.<br> (c) <code>a</code>, <code>d</code>, and <code>e</code> are visible.<br> (d) <code>a</code> and <code>f</code> are visible. </p><h4 id="Answers-to-Selected-Programming-Projects-4"><a href="#Answers-to-Selected-Programming-Projects-4" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>3.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_CARDS 5</span><br><span class="line">#define RANK 0</span><br><span class="line">#define SUIT 1</span><br><span class="line"> </span><br><span class="line">/* external variables */</span><br><span class="line">int hand[NUM_CARDS][2];</span><br><span class="line">/*    0    1</span><br><span class="line">    ____ ____</span><br><span class="line"> 0 |____|____|</span><br><span class="line"> 1 |____|____|</span><br><span class="line"> 2 |____|____|</span><br><span class="line"> 3 |____|____|</span><br><span class="line"> 4 |____|____|</span><br><span class="line">    rank suit</span><br><span class="line">*/</span><br><span class="line"> </span><br><span class="line">bool straight, flush, four, three;</span><br><span class="line">int pairs;   /* can be 0, 1, or 2 */</span><br><span class="line"> </span><br><span class="line">/* prototypes */</span><br><span class="line">void read_cards(void);</span><br><span class="line">void analyze_hand(void);</span><br><span class="line">void print_result(void);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Calls read_cards, analyze_hand, and print_result *</span><br><span class="line"> *       repeatedly.                                      *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  for (;;) {</span><br><span class="line">    read_cards();</span><br><span class="line">    analyze_hand();</span><br><span class="line">    print_result();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * read_cards: Reads the cards into the external variable *</span><br><span class="line"> *             hand; checks for bad cards and duplicate   *</span><br><span class="line"> *             cards.                                     *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void read_cards(void)</span><br><span class="line">{</span><br><span class="line">  char ch, rank_ch, suit_ch;</span><br><span class="line">  int i, rank, suit;</span><br><span class="line">  bool bad_card, duplicate_card;</span><br><span class="line">  int cards_read = 0;</span><br><span class="line"> </span><br><span class="line">  while (cards_read &lt; NUM_CARDS) {</span><br><span class="line">    bad_card = false;</span><br><span class="line"> </span><br><span class="line">    printf("Enter a card: ");</span><br><span class="line"> </span><br><span class="line">    rank_ch = getchar();</span><br><span class="line">    switch (rank_ch) {</span><br><span class="line">      case '0':           exit(EXIT_SUCCESS);</span><br><span class="line">      case '2':           rank = 0; break;</span><br><span class="line">      case '3':           rank = 1; break;</span><br><span class="line">      case '4':           rank = 2; break;</span><br><span class="line">      case '5':           rank = 3; break;</span><br><span class="line">      case '6':           rank = 4; break;</span><br><span class="line">      case '7':           rank = 5; break;</span><br><span class="line">      case '8':           rank = 6; break;</span><br><span class="line">      case '9':           rank = 7; break;</span><br><span class="line">      case 't': case 'T': rank = 8; break;</span><br><span class="line">      case 'j': case 'J': rank = 9; break;</span><br><span class="line">      case 'q': case 'Q': rank = 10; break;</span><br><span class="line">      case 'k': case 'K': rank = 11; break;</span><br><span class="line">      case 'a': case 'A': rank = 12; break;</span><br><span class="line">      default:            bad_card = true;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    suit_ch = getchar();</span><br><span class="line">    switch (suit_ch) {</span><br><span class="line">      case 'c': case 'C': suit = 0; break;</span><br><span class="line">      case 'd': case 'D': suit = 1; break;</span><br><span class="line">      case 'h': case 'H': suit = 2; break;</span><br><span class="line">      case 's': case 'S': suit = 3; break;</span><br><span class="line">      default:            bad_card = true;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    while ((ch = getchar()) != '\n')</span><br><span class="line">      if (ch != ' ') bad_card = true;</span><br><span class="line"> </span><br><span class="line">    if (bad_card) {</span><br><span class="line">      printf("Bad card; ignored.\n");</span><br><span class="line">      continue;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    duplicate_card = false;</span><br><span class="line">    for (i = 0; i &lt; cards_read; i++)</span><br><span class="line">      if (hand[i][RANK] == rank &amp;&amp; hand[i][SUIT] == suit) {</span><br><span class="line">        printf("Duplicate card; ignored.\n");</span><br><span class="line">        duplicate_card = true;</span><br><span class="line">        break;</span><br><span class="line">      }</span><br><span class="line"> </span><br><span class="line">    if (!duplicate_card) {</span><br><span class="line">      hand[cards_read][RANK] = rank;</span><br><span class="line">      hand[cards_read][SUIT] = suit;</span><br><span class="line">      cards_read++;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * analyze_hand: Determines whether the hand contains a   *</span><br><span class="line"> *               straight, a flush, four-of-a-kind,       *</span><br><span class="line"> *               and/or three-of-a-kind; determines the   *</span><br><span class="line"> *               number of pairs; stores the results into *</span><br><span class="line"> *               the external variables straight, flush,  *</span><br><span class="line"> *               four, three, and pairs.                  *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void analyze_hand(void)</span><br><span class="line">{</span><br><span class="line">  int rank, suit, card, pass, run;</span><br><span class="line"> </span><br><span class="line">  straight = true;</span><br><span class="line">  flush = true;</span><br><span class="line">  four = false;</span><br><span class="line">  three = false;</span><br><span class="line">  pairs = 0;</span><br><span class="line"> </span><br><span class="line">  /* sort cards by rank */</span><br><span class="line">  for (pass = 1; pass &lt; NUM_CARDS; pass++)</span><br><span class="line">    for (card = 0; card &lt; NUM_CARDS - pass; card++) {</span><br><span class="line">      rank = hand[card][RANK];</span><br><span class="line">      suit = hand[card][SUIT];</span><br><span class="line">      if (hand[card+1][RANK] &lt; rank) {</span><br><span class="line">        hand[card][RANK] = hand[card+1][RANK];</span><br><span class="line">        hand[card][SUIT] = hand[card+1][SUIT];</span><br><span class="line">        hand[card+1][RANK] = rank;</span><br><span class="line">        hand[card+1][SUIT] = suit;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  /* check for flush */</span><br><span class="line">  suit = hand[0][SUIT];</span><br><span class="line">  for (card = 1; card &lt; NUM_CARDS; card++)</span><br><span class="line">    if (hand[card][SUIT] != suit)</span><br><span class="line">      flush = false;</span><br><span class="line"> </span><br><span class="line">  /* check for straight */</span><br><span class="line">  for (card = 0; card &lt; NUM_CARDS - 1; card++)</span><br><span class="line">    if (hand[card][RANK] + 1 != hand[card+1][RANK])</span><br><span class="line">      straight = false;</span><br><span class="line"> </span><br><span class="line">  /* check for 4-of-a-kind, 3-of-a-kind, and pairs by</span><br><span class="line">     looking for "runs" of cards with identical ranks */</span><br><span class="line">  card = 0;</span><br><span class="line">  while (card &lt; NUM_CARDS) {</span><br><span class="line">    rank = hand[card][RANK];</span><br><span class="line">    run = 0;</span><br><span class="line">    do {</span><br><span class="line">      run++;</span><br><span class="line">      card++;</span><br><span class="line">    } while (card &lt; NUM_CARDS &amp;&amp; hand[card][RANK] == rank);</span><br><span class="line">    switch (run) {</span><br><span class="line">      case 2: pairs++;      break;</span><br><span class="line">      case 3: three = true; break;</span><br><span class="line">      case 4: four = true;  break;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print_result: Prints the classification of the hand,   *</span><br><span class="line"> *               based on the values of the external      *</span><br><span class="line"> *               variables straight, flush, four, three,  *</span><br><span class="line"> *               and pairs.                               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print_result(void)</span><br><span class="line">{</span><br><span class="line">  if (straight &amp;&amp; flush) printf("Straight flush");</span><br><span class="line">  else if (four)         printf("Four of a kind");</span><br><span class="line">  else if (three &amp;&amp;</span><br><span class="line">           pairs == 1)   printf("Full house");</span><br><span class="line">  else if (flush)        printf("Flush");</span><br><span class="line">  else if (straight)     printf("Straight");</span><br><span class="line">  else if (three)        printf("Three of a kind");</span><br><span class="line">  else if (pairs == 2)   printf("Two pairs");</span><br><span class="line">  else if (pairs == 1)   printf("Pair");</span><br><span class="line">  else                   printf("High card");</span><br><span class="line"> </span><br><span class="line">  printf("\n\n");</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_RANKS 13</span><br><span class="line">#define NUM_SUITS 4</span><br><span class="line">#define NUM_CARDS 5</span><br><span class="line"> </span><br><span class="line">/* external variables */</span><br><span class="line">int num_in_rank[NUM_RANKS];</span><br><span class="line">int num_in_suit[NUM_SUITS];</span><br><span class="line">bool straight, flush, four, three;</span><br><span class="line">int pairs;   /* can be 0, 1, or 2 */</span><br><span class="line"> </span><br><span class="line">/* prototypes */</span><br><span class="line">void read_cards(void);</span><br><span class="line">void analyze_hand(void);</span><br><span class="line">void print_result(void);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Calls read_cards, analyze_hand, and print_result *</span><br><span class="line"> *       repeatedly.                                      *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  for (;;) {</span><br><span class="line">    read_cards();</span><br><span class="line">    analyze_hand();</span><br><span class="line">    print_result();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * read_cards: Reads the cards into the external          *</span><br><span class="line"> *             variables num_in_rank and num_in_suit;     *</span><br><span class="line"> *             checks for bad cards and duplicate cards.  *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void read_cards(void)</span><br><span class="line">{</span><br><span class="line">  bool card_exists[NUM_RANKS][NUM_SUITS];</span><br><span class="line">  char ch, rank_ch, suit_ch;</span><br><span class="line">  int rank, suit;</span><br><span class="line">  bool bad_card;</span><br><span class="line">  int cards_read = 0;</span><br><span class="line"> </span><br><span class="line">  for (rank = 0; rank &lt; NUM_RANKS; rank++) {</span><br><span class="line">    num_in_rank[rank] = 0;</span><br><span class="line">    for (suit = 0; suit &lt; NUM_SUITS; suit++)</span><br><span class="line">      card_exists[rank][suit] = false;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  for (suit = 0; suit &lt; NUM_SUITS; suit++)</span><br><span class="line">    num_in_suit[suit] = 0;</span><br><span class="line"> </span><br><span class="line">  while (cards_read &lt; NUM_CARDS) {</span><br><span class="line">    bad_card = false;</span><br><span class="line"> </span><br><span class="line">    printf("Enter a card: ");</span><br><span class="line"> </span><br><span class="line">    rank_ch = getchar();</span><br><span class="line">    switch (rank_ch) {</span><br><span class="line">      case '0':           exit(EXIT_SUCCESS);</span><br><span class="line">      case '2':           rank = 0; break;</span><br><span class="line">      case '3':           rank = 1; break;</span><br><span class="line">      case '4':           rank = 2; break;</span><br><span class="line">      case '5':           rank = 3; break;</span><br><span class="line">      case '6':           rank = 4; break;</span><br><span class="line">      case '7':           rank = 5; break;</span><br><span class="line">      case '8':           rank = 6; break;</span><br><span class="line">      case '9':           rank = 7; break;</span><br><span class="line">      case 't': case 'T': rank = 8; break;</span><br><span class="line">      case 'j': case 'J': rank = 9; break;</span><br><span class="line">      case 'q': case 'Q': rank = 10; break;</span><br><span class="line">      case 'k': case 'K': rank = 11; break;</span><br><span class="line">      case 'a': case 'A': rank = 12; break;</span><br><span class="line">      default:            bad_card = true;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    suit_ch = getchar();</span><br><span class="line">    switch (suit_ch) {</span><br><span class="line">      case 'c': case 'C': suit = 0; break;</span><br><span class="line">      case 'd': case 'D': suit = 1; break;</span><br><span class="line">      case 'h': case 'H': suit = 2; break;</span><br><span class="line">      case 's': case 'S': suit = 3; break;</span><br><span class="line">      default:            bad_card = true;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    while ((ch = getchar()) != '\n')</span><br><span class="line">      if (ch != ' ') bad_card = true;</span><br><span class="line"> </span><br><span class="line">    if (bad_card)</span><br><span class="line">      printf("Bad card; ignored.\n");</span><br><span class="line">    else if (card_exists[rank][suit])</span><br><span class="line">      printf("Duplicate card; ignored.\n");</span><br><span class="line">    else {</span><br><span class="line">      num_in_rank[rank]++;</span><br><span class="line">      num_in_suit[suit]++;</span><br><span class="line">      card_exists[rank][suit] = true;</span><br><span class="line">      cards_read++;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * analyze_hand: Determines whether the hand contains a   *</span><br><span class="line"> *               straight, a flush, four-of-a-kind,       *</span><br><span class="line"> *               and/or three-of-a-kind; determines the   *</span><br><span class="line"> *               number of pairs; stores the results into *</span><br><span class="line"> *               the external variables straight, flush,  *</span><br><span class="line"> *               four, three, and pairs.                  *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void analyze_hand(void)</span><br><span class="line">{</span><br><span class="line">  int num_consec = 0;</span><br><span class="line">  int rank, suit;</span><br><span class="line"> </span><br><span class="line">  straight = false;</span><br><span class="line">  flush = false;</span><br><span class="line">  four = false;</span><br><span class="line">  three = false;</span><br><span class="line">  pairs = 0;</span><br><span class="line"> </span><br><span class="line">  /* check for flush */</span><br><span class="line">  for (suit = 0; suit &lt; NUM_SUITS; suit++)</span><br><span class="line">    if (num_in_suit[suit] == NUM_CARDS)</span><br><span class="line">      flush = true;</span><br><span class="line"> </span><br><span class="line">  /* check for straight */</span><br><span class="line">  rank = 0;</span><br><span class="line">  while (num_in_rank[rank] == 0) rank++;</span><br><span class="line">  for (; rank &lt; NUM_RANKS &amp;&amp; num_in_rank[rank] &gt; 0; rank++)</span><br><span class="line">    num_consec++;</span><br><span class="line">  if (num_consec == NUM_CARDS) {</span><br><span class="line">    straight = true;</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  /* check for ace-low straight */</span><br><span class="line">  if (num_consec == NUM_CARDS - 1 &amp;&amp;</span><br><span class="line">      num_in_rank[0] &gt; 0 &amp;&amp; num_in_rank[NUM_RANKS-1] &gt; 0) {</span><br><span class="line">    straight = true;</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  /* check for 4-of-a-kind, 3-of-a-kind, and pairs */</span><br><span class="line">  for (rank = 0; rank &lt; NUM_RANKS; rank++) {</span><br><span class="line">    if (num_in_rank[rank] == 4) four = true;</span><br><span class="line">    if (num_in_rank[rank] == 3) three = true;</span><br><span class="line">    if (num_in_rank[rank] == 2) pairs++;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print_result: Prints the classification of the hand,   *</span><br><span class="line"> *               based on the values of the external      *</span><br><span class="line"> *               variables straight, flush, four, three,  *</span><br><span class="line"> *               and pairs.                               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print_result(void)</span><br><span class="line">{</span><br><span class="line">  if (straight &amp;&amp; flush) printf("Straight flush");</span><br><span class="line">  else if (four)         printf("Four of a kind");</span><br><span class="line">  else if (three &amp;&amp;</span><br><span class="line">           pairs == 1)   printf("Full house");</span><br><span class="line">  else if (flush)        printf("Flush");</span><br><span class="line">  else if (straight)     printf("Straight");</span><br><span class="line">  else if (three)        printf("Three of a kind");</span><br><span class="line">  else if (pairs == 2)   printf("Two pairs");</span><br><span class="line">  else if (pairs == 1)   printf("Pair");</span><br><span class="line">  else                   printf("High card");</span><br><span class="line"> </span><br><span class="line">  printf("\n\n");</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-11"><a href="#Chapter-11" class="headerlink" title="Chapter 11"></a>Chapter 11</h3><h4 id="Answers-to-Selected-Exercises-6"><a href="#Answers-to-Selected-Exercises-6" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] (e), (f), and (i) are legal. (a) is illegal because <code>p</code> is a pointer to an integer and <code>i</code> is an integer. (b) is illegal because <code>*p</code> is an integer and <code>&amp;i</code> is a pointer to an integer. (c) is illegal because <code>&amp;p</code> is a pointer to a pointer to an integer and <code>q</code> is a pointer to an integer. (d) is illegal for reasons similar to (c). (g) is illegal because <code>p</code> is a pointer to an integer and <code>*q</code> is an integer. (h) is illegal because <code>*p</code> is an integer and <code>q</code> is a pointer to an integer. </p><p><strong>4.</strong> [was #4; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void swap(int *p, int *q)</span><br><span class="line">{</span><br><span class="line">  int temp;</span><br><span class="line"> </span><br><span class="line">  temp = *p;</span><br><span class="line">  *p = *q;</span><br><span class="line">  *q = temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">void find_two_largest(int a[], int n, int *largest,</span><br><span class="line">                      int *second_largest)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  if (a[0] &gt; a[1]) {</span><br><span class="line">    *largest = a[0];</span><br><span class="line">    *second_largest = a[1];</span><br><span class="line">  } else {</span><br><span class="line">    *largest = a[1];</span><br><span class="line">    *second_largest = a[0];</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  for (i = 2; i &lt; n; i++)</span><br><span class="line">    if (a[i] &gt; *largest) {</span><br><span class="line">      *second_largest = *largest;</span><br><span class="line">      *largest = a[i];</span><br><span class="line">    } else if (a[i] &gt; *second_largest)</span><br><span class="line">      *second_largest = a[i];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-12"><a href="#Chapter-12" class="headerlink" title="Chapter 12"></a>Chapter 12</h3><h4 id="Answers-to-Selected-Exercises-7"><a href="#Answers-to-Selected-Exercises-7" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] The statement is illegal because pointers cannot be added. Here’s a legal statement that has the desired effect: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">middle = low + (high - low) / 2;</span><br></pre></td></tr></tbody></table></figure><p>The value of <code>(high</code> <code>-</code> <code>low)</code> <code>/</code> <code>2</code> is an integer, not a pointer, so it can legally be added to <code>low</code>. </p><p><strong>4.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">int *top_ptr;</span><br><span class="line"> </span><br><span class="line">void make_empty(void)</span><br><span class="line">{</span><br><span class="line">  top_ptr = &amp;contents[0];</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_empty(void)</span><br><span class="line">{</span><br><span class="line">  return top_ptr == &amp;contents[0];</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_full(void)</span><br><span class="line">{</span><br><span class="line">  return top_ptr == &amp;contents[STACK_SIZE];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #10; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int sum_array(const int a[], int n)</span><br><span class="line">{</span><br><span class="line">  int *p, sum;</span><br><span class="line"> </span><br><span class="line">  sum = 0;</span><br><span class="line">  for (p = a; p &lt; a + n; p++)</span><br><span class="line">    sum += *p;</span><br><span class="line">  return sum;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>13.</strong> [was #12; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#define N 10</span><br><span class="line"> </span><br><span class="line">double ident[N][N], *p;</span><br><span class="line">int num_zeros = N;</span><br><span class="line"> </span><br><span class="line">for (p = &amp;ident[0][0]; p &lt;= &amp;ident[N-1][N-1]; p++)</span><br><span class="line">  if (num_zeros == N) {</span><br><span class="line">    *p = 1.0;</span><br><span class="line">    num_zeros = 0;</span><br><span class="line">  } else {</span><br><span class="line">    *p = 0.0;</span><br><span class="line">    num_zeros++;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #14] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int *p;</span><br><span class="line"> </span><br><span class="line">for (p = temperatures[i]; p &lt; temperatures[i] + 24; p++)</span><br><span class="line">  printf("%d ", *p);</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-5"><a href="#Answers-to-Selected-Programming-Projects-5" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #4] </p><p>(a)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define MSG_LEN 80     /* maximum length of message */</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char msg[MSG_LEN];</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a message: ");</span><br><span class="line">  for (i = 0; i &lt; MSG_LEN; i++) {</span><br><span class="line">    msg[i] = getchar();</span><br><span class="line">    if (msg[i] == '\n')</span><br><span class="line">      break;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Reversal is: ");</span><br><span class="line">  for (i--; i &gt;= 0; i--)</span><br><span class="line">    putchar(msg[i]);</span><br><span class="line">  putchar('\n');</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define MSG_LEN 80     /* maximum length of message */</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char msg[MSG_LEN], *p;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a message: ");</span><br><span class="line">  for (p = &amp;msg[0]; p &lt; &amp;msg[MSG_LEN]; p++) {</span><br><span class="line">    *p = getchar();</span><br><span class="line">    if (*p == '\n')</span><br><span class="line">      break;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Reversal is: ");</span><br><span class="line">  for (p--; p &gt;= &amp;msg[0]; p--)</span><br><span class="line">    putchar(*p);</span><br><span class="line">  putchar('\n');</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>3.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define MSG_LEN 80     /* maximum length of message */</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char msg[MSG_LEN], *p;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a message: ");</span><br><span class="line">  for (p = msg; p &lt; msg + MSG_LEN; p++) {</span><br><span class="line">    *p = getchar();</span><br><span class="line">    if (*p == '\n')</span><br><span class="line">      break;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Reversal is: ");</span><br><span class="line">  for (p--; p &gt;= msg; p--)</span><br><span class="line">    putchar(*p);</span><br><span class="line">  putchar('\n');</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-13"><a href="#Chapter-13" class="headerlink" title="Chapter 13"></a>Chapter 13</h3><h4 id="Answers-to-Selected-Exercises-8"><a href="#Answers-to-Selected-Exercises-8" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><p>(a) Illegal; <code>p</code> is not a character.<br> (b) Legal; output is <code>a</code>.<br> (c) Legal; output is <code>abc</code>.<br> (d) Illegal; <code>*p</code> is not a pointer. </p><p><strong>4.</strong> [was #4] </p><p>(a)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i = 0;</span><br><span class="line"> </span><br><span class="line">  while ((ch = getchar()) != '\n')</span><br><span class="line">    if (i == 0 &amp;&amp; isspace(ch))</span><br><span class="line">      ;   /* ignore */</span><br><span class="line">    else if (i &lt; n)</span><br><span class="line">      str[i++] = ch;</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i = 0;</span><br><span class="line"> </span><br><span class="line">  while (!isspace(ch = getchar()))</span><br><span class="line">    if (i &lt; n)</span><br><span class="line">      str[i++] = ch;</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i = 0;</span><br><span class="line"> </span><br><span class="line">  do {</span><br><span class="line">    ch = getchar();</span><br><span class="line">    if (i &lt; n)</span><br><span class="line">      str[i++] = ch;</span><br><span class="line">  } while (ch != '\n');</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(d)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">int read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; n; i++) {</span><br><span class="line">    ch = getchar();</span><br><span class="line">    if (ch == '\n')</span><br><span class="line">      break;</span><br><span class="line">    str[i] = ch;</span><br><span class="line">  }</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void censor(char s[])</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; s[i] != '\0'; i++)</span><br><span class="line">    if (s[i] == 'f' &amp;&amp; s[i+1] == 'o' &amp;&amp; s[i+2] =='o')</span><br><span class="line">      s[i] = s[i+1] = s[i+2] = 'x';</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Note that the short-circuit evaluation of <code>&amp;&amp;</code> prevents the <code>if</code> statement from testing characters that follow the null character. </p><p><strong>8.</strong> [was #10] <code>tired-or-wired?</code></p><p><strong>10.</strong> [was #12] The value of <code>q</code> is undefined, so the call of <code>strcpy</code> attempts to copy the string pointed to by <code>p</code> into some unknown area of memory. Exercise 2 in Chapter 17 discusses how to write this function correctly. </p><p><strong>15.</strong> [was #8] </p><p>(a) 3<br> (b) 0<br> (c) The length of the longest prefix of the string <code>s</code> that consists entirely of characters from the string <code>t</code>. Or, equivalently, the position of the first character in <code>s</code> that is not also in <code>t</code>.</p><p><strong>16.</strong> [was #16] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int count_spaces(const char *s)</span><br><span class="line">{</span><br><span class="line">  int count = 0;</span><br><span class="line"> </span><br><span class="line">  while (*s)</span><br><span class="line">    if (*s++ == ' ')</span><br><span class="line">      count++;</span><br><span class="line">  return count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-6"><a href="#Answers-to-Selected-Programming-Projects-6" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #14] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"> </span><br><span class="line">#define WORD_LEN 20</span><br><span class="line"> </span><br><span class="line">void read_line(char str[], int n);</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char smallest_word[WORD_LEN+1],</span><br><span class="line">       largest_word[WORD_LEN+1],</span><br><span class="line">       current_word[WORD_LEN+1];</span><br><span class="line"> </span><br><span class="line">  printf("Enter word: ");</span><br><span class="line">  read_line(current_word, WORD_LEN);</span><br><span class="line">  strcpy(smallest_word, strcpy(largest_word, current_word));</span><br><span class="line"> </span><br><span class="line">  while (strlen(current_word) != 4) {</span><br><span class="line">    printf("Enter word: ");</span><br><span class="line">    read_line(current_word, WORD_LEN);</span><br><span class="line">    if (strcmp(current_word, smallest_word) &lt; 0)</span><br><span class="line">      strcpy(smallest_word, current_word);</span><br><span class="line">    if (strcmp(current_word, largest_word) &gt; 0)</span><br><span class="line">      strcpy(largest_word, current_word);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("\nSmallest word: %s\n", smallest_word);</span><br><span class="line">  printf("Largest word: %s\n", largest_word);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i = 0;</span><br><span class="line"> </span><br><span class="line">  while ((ch = getchar()) != '\n')</span><br><span class="line">    if (i &lt; n)</span><br><span class="line">      str[i++] = ch;</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #18] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = argc - 1; i &gt; 0; i--)</span><br><span class="line">    printf("%s ", argv[i]);</span><br><span class="line">  printf("\n");</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #20] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_PLANETS 9</span><br><span class="line"> </span><br><span class="line">int string_equal(const char *s, const char *t);</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  char *planets[] = {"Mercury", "Venus", "Earth",</span><br><span class="line">                     "Mars", "Jupiter", "Saturn",</span><br><span class="line">                     "Uranus", "Neptune", "Pluto"};</span><br><span class="line">  int i, j;</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt; argc; i++) {</span><br><span class="line">    for (j = 0; j &lt; NUM_PLANETS; j++)</span><br><span class="line">      if (string_equal(argv[i], planets[j])) {</span><br><span class="line">        printf("%s is planet %d\n", argv[i], j + 1);</span><br><span class="line">        break;</span><br><span class="line">      }</span><br><span class="line">    if (j == NUM_PLANETS)</span><br><span class="line">      printf("%s is not a planet\n", argv[i]);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int string_equal(const char *s, const char *t)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; toupper(s[i]) == toupper(t[i]); i++)</span><br><span class="line">    if (s[i] == '\0')</span><br><span class="line">      return 1;</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-14"><a href="#Chapter-14" class="headerlink" title="Chapter 14"></a>Chapter 14</h3><h4 id="Answers-to-Selected-Exercises-9"><a href="#Answers-to-Selected-Exercises-9" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] <code>#define NELEMS(a) ((int) (sizeof(a) / sizeof(a[0])))</code> </p><p><strong>4.</strong> [was #4] </p><p>(a) One problem stems from the lack of parentheses around the replacement list. For example, the statement </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1/AVG(b, c);</span><br></pre></td></tr></tbody></table></figure><p>will be replaced by </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1/(b+c)/2;</span><br></pre></td></tr></tbody></table></figure><p>Even if we add the missing parentheses, though, the macro still has problems, because it needs parentheses around <code>x</code> and <code>y</code> in the replacement list. The preprocessor will turn the statement </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = AVG(b&lt;c, c&gt;d);</span><br></pre></td></tr></tbody></table></figure><p>into </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = ((b&lt;c+c&gt;d)/2);</span><br></pre></td></tr></tbody></table></figure><p>which is equivalent to </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = ((b&lt;(c+c)&gt;d)/2);</span><br></pre></td></tr></tbody></table></figure><p>Here’s the final (corrected) version of the macro: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define AVG(x,y) (((x)+(y))/2)</span><br></pre></td></tr></tbody></table></figure><p>(b) The problem is the lack of parentheses around the replacement list. For example, </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1/AREA(b, c);</span><br></pre></td></tr></tbody></table></figure><p>becomes </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1/(b)*(c);</span><br></pre></td></tr></tbody></table></figure><p>Here’s the corrected macro: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define AREA(x,y) ((x)*(y))</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #6] </p><p>(a) The call of <code>putchar</code> expands into the following statement: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putchar(('a'&lt;=(s[++i])&amp;&amp;(s[++i])&lt;='z'?(s[++i])-'a'+'A':(s[++i])));</span><br></pre></td></tr></tbody></table></figure><p>The character <code>a</code> is less than or equal to <code>s[1]</code> (which is <code>b</code>), yielding a true condition. The character <code>s[2]</code> (which is <code>c</code>) is less than or equal to <code>z</code>, which is also true. The value printed is <code>s[3]-'a'+'A'</code>, which is <code>D</code> (assuming that the character set is ASCII). </p><p>(b) The character <code>a</code> is not less than or equal to <code>s[1]</code> (which is <code>1</code>) so the test condition is false. The value printed is <code>s[2]</code>, which is <code>2</code>. </p><p><strong>7.</strong> [was #8] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">long long_max(long x, long y)</span><br><span class="line">{</span><br><span class="line">  return x &gt; y ? x : y;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The preprocessor would actually put all the tokens on one line, but this version is more readable. </p><p>(b) The problem with types such as <code>unsigned</code> <code>long</code> is that they require two words, which prevents <code>GENERIC_MAX</code> from creating the desired function name. For example, <code>GENERIC_MAX(unsigned</code> <code>long)</code> would expand into </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unsigned long unsigned long_max(unsigned long x, unsigned long y)</span><br><span class="line">{</span><br><span class="line">  return x &gt; y ? x : y;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c) To make <code>GENERIC_MAX</code> work with any basic type, use a type definition to rename the type: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef unsigned long ULONG;</span><br></pre></td></tr></tbody></table></figure><p>We can now write <code>GENERIC_MAX(ULONG)</code>. </p><p><strong>12.</strong> [was #10] (c) and (e) will fail, since <code>M</code> is defined. </p><p><strong>14.</strong> [was #12; modified] Here’s what the program will look like after preprocessing: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int a[= 10], i, j, k, m;</span><br><span class="line"> </span><br><span class="line">Blank line</span><br><span class="line">  i = j;</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line"> </span><br><span class="line">  i = 10 * j+1;</span><br><span class="line">  i = (x,y) x-y(j, k);</span><br><span class="line">  i = ((((j)*(j)))*(((j)*(j))));</span><br><span class="line">  i = (((j)*(j))*(j));</span><br><span class="line">  i = jk;</span><br><span class="line">  puts("i" "j");</span><br><span class="line"> </span><br><span class="line">Blank line</span><br><span class="line">  i = SQR(j);</span><br><span class="line">Blank line</span><br><span class="line">  i = (j);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Some preprocessors delete white-space characters at the beginning of a line, so your results may vary. Three lines will cause errors when the program is compiled. Two contain syntax errors: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int a[= 10], i, j, k, m;</span><br><span class="line">i = (x,y) x-y(j, k);</span><br></pre></td></tr></tbody></table></figure><p>The third refers to an undefined variable: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = jk;</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-15"><a href="#Chapter-15" class="headerlink" title="Chapter 15"></a>Chapter 15</h3><h4 id="Answers-to-Selected-Exercises-10"><a href="#Answers-to-Selected-Exercises-10" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] (b). Function definitions should not be put in a header file. If a function definition appears in a header file that is included by two (or more) source files, the program can’t be linked, since the linker will see two copies of the function. </p><p><strong>6.</strong> [was #8] </p><p>(a) <code>main.c</code>, <code>f1.c</code>, and <code>f2.c</code>.<br> (b) <code>f1.c</code> (assuming that <code>f1.h</code> is not affected by the change).<br> (c) <code>main.c</code>, <code>f1.c</code>, and <code>f2.c</code>, since all three include <code>f1.h</code>.<br> (d) <code>f1.c</code> and <code>f2.c</code>, since both include <code>f2.h</code>.</p><h3 id="Chapter-16"><a href="#Chapter-16" class="headerlink" title="Chapter 16"></a>Chapter 16</h3><h4 id="Answers-to-Selected-Exercises-11"><a href="#Answers-to-Selected-Exercises-11" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2; modified] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">struct {</span><br><span class="line">  double real, imaginary;</span><br><span class="line">} c1, c2, c3;</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">struct {</span><br><span class="line">  double real, imaginary;</span><br><span class="line">} c1 = {0.0, 1.0}, c2 = {1.0, 0.0}, c3;</span><br></pre></td></tr></tbody></table></figure><p>(c) Only one statement is necessary: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c1 = c2;</span><br></pre></td></tr></tbody></table></figure><p>(d) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c3.real = c1.real + c2.real;</span><br><span class="line">c3.imaginary = c1.imaginary + c2.imaginary;</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4; modified] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typedef struct {</span><br><span class="line">  double real, imaginary;</span><br><span class="line">} Complex;</span><br></pre></td></tr></tbody></table></figure><p>(b) <code>Complex c1, c2, c3;</code> </p><p>(c) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Complex make_complex(double real, double imaginary)</span><br><span class="line">{</span><br><span class="line">  Complex c;</span><br><span class="line"> </span><br><span class="line">  c.real = real;</span><br><span class="line">  c.imaginary = imaginary;</span><br><span class="line">  return c;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(d) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Complex add_complex(Complex c1, Complex c2)</span><br><span class="line">{</span><br><span class="line">  Complex c3;</span><br><span class="line"> </span><br><span class="line">  c3.real = c1.real + c2.real;</span><br><span class="line">  c3.imaginary = c1.imaginary + c2.imaginary;</span><br><span class="line">  return c3;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>11.</strong> [was #10; modified] The <code>a</code> member will occupy 8 bytes, the union <code>e</code> will take 8 bytes (the largest member, <code>c</code>, is 8 bytes long), and the array <code>f</code> will require 4 bytes, so the total space allocated for <code>s</code> will be 20 bytes. </p><p><strong>14.</strong> [was #12; modified] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">double area(struct shape s)</span><br><span class="line">{</span><br><span class="line">  if (s.shape_kind == RECTANGLE)</span><br><span class="line">    return s.u.rectangle.height * s.u.rectangle.width;</span><br><span class="line">  else</span><br><span class="line">    return 3.14159 * s.u.circle.radius * s.u.circle.radius;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct shape move(struct shape s, int x, int y)</span><br><span class="line">{</span><br><span class="line">  struct shape new_shape = s;</span><br><span class="line"> </span><br><span class="line">  new_shape.center.x += x;</span><br><span class="line">  new_shape.center.y += y;</span><br><span class="line">  return new_shape;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">struct shape scale(struct shape s, double c)</span><br><span class="line">{</span><br><span class="line">  struct shape new_shape = s;</span><br><span class="line"> </span><br><span class="line">  if (new_shape.shape_kind == RECTANGLE) {</span><br><span class="line">    new_shape.u.rectangle.height *= c;</span><br><span class="line">    new_shape.u.rectangle.width *= c;</span><br><span class="line">  } else</span><br><span class="line">    new_shape.u.circle.radius *= c;</span><br><span class="line"> </span><br><span class="line">  return new_shape;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #14] </p><p>(a) <code>enum week_days {MON, TUE, WED, THU, FRI, SAT, SUN};</code><br> (b) <code>typedef enum {MON, TUE, WED, THU, FRI, SAT, SUN} Week_days;</code> </p><p><strong>17.</strong> [was #16] All the statements are legal, since C allows integers and enumeration values to be mixed without restriction. Only (a), (d), and (e) are safe. (b) is not meaningful if <code>i</code> has a value other than 0 or 1. (c) will not yield a meaningful result if <code>b</code> has the value 1. </p><h4 id="Answers-to-Selected-Programming-Projects-7"><a href="#Answers-to-Selected-Programming-Projects-7" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #6; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define COUNTRY_COUNT \</span><br><span class="line">  ((int) (sizeof(country_codes) / sizeof(country_codes[0])))</span><br><span class="line"> </span><br><span class="line">struct dialing_code {</span><br><span class="line">  char *country;</span><br><span class="line">  int code;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">const struct dialing_code country_codes[] =</span><br><span class="line">  {{"Argentina",            54}, {"Bangladesh",      880},</span><br><span class="line">   {"Brazil",               55}, {"Burma (Myanmar)",  95},</span><br><span class="line">   {"China",                86}, {"Colombia",         57},</span><br><span class="line">   {"Congo, Dem. Rep. of", 243}, {"Egypt",            20},</span><br><span class="line">   {"Ethiopia",            251}, {"France",           33},</span><br><span class="line">   {"Germany",              49}, {"India",            91},</span><br><span class="line">   {"Indonesia",            62}, {"Iran",             98},</span><br><span class="line">   {"Italy",                39}, {"Japan",            81},</span><br><span class="line">   {"Mexico",               52}, {"Nigeria",         234},</span><br><span class="line">   {"Pakistan",             92}, {"Philippines",      63},</span><br><span class="line">   {"Poland",               48}, {"Russia",            7},</span><br><span class="line">   {"South Africa",         27}, {"South Korea",      82},</span><br><span class="line">   {"Spain",                34}, {"Sudan",           249},</span><br><span class="line">   {"Thailand",             66}, {"Turkey",           90},</span><br><span class="line">   {"Ukraine",             380}, {"United Kingdom",   44},</span><br><span class="line">   {"United States",         1}, {"Vietnam",          84}};</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int code, i;</span><br><span class="line"> </span><br><span class="line">  printf("Enter dialing code: ");</span><br><span class="line">  scanf("%d", &amp;code);</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; COUNTRY_COUNT; i++)</span><br><span class="line">    if (code == country_codes[i].code) {</span><br><span class="line">      printf("The country with dialing code %d is %s\n",</span><br><span class="line">             code, country_codes[i].country);</span><br><span class="line">      return 0;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  printf("No corresponding country found\n");</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>3.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include "readline.h"</span><br><span class="line"> </span><br><span class="line">#define NAME_LEN 25</span><br><span class="line">#define MAX_PARTS 100</span><br><span class="line"> </span><br><span class="line">struct part {</span><br><span class="line">  int number;</span><br><span class="line">  char name[NAME_LEN+1];</span><br><span class="line">  int on_hand;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">int find_part(int number, const struct part inv[], int np);</span><br><span class="line">void insert(struct part inv[], int *np);</span><br><span class="line">void search(const struct part inv[], int np);</span><br><span class="line">void update(struct part inv[], int np);</span><br><span class="line">void print(const struct part inv[], int np);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Prompts the user to enter an operation code,     *</span><br><span class="line"> *       then calls a function to perform the requested   *</span><br><span class="line"> *       action. Repeats until the user enters the        *</span><br><span class="line"> *       command 'q'. Prints an error message if the user *</span><br><span class="line"> *       enters an illegal code.                          *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char code;</span><br><span class="line">  struct part inventory[MAX_PARTS];</span><br><span class="line">  int num_parts = 0;</span><br><span class="line"> </span><br><span class="line">  for (;;) {</span><br><span class="line">    printf("Enter operation code: ");</span><br><span class="line">    scanf(" %c", &amp;code);</span><br><span class="line">    while (getchar() != '\n')   /* skips to end of line */</span><br><span class="line">      ;</span><br><span class="line">    switch (code) {</span><br><span class="line">      case 'i': insert(inventory, &amp;num_parts);</span><br><span class="line">                break;</span><br><span class="line">      case 's': search(inventory, num_parts);</span><br><span class="line">                break;</span><br><span class="line">      case 'u': update(inventory, num_parts);</span><br><span class="line">                break;</span><br><span class="line">      case 'p': print(inventory, num_parts);</span><br><span class="line">                break;</span><br><span class="line">      case 'q': return 0;</span><br><span class="line">      default:  printf("Illegal code\n");</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * find_part: Looks up a part number in the inv array.    *</span><br><span class="line"> *            Returns the array index if the part number  *</span><br><span class="line"> *            is found; otherwise, returns -1.            *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int find_part(int number, const struct part inv[], int np)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; np; i++)</span><br><span class="line">    if (inv[i].number == number)</span><br><span class="line">      return i;</span><br><span class="line">  return -1;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * insert: Prompts the user for information about a new   *</span><br><span class="line"> *         part and then inserts the part into the inv    *</span><br><span class="line"> *         array. Prints an error message and returns     *</span><br><span class="line"> *         prematurely if the part already exists or the  *</span><br><span class="line"> *         array is full.                                 *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void insert(struct part inv[], int *np)</span><br><span class="line">{</span><br><span class="line">  int part_number;</span><br><span class="line"> </span><br><span class="line">  if (*np == MAX_PARTS) {</span><br><span class="line">    printf("Database is full; can't add more parts.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;part_number);</span><br><span class="line">  if (find_part(part_number, inv, *np) &gt;= 0) {</span><br><span class="line">    printf("Part already exists.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  inv[*np].number = part_number;</span><br><span class="line">  printf("Enter part name: ");</span><br><span class="line">  read_line(inv[*np].name, NAME_LEN);</span><br><span class="line">  printf("Enter quantity on hand: ");</span><br><span class="line">  scanf("%d", &amp;inv[*np].on_hand);</span><br><span class="line">  (*np)++;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * search: Prompts the user to enter a part number, then  *</span><br><span class="line"> *         looks up the part in the inv array. If the     *</span><br><span class="line"> *         part exists, prints the name and quantity on   *</span><br><span class="line"> *         hand; if not, prints an error message.         *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void search(const struct part inv[], int np)</span><br><span class="line">{</span><br><span class="line">  int i, number;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number, inv, np);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Part name: %s\n", inv[i].name);</span><br><span class="line">    printf("Quantity on hand: %d\n", inv[i].on_hand);</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * update: Prompts the user to enter a part number.       *</span><br><span class="line"> *         Prints an error message if the part can't be   *</span><br><span class="line"> *         found in the inv array; otherwise, prompts the *</span><br><span class="line"> *         user to enter change in quantity on hand and   *</span><br><span class="line"> *         updates the array.                             *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void update(struct part inv[], int np)</span><br><span class="line">{</span><br><span class="line">  int i, number, change;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number, inv, np);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Enter change in quantity on hand: ");</span><br><span class="line">    scanf("%d", &amp;change);</span><br><span class="line">    inv[i].on_hand += change;</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print: Prints a listing of all parts in the inv array, *</span><br><span class="line"> *        showing the part number, part name, and         *</span><br><span class="line"> *        quantity on hand. Parts are printed in the      *</span><br><span class="line"> *        order in which they were entered into the       *</span><br><span class="line"> *        array.                                          *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print(const struct part inv[], int np)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  printf("Part Number   Part Name                  "</span><br><span class="line">         "Quantity on Hand\n");</span><br><span class="line">  for (i = 0; i &lt; np; i++)</span><br><span class="line">    printf("%7d       %-25s%11d\n", inv[i].number,</span><br><span class="line">           inv[i].name, inv[i].on_hand);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-17"><a href="#Chapter-17" class="headerlink" title="Chapter 17"></a>Chapter 17</h3><h4 id="Answers-to-Selected-Exercises-12"><a href="#Answers-to-Selected-Exercises-12" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">char *duplicate(const char *s)</span><br><span class="line">{</span><br><span class="line">  char *temp = malloc(strlen(s) + 1);</span><br><span class="line"> </span><br><span class="line">  if (temp == NULL)</span><br><span class="line">    return NULL;</span><br><span class="line"> </span><br><span class="line">  strcpy(temp, s);</span><br><span class="line">  return temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #6] (b) and (c) are legal. (a) is illegal because it tries to reference a member of <code>d</code> without mentioning <code>d</code>. (d) is illegal because it uses <code>-&gt;</code> instead of <code>.</code> to reference the <code>c</code> member of <code>d</code>.</p><p><strong>7.</strong> [was #8] The first call of <code>free</code> will release the space for the first node in the list, making <code>p</code> a dangling pointer. Executing <code>p</code> <code>=</code> <code>p-&gt;next</code> to advance to the next node will have an undefined effect. Here’s a correct way to write the loop, using a temporary pointer that points to the node being deleted: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct node *temp;</span><br><span class="line"> </span><br><span class="line">p = first;</span><br><span class="line">while (p != NULL) {</span><br><span class="line">  temp = p;</span><br><span class="line">  p = p-&gt;next;</span><br><span class="line">  free(temp);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #10; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "stack.h"</span><br><span class="line"> </span><br><span class="line">struct node {</span><br><span class="line">  int value;</span><br><span class="line">  struct node *next;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">struct node *top = NULL;</span><br><span class="line"> </span><br><span class="line">void make_empty(void)</span><br><span class="line">{</span><br><span class="line">  struct node *temp;</span><br><span class="line"> </span><br><span class="line">  while (top != NULL) {</span><br><span class="line">    temp = top;</span><br><span class="line">    top = top-&gt;next;</span><br><span class="line">    free(temp);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_empty(void)</span><br><span class="line">{</span><br><span class="line">  return top == NULL;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool push(int i)</span><br><span class="line">{</span><br><span class="line">  struct node *new_node;</span><br><span class="line"> </span><br><span class="line">  new_node = malloc(sizeof(struct node));</span><br><span class="line">  if (new_node == NULL)</span><br><span class="line">    return false;</span><br><span class="line"> </span><br><span class="line">  new_node-&gt;value = i;</span><br><span class="line">  new_node-&gt;next = top;</span><br><span class="line">  top = new_node;</span><br><span class="line"> </span><br><span class="line">  return true;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int pop(void)</span><br><span class="line">{</span><br><span class="line">  struct node *temp;</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  if (is_empty()) {</span><br><span class="line">    printf("*** Stack underflow; program terminated. ***\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  i = top-&gt;value;</span><br><span class="line">  temp = top;</span><br><span class="line">  top = top-&gt;next;</span><br><span class="line">  free(temp);</span><br><span class="line"> </span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #12] The output of the program is </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Answer: 3</span><br></pre></td></tr></tbody></table></figure><p>The program tests the values of <code>f2(0)</code>, <code>f2(1)</code>, <code>f2(2)</code>, and so on, stopping when <code>f2</code> returns zero. It then prints the argument that was passed to <code>f2</code> to make it return zero. </p><p><strong>17.</strong> [was #14] Assuming that <code>compare</code> is the name of the comparison function, the following call of <code>qsort</code> will sort the last 50 elements of <code>a</code>: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qsort(&amp;a[50], 50, sizeof(a[0]), compare);</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-8"><a href="#Answers-to-Selected-Programming-Projects-8" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "readline.h"</span><br><span class="line"> </span><br><span class="line">#define NAME_LEN 25</span><br><span class="line">#define INITIAL_PARTS 10</span><br><span class="line"> </span><br><span class="line">struct part {</span><br><span class="line">  int number;</span><br><span class="line">  char name[NAME_LEN+1];</span><br><span class="line">  int on_hand;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">struct part *inventory;</span><br><span class="line">int num_parts = 0;      /* number of parts currently stored */</span><br><span class="line">int max_parts = INITIAL_PARTS;   /* size of inventory array */</span><br><span class="line"> </span><br><span class="line">int find_part(int number);</span><br><span class="line">void insert(void);</span><br><span class="line">void search(void);</span><br><span class="line">void update(void);</span><br><span class="line">void print(void);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Prompts the user to enter an operation code,     *</span><br><span class="line"> *       then calls a function to perform the requested   *</span><br><span class="line"> *       action. Repeats until the user enters the        *</span><br><span class="line"> *       command 'q'. Prints an error message if the user *</span><br><span class="line"> *       enters an illegal code.                          *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char code;</span><br><span class="line"> </span><br><span class="line">  inventory = malloc(max_parts * sizeof(struct part));</span><br><span class="line">  if (inventory == NULL) {</span><br><span class="line">    printf("Can't allocate initial inventory space.\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  for (;;) {</span><br><span class="line">    printf("Enter operation code: ");</span><br><span class="line">    scanf(" %c", &amp;code);</span><br><span class="line">    while (getchar() != '\n')   /* skips to end of line */</span><br><span class="line">      ;</span><br><span class="line">    switch (code) {</span><br><span class="line">      case 'i': insert();</span><br><span class="line">                break;</span><br><span class="line">      case 's': search();</span><br><span class="line">                break;</span><br><span class="line">      case 'u': update();</span><br><span class="line">                break;</span><br><span class="line">      case 'p': print();</span><br><span class="line">                break;</span><br><span class="line">      case 'q': return 0;</span><br><span class="line">      default:  printf("Illegal code\n");</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * find_part: Looks up a part number in the inventory     *</span><br><span class="line"> *            array. Returns the array index if the part  *</span><br><span class="line"> *            number is found; otherwise, returns -1.     *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int find_part(int number)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; num_parts; i++)</span><br><span class="line">    if (inventory[i].number == number)</span><br><span class="line">      return i;</span><br><span class="line">  return -1;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * insert: Prompts the user for information about a new   *</span><br><span class="line"> *         part and then inserts the part into the        *</span><br><span class="line"> *         database. Prints an error message and returns  *</span><br><span class="line"> *         prematurely if the part already exists or the  *</span><br><span class="line"> *         database is full.                              *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void insert(void)</span><br><span class="line">{</span><br><span class="line">  int part_number;</span><br><span class="line">  struct part *temp;</span><br><span class="line"> </span><br><span class="line">  if (num_parts == max_parts) {</span><br><span class="line">    max_parts *= 2;</span><br><span class="line">    temp = realloc(inventory, max_parts * sizeof(struct part));</span><br><span class="line">    if (temp == NULL) {</span><br><span class="line">      printf("Insufficient memory; can't add more parts.\n");</span><br><span class="line">      return;</span><br><span class="line">    }</span><br><span class="line">    inventory = temp;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;part_number);</span><br><span class="line">  if (find_part(part_number) &gt;= 0) {</span><br><span class="line">    printf("Part already exists.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  inventory[num_parts].number = part_number;</span><br><span class="line">  printf("Enter part name: ");</span><br><span class="line">  read_line(inventory[num_parts].name, NAME_LEN);</span><br><span class="line">  printf("Enter quantity on hand: ");</span><br><span class="line">  scanf("%d", &amp;inventory[num_parts].on_hand);</span><br><span class="line">  num_parts++;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * search: Prompts the user to enter a part number, then  *</span><br><span class="line"> *         looks up the part in the database. If the part *</span><br><span class="line"> *         exists, prints the name and quantity on hand;  *</span><br><span class="line"> *         if not, prints an error message.               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void search(void)</span><br><span class="line">{</span><br><span class="line">  int i, number;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Part name: %s\n", inventory[i].name);</span><br><span class="line">    printf("Quantity on hand: %d\n", inventory[i].on_hand);</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * update: Prompts the user to enter a part number.       *</span><br><span class="line"> *         Prints an error message if the part doesn't    *</span><br><span class="line"> *         exist; otherwise, prompts the user to enter    *</span><br><span class="line"> *         change in quantity on hand and updates the     *</span><br><span class="line"> *         database.                                      *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void update(void)</span><br><span class="line">{</span><br><span class="line">  int i, number, change;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Enter change in quantity on hand: ");</span><br><span class="line">    scanf("%d", &amp;change);</span><br><span class="line">    inventory[i].on_hand += change;</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print: Prints a listing of all parts in the database,  *</span><br><span class="line"> *        showing the part number, part name, and         *</span><br><span class="line"> *        quantity on hand. Parts are printed in the      *</span><br><span class="line"> *        order in which they were entered into the       *</span><br><span class="line"> *        database.                                       *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print(void)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  printf("Part Number   Part Name                  "</span><br><span class="line">         "Quantity on Hand\n");</span><br><span class="line">  for (i = 0; i &lt; num_parts; i++)</span><br><span class="line">    printf("%7d       %-25s%11d\n", inventory[i].number,</span><br><span class="line">           inventory[i].name, inventory[i].on_hand);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>2.</strong> [was #16] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "readline.h"</span><br><span class="line"> </span><br><span class="line">#define NAME_LEN 25</span><br><span class="line">#define MAX_PARTS 100</span><br><span class="line"> </span><br><span class="line">struct part {</span><br><span class="line">  int number;</span><br><span class="line">  char name[NAME_LEN+1];</span><br><span class="line">  int on_hand;</span><br><span class="line">} inventory[MAX_PARTS];</span><br><span class="line"> </span><br><span class="line">int num_parts = 0;   /* number of parts currently stored */</span><br><span class="line"> </span><br><span class="line">int find_part(int number);</span><br><span class="line">void insert(void);</span><br><span class="line">void search(void);</span><br><span class="line">void update(void);</span><br><span class="line">void print(void);</span><br><span class="line">int compare_parts(const void *p, const void *q);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Prompts the user to enter an operation code,     *</span><br><span class="line"> *       then calls a function to perform the requested   *</span><br><span class="line"> *       action. Repeats until the user enters the        *</span><br><span class="line"> *       command 'q'. Prints an error message if the user *</span><br><span class="line"> *       enters an illegal code.                          *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char code;</span><br><span class="line"> </span><br><span class="line">  for (;;) {</span><br><span class="line">    printf("Enter operation code: ");</span><br><span class="line">    scanf(" %c", &amp;code);</span><br><span class="line">    while (getchar() != '\n')   /* skips to end of line */</span><br><span class="line">      ;</span><br><span class="line">    switch (code) {</span><br><span class="line">      case 'i': insert();</span><br><span class="line">                break;</span><br><span class="line">      case 's': search();</span><br><span class="line">                break;</span><br><span class="line">      case 'u': update();</span><br><span class="line">                break;</span><br><span class="line">      case 'p': print();</span><br><span class="line">                break;</span><br><span class="line">      case 'q': return 0;</span><br><span class="line">      default:  printf("Illegal code\n");</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * find_part: Looks up a part number in the inventory     *</span><br><span class="line"> *            array. Returns the array index if the part  *</span><br><span class="line"> *            number is found; otherwise, returns -1.     *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int find_part(int number)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; num_parts; i++)</span><br><span class="line">    if (inventory[i].number == number)</span><br><span class="line">      return i;</span><br><span class="line">  return -1;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * insert: Prompts the user for information about a new   *</span><br><span class="line"> *         part and then inserts the part into the        *</span><br><span class="line"> *         database. Prints an error message and returns  *</span><br><span class="line"> *         prematurely if the part already exists or the  *</span><br><span class="line"> *         database is full.                              *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void insert(void)</span><br><span class="line">{</span><br><span class="line">  int part_number;</span><br><span class="line"> </span><br><span class="line">  if (num_parts == MAX_PARTS) {</span><br><span class="line">    printf("Database is full; can't add more parts.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;part_number);</span><br><span class="line">  if (find_part(part_number) &gt;= 0) {</span><br><span class="line">    printf("Part already exists.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  inventory[num_parts].number = part_number;</span><br><span class="line">  printf("Enter part name: ");</span><br><span class="line">  read_line(inventory[num_parts].name, NAME_LEN);</span><br><span class="line">  printf("Enter quantity on hand: ");</span><br><span class="line">  scanf("%d", &amp;inventory[num_parts].on_hand);</span><br><span class="line">  num_parts++;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * search: Prompts the user to enter a part number, then  *</span><br><span class="line"> *         looks up the part in the database. If the part *</span><br><span class="line"> *         exists, prints the name and quantity on hand;  *</span><br><span class="line"> *         if not, prints an error message.               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void search(void)</span><br><span class="line">{</span><br><span class="line">  int i, number;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Part name: %s\n", inventory[i].name);</span><br><span class="line">    printf("Quantity on hand: %d\n", inventory[i].on_hand);</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * update: Prompts the user to enter a part number.       *</span><br><span class="line"> *         Prints an error message if the part doesn't    *</span><br><span class="line"> *         exist; otherwise, prompts the user to enter    *</span><br><span class="line"> *         change in quantity on hand and updates the     *</span><br><span class="line"> *         database.                                      *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void update(void)</span><br><span class="line">{</span><br><span class="line">  int i, number, change;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Enter change in quantity on hand: ");</span><br><span class="line">    scanf("%d", &amp;change);</span><br><span class="line">    inventory[i].on_hand += change;</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print: Sorts the inventory array by part number, then  *</span><br><span class="line"> *        prints a listing of all parts in the database,  *</span><br><span class="line"> *        showing the part number, part name, and         *</span><br><span class="line"> *        quantity on hand.                               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print(void)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  qsort(inventory, num_parts, sizeof(struct part), compare_parts);</span><br><span class="line">  printf("Part Number   Part Name                  "</span><br><span class="line">         "Quantity on Hand\n");</span><br><span class="line">  for (i = 0; i &lt; num_parts; i++)</span><br><span class="line">    printf("%7d       %-25s%11d\n", inventory[i].number,</span><br><span class="line">           inventory[i].name, inventory[i].on_hand);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int compare_parts(const void *p, const void *q)</span><br><span class="line">{</span><br><span class="line">  return ((struct part *) p)-&gt;number - ((struct part *) q)-&gt;number;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-18"><a href="#Chapter-18" class="headerlink" title="Chapter 18"></a>Chapter 18</h3><h4 id="Answers-to-Selected-Exercises-13"><a href="#Answers-to-Selected-Exercises-13" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><p>(a) <code>extern</code><br> (b) <code>static</code><br> (c) <code>extern</code> and <code>static</code> (when applied to a local variable) </p><p><strong>4.</strong> [was #4] If <code>f</code> has never been called previously, the value of <code>f(10)</code> will be 0. If <code>f</code> has been called five times previously, the value of <code>f(10)</code> will be 50, since <code>j</code> is incremented once per call. </p><p><strong>8.</strong> [was #6; modified] </p><p>(a) <code>x</code> is an array of ten pointers to functions. Each function takes an <code>int</code> argument and returns a character.<br> (b) <code>x</code> is a function that returns a pointer to an array of five integers.<br> (c) <code>x</code> is a function with no arguments that returns a pointer to a function with an <code>int</code> argument that returns a pointer to a <code>float</code> value.<br> (d) <code>x</code> is a function with two arguments. The first argument is an integer, and the second is a pointer to a function with an <code>int</code> argument and no return value. <code>x</code> returns a pointer to a function with an <code>int</code> argument and no return value. (Although this example may seem artificially complex, the <code>signal</code> function—part of the standard C library—has exactly this prototype. See p. 632 for a discussion of <code>signal</code>.)</p><p><strong>10.</strong> [was #8] </p><p>(a) <code>char *(*p)(char *);</code><br> (b) <code>void *f(struct t *p, long int n)(void);</code><br> (c) <code>void (*a[])(void) = {insert, search, update, print};</code><br> (d) <code>struct t (*b[10])(int, int);</code> </p><p><strong>13.</strong> [was #10] (a), (c), and (d) are legal. (b) is illegal; the initializer for a variable with static storage duration must be a constant expression, and <code>i</code> <code>*</code> <code>i</code> doesn’t qualify. </p><p><strong>15.</strong> [was #12] (a). Variables with static storage duration are initialized to zero by default; variables with automatic storage duration have no default initial value. </p><h3 id="Chapter-19"><a href="#Chapter-19" class="headerlink" title="Chapter 19"></a>Chapter 19</h3><h4 id="Answers-to-Selected-Exercises-14"><a href="#Answers-to-Selected-Exercises-14" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "stack.h"</span><br><span class="line"> </span><br><span class="line">#define PUBLIC  /* empty */</span><br><span class="line">#define PRIVATE static</span><br><span class="line"> </span><br><span class="line">struct node {</span><br><span class="line">  int data;</span><br><span class="line">  struct node *next;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">PRIVATE struct node *top = NULL;</span><br><span class="line"> </span><br><span class="line">PRIVATE void terminate(const char *message)</span><br><span class="line">{</span><br><span class="line">  printf("%s\n", message);</span><br><span class="line">  exit(EXIT_FAILURE);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC void make_empty(void)</span><br><span class="line">{</span><br><span class="line">  while (!is_empty())</span><br><span class="line">    pop();</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC bool is_empty(void)</span><br><span class="line">{</span><br><span class="line">  return top == NULL;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC bool is_full(void)</span><br><span class="line">{</span><br><span class="line">  return false;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC void push(int i)</span><br><span class="line">{</span><br><span class="line">  struct node *new_node = malloc(sizeof(struct node));</span><br><span class="line">  if (new_node == NULL)</span><br><span class="line">    terminate("Error in push: stack is full.");</span><br><span class="line"> </span><br><span class="line">  new_node-&gt;data = i;</span><br><span class="line">  new_node-&gt;next = top;</span><br><span class="line">  top = new_node;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC int pop(void)</span><br><span class="line">{</span><br><span class="line">  struct node *old_top;</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  if (is_empty())</span><br><span class="line">    terminate("Error in pop: stack is empty.");</span><br><span class="line"> </span><br><span class="line">  old_top = top;</span><br><span class="line">  i = top-&gt;data;</span><br><span class="line">  top = top-&gt;next;</span><br><span class="line">  free(old_top);</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4; modified] </p><p>(a) Contents of <code>stack.c</code> file: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "stack.h"</span><br><span class="line"> </span><br><span class="line">static void terminate(const char *message)</span><br><span class="line">{</span><br><span class="line">  printf("%s\n", message);</span><br><span class="line">  exit(EXIT_FAILURE);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void make_empty(Stack *s)</span><br><span class="line">{</span><br><span class="line">  s-&gt;top = 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_empty(const Stack *s)</span><br><span class="line">{</span><br><span class="line">  return s-&gt;top == 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_full(const Stack *s)</span><br><span class="line">{</span><br><span class="line">  return s-&gt;top == STACK_SIZE;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void push(Stack *s, int i)</span><br><span class="line">{</span><br><span class="line">  if (is_full(s))</span><br><span class="line">    terminate("Error in push: stack is full.");</span><br><span class="line">  s-&gt;contents[s-&gt;top++] = i;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int pop(Stack *s)</span><br><span class="line">{</span><br><span class="line">  if (is_empty(s))</span><br><span class="line">    terminate("Error in pop: stack is empty.");</span><br><span class="line">  return s-&gt;contents[--s-&gt;top];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) Contents of <code>stack.h</code> file: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#ifndef STACK_H</span><br><span class="line">#define STACK_H</span><br><span class="line"> </span><br><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line"> </span><br><span class="line">struct node {</span><br><span class="line">  int data;</span><br><span class="line">  struct node *next;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">typedef struct node *Stack;</span><br><span class="line"> </span><br><span class="line">void make_empty(Stack *s);</span><br><span class="line">bool is_empty(const Stack *s);</span><br><span class="line">bool is_full(const Stack *s);</span><br><span class="line">void push(Stack *s, int i);</span><br><span class="line">int pop(Stack *s);</span><br><span class="line"> </span><br><span class="line">#endif</span><br></pre></td></tr></tbody></table></figure><p>Contents of <code>stack.c</code> file: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "stack.h"</span><br><span class="line"> </span><br><span class="line">static void terminate(const char *message)</span><br><span class="line">{</span><br><span class="line">  printf("%s\n", message);</span><br><span class="line">  exit(EXIT_FAILURE);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void make_empty(Stack *s)</span><br><span class="line">{</span><br><span class="line">  while (!is_empty(s))</span><br><span class="line">    pop(s);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_empty(const Stack *s)</span><br><span class="line">{</span><br><span class="line">  return *s == NULL;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_full(const Stack *s)</span><br><span class="line">{</span><br><span class="line">  return false;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void push(Stack *s, int i)</span><br><span class="line">{</span><br><span class="line">  struct node *new_node = malloc(sizeof(struct node));</span><br><span class="line">  if (new_node == NULL)</span><br><span class="line">    terminate("Error in push: stack is full.");</span><br><span class="line"> </span><br><span class="line">  new_node-&gt;data = i;</span><br><span class="line">  new_node-&gt;next = *s;</span><br><span class="line">  *s = new_node;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int pop(Stack *s)</span><br><span class="line">{</span><br><span class="line">  struct node *old_top;</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  if (is_empty(s))</span><br><span class="line">    terminate("Error in pop: stack is empty.");</span><br><span class="line"> </span><br><span class="line">  old_top = *s;</span><br><span class="line">  i = (*s)-&gt;data;</span><br><span class="line">  *s = (*s)-&gt;next;</span><br><span class="line">  free(old_top);</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-20"><a href="#Chapter-20" class="headerlink" title="Chapter 20"></a>Chapter 20</h3><h4 id="Answers-to-Selected-Exercises-15"><a href="#Answers-to-Selected-Exercises-15" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] To toggle a bit in a variable <code>i</code>, apply the exclusive-or operator (<code>^</code>) to <code>i</code> and a mask with a 1 bit in the desired position, then store the result back into <code>i</code>. To toggle bit 4, for example, use the statement </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = i ^ 0x0010;</span><br></pre></td></tr></tbody></table></figure><p>or, more concisely, </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i ^= 0x0010;</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4] ``</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define MK_COLOR(r,g,b) ((long) (b) &lt;&lt; 16 | (g) &lt;&lt; 8 | (r))</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6; modified] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">unsigned short swap_bytes(unsigned short i);</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  unsigned short i;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a hexadecimal number (up to four digits): ");</span><br><span class="line">  scanf("%hx", &amp;i);</span><br><span class="line">  printf("Number with bytes swapped: %hx\n", swap_bytes(i));</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">unsigned short swap_bytes(unsigned short i)</span><br><span class="line">{</span><br><span class="line">  unsigned short high_byte = i &lt;&lt; 8;</span><br><span class="line">  unsigned short low_byte = i &gt;&gt; 8;</span><br><span class="line"> </span><br><span class="line">  return high_byte | low_byte;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unsigned short swap_bytes(unsigned short i)</span><br><span class="line">{</span><br><span class="line">  return i &lt;&lt; 8 | i &gt;&gt; 8;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #8] </p><p>(a) The value of <code>~0</code> is a number containing all 1 bits. Shifting this number to the left by <code>n</code> places yields a result of the form 1…10…0, where there are <code>n</code> 0 bits. Applying the <code>~</code> operator to that number yields a result of the form 0…01…1, where there are <code>n</code> 1 bits. </p><p>(b) It returns a bit-field within <code>i</code> of length <code>n</code> starting at position <code>m</code>. Positions are assumed to be numbered starting from the rightmost bit, which is position 0. </p><p><strong>14.</strong> [was #9] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct IEEE_float {</span><br><span class="line">  unsigned int fraction: 23;   /* members may need to be reversed */</span><br><span class="line">  unsigned int exponent: 8;</span><br><span class="line">  unsigned int sign: 1;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-21"><a href="#Chapter-21" class="headerlink" title="Chapter 21"></a>Chapter 21</h3><h4 id="Answers-to-Selected-Exercises-16"><a href="#Answers-to-Selected-Exercises-16" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>7.</strong> [was #4] </p><p>(a) <code>&lt;time.h&gt;</code><br> (b) <code>&lt;ctype.h&gt;</code><br> (c) <code>&lt;limits.h&gt;</code><br> (d) <code>&lt;math.h&gt;</code><br> (e) <code>&lt;limits.h&gt;</code><br> (f) <code>&lt;float.h&gt;</code><br> (g) <code>&lt;string.h&gt;</code><br> (h) <code>&lt;stdio.h&gt;</code> </p><h3 id="Chapter-22"><a href="#Chapter-22" class="headerlink" title="Chapter 22"></a>Chapter 22</h3><h4 id="Answers-to-Selected-Exercises-17"><a href="#Answers-to-Selected-Exercises-17" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><p>(a) <code>"rb+"</code><br> (b) <code>"a"</code><br> (c) <code>"rb"</code><br> (d) <code>"r"</code> </p><p><strong>4.</strong> [was #4] </p><p>(a) <code>00000083.736</code><br> (b) <code>00000029749.</code><br> (c) <code>001.0549e+09</code><br> (d) <code>002.3522e-05</code> </p><p><strong>6.</strong> [was #6] <code>printf(widget == 1 ? "%d widget" : "%d widgets", widget);</code> </p><p><strong>8.</strong> [was #8] No. The difference is that <code>"%1s"</code> will store a null character after it reads and stores a nonblank character; <code>" %c"</code> will store only the nonblank character. As a result, the two format strings must be used differently: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">char c, s[2];</span><br><span class="line"> </span><br><span class="line">scanf(" %c", &amp;c);  /* stores a nonblank character into c */</span><br><span class="line">scanf("%1s", s);   /* stores a nonblank character into s[0]</span><br><span class="line">                      and a null character into s[1] */</span><br><span class="line"> </span><br></pre></td></tr></tbody></table></figure><p><strong>10.</strong> [was #10] Revise the program’s <code>while</code> loop as follows: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">while ((ch = getc(source_fp)) != EOF)</span><br><span class="line">  if (putc(ch, dest_fp) == EOF) {</span><br><span class="line">    fprintf(stderr, "Error during writing; copy terminated\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p><strong>14.</strong> [was #18] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">char *fget_string(char *s, int n, FILE *stream)</span><br><span class="line">{</span><br><span class="line">  int ch, len = 0;</span><br><span class="line"> </span><br><span class="line">  while (len &lt; n - 1) {</span><br><span class="line">    if ((ch = getc(stream)) == EOF) {</span><br><span class="line">      if (len == 0 || ferror(stream))</span><br><span class="line">        return NULL;</span><br><span class="line">      break;</span><br><span class="line">    }</span><br><span class="line">    s[len++] = ch;</span><br><span class="line">    if (ch == '\n')</span><br><span class="line">      break;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  s[len] = '\0';</span><br><span class="line">  return s;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int fput_string(const char *s, FILE *stream)</span><br><span class="line">{</span><br><span class="line">  while (*s != '\0') {</span><br><span class="line">    if (putc(*s, stream) == EOF)</span><br><span class="line">      return EOF;</span><br><span class="line">    s++;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #22] </p><p>(a) <code>fseek(fp, n * 64L, SEEK_SET);</code><br> (b) <code>fseek(fp, -64L, SEEK_END);</code><br> (c) <code>fseek(fp, 64L, SEEK_CUR);</code><br> (d) <code>fseek(fp, -128L, SEEK_CUR);</code> </p><h4 id="Answers-to-Selected-Programming-Projects-9"><a href="#Answers-to-Selected-Programming-Projects-9" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>2.</strong> [was #12] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int ch;</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: toupper file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "r")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  while ((ch = getc(fp)) != EOF)</span><br><span class="line">    putchar(toupper(ch));</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #14] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int count = 0;</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: cntchar file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "r")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  while (getc(fp) != EOF)</span><br><span class="line">    count++;</span><br><span class="line"> </span><br><span class="line">  printf("There are %d characters in %s\n", count, argv[1]);</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int ch, count = 0;</span><br><span class="line">  bool in_word;</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: cntword file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "r")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  in_word = false;</span><br><span class="line">  while ((ch = getc(fp)) != EOF)</span><br><span class="line">    if (isspace(ch))</span><br><span class="line">      in_word = false;</span><br><span class="line">    else if (!in_word) {</span><br><span class="line">      in_word = true;</span><br><span class="line">      count++;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  printf("There are %d words in %s\n", count, argv[1]);</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int ch, count = 0;</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: cntline file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "r")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  while((ch = getc(fp)) != EOF)</span><br><span class="line">    if (ch == '\n')</span><br><span class="line">      count++;</span><br><span class="line"> </span><br><span class="line">  printf("There are %d lines in %s\n", count, argv[1]);</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #16; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int i, n, offset;</span><br><span class="line">  unsigned char buffer[10];</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: viewfile file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "rb")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Offset              Bytes              Characters\n");</span><br><span class="line">  printf("------  -----------------------------  ----------\n");</span><br><span class="line"> </span><br><span class="line">  for (offset = 0;; offset += 10) {</span><br><span class="line">    n = fread(buffer, 1, 10, fp);</span><br><span class="line">    if (n == 0)</span><br><span class="line">      break;</span><br><span class="line"> </span><br><span class="line">    printf("%6d  ", offset);</span><br><span class="line">    for (i = 0; i &lt; n; i++)</span><br><span class="line">      printf("%.2X ", buffer[i]);</span><br><span class="line">    for (; i &lt; 10; i++)</span><br><span class="line">      printf("   ");</span><br><span class="line">    printf(" ");</span><br><span class="line">    for (i = 0; i &lt; n; i++) {</span><br><span class="line">      if (!isprint(buffer[i]))</span><br><span class="line">        buffer[i] = '.';</span><br><span class="line">      printf("%c", buffer[i]);</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>9.</strong> [was #20] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NAME_LEN 25</span><br><span class="line"> </span><br><span class="line">struct part {</span><br><span class="line">  int number;</span><br><span class="line">  char name[NAME_LEN + 1];</span><br><span class="line">  int on_hand;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *in_fp1, *in_fp2, *out_fp;</span><br><span class="line">  int num_read1, num_read2;</span><br><span class="line">  struct part part1, part2;</span><br><span class="line"> </span><br><span class="line">  if (argc != 4) {</span><br><span class="line">    fprintf(stderr, "usage: merge infile1 infile2 outfile\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((in_fp1 = fopen(argv[1], "rb")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((in_fp2 = fopen(argv[2], "rb")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[2]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((out_fp = fopen(argv[3], "wb")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[3]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  num_read1 = fread(&amp;part1, sizeof(struct part), 1, in_fp1);</span><br><span class="line">  num_read2 = fread(&amp;part2, sizeof(struct part), 1, in_fp2);</span><br><span class="line">  while (num_read1 == 1 &amp;&amp; num_read2 == 1)</span><br><span class="line">    /* successfully read records from both files */</span><br><span class="line">    if (part1.number &lt; part2.number) {</span><br><span class="line">      fwrite(&amp;part1, sizeof(struct part), 1, out_fp);</span><br><span class="line">      num_read1 = fread(&amp;part1, sizeof(struct part), 1, in_fp1);</span><br><span class="line">    } else if (part1.number &gt; part2.number) {</span><br><span class="line">      fwrite(&amp;part2, sizeof(struct part), 1, out_fp);</span><br><span class="line">      num_read2 = fread(&amp;part2, sizeof(struct part), 1, in_fp2);</span><br><span class="line">    } else {</span><br><span class="line">      /* part numbers are equal */</span><br><span class="line">      if (strcmp(part1.name, part2.name) != 0)</span><br><span class="line">        fprintf(stderr,</span><br><span class="line">                "Names don't match for part %d; using the name %s\n",</span><br><span class="line">                part1.number, part1.name);</span><br><span class="line">      part1.on_hand += part2.on_hand;</span><br><span class="line">      fwrite(&amp;part1, sizeof(struct part), 1, out_fp);</span><br><span class="line">      num_read1 = fread(&amp;part1, sizeof(struct part), 1, in_fp1);</span><br><span class="line">      num_read2 = fread(&amp;part2, sizeof(struct part), 1, in_fp2);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  /* copy rest of file1 to output file */</span><br><span class="line">  while (num_read1 == 1) {</span><br><span class="line">    fwrite(&amp;part1, sizeof(struct part), 1, out_fp);</span><br><span class="line">    num_read1 = fread(&amp;part1, sizeof(struct part), 1, in_fp1);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  /* copy rest of file2 to output file */</span><br><span class="line">  while (num_read2 == 1) {</span><br><span class="line">    fwrite(&amp;part2, sizeof(struct part), 1, out_fp);</span><br><span class="line">    num_read2 = fread(&amp;part2, sizeof(struct part), 1, in_fp2);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  fclose(in_fp1);</span><br><span class="line">  fclose(in_fp2);</span><br><span class="line">  fclose(out_fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-23"><a href="#Chapter-23" class="headerlink" title="Chapter 23"></a>Chapter 23</h3><h4 id="Answers-to-Selected-Exercises-18"><a href="#Answers-to-Selected-Exercises-18" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>1.</strong> [was #2; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">double round_nearest(double x, int n)</span><br><span class="line">{</span><br><span class="line">  double power = pow(10.0, n);</span><br><span class="line"> </span><br><span class="line">  if (x &lt; 0.0)</span><br><span class="line">    return ceil(x * power - 0.5) / power;</span><br><span class="line">  else</span><br><span class="line">    return floor(x * power + 0.5) / power;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6] </p><p>(a) <code>memmove</code><br> (b) <code>memmove</code> (we can’t use <code>strcpy</code> because its behavior is undefined when the source of the copy overlaps with the destination)<br> (c) <code>strncpy</code><br> (d) <code>memcpy</code> </p><p><strong>8.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int numchar(const char *s, char ch)</span><br><span class="line">{</span><br><span class="line">  int count = 0;</span><br><span class="line"> </span><br><span class="line">  s = strchr(s, ch);</span><br><span class="line">  while (s != NULL) {</span><br><span class="line">    count++;</span><br><span class="line">    s = strchr(s + 1, ch);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>10.</strong> [was #10] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (strstr("foo#bar#baz", str) != NULL) …</span><br></pre></td></tr></tbody></table></figure><p>The assumptions are that <code>str</code> is at least three characters long and doesn’t contain the <code>#</code> character. </p><p><strong>11.</strong> [was #12] <code>memset(&amp;s[strlen(s)-n], '!', n);</code> </p><h4 id="Answers-to-Selected-Programming-Projects-10"><a href="#Answers-to-Selected-Programming-Projects-10" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>2.</strong> [was #4; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  bool nonblank_seen = false;</span><br><span class="line">  int ch;</span><br><span class="line"> </span><br><span class="line">  while ((ch = getchar()) != EOF) {</span><br><span class="line">    if (nonblank_seen)</span><br><span class="line">      putchar(ch);</span><br><span class="line">    else if (!isspace(ch)) {</span><br><span class="line">      nonblank_seen = true;</span><br><span class="line">      putchar(ch);</span><br><span class="line">    }</span><br><span class="line">    if (ch == '\n')</span><br><span class="line">      nonblank_seen = false;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-24"><a href="#Chapter-24" class="headerlink" title="Chapter 24"></a>Chapter 24</h3><h4 id="Answers-to-Selected-Exercises-19"><a href="#Answers-to-Selected-Exercises-19" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>4.</strong> [was #2] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">double try_math_fcn(double (*f)(double), double x, const char *msg)</span><br><span class="line">{</span><br><span class="line">  double result;</span><br><span class="line"> </span><br><span class="line">  errno = 0;</span><br><span class="line">  result = (*f)(x);</span><br><span class="line">  if (errno != 0) {</span><br><span class="line">    perror(msg);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line">  return result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define TRY_MATH_FCN(f,x) try_math_fcn(f, x, "Error in call of " #f)</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char code;</span><br><span class="line"> </span><br><span class="line">  for (;;) {</span><br><span class="line">    setjmp(env);</span><br><span class="line">    printf("Enter operation code: ");</span><br><span class="line">    scanf(" %c", &amp;code);</span><br><span class="line">    while (getchar() != '\n')   /* skips to end of line */</span><br><span class="line">      ;</span><br><span class="line">    switch (code) {</span><br><span class="line">      case 'i': insert();</span><br><span class="line">                break;</span><br><span class="line">      case 's': search();</span><br><span class="line">                break;</span><br><span class="line">      case 'u': update();</span><br><span class="line">                break;</span><br><span class="line">      case 'p': print();</span><br><span class="line">                break;</span><br><span class="line">      case 'q': return 0;</span><br><span class="line">      default:  printf("Illegal code\n");</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The <code>jmp_buf</code> variable <code>env</code> will need to be global, rather than local to <code>main</code>, so that the function performing the <code>longjmp</code> will be able to supply it as an argument.</p><h3 id="Chapter-25"><a href="#Chapter-25" class="headerlink" title="Chapter 25"></a>Chapter 25</h3><h4 id="Answers-to-Selected-Exercises-20"><a href="#Answers-to-Selected-Exercises-20" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>6.</strong> [was #4; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">while ((orig_char = getchar()) != EOF) ??&lt;</span><br><span class="line">  new_char = orig_char ??' KEY;</span><br><span class="line">  if (isprint(orig_char) &amp;&amp; isprint(new_char))</span><br><span class="line">    putchar(new_char);</span><br><span class="line">  else</span><br><span class="line">    putchar(orig_char);</span><br><span class="line">??&gt;</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-11"><a href="#Answers-to-Selected-Programming-Projects-11" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;locale.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char *temp, *C_locale;</span><br><span class="line"> </span><br><span class="line">  temp = setlocale(LC_ALL, NULL);</span><br><span class="line">    /* "C" is the current locale by default */</span><br><span class="line">  if (temp == NULL) {</span><br><span class="line">    printf("\"C\" locale information not available\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  C_locale = malloc(strlen(temp) + 1);</span><br><span class="line">  if (C_locale == NULL) {</span><br><span class="line">    printf("Can't allocate space to store locale information\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  strcpy(C_locale, temp);</span><br><span class="line"> </span><br><span class="line">  temp = setlocale(LC_ALL, "");</span><br><span class="line">  if (temp == NULL) {</span><br><span class="line">    printf("Native locale information not available\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if (strcmp(temp, C_locale) == 0)</span><br><span class="line">    printf("Native locale is the same as the \"C\" locale\n");</span><br><span class="line">  else</span><br><span class="line">    printf("Native locale is not the same as the \"C\" locale\n");</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-26"><a href="#Chapter-26" class="headerlink" title="Chapter 26"></a>Chapter 26</h3><h4 id="Answers-to-Selected-Exercises-21"><a href="#Answers-to-Selected-Exercises-21" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">void int_printf(const char *format, ...)</span><br><span class="line">{</span><br><span class="line">  va_list ap;</span><br><span class="line">  const char *p;</span><br><span class="line">  int digit, i, power, temp;</span><br><span class="line"> </span><br><span class="line">  va_start(ap, format);</span><br><span class="line"> </span><br><span class="line">  for (p = format; *p != '\0'; p++) {</span><br><span class="line">    if (*p != '%') {</span><br><span class="line">      putchar(*p);</span><br><span class="line">      continue;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    if (*++p == 'd') {</span><br><span class="line">      i = va_arg(ap, int);</span><br><span class="line">      if (i &lt; 0) {</span><br><span class="line">        i = -i;</span><br><span class="line">        putchar('-');</span><br><span class="line">      }</span><br><span class="line"> </span><br><span class="line">      temp = i;</span><br><span class="line">      power = 1;</span><br><span class="line">      while (temp &gt; 9) {</span><br><span class="line">        temp /= 10;</span><br><span class="line">        power *= 10;</span><br><span class="line">      }</span><br><span class="line"> </span><br><span class="line">      do {</span><br><span class="line">        digit = i / power;</span><br><span class="line">        putchar(digit + '0');</span><br><span class="line">        i -= digit * power;</span><br><span class="line">        power /= 10;</span><br><span class="line">      } while (i &gt; 0);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  va_end(ap);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>7.</strong> [was #4] The statement converts the string that <code>p</code> points to into a long integer, storing the result in <code>value</code>. <code>p</code> is left pointing to the first character not included in the conversion. The base used for the conversion is 10. </p><p><strong>9.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">double rand_double(void)</span><br><span class="line">{</span><br><span class="line">  return (double) rand() / (RAND_MAX + 1);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-12"><a href="#Answers-to-Selected-Programming-Projects-12" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #8] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int count = 1000;</span><br><span class="line"> </span><br><span class="line">  while (count-- &gt; 0)</span><br><span class="line">    printf("%d", rand() &amp; 1);</span><br><span class="line">  printf("\n");</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) For generating numbers in the range 0 to <code>N</code> <code>-</code> <code>1</code>, the formula <code>rand()</code> <code>/</code> <code>(RAND_MAX</code> <code>/</code> <code>N</code> <code>+</code> <code>1)</code> often gives better results than <code>rand()</code> <code>%</code> <code>N</code>. For example, if <code>N</code> is 2 and <code>RAND_MAX</code> is 32767, the formula works out to <code>rand()</code> <code>/</code> 16384, which yields 0 if the return value of <code>rand</code> is less than 16384 and 1 if it’s greater than or equal to 16384. </p><p><strong>3.</strong> [was #10; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">#define N 1000</span><br><span class="line"> </span><br><span class="line">int compare_ints(const void *p, const void *q);</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int a[N], i;</span><br><span class="line">  clock_t start_clock;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; N; i++)</span><br><span class="line">    a[i] = N - i;</span><br><span class="line"> </span><br><span class="line">  start_clock = clock();</span><br><span class="line">  qsort(a, N, sizeof(a[0]), compare_ints);</span><br><span class="line"> </span><br><span class="line">  printf("Time used to sort %d integers: %g sec.\n", N,</span><br><span class="line">         (clock() - start_clock) / (double) CLOCKS_PER_SEC);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int compare_ints(const void *p, const void *q)</span><br><span class="line">{</span><br><span class="line">  return *(int *)p - *(int *)q;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #12] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  struct tm t;</span><br><span class="line">  int n;</span><br><span class="line"> </span><br><span class="line">  /* initialize unused members */</span><br><span class="line">  t.tm_sec = t.tm_min = t.tm_hour = 0;</span><br><span class="line">  t.tm_isdst = -1;</span><br><span class="line"> </span><br><span class="line">  printf("Enter month (1-12): ");</span><br><span class="line">  scanf("%d", &amp;t.tm_mon);</span><br><span class="line">  t.tm_mon--;</span><br><span class="line"> </span><br><span class="line">  printf("Enter day (1-31): ");</span><br><span class="line">  scanf("%d", &amp;t.tm_mday);</span><br><span class="line"> </span><br><span class="line">  printf("Enter year: ");</span><br><span class="line">  scanf("%d", &amp;t.tm_year);</span><br><span class="line">  t.tm_year -= 1900;</span><br><span class="line"> </span><br><span class="line">  printf("Enter number of days in future: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line"> </span><br><span class="line">  t.tm_mday += n;</span><br><span class="line">  mktime(&amp;t);</span><br><span class="line">  printf("\nFuture date: %d/%d/%d\n",</span><br><span class="line">         t.tm_mon + 1, t.tm_mday, t.tm_year + 1900);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #14] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  time_t current = time(NULL);</span><br><span class="line">  struct tm *ptr;</span><br><span class="line">  char date_time[37];</span><br><span class="line"> </span><br><span class="line">  ptr = localtime(&amp;current);</span><br><span class="line">  strftime(date_time, sizeof(date_time), "%A, %B %d, %Y  %I:%M", ptr);</span><br><span class="line">  printf("%s%c\n", date_time, ptr-&gt;tm_hour &lt;= 11 ? 'a' : 'p');</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  time_t current = time(NULL);</span><br><span class="line">  char date_time[22];</span><br><span class="line"> </span><br><span class="line">  strftime(date_time, sizeof(date_time), "%a, %d %b %y  %H:%M",</span><br><span class="line">           localtime(&amp;current));</span><br><span class="line">  puts(date_time);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  time_t current = time(NULL);</span><br><span class="line">  struct tm *ptr;</span><br><span class="line">  char date[9], time[12];</span><br><span class="line"> </span><br><span class="line">  ptr = localtime(&amp;current);</span><br><span class="line">  strftime(date, sizeof(date), "%m/%d/%y", ptr);</span><br><span class="line">  strftime(time, sizeof(time), "%I:%M:%S %p", ptr);</span><br><span class="line"> </span><br><span class="line">  /* print date and time, suppressing leading zero in hours */</span><br><span class="line">  printf("%s  %s\n", date, time[0] == '0' ? &amp;time[1] : time);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> C </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>远程解锁模块 API 文档</title>
      
      
      <link href="/cn/posts/2167915263/"/>
      
      
      <url>/cn/posts/2167915263/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="远程解锁模块-API-文档"><a href="#远程解锁模块-API-文档" class="headerlink" title="远程解锁模块 API 文档"></a>远程解锁模块 API 文档</h1><p><strong>版本:</strong> 1.0</p><p>本文档是远程解锁模块 (Remote Unlock Module) 的官方API参考。提供了所有可用端点的详细信息，包括如何进行身份验证、请求参数、以及预期的响应格式。</p><ul><li><strong>服务条款:</strong> <a href="https://rfu.czqu.net/">https://rfu.czqu.net</a></li></ul><h2 id="免-责-声-明"><a href="#免-责-声-明" class="headerlink" title="免 责 声 明"></a><strong>免 责 声 明</strong></h2><p>本 [网站/文件/服务/产品]（以下简称“本服务”）提供的信息仅供一般参考之用。所有信息均基于诚信原则提供，但我们不对本服务上任何信息的准确性、充分性、有效性、可靠性、可用性或完整性作出任何明示或暗示的陈述或保证。</p><p>在任何情况下，对于因使用本服务或依赖本服务提供的任何信息而导致的任何形式的损失或损害，我们概不负责。您使用本服务以及对本服务上任何信息的依赖，风险完全由您自行承担。</p><p>本服务可能包含（或通过本服务将您引导至）来自第三方网站的链接或内容。我们不会对此类外部链接的准确性、相关性、及时性或完整性进行调查、监控或检查。</p><p>本服务提供的内容不构成任何形式的专业建议（包括但不限于法律、财务、医疗或其他专业建议）。所有内容仅为信息分享，在根据此类信息采取任何行动之前，我们强烈建议您咨询相关领域的专业人士。我们不提供任何形式的专业建议。</p><hr><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="基础URL"><a href="#基础URL" class="headerlink" title="基础URL"></a>基础URL</h3><p>所有API请求的基础URL如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:2091/api/v1</span><br></pre></td></tr></tbody></table></figure><h3 id="身份验证"><a href="#身份验证" class="headerlink" title="身份验证"></a>身份验证</h3><p>本API的大部分端点需要通过API密钥进行身份验证。请在HTTP请求头 (Header) 中包含 <code>Authorization</code> 字段。</p><ul><li><strong>类型:</strong> <code>apiKey</code></li><li><strong>请求头字段名:</strong> <code>Authorization</code></li><li><strong>格式:</strong> <code>Authorization: Bearer  &lt;YOUR_API_KEY&gt;</code></li></ul><blockquote><p><strong>中文提示:</strong> 这里的 <code>&lt;YOUR_API_KEY&gt;</code> 需要替换为您在登录或系统配置中获取的实际认证令牌 (Token)。所有需要认证的接口都必须携带此请求头，否则将返回 <code>401 Unauthorized</code> 错误。</p></blockquote><h3 id="通用响应格式"><a href="#通用响应格式" class="headerlink" title="通用响应格式"></a>通用响应格式</h3><p>所有API的响应都遵循统一的数据结构，方便客户端进行统一处理。</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"code"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"msg"</span><span class="punctuation">:</span> <span class="string">"success"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"data"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"request_id"</span><span class="punctuation">:</span> <span class="string">"unique-request-id-string"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><ul><li><code>code</code>: 状态码。<code>0</code> 通常表示成功，其他非零值表示不同类型的错误。</li><li><code>msg</code>: 对本次响应的简短描述，可能是 “success” 或具体的错误信息。</li><li><code>data</code>: 实际返回的数据内容，可以是对象、数组或null。</li><li><code>request_id</code>: 本次请求的唯一标识符，可用于问题排查。</li></ul><hr><h2 id="API-端点详解"><a href="#API-端点详解" class="headerlink" title="API 端点详解"></a>API 端点详解</h2><h3 id="计算机控制-PC-Control"><a href="#计算机控制-PC-Control" class="headerlink" title="计算机控制 (PC Control)"></a>计算机控制 (PC Control)</h3><h4 id="POST-control-pc-action"><a href="#POST-control-pc-action" class="headerlink" title="POST /control-pc/{action}/"></a><code>POST /control-pc/{action}/</code></h4><p>控制计算机执行指定操作，如关机、待机或锁定。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li><li><strong>描述:</strong> 根据传入的 <code>action</code> 参数来控制计算机。<code>shutdown</code> (关机) 和 <code>standby</code> (待机) 操作还可以附加一个延迟时间。</li></ul><p><strong>路径参数 (Path Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>枚举值</th><th>中文说明</th></tr></thead><tbody><tr><td><code>action</code></td><td>string</td><td>是</td><td><code>shutdown</code>, <code>standby</code>, <code>lock</code></td><td>要执行的操作类型。分别是关机、待机、锁定。</td></tr></tbody></table><p><strong>查询参数 (Query Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>中文说明</th></tr></thead><tbody><tr><td><code>delay</code></td><td>string</td><td>是</td><td>延迟执行的时间（秒）。仅在 <code>action</code> 为 <code>shutdown</code> 或 <code>standby</code> 时有效。</td></tr><tr><td><code>shutdown_type</code></td><td>string</td><td>否</td><td>关机类型。当且仅当action=shutdown生效。例如，可以指定为“强制”或“混合”等（具体可用值参考下面）。</td></tr></tbody></table><table><thead><tr><th>shutdown_type</th><th>中文说明</th></tr></thead><tbody><tr><td>0</td><td>不执行操作</td></tr><tr><td><strong>通用 (General)</strong></td><td></td></tr><tr><td>1</td><td>注销当前用户</td></tr><tr><td>2</td><td>强制关闭所有应用程序并关机</td></tr><tr><td>3</td><td>强制关闭所有应用程序并重启</td></tr><tr><td><strong>仅Windows 版可用</strong></td><td></td></tr><tr><td>4</td><td>关机但不关闭电源</td></tr><tr><td>5</td><td>重启计算机</td></tr><tr><td>6</td><td>强制关闭所有应用程序</td></tr><tr><td>7</td><td>关机并关闭电源</td></tr><tr><td>8</td><td>重启应用程序</td></tr><tr><td>9</td><td>混合关机</td></tr><tr><td>10</td><td>强制关闭所有应用程序并关机同时关闭电源</td></tr><tr><td>11</td><td>重启计算机并重启应用程序</td></tr><tr><td>12</td><td>强制关闭应用程序后重启并重启应用程序</td></tr><tr><td>13</td><td>关机但不关闭电源，关机后重启应用程序</td></tr><tr><td>14</td><td>混合关机并强制关闭应用程序</td></tr><tr><td>15</td><td>混合关机并重启应用程序</td></tr><tr><td>16</td><td>混合关机、强制关闭应用程序并重启应用程序</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 操作指令已成功发送。</li><li><code>400 Bad Request</code>: 无效的操作类型 (<code>action</code> 不在枚举值内)。</li><li><code>500 Internal Server Error</code>: 执行操作失败，可能是权限不足或其他系统错误。</li></ul><hr><h3 id="系统信息-System"><a href="#系统信息-System" class="headerlink" title="系统信息 (System)"></a>系统信息 (System)</h3><h4 id="GET-info"><a href="#GET-info" class="headerlink" title="GET /info"></a><code>GET /info</code></h4><p>获取软件的版本等基本信息。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li></ul><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功获取信息。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><h4 id="GET-info-check-update"><a href="#GET-info-check-update" class="headerlink" title="GET /info/check_update"></a><code>GET /info/check_update</code></h4><p>检查系统是否有可用的更新。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li><li><strong>描述:</strong> 返回最新的可用更新详情，包括版本号、更新URL和发布说明。</li></ul><p><strong>查询参数 (Query Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>默认值</th><th>中文说明</th></tr></thead><tbody><tr><td><code>lang</code></td><td>string</td><td>否</td><td><code>en</code></td><td>指定更新信息的语言。</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功获取更新信息。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><h4 id="GET-info-language"><a href="#GET-info-language" class="headerlink" title="GET /info/language"></a><code>GET /info/language</code></h4><p>获取当前系统设置的语言。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>❌</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 不需要</li></ul><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功获取语言设置。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><h4 id="PATCH-info-language"><a href="#PATCH-info-language" class="headerlink" title="PATCH /info/language"></a><code>PATCH /info/language</code></h4><p>设置系统语言。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>❌</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 不需要</li></ul><p><strong>查询参数 (Query Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>默认值</th><th>中文说明</th></tr></thead><tbody><tr><td><code>lang</code></td><td>string</td><td>否</td><td><code>en</code></td><td>要设置的目标语言。</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功设置语言。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><h4 id="GET-logs-module"><a href="#GET-logs-module" class="headerlink" title="GET /logs/{module}"></a><code>GET /logs/{module}</code></h4><p>实时获取系统日志流。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li><li><strong>描述:</strong> 此端点会建立一个长连接，实时推送系统产生的日志。连接将保持打开状态，直到客户端关闭或发生错误。</li></ul><p><strong>路径参数 (Path Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>中文说明</th></tr></thead><tbody><tr><td><code>module</code></td><td>string</td><td>是</td><td>指定要获取哪个模块的日志。当前文档中，此值必须是 <code>service</code>。</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 开始推送日志流 (<code>Content-Type: text/event-stream</code>)。</li><li><code>400 Bad Request</code>: 指定了无效的模块。</li><li><code>500 Internal Server Error</code>: 服务器内部错误，例如日志缓冲区不可用。</li></ul><hr><h3 id="节能模式-Power-Saving"><a href="#节能模式-Power-Saving" class="headerlink" title="节能模式 (Power Saving)"></a>节能模式 (Power Saving)</h3><h4 id="POST-power-saving"><a href="#POST-power-saving" class="headerlink" title="POST /power-saving"></a><code>POST /power-saving</code></h4><p>开启、关闭或自动设置节能模式。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li><li><strong>描述:</strong> 该功能会先将设置写入数据库，如果写入成功，再应用到系统。即使系统应用失败，数据库中的值也会被更新。</li></ul><p><strong>查询参数 (Query Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>默认值</th><th>中文说明</th></tr></thead><tbody><tr><td><code>mode</code></td><td>string</td><td>否</td><td><code>auto</code></td><td>节能模式。可选值为 <code>enable</code> (开启), <code>disable</code> (关闭), 或 <code>auto</code> (自动)。</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功设置节能模式。</li><li><code>400 Bad Request</code>: 无效的请求参数。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><h4 id="GET-power-saving-status"><a href="#GET-power-saving-status" class="headerlink" title="GET /power-saving/status"></a><code>GET /power-saving/status</code></h4><p>获取当前节能模式的状态。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li></ul><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功获取节能模式状态。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><hr><h3 id="网络接口-Network-Interfaces"><a href="#网络接口-Network-Interfaces" class="headerlink" title="网络接口 (Network Interfaces)"></a>网络接口 (Network Interfaces)</h3><h4 id="GET-interface"><a href="#GET-interface" class="headerlink" title="GET /interface"></a><code>GET /interface</code></h4><p>获取有效的网络接口列表。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li><li><strong>描述:</strong> 根据指定的IP版本（IPv4或IPv6），返回一个当前设备上所有有效网络接口的列表。</li></ul><p><strong>查询参数 (Query Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>默认值</th><th>枚举值</th><th>中文说明</th></tr></thead><tbody><tr><td><code>type</code></td><td>string</td><td>否</td><td><code>4</code></td><td><code>4</code>, <code>6</code></td><td>IP协议版本类型，<code>4</code> 代表IPv4，<code>6</code> 代表IPv6。</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功返回网络接口列表。</li><li><code>400 Bad Request</code>: 请求参数不正确。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><h4 id="GET-interface-ip"><a href="#GET-interface-ip" class="headerlink" title="GET /interface/{ip}"></a><code>GET /interface/{ip}</code></h4><p>根据IP地址获取其对应的MAC地址。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li></ul><p><strong>路径参数 (Path Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>中文说明</th></tr></thead><tbody><tr><td><code>ip</code></td><td>string</td><td>是</td><td>要查询的IP地址。</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功获取MAC地址。</li><li><code>400 Bad Request</code>: 请求格式不正确（例如IP地址无效）。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><h4 id="GET-interface-ip-all"><a href="#GET-interface-ip-all" class="headerlink" title="GET /interface/{ip}/all"></a><code>GET /interface/{ip}/all</code></h4><p>根据IP地址获取完整的接口信息。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要</li></ul><p><strong>路径参数 (Path Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>中文说明</th></tr></thead><tbody><tr><td><code>ip</code></td><td>string</td><td>是</td><td>要查询的IP地址。</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 成功获取接口信息。</li><li><code>400 Bad Request</code>: 请求格式不正确。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><hr><h3 id="用户认证与操作-User"><a href="#用户认证与操作-User" class="headerlink" title="用户认证与操作 (User)"></a>用户认证与操作 (User)</h3><h4 id="POST-login"><a href="#POST-login" class="headerlink" title="POST /login"></a><code>POST /login</code></h4><p>用户登录。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>✅</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 需要 (此处的认证可能是指客户端的基础认证，用于换取更长时效的Token)</li><li><strong>描述:</strong> 使用用户名和密码进行身份验证，成功后会返回一个JWT（JSON Web Token），用于后续需要认证的API请求。</li></ul><p><strong>请求体 (Request Body)</strong></p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"username"</span><span class="punctuation">:</span> <span class="string">"your_username"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"password"</span><span class="punctuation">:</span> <span class="string">"your_password"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><ul><li><strong>Schema:</strong> <code>LoginRequest</code></li></ul><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 认证成功，响应的 <code>data</code> 字段中会包含JWT Token。</li><li><code>400 Bad Request</code>: 请求参数无效（例如用户名或密码为空）。</li><li><code>500 Internal Server Error</code>: 服务器内部错误。</li></ul><h4 id="POST-unlock"><a href="#POST-unlock" class="headerlink" title="POST /unlock"></a><code>POST /unlock</code></h4><p>解锁你的电脑。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>❌</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 不需要</li><li><strong>描述:</strong> 发送电脑的用户名和密码来执行解锁操作。</li></ul><p><strong>请求体 (Request Body)</strong></p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"username"</span><span class="punctuation">:</span> <span class="string">"your_pc_username"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"password"</span><span class="punctuation">:</span> <span class="string">"your_pc_password"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><ul><li><strong>Schema:</strong> <code>PcUserInfo</code></li></ul><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 解锁成功。</li><li><code>400 Bad Request</code>: 请求格式不正确。</li><li><code>500 Internal Server Error</code>: 内部错误（例如用户名或密码错误，解锁失败）。</li></ul><hr><h3 id="其他-Miscellaneous"><a href="#其他-Miscellaneous" class="headerlink" title="其他 (Miscellaneous)"></a>其他 (Miscellaneous)</h3><h4 id="GET-ping"><a href="#GET-ping" class="headerlink" title="GET /ping"></a><code>GET /ping</code></h4><p>服务探活（Ping）。</p><ul><li><strong>认证:</strong> <span class="github-emoji"><span>❌</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> 不需要</li><li><strong>描述:</strong> 用于检查服务是否正常运行，或特定子服务（如WebSocket）的状态。</li></ul><p><strong>查询参数 (Query Parameters)</strong></p><table><thead><tr><th>参数名</th><th>类型</th><th>必需</th><th>枚举值</th><th>中文说明</th></tr></thead><tbody><tr><td><code>type</code></td><td>string</td><td>否</td><td><code>ws</code>, <code>pairing</code></td><td>探测类型。<code>ws</code> 可能用于测试WebSocket服务，<code>pairing</code> 可能用于测试配对服务。</td></tr></tbody></table><p><strong>响应 (Responses)</strong></p><ul><li><code>200 OK</code>: 服务正常。</li><li><code>500 Internal Server Error</code>: 服务异常。</li></ul><hr><h2 id="数据模型-Definitions"><a href="#数据模型-Definitions" class="headerlink" title="数据模型 (Definitions)"></a>数据模型 (Definitions)</h2><h3 id="LoginRequest"><a href="#LoginRequest" class="headerlink" title="LoginRequest"></a><code>LoginRequest</code></h3><p>用户登录时使用的凭据对象。</p><table><thead><tr><th>字段名</th><th>类型</th><th>必需</th><th>中文说明</th></tr></thead><tbody><tr><td><code>username</code></td><td>string</td><td>是</td><td>用户名</td></tr><tr><td><code>password</code></td><td>string</td><td>是</td><td>密码</td></tr></tbody></table><h3 id="PcUserInfo"><a href="#PcUserInfo" class="headerlink" title="PcUserInfo"></a><code>PcUserInfo</code></h3><p>解锁电脑时使用的用户信息对象。</p><table><thead><tr><th>字段名</th><th>类型</th><th>必需</th><th>中文说明</th></tr></thead><tbody><tr><td><code>username</code></td><td>string</td><td>否</td><td>电脑的用户名</td></tr><tr><td><code>password</code></td><td>string</td><td>否</td><td>电脑的登录密码</td></tr></tbody></table><h3 id="ResponseData"><a href="#ResponseData" class="headerlink" title="ResponseData"></a><code>ResponseData</code></h3><p>所有API响应的通用数据结构。</p><table><thead><tr><th>字段名</th><th>类型</th><th>中文说明</th></tr></thead><tbody><tr><td><code>code</code></td><td>integer</td><td>业务状态码, <code>0</code> 表示成功</td></tr><tr><td><code>data</code></td><td>object</td><td>实际返回的数据</td></tr><tr><td><code>msg</code></td><td>string</td><td>提示信息</td></tr><tr><td><code>request_id</code></td><td>string</td><td>本次请求的唯一ID</td></tr></tbody></table>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> 远程解锁 </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> 远程解锁 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>远程解锁常见问题</title>
      
      
      <link href="/cn/posts/31496/"/>
      
      
      <url>/cn/posts/31496/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="联系我们："><a href="#联系我们：" class="headerlink" title="联系我们："></a>联系我们：</h3><p>QQ群：1053768454(推荐)</p><blockquote><p>或者在文末评论区留下你的意见和建议。</p></blockquote><h3 id="常见问题："><a href="#常见问题：" class="headerlink" title="常见问题："></a>常见问题：</h3><h5 id="1-锁屏界面无反应？无法连接？"><a href="#1-锁屏界面无反应？无法连接？" class="headerlink" title="1.锁屏界面无反应？无法连接？"></a>1.锁屏界面无反应？无法连接？</h5><p>新版不在锁屏界面展示解锁结果，而是通过接口返回，调用接口的时候可以看到。接口文档可以到官网查阅。</p><p>无法连接可能是防火墙问题，可以试试先关闭防火墙排查，此问题的出现可能是安装的时候阻止了创建防火墙规则请手动给LogonUI.exe添加规则。</p><p>还有一种可能就是启动了开始配对。请看第三条。</p><p>目前的网络插件只有局域网版，监听了所有IP，支持IPV6，但是不建议直接开放到公网。</p><h5 id="2-锁屏界面提示用户名密码错误"><a href="#2-锁屏界面提示用户名密码错误" class="headerlink" title="2.锁屏界面提示用户名密码错误~~"></a>2.锁屏界面提示用户名密码错误~~</h5><p>1.请检查你输入的是密码而不是<strong>pin</strong>。</p><p>2.如果有更改过微软账户密码，可能是本地密码和在线密码不同步导致的</p><blockquote><p>建议您参考以下步骤：</p><p>方案一：直接重新绑定微软账户和本地账户</p><p>方案二：</p><p>1.按Windows徽标 + R组合键调出运行窗口，在其中输入“control userpasswords2 ”或“netplwiz”，打开“用户帐户”窗口，</p><p>2.选中需要操作的帐户，重新勾选“要使用本计算机，用户必须输入用户名和密码”，然后“应用”；然后再取消勾选“要使用本计算机，用户必须输入用户名和密码”，再点击“应用”，就会弹出自动登录设置窗口了。在其中输入微软帐户的新密码，然后点击“确定”关闭“自动登录”设置窗口，最后点击“用户帐户”窗口的“确定”按钮。</p><p><a href="https://answers.microsoft.com/zh-hans/windows/forum/all/microsoft%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95/092f9d9c-909e-4f7f-8fab-5e4169480960">https://answers.microsoft.com/zh-hans/windows/forum/all/microsoft%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95/092f9d9c-909e-4f7f-8fab-5e4169480960</a></p></blockquote><h5 id="3-二维码怎么不见了"><a href="#3-二维码怎么不见了" class="headerlink" title="3.二维码怎么不见了?"></a>3.二维码怎么不见了?</h5><p>（鸿蒙用户请绕过此此条，鸿蒙版支持自动配对无需扫码。二维码被移到控制面板了,请通过下拉框选择合适的网卡，不然无法解锁。开机功能一般需要有线网卡的支持请选择有线网卡。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/31496/image-20240523195407352.png" alt="image-20240523195407352"></p><p>如果配对的时候想进行测试，可以在这点开始配对。此操作会打开和锁屏界面一样的服务，支持蓝牙发送，或者http api的测试。使用后请关闭。不然锁屏界面可能会无法连接。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/31496/image-20240523195647086.png" alt="image-20240523195647086"></p><h5 id="1-连接不上-fail-to-connect-xxxx-一直显示查找ip的解决办法"><a href="#1-连接不上-fail-to-connect-xxxx-一直显示查找ip的解决办法" class="headerlink" title="1.连接不上/fail to connect xxxx/一直显示查找ip的解决办法"></a><del>1.连接不上/fail to connect xxxx/一直显示查找ip的解决办法</del></h5><p><del>1.可能是防火墙问题导致的：</del></p><blockquote><p> <del>解决方案Windows防火墙 –&gt; 高级设置 –&gt; 入站规则 –&gt; 在列表里找到“文件和打印机共享(回显请求 - ICMPv4-In)” –&gt; 右击选择启用规则，并在其属性里设置为‘允许连接’–&gt; 确定 –&gt; 大功告成。</del><br><del>要禁止ping,去掉勾选即可.</del></p></blockquote><p><del>2.由于ip设置错误导致的(下一版本修复)</del></p><blockquote><p><del>解决方案：</del></p><p><del><strong>手动搜索添加即可，不要用二维码添加</strong></del></p><p><del>1.检查电脑和手机是否在同一局域网</del></p><p><del>2.检查App中使用的ip与电脑当前ip是否一致</del></p><p><del>检查方法如下：</del></p><p><del>App点击管理-》选择设备-》查看更多-》ip:</del></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/31496/image-20200816170902707.png" alt="Appip"></p><p><a href="">win10直接打开网络和Internet设置查看:</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/31496/image-20200816171118185.png" alt="电脑ip"></p></blockquote><h5 id="2-锁屏界面无任何变化，没有出现远程解锁的图标"><a href="#2-锁屏界面无任何变化，没有出现远程解锁的图标" class="headerlink" title="2.锁屏界面无任何变化，没有出现远程解锁的图标"></a><del>2.锁屏界面无任何变化，没有出现远程解锁的图标</del></h5><p><del>手动添加注册表信息，双击Register.reg一直点是就行了。如果仍然没有显示在登录界面，请检查是否安装VC Redistributable for 2017。安装2.0版本前请先卸载2.0以下的版本。</del></p><h5 id="3-Windows-7-安装了Windows10-版本导致锁屏界面一直闪烁"><a href="#3-Windows-7-安装了Windows10-版本导致锁屏界面一直闪烁" class="headerlink" title="3.Windows 7 安装了Windows10 版本导致锁屏界面一直闪烁"></a><del>3.Windows 7 安装了Windows10 版本导致锁屏界面一直闪烁</del></h5><p><del>遇到这种情况，进入修复环境，打开命令行选项用del命令删除安装目录下RemoteFingerUnlockModule.dll文件即可。</del></p><h5 id="4-锁屏界面提示用户名密码错误"><a href="#4-锁屏界面提示用户名密码错误" class="headerlink" title="4.锁屏界面提示用户名密码错误"></a><del>4.锁屏界面提示用户名密码错误</del></h5><p><del>1.请检查你输入的是密码而不是<strong>pin</strong>。</del></p><p><del>2.如果有更改过微软账户密码，可能是本地密码和在线密码不同步导致的</del></p><blockquote><p><del>建议您参考以下步骤：</del></p><p><del>方案一：直接重新绑定微软账户和本地账户</del></p><p><del>方案二：</del></p><p><del>1.按Windows徽标 + R组合键调出运行窗口，在其中输入“control userpasswords2 ”或“netplwiz”，打开“用户帐户”窗口，</del></p><p><del>2.选中需要操作的帐户，重新勾选“要使用本计算机，用户必须输入用户名和密码”，然后“应用”；然后再取消勾选“要使用本计算机，用户必须输入用户名和密码”，再点击“应用”，就会弹出自动登录设置窗口了。在其中输入微软帐户的新密码，然后点击“确定”关闭“自动登录”设置窗口，最后点击“用户帐户”窗口的“确定”按钮。</del></p><p><del><a href="https://answers.microsoft.com/zh-hans/windows/forum/all/microsoft%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95/092f9d9c-909e-4f7f-8fab-5e4169480960">https://answers.microsoft.com/zh-hans/windows/forum/all/microsoft%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95/092f9d9c-909e-4f7f-8fab-5e4169480960</a></del></p></blockquote>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> 远程解锁 </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> 远程解锁 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>esp8266固件的安装</title>
      
      
      <link href="/cn/posts/3450539282/"/>
      
      
      <url>/cn/posts/3450539282/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h3><p>首先需要安装驱动，你需要问问卖给你这个设备的卖家。</p><h3 id="安装固件"><a href="#安装固件" class="headerlink" title="安装固件"></a>安装固件</h3><blockquote><p>可以直接使用写好的脚本傻瓜式刷入</p><p>链接：<a href="https://pan.baidu.com/s/1ukUvB0x7mUhHkJWuoQy2fQ">https://pan.baidu.com/s/1ukUvB0x7mUhHkJWuoQy2fQ</a><br>提取码：b0hy</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/3450539282/image-20211005193224231.png" alt="image-20211005193224231"></p></blockquote><p>想自己安装的可以继续往下看</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>首先你需要安装依赖</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install esptool</span><br><span class="line">pip install pyserial</span><br></pre></td></tr></tbody></table></figure><p>接着就可以进行刷写固件了</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ./esptool.py --port COM13 write_flash 0x0000 ./firmware.bin</span><br></pre></td></tr></tbody></table></figure><p>这里的COM13可以使用设备管理器查看：</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/3450539282/image-20211005183736379.png" style="zoom: 80%;"><h3 id="擦除"><a href="#擦除" class="headerlink" title="擦除"></a>擦除</h3><p><strong>擦除后所有数据都会消失，需要重新刷写固件</strong></p><p>擦除所有数据 (所有数据会变成 0xFF ):</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esptool.py erase_flash</span><br></pre></td></tr></tbody></table></figure><p>擦除指定区域的数据, 例如 从0x20000 到 0x4000   (共16KB):</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esptool.py erase_region 0x20000 0x4000</span><br></pre></td></tr></tbody></table></figure><p>地址和长度都必须是SPI flash erase扇区大小的倍数。也就是0x1000(4096)字节。</p><p>详情参见</p><p><a href="https://github.com/espressif/esptool">espressif/esptool: Espressif SoC serial bootloader utility (github.com)</a></p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> 远程解锁 </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Esp8266 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>springboot学习笔记</title>
      
      
      <link href="/cn/posts/59173/"/>
      
      
      <url>/cn/posts/59173/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="一、Spring-Boot-入门"><a href="#一、Spring-Boot-入门" class="headerlink" title="一、Spring Boot 入门"></a><strong>一、</strong>Spring Boot 入门</h1><h2 id="1、Spring-Boot-简介"><a href="#1、Spring-Boot-简介" class="headerlink" title="1、Spring Boot 简介"></a>1、Spring Boot 简介</h2><blockquote><p>简化Spring应用开发的一个框架；</p><p>整个Spring技术栈的一个大整合；</p><p>J2EE开发的一站式解决方案；</p></blockquote><h2 id="2、微服务"><a href="#2、微服务" class="headerlink" title="2、微服务"></a>2、微服务</h2><p>2014，martin fowler</p><p>微服务：架构风格（服务微化）</p><p>一个应用应该是一组小型服务；可以通过HTTP的方式进行互通；</p><p>单体应用：ALL IN ONE</p><p>微服务：每一个功能元素最终都是一个可独立替换和独立升级的软件单元；</p><p><a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa">详细参照微服务文档</a></p><h2 id="3、环境准备"><a href="#3、环境准备" class="headerlink" title="3、环境准备"></a>3、环境准备</h2><p><a href="http://www.gulixueyuan.com/">http://www.gulixueyuan.com/</a> 谷粒学院</p><p>环境约束</p><p>–jdk1.8：Spring Boot 推荐jdk1.7及以上；java version “1.8.0_112”</p><p>–maven3.x：maven 3.3以上版本；Apache Maven 3.3.9</p><p>–IntelliJIDEA2017：IntelliJ IDEA 2017.2.2 x64、STS</p><p>–SpringBoot 1.5.9.RELEASE：1.5.9；</p><p>统一环境；</p><h3 id="1、MAVEN设置；"><a href="#1、MAVEN设置；" class="headerlink" title="1、MAVEN设置；"></a>1、MAVEN设置；</h3><p>给maven 的settings.xml配置文件的profiles标签添加</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2、IDEA设置"><a href="#2、IDEA设置" class="headerlink" title="2、IDEA设置"></a>2、IDEA设置</h3><p>整合maven进来；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151045.png" alt="idea设置"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151112.png" alt="images/"></p><h2 id="4、Spring-Boot-HelloWorld"><a href="#4、Spring-Boot-HelloWorld" class="headerlink" title="4、Spring Boot HelloWorld"></a>4、Spring Boot HelloWorld</h2><p>一个功能：</p><p>浏览器发送hello请求，服务器接受请求并处理，响应Hello World字符串；</p><h3 id="1、创建一个maven工程；（jar）"><a href="#1、创建一个maven工程；（jar）" class="headerlink" title="1、创建一个maven工程；（jar）"></a>1、创建一个maven工程；（jar）</h3><h3 id="2、导入spring-boot相关的依赖"><a href="#2、导入spring-boot相关的依赖" class="headerlink" title="2、导入spring boot相关的依赖"></a>2、导入spring boot相关的依赖</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3、编写一个主程序；启动Spring-Boot应用"><a href="#3、编写一个主程序；启动Spring-Boot应用" class="headerlink" title="3、编写一个主程序；启动Spring Boot应用"></a>3、编写一个主程序；启动Spring Boot应用</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> 来标注一个主程序类，说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMainApplication</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication.class,args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="4、编写相关的Controller、Service"><a href="#4、编写相关的Controller、Service" class="headerlink" title="4、编写相关的Controller、Service"></a>4、编写相关的Controller、Service</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping("/hello")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="5、运行主程序测试"><a href="#5、运行主程序测试" class="headerlink" title="5、运行主程序测试"></a>5、运行主程序测试</h3><h3 id="6、简化部署"><a href="#6、简化部署" class="headerlink" title="6、简化部署"></a>6、简化部署</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个插件，可以将应用打包成一个可执行的jar包；--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>将这个应用打成jar包，直接使用java -jar的命令进行执行；</p><h2 id="5、Hello-World探究"><a href="#5、Hello-World探究" class="headerlink" title="5、Hello World探究"></a>5、Hello World探究</h2><h3 id="1、POM文件"><a href="#1、POM文件" class="headerlink" title="1、POM文件"></a>1、POM文件</h3><h4 id="1、父项目"><a href="#1、父项目" class="headerlink" title="1、父项目"></a>1、父项目</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">他的父项目是</span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">他来真正管理Spring Boot应用里面的所有依赖版本；</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>Spring Boot的版本仲裁中心；</p><p>以后我们导入依赖默认是不需要写版本；（没有在dependencies里面管理的依赖自然需要声明版本号）</p><h4 id="2、启动器"><a href="#2、启动器" class="headerlink" title="2、启动器"></a>2、启动器</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><strong>spring-boot-starter</strong>-==web==：</p><p>​    spring-boot-starter：spring-boot场景启动器；帮我们导入了web模块正常运行所依赖的组件；</p><p>Spring Boot将所有的功能场景都抽取出来，做成一个个的starters（启动器），只需要在项目里面引入这些starter相关场景的所有依赖都会导入进来。要用什么功能就导入什么场景的启动器</p><h3 id="2、主程序类，主入口类"><a href="#2、主程序类，主入口类" class="headerlink" title="2、主程序类，主入口类"></a>2、主程序类，主入口类</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> 来标注一个主程序类，说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMainApplication</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication.class,args);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>@<strong>SpringBootApplication</strong>:    Spring Boot应用标注在某个类上说明这个类是SpringBoot的主配置类，SpringBoot就应该运行这个类的main方法来启动SpringBoot应用；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = {</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication {</span><br></pre></td></tr></tbody></table></figure><p>@<strong>SpringBootConfiguration</strong>:Spring Boot的配置类；</p><p>​        标注在某个类上，表示这是一个Spring Boot的配置类；</p><p>​        @<strong>Configuration</strong>:配置类上来标注这个注解；</p><p>​            配置类 —–  配置文件；配置类也是容器中的一个组件；@Component</p><p>@<strong>EnableAutoConfiguration</strong>：开启自动配置功能；</p><p>​        以前我们需要配置的东西，Spring Boot帮我们自动配置；@<strong>EnableAutoConfiguration</strong>告诉SpringBoot开启自动配置功能；这样自动配置才能生效；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(EnableAutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration {</span><br></pre></td></tr></tbody></table></figure><p>​          @<strong>AutoConfigurationPackage</strong>：自动配置包</p><p>​        @<strong>Import</strong>(AutoConfigurationPackages.Registrar.class)：</p><p>​        Spring的底层注解@Import，给容器中导入一个组件；导入的组件由AutoConfigurationPackages.Registrar.class；</p><p>==将主配置类（@SpringBootApplication标注的类）的所在包及下面所有子包里面的所有组件扫描到Spring容器；==</p><p>​    @<strong>Import</strong>(EnableAutoConfigurationImportSelector.class)；</p><p>​        给容器中导入组件？</p><p>​        <strong>EnableAutoConfigurationImportSelector</strong>：导入哪些组件的选择器；</p><p>​        将所有需要导入的组件以全类名的方式返回；这些组件就会被添加到容器中；</p><p>​        会给容器中导入非常多的自动配置类（xxxAutoConfiguration）；就是给容器中导入这个场景需要的所有组件，并配置好这些组件；        <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129224104.png" alt="自动配置类"></p><p>有了自动配置类，免去了我们手动编写配置注入功能组件等的工作；</p><p>​        SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class,classLoader)；</p><p>==Spring Boot在启动的时候从类路径下的META-INF/spring.factories中获取EnableAutoConfiguration指定的值，将这些值作为自动配置类导入到容器中，自动配置类就生效，帮我们进行自动配置工作；==以前我们需要自己配置的东西，自动配置类都帮我们；</p><p>J2EE的整体整合解决方案和自动配置都在spring-boot-autoconfigure-1.5.9.RELEASE.jar；</p><p>​        </p><p>==Spring注解版（谷粒学院）==</p><h2 id="6、使用Spring-Initializer快速创建Spring-Boot项目"><a href="#6、使用Spring-Initializer快速创建Spring-Boot项目" class="headerlink" title="6、使用Spring Initializer快速创建Spring Boot项目"></a>6、使用Spring Initializer快速创建Spring Boot项目</h2><h3 id="1、IDEA：使用-Spring-Initializer快速创建项目"><a href="#1、IDEA：使用-Spring-Initializer快速创建项目" class="headerlink" title="1、IDEA：使用 Spring Initializer快速创建项目"></a>1、IDEA：使用 Spring Initializer快速创建项目</h3><p>IDE都支持使用Spring的项目创建向导快速创建一个Spring Boot项目；</p><p>选择我们需要的模块；向导会联网创建Spring Boot项目；</p><p>默认生成的Spring Boot项目；</p><ul><li>主程序已经生成好了，我们只需要我们自己的逻辑</li><li>resources文件夹中目录结构<ul><li>static：保存所有的静态资源； js css  images；</li><li>templates：保存所有的模板页面；（Spring Boot默认jar包使用嵌入式的Tomcat，默认不支持JSP页面）；可以使用模板引擎（freemarker、thymeleaf）；</li><li>application.properties：Spring Boot应用的配置文件；可以修改一些默认设置；</li></ul></li></ul><h3 id="2、STS使用-Spring-Starter-Project快速创建项目"><a href="#2、STS使用-Spring-Starter-Project快速创建项目" class="headerlink" title="2、STS使用 Spring Starter Project快速创建项目"></a>2、STS使用 Spring Starter Project快速创建项目</h3><hr><h1 id="二、配置文件"><a href="#二、配置文件" class="headerlink" title="二、配置文件"></a>二、配置文件</h1><h2 id="1、配置文件"><a href="#1、配置文件" class="headerlink" title="1、配置文件"></a>1、配置文件</h2><p>SpringBoot使用一个全局的配置文件，配置文件名是固定的；</p><p>•application.properties</p><p>•application.yml</p><p>配置文件的作用：修改SpringBoot自动配置的默认值；SpringBoot在底层都给我们自动配置好；</p><p>YAML（YAML Ain’t Markup Language）</p><p>​    YAML  A Markup Language：是一个标记语言</p><p>​    YAML   isn’t Markup Language：不是一个标记语言；</p><p>标记语言：</p><p>​    以前的配置文件；大多都使用的是  <strong>xxxx.xml</strong>文件；</p><p>​    YAML：<strong>以数据为中心</strong>，比json、xml等更适合做配置文件；</p><p>​    YAML：配置例子</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></tbody></table></figure><p>​    XML：</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>8081<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2、YAML语法："><a href="#2、YAML语法：" class="headerlink" title="2、YAML语法："></a>2、YAML语法：</h2><h3 id="1、基本语法"><a href="#1、基本语法" class="headerlink" title="1、基本语法"></a>1、基本语法</h3><p>k:(空格)v：表示一对键值对（空格必须有）；</p><p>以<strong>空格</strong>的缩进来控制层级关系；只要是左对齐的一列数据，都是同一个层级的</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/hello</span></span><br></pre></td></tr></tbody></table></figure><p>属性和值也是大小写敏感；</p><h3 id="2、值的写法"><a href="#2、值的写法" class="headerlink" title="2、值的写法"></a>2、值的写法</h3><h4 id="字面量：普通的值（数字，字符串，布尔）"><a href="#字面量：普通的值（数字，字符串，布尔）" class="headerlink" title="字面量：普通的值（数字，字符串，布尔）"></a>字面量：普通的值（数字，字符串，布尔）</h4><p>​    k: v：字面直接来写；</p><p>​        字符串默认不用加上单引号或者双引号；</p><p>​        “”：双引号；不会转义字符串里面的特殊字符；特殊字符会作为本身想表示的意思</p><p>​                name:   “zhangsan \n lisi”：输出；zhangsan 换行  lisi</p><p>​        ‘’：单引号；会转义特殊字符，特殊字符最终只是一个普通的字符串数据</p><p>​                name:   ‘zhangsan \n lisi’：输出；zhangsan \n  lisi</p><h4 id="对象、Map（属性和值）（键值对）："><a href="#对象、Map（属性和值）（键值对）：" class="headerlink" title="对象、Map（属性和值）（键值对）："></a>对象、Map（属性和值）（键值对）：</h4><p>​    k: v：在下一行来写对象的属性和值的关系；注意缩进</p><p>​        对象还是k: v的方式</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span></span><br><span class="line"><span class="attr">lastName:</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></tbody></table></figure><p>行内写法：</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span> {<span class="attr">lastName:</span> <span class="string">zhangsan</span>,<span class="attr">age:</span> <span class="number">18</span>}</span><br></pre></td></tr></tbody></table></figure><h4 id="数组（List、Set）："><a href="#数组（List、Set）：" class="headerlink" title="数组（List、Set）："></a>数组（List、Set）：</h4><p>用- 值表示数组中的一个元素</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></tbody></table></figure><p>行内写法</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span> [<span class="string">cat</span>,<span class="string">dog</span>,<span class="string">pig</span>]</span><br></pre></td></tr></tbody></table></figure><h2 id="3、配置文件值注入"><a href="#3、配置文件值注入" class="headerlink" title="3、配置文件值注入"></a>3、配置文件值注入</h2><p>配置文件</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">    <span class="attr">lastName:</span> <span class="string">hello</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">    <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">birth:</span> <span class="number">2017</span><span class="string">/12/12</span></span><br><span class="line">    <span class="attr">maps:</span> {<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="number">12</span>}</span><br><span class="line">    <span class="attr">lists:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">lisi</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zhaoliu</span></span><br><span class="line">    <span class="attr">dog:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">小狗</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">12</span></span><br></pre></td></tr></tbody></table></figure><p>javaBean：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = "person"：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能容器提供的<span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "person")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>我们可以导入配置文件处理器，以后编写配置就有提示了</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入配置文件处理器，配置文件进行绑定就会有提示--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="1、properties配置文件在idea中默认utf-8可能会乱码"><a href="#1、properties配置文件在idea中默认utf-8可能会乱码" class="headerlink" title="1、properties配置文件在idea中默认utf-8可能会乱码"></a>1、properties配置文件在idea中默认utf-8可能会乱码</h4><p>调整</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180130161620.png" alt="idea配置乱码"></p><h4 id="2、-Value获取值和-ConfigurationProperties获取值比较"><a href="#2、-Value获取值和-ConfigurationProperties获取值比较" class="headerlink" title="2、@Value获取值和@ConfigurationProperties获取值比较"></a>2、@Value获取值和@ConfigurationProperties获取值比较</h4><table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>功能</td><td>批量注入配置文件中的属性</td><td>一个个指定</td></tr><tr><td>松散绑定（松散语法）</td><td>支持</td><td>不支持</td></tr><tr><td>SpEL</td><td>不支持</td><td>支持</td></tr><tr><td>JSR303数据校验</td><td>支持</td><td>不支持</td></tr><tr><td>复杂类型封装</td><td>支持</td><td>不支持</td></tr></tbody></table><p>配置文件yml还是properties他们都能获取到值；</p><p>如果说，我们只是在某个业务逻辑中需要获取一下配置文件中的某项值，使用@Value；</p><p>如果说，我们专门编写了一个javaBean来和配置文件进行映射，我们就直接使用@ConfigurationProperties；</p><h4 id="3、配置文件注入值数据校验"><a href="#3、配置文件注入值数据校验" class="headerlink" title="3、配置文件注入值数据校验"></a>3、配置文件注入值数据校验</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "person")</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class="Person"&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name="lastName" value="字面量/${key}从环境变量、配置文件中获取值/#{SpEL}"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastName必须是邮箱格式</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="comment">//@Value("${person.last-name}")</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value("#{11*2}")</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value("true")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></tbody></table></figure><h4 id="4、-PropertySource-amp-ImportResource-amp-Bean"><a href="#4、-PropertySource-amp-ImportResource-amp-Bean" class="headerlink" title="4、@PropertySource&amp;@ImportResource&amp;@Bean"></a>4、@PropertySource&amp;@ImportResource&amp;@Bean</h4><p>@<strong>PropertySource</strong>：加载指定的配置文件；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = "person"：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能容器提供的<span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@ConfigurationProperties</span>(prefix = "person")默认从全局配置文件中获取值；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PropertySource(value = {"classpath:person.properties"})</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "person")</span></span><br><span class="line"><span class="comment">//@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class="Person"&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name="lastName" value="字面量/${key}从环境变量、配置文件中获取值/#{SpEL}"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastName必须是邮箱格式</span></span><br><span class="line">   <span class="comment">// @Email</span></span><br><span class="line">    <span class="comment">//@Value("${person.last-name}")</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value("#{11*2}")</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value("true")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>@<strong>ImportResource</strong>：导入Spring的配置文件，让配置文件里面的内容生效；</p><p>Spring Boot里面没有Spring的配置文件，我们自己编写的配置文件，也不能自动识别；</p><p>想让Spring的配置文件生效，加载进来；@<strong>ImportResource</strong>标注在一个配置类上</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(locations = {"classpath:beans.xml"})</span></span><br><span class="line">导入Spring的配置文件让其生效</span><br></pre></td></tr></tbody></table></figure><p>不来编写Spring的配置文件</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloService"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.springboot.service.HelloService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>SpringBoot推荐给容器中添加组件的方式；推荐使用全注解的方式</p><p>1、配置类**@Configuration**——&gt;Spring配置文件</p><p>2、使用**@Bean**给容器中添加组件</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>：指明当前类是一个配置类；就是来替代之前的Spring配置文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 在配置文件中用&lt;bean&gt;&lt;bean/&gt;标签添加组件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAppConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将方法的返回值添加到容器中；容器中这个组件默认的id就是方法名</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService02</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"配置类@Bean给容器中添加组件了..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>##4、配置文件占位符</p><h3 id="1、随机数"><a href="#1、随机数" class="headerlink" title="1、随机数"></a>1、随机数</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">${random.value}、${random.<span class="type">int</span>}、${random.<span class="type">long</span>}</span><br><span class="line">${random.<span class="type">int</span>(<span class="number">10</span>)}、${random.<span class="type">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="2、占位符获取之前配置的值，如果没有可以是用-指定默认值"><a href="#2、占位符获取之前配置的值，如果没有可以是用-指定默认值" class="headerlink" title="2、占位符获取之前配置的值，如果没有可以是用:指定默认值"></a>2、占位符获取之前配置的值，如果没有可以是用:指定默认值</h3><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person.last-name</span>=<span class="string">张三${random.uuid}</span></span><br><span class="line"><span class="attr">person.age</span>=<span class="string">${random.int}</span></span><br><span class="line"><span class="attr">person.birth</span>=<span class="string">2017/12/15</span></span><br><span class="line"><span class="attr">person.boss</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">person.maps.k1</span>=<span class="string">v1</span></span><br><span class="line"><span class="attr">person.maps.k2</span>=<span class="string">14</span></span><br><span class="line"><span class="attr">person.lists</span>=<span class="string">a,b,c</span></span><br><span class="line"><span class="attr">person.dog.name</span>=<span class="string">${person.hello:hello}_dog</span></span><br><span class="line"><span class="attr">person.dog.age</span>=<span class="string">15</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5、Profile"><a href="#5、Profile" class="headerlink" title="5、Profile"></a>5、Profile</h2><h3 id="1、多Profile文件"><a href="#1、多Profile文件" class="headerlink" title="1、多Profile文件"></a>1、多Profile文件</h3><p>我们在主配置文件编写的时候，文件名可以是   application-{profile}.properties/yml</p><p>默认使用application.properties的配置；</p><h3 id="2、yml支持多文档块方式"><a href="#2、yml支持多文档块方式" class="headerlink" title="2、yml支持多文档块方式"></a>2、yml支持多文档块方式</h3><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span>  <span class="comment">#指定属于哪个环境</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3、激活指定profile"><a href="#3、激活指定profile" class="headerlink" title="3、激活指定profile"></a>3、激活指定profile</h3><p>​    1、在配置文件中指定  spring.profiles.active=dev</p><p>​    2、命令行：</p><p>​        java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar –spring.profiles.active=dev；</p><p>​        可以直接在测试的时候，配置传入命令行参数</p><p>​    3、虚拟机参数；</p><p>​        -Dspring.profiles.active=dev</p><h2 id="6、配置文件加载位置"><a href="#6、配置文件加载位置" class="headerlink" title="6、配置文件加载位置"></a>6、配置文件加载位置</h2><p>springboot 启动会扫描以下位置的application.properties或者application.yml文件作为Spring boot的默认配置文件</p><p>–file:./config/</p><p>–file:./</p><p>–classpath:/config/</p><p>–classpath:/</p><p>优先级由高到底，高优先级的配置会覆盖低优先级的配置；</p><p>SpringBoot会从这四个位置全部加载主配置文件；<strong>互补配置</strong>；</p><p>==我们还可以通过spring.config.location来改变默认的配置文件位置==</p><p><strong>项目打包好以后，我们可以使用命令行参数的形式，启动项目的时候来指定配置文件的新位置；指定配置文件和默认加载的这些配置文件共同起作用形成互补配置；</strong></p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar –spring.config.location=G:/application.properties</p><h2 id="7、外部配置加载顺序"><a href="#7、外部配置加载顺序" class="headerlink" title="7、外部配置加载顺序"></a>7、外部配置加载顺序</h2><p><strong>==SpringBoot也可以从以下位置加载配置； 优先级从高到低；高优先级的配置覆盖低优先级的配置，所有的配置会形成互补配置==</strong></p><p><strong>1.命令行参数</strong></p><p>所有的配置都可以在命令行上进行指定</p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar –server.port=8087  –server.context-path=/abc</p><p>多个配置用空格分开； –配置项=值</p><p>2.来自java:comp/env的JNDI属性</p><p>3.Java系统属性（System.getProperties()）</p><p>4.操作系统环境变量</p><p>5.RandomValuePropertySource配置的random.*属性值</p><p>==<strong>由jar包外向jar包内进行寻找；</strong>==</p><p>==<strong>优先加载带profile</strong>==</p><p><strong>6.jar包外部的application-{profile}.properties或application.yml(带spring.profile)配置文件</strong></p><p><strong>7.jar包内部的application-{profile}.properties或application.yml(带spring.profile)配置文件</strong></p><p>==<strong>再来加载不带profile</strong>==</p><p><strong>8.jar包外部的application.properties或application.yml(不带spring.profile)配置文件</strong></p><p><strong>9.jar包内部的application.properties或application.yml(不带spring.profile)配置文件</strong></p><p>10.@Configuration注解类上的@PropertySource</p><p>11.通过SpringApplication.setDefaultProperties指定的默认属性</p><p>所有支持的配置加载来源；</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-external-config">参考官方文档</a></p><h2 id="8、自动配置原理"><a href="#8、自动配置原理" class="headerlink" title="8、自动配置原理"></a>8、自动配置原理</h2><p>配置文件到底能写什么？怎么写？自动配置原理；</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties">配置文件能配置的属性参照</a></p><h3 id="1、自动配置原理："><a href="#1、自动配置原理：" class="headerlink" title="1、自动配置原理："></a>1、<strong>自动配置原理：</strong></h3><p>1）、SpringBoot启动的时候加载主配置类，开启了自动配置功能 ==@EnableAutoConfiguration==</p><p><strong>2）、@EnableAutoConfiguration 作用：</strong></p><ul><li><p>利用EnableAutoConfigurationImportSelector给容器中导入一些组件？</p></li><li><p>可以查看selectImports()方法的内容；</p></li><li><p>List<string> configurations = getCandidateConfigurations(annotationMetadata,      attributes);获取候选的配置</string></p><ul><li>```java<br>SpringFactoriesLoader.loadFactoryNames()<br>扫描所有jar包类路径下  META-INF/spring.factories<br>把扫描到的这些文件的内容包装成properties对象<br>从properties中获取到EnableAutoConfiguration.class类（类名）对应的值，然后把他们添加在容器中<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">**==将 类路径下  META-INF/spring.factories 里面配置的所有EnableAutoConfiguration的值加入到了容器中；==**</span><br><span class="line"></span><br><span class="line">```properties</span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceDelegatingViewResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.SitePreferenceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.reactor.ReactorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityFilterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.FallbackWebSecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.OAuth2AutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.SocialWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.FacebookAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.LinkedInAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.TwitterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.DispatcherServletAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.EmbeddedServletContainerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpEncodingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpMessageConvertersAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.MultipartAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ServerPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketMessagingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul><p>每一个这样的  xxxAutoConfiguration类都是容器中的一个组件，都加入到容器中；用他们来做自动配置；</p><p>3）、每一个自动配置类进行自动配置功能；</p><p>4）、以<strong>HttpEncodingAutoConfiguration（Http编码自动配置）</strong>为例解释自动配置原理；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//表示这是一个配置类，以前编写的配置文件一样，也可以给容器中添加组件</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HttpEncodingProperties.class)</span>  <span class="comment">//启动指定类的ConfigurationProperties功能；将配置文件中对应的值和HttpEncodingProperties绑定起来；并把HttpEncodingProperties加入到ioc容器中</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//Spring底层@Conditional注解（Spring注解版），根据不同的条件，如果满足指定的条件，整个配置类里面的配置就会生效；    判断当前应用是否是web应用，如果是，当前配置类生效</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnClass(CharacterEncodingFilter.class)</span>  <span class="comment">//判断当前项目有没有这个类CharacterEncodingFilter；SpringMVC中进行乱码解决的过滤器；</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "spring.http.encoding", value = "enabled", matchIfMissing = true)</span>  <span class="comment">//判断配置文件中是否存在某个配置  spring.http.encoding.enabled；如果不存在，判断也是成立的</span></span><br><span class="line"><span class="comment">//即使我们配置文件中不配置pring.http.encoding.enabled=true，也是默认生效的；</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingAutoConfiguration</span> {</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//他已经和SpringBoot的配置文件映射了</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HttpEncodingProperties properties;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">//只有一个有参构造器的情况下，参数的值就会从容器中拿</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">HttpEncodingAutoConfiguration</span><span class="params">(HttpEncodingProperties properties)</span> {</span><br><span class="line"><span class="built_in">this</span>.properties = properties;</span><br><span class="line">}</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//给容器中添加一个组件，这个组件的某些值需要从properties中获取</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(CharacterEncodingFilter.class)</span> <span class="comment">//判断容器没有这个组件？</span></span><br><span class="line"><span class="keyword">public</span> CharacterEncodingFilter <span class="title function_">characterEncodingFilter</span><span class="params">()</span> {</span><br><span class="line"><span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderedCharacterEncodingFilter</span>();</span><br><span class="line">filter.setEncoding(<span class="built_in">this</span>.properties.getCharset().name());</span><br><span class="line">filter.setForceRequestEncoding(<span class="built_in">this</span>.properties.shouldForce(Type.REQUEST));</span><br><span class="line">filter.setForceResponseEncoding(<span class="built_in">this</span>.properties.shouldForce(Type.RESPONSE));</span><br><span class="line"><span class="keyword">return</span> filter;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>根据当前不同的条件判断，决定这个配置类是否生效？</p><p>一但这个配置类生效；这个配置类就会给容器中添加各种组件；这些组件的属性是从对应的properties类中获取的，这些类里面的每一个属性又是和配置文件绑定的；</p><p>5）、所有在配置文件中能配置的属性都是在xxxxProperties类中封装者‘；配置文件能配置什么就可以参照某个功能对应的这个属性类</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = "spring.http.encoding")</span>  <span class="comment">//从配置文件中获取指定的值和bean的属性进行绑定</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingProperties</span> {</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_CHARSET</span> <span class="operator">=</span> Charset.forName(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></tbody></table></figure><p><strong>精髓：</strong></p><p>​    <strong>1）、SpringBoot启动会加载大量的自动配置类</strong></p><p>​    <strong>2）、我们看我们需要的功能有没有SpringBoot默认写好的自动配置类；</strong></p><p>​    <strong>3）、我们再来看这个自动配置类中到底配置了哪些组件；（只要我们要用的组件有，我们就不需要再来配置了）</strong></p><p>​    <strong>4）、给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们就可以在配置文件中指定这些属性的值；</strong></p><p>xxxxAutoConfigurartion：自动配置类；</p><p>给容器中添加组件</p><p>xxxxProperties:封装配置文件中相关属性；</p><h3 id="2、细节"><a href="#2、细节" class="headerlink" title="2、细节"></a>2、细节</h3><h4 id="1、-Conditional派生注解（Spring注解版原生的-Conditional作用）"><a href="#1、-Conditional派生注解（Spring注解版原生的-Conditional作用）" class="headerlink" title="1、@Conditional派生注解（Spring注解版原生的@Conditional作用）"></a>1、@Conditional派生注解（Spring注解版原生的@Conditional作用）</h4><p>作用：必须是@Conditional指定的条件成立，才给容器中添加组件，配置配里面的所有内容才生效；</p><table><thead><tr><th>@Conditional扩展注解</th><th>作用（判断是否满足当前指定条件）</th></tr></thead><tbody><tr><td>@ConditionalOnJava</td><td>系统的java版本是否符合要求</td></tr><tr><td>@ConditionalOnBean</td><td>容器中存在指定Bean；</td></tr><tr><td>@ConditionalOnMissingBean</td><td>容器中不存在指定Bean；</td></tr><tr><td>@ConditionalOnExpression</td><td>满足SpEL表达式指定</td></tr><tr><td>@ConditionalOnClass</td><td>系统中有指定的类</td></tr><tr><td>@ConditionalOnMissingClass</td><td>系统中没有指定的类</td></tr><tr><td>@ConditionalOnSingleCandidate</td><td>容器中只有一个指定的Bean，或者这个Bean是首选Bean</td></tr><tr><td>@ConditionalOnProperty</td><td>系统中指定的属性是否有指定的值</td></tr><tr><td>@ConditionalOnResource</td><td>类路径下是否存在指定资源文件</td></tr><tr><td>@ConditionalOnWebApplication</td><td>当前是web环境</td></tr><tr><td>@ConditionalOnNotWebApplication</td><td>当前不是web环境</td></tr><tr><td>@ConditionalOnJndi</td><td>JNDI存在指定项</td></tr></tbody></table><p><strong>自动配置类必须在一定的条件下才能生效；</strong></p><p>我们怎么知道哪些自动配置类生效；</p><p>**==我们可以通过启用  debug=true属性；来让控制台打印自动配置报告==**，这样我们就可以很方便的知道哪些自动配置类生效；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">=========================</span><br><span class="line">AUTO-CONFIGURATION REPORT</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Positive matches:（自动配置类启用的）</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   DispatcherServletAutoConfiguration matched:</span><br><span class="line">      - <span class="meta">@ConditionalOnClass</span> found required class <span class="string">'org.springframework.web.servlet.DispatcherServlet'</span>; <span class="meta">@ConditionalOnMissingClass</span> did not find unwanted <span class="title function_">class</span> <span class="params">(OnClassCondition)</span></span><br><span class="line">      - <span class="meta">@ConditionalOnWebApplication</span> (required) found <span class="title function_">StandardServletEnvironment</span> <span class="params">(OnWebApplicationCondition)</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">Negative matches:（没有启动，没有匹配成功的自动配置类）</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   ActiveMQAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - <span class="meta">@ConditionalOnClass</span> did not find required classes <span class="string">'javax.jms.ConnectionFactory'</span>, <span class="string">'org.apache.activemq.ActiveMQConnectionFactory'</span> (OnClassCondition)</span><br><span class="line"></span><br><span class="line">   AopAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - <span class="meta">@ConditionalOnClass</span> did not find required classes <span class="string">'org.aspectj.lang.annotation.Aspect'</span>, <span class="string">'org.aspectj.lang.reflect.Advice'</span> (OnClassCondition)</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure><h1 id="三、日志"><a href="#三、日志" class="headerlink" title="三、日志"></a>三、日志</h1><h2 id="1、日志框架"><a href="#1、日志框架" class="headerlink" title="1、日志框架"></a>1、日志框架</h2><p> 小张；开发一个大型系统；</p><p>​        1、System.out.println(“”)；将关键数据打印在控制台；去掉？写在一个文件？</p><p>​        2、框架来记录系统的一些运行时信息；日志框架 ；  zhanglogging.jar；</p><p>​        3、高大上的几个功能？异步模式？自动归档？xxxx？  zhanglogging-good.jar？</p><p>​        4、将以前框架卸下来？换上新的框架，重新修改之前相关的API；zhanglogging-prefect.jar；</p><p>​        5、JDBC—数据库驱动；</p><p>​            写了一个统一的接口层；日志门面（日志的一个抽象层）；logging-abstract.jar；</p><p>​            给项目中导入具体的日志实现就行了；我们之前的日志框架都是实现的抽象层；</p><p><strong>市面上的日志框架；</strong></p><p>JUL、JCL、Jboss-logging、logback、log4j、log4j2、slf4j….</p><table><thead><tr><th>日志门面  （日志的抽象层）</th><th>日志实现</th></tr></thead><tbody><tr><td><del>JCL（Jakarta  Commons Logging）</del>    SLF4j（Simple  Logging Facade for Java）    <strong><del>jboss-logging</del></strong></td><td>Log4j  JUL（java.util.logging）  Log4j2  <strong>Logback</strong></td></tr></tbody></table><p>左边选一个门面（抽象层）、右边来选一个实现；</p><p>日志门面：  SLF4J；</p><p>日志实现：Logback；</p><p>SpringBoot：底层是Spring框架，Spring框架默认是用JCL；‘</p><p>​    <strong>==SpringBoot选用 SLF4j和logback；==</strong></p><h2 id="2、SLF4j使用"><a href="#2、SLF4j使用" class="headerlink" title="2、SLF4j使用"></a>2、SLF4j使用</h2><h3 id="1、如何在系统中使用SLF4j-https-www-slf4j-org"><a href="#1、如何在系统中使用SLF4j-https-www-slf4j-org" class="headerlink" title="1、如何在系统中使用SLF4j   https://www.slf4j.org"></a>1、如何在系统中使用SLF4j   <a href="https://www.slf4j.org/">https://www.slf4j.org</a></h3><p>以后开发的时候，日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法；</p><p>给系统里面导入slf4j的jar和  logback的实现jar</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> {</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">"Hello World"</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>图示；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/concrete-bindings.png" alt="images/concrete-bindings.png"></p><p>每一个日志的实现框架都有自己的配置文件。使用slf4j以后，<strong>配置文件还是做成日志实现框架自己本身的配置文件；</strong></p><h3 id="2、遗留问题"><a href="#2、遗留问题" class="headerlink" title="2、遗留问题"></a>2、遗留问题</h3><p>a（slf4j+logback）: Spring（commons-logging）、Hibernate（jboss-logging）、MyBatis、xxxx</p><p>统一日志记录，即使是别的框架和我一起统一使用slf4j进行输出？</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/legacy.png"></p><p><strong>如何让系统中所有的日志都统一到slf4j；</strong></p><p>==1、将系统中其他日志框架先排除出去；==</p><p>==2、用中间包来替换原有的日志框架；==</p><p>==3、我们导入slf4j其他的实现==</p><h2 id="3、SpringBoot日志关系"><a href="#3、SpringBoot日志关系" class="headerlink" title="3、SpringBoot日志关系"></a>3、SpringBoot日志关系</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>SpringBoot使用它来做日志功能；</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>底层依赖关系</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131220946.png"></p><p>总结：</p><p>​    1）、SpringBoot底层也是使用slf4j+logback的方式进行日志记录</p><p>​    2）、SpringBoot也把其他的日志都替换成了slf4j；</p><p>​    3）、中间替换包？</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings("rawtypes")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LogFactory</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J</span> <span class="operator">=</span> <span class="string">"http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">LogFactory</span> <span class="variable">logFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SLF4JLogFactory</span>();</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131221411.png"></p><p>​    4）、如果我们要引入其他框架？一定要把这个框架的默认日志依赖移除掉？</p><p>​            Spring框架用的是commons-logging；</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><strong>==SpringBoot能自动适配所有的日志，而且底层使用slf4j+logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖的日志框架排除掉即可；==</strong></p><h2 id="4、日志使用；"><a href="#4、日志使用；" class="headerlink" title="4、日志使用；"></a>4、日志使用；</h2><h3 id="1、默认配置"><a href="#1、默认配置" class="headerlink" title="1、默认配置"></a>1、默认配置</h3><p>SpringBoot默认帮我们配置好了日志；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//记录器</span></span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> {</span><br><span class="line"><span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//日志的级别；</span></span><br><span class="line"><span class="comment">//由低到高   trace&lt;debug&lt;info&lt;warn&lt;error</span></span><br><span class="line"><span class="comment">//可以调整输出的日志级别；日志就只会在这个级别以以后的高级别生效</span></span><br><span class="line">logger.trace(<span class="string">"这是trace日志..."</span>);</span><br><span class="line">logger.debug(<span class="string">"这是debug日志..."</span>);</span><br><span class="line"><span class="comment">//SpringBoot默认给我们使用的是info级别的，没有指定级别的就用SpringBoot默认规定的级别；root级别</span></span><br><span class="line">logger.info(<span class="string">"这是info日志..."</span>);</span><br><span class="line">logger.warn(<span class="string">"这是warn日志..."</span>);</span><br><span class="line">logger.error(<span class="string">"这是error日志..."</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><pre><code>    日志输出格式：        %d表示日期时间，        %thread表示线程名，        %-5level：级别从左显示5个字符宽度        %logger{50} 表示logger名字最长50个字符，否则按照句点分割。         %msg：日志消息，        %n是换行符    --&gt;    %d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</code></pre><p>SpringBoot修改日志的默认配置</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.level.com.atguigu</span>=<span class="string">trace</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#logging.path=</span></span><br><span class="line"><span class="comment"># 不指定路径在当前项目下生成springboot.log日志</span></span><br><span class="line"><span class="comment"># 可以指定完整的路径；</span></span><br><span class="line"><span class="comment">#logging.file=G:/springboot.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 在当前磁盘的根路径下创建spring文件夹和里面的log文件夹；使用&nbsp;spring.log 作为默认文件</span></span><br><span class="line"><span class="attr">logging.path</span>=<span class="string">/spring/log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#  在控制台输出的日志的格式</span></span><br><span class="line"><span class="attr">logging.pattern.console</span>=<span class="string">%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n</span></span><br><span class="line"><span class="comment"># 指定文件中日志输出的格式</span></span><br><span class="line"><span class="attr">logging.pattern.file</span>=<span class="string">%d{yyyy-MM-dd} === [%thread] === %-5level === %logger{50} ==== %msg%n</span></span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>logging.file</th><th>logging.path</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>(none)</td><td>(none)</td><td></td><td>只在控制台输出</td></tr><tr><td>指定文件名</td><td>(none)</td><td>my.log</td><td>输出日志到my.log文件</td></tr><tr><td>(none)</td><td>指定目录</td><td>/var/log</td><td>输出到指定目录的 spring.log 文件中</td></tr></tbody></table><h3 id="2、指定配置"><a href="#2、指定配置" class="headerlink" title="2、指定配置"></a>2、指定配置</h3><p>给类路径下放上每个日志框架自己的配置文件即可；SpringBoot就不使用他默认配置的了</p><table><thead><tr><th>Logging System</th><th>Customization</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr><tr><td>JDK (Java Util Logging)</td><td><code>logging.properties</code></td></tr></tbody></table><p>logback.xml：直接就被日志框架识别了；</p><p><strong>logback-spring.xml</strong>：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用SpringBoot的高级Profile功能</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"staging"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configuration to be enabled when the "staging" profile is active --&gt;</span></span><br><span class="line">  可以指定某段配置只在某个环境下生效</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>如：</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"stdout"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        日志输出格式：</span></span><br><span class="line"><span class="comment">%d表示日期时间，</span></span><br><span class="line"><span class="comment">%thread表示线程名，</span></span><br><span class="line"><span class="comment">%-5level：级别从左显示5个字符宽度</span></span><br><span class="line"><span class="comment">%logger{50} 表示logger名字最长50个字符，否则按照句点分割。 </span></span><br><span class="line"><span class="comment">%msg：日志消息，</span></span><br><span class="line"><span class="comment">%n是换行符</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} ----&gt; [%thread] ---&gt; %-5level %logger{50} - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"!dev"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} ==== [%thread] ==== %-5level %logger{50} - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下错误</p><p> <code>no applicable action for [springProfile]</code></p><h2 id="5、切换日志框架"><a href="#5、切换日志框架" class="headerlink" title="5、切换日志框架"></a>5、切换日志框架</h2><p>可以按照slf4j的日志适配图，进行相关的切换；</p><p>slf4j+log4j的方式；</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>切换为log4j2</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><hr><h1 id="四、Web开发"><a href="#四、Web开发" class="headerlink" title="四、Web开发"></a>四、Web开发</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><p>使用SpringBoot；</p><p><strong>1）、创建SpringBoot应用，选中我们需要的模块；</strong></p><p><strong>2）、SpringBoot已经默认将这些场景配置好了，只需要在配置文件中指定少量配置就可以运行起来</strong></p><p><strong>3）、自己编写业务代码；</strong></p><p><strong>自动配置原理？</strong></p><p>这个场景SpringBoot帮我们配置了什么？能不能修改？能修改哪些配置？能不能扩展？xxx</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxAutoConfiguration：帮我们给容器中自动配置组件；</span><br><span class="line">xxxxProperties:配置类来封装配置文件的内容；</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="2、SpringBoot对静态资源的映射规则；"><a href="#2、SpringBoot对静态资源的映射规则；" class="headerlink" title="2、SpringBoot对静态资源的映射规则；"></a>2、SpringBoot对静态资源的映射规则；</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = "spring.resources", ignoreUnknownFields = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceProperties</span> <span class="keyword">implements</span> <span class="title class_">ResourceLoaderAware</span> {</span><br><span class="line">  <span class="comment">//可以设置和静态资源有关的参数，缓存时间等</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">WebMvcAuotConfiguration：</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> {</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) {</span><br><span class="line">logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="type">Integer</span> <span class="variable">cachePeriod</span> <span class="operator">=</span> <span class="built_in">this</span>.resourceProperties.getCachePeriod();</span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) {</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(<span class="string">"/webjars/**"</span>)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="string">"classpath:/META-INF/resources/webjars/"</span>)</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">}</span><br><span class="line"><span class="type">String</span> <span class="variable">staticPathPattern</span> <span class="operator">=</span> <span class="built_in">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">         <span class="comment">//静态资源文件夹映射</span></span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) {</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(staticPathPattern)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="built_in">this</span>.resourceProperties.getStaticLocations())</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">       <span class="comment">//配置欢迎页映射</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(</span></span><br><span class="line"><span class="params">ResourceProperties resourceProperties)</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(resourceProperties.getWelcomePage(),</span><br><span class="line"><span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">      <span class="comment">//配置喜欢的图标</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(value = "spring.mvc.favicon.enabled", matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FaviconConfiguration</span> {</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ResourceProperties resourceProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">FaviconConfiguration</span><span class="params">(ResourceProperties resourceProperties)</span> {</span><br><span class="line"><span class="built_in">this</span>.resourceProperties = resourceProperties;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SimpleUrlHandlerMapping <span class="title function_">faviconHandlerMapping</span><span class="params">()</span> {</span><br><span class="line"><span class="type">SimpleUrlHandlerMapping</span> <span class="variable">mapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleUrlHandlerMapping</span>();</span><br><span class="line">mapping.setOrder(Ordered.HIGHEST_PRECEDENCE + <span class="number">1</span>);</span><br><span class="line">             <span class="comment">//所有  **/favicon.ico </span></span><br><span class="line">mapping.setUrlMap(Collections.singletonMap(<span class="string">"**/favicon.ico"</span>,</span><br><span class="line">faviconRequestHandler()));</span><br><span class="line"><span class="keyword">return</span> mapping;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ResourceHttpRequestHandler <span class="title function_">faviconRequestHandler</span><span class="params">()</span> {</span><br><span class="line"><span class="type">ResourceHttpRequestHandler</span> <span class="variable">requestHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceHttpRequestHandler</span>();</span><br><span class="line">requestHandler</span><br><span class="line">.setLocations(<span class="built_in">this</span>.resourceProperties.getFaviconLocations());</span><br><span class="line"><span class="keyword">return</span> requestHandler;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>==1）、所有 /webjars/** ，都去 classpath:/META-INF/resources/webjars/ 找资源；==</p><p>​    webjars：以jar包的方式引入静态资源；</p><p><a href="http://www.webjars.org/">http://www.webjars.org/</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180203181751.png"></p><p>localhost:8080/webjars/jquery/3.3.1/jquery.js</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入jquery-webjar--&gt;</span>在访问的时候只需要写webjars下面资源的名称即可</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>==2）、”/**” 访问当前项目的任何资源，都去（静态资源的文件夹）找映射==</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"classpath:/META-INF/resources/", </span><br><span class="line">"classpath:/resources/",</span><br><span class="line">"classpath:/static/", </span><br><span class="line">"classpath:/public/" </span><br><span class="line">"/"：当前项目的根路径</span><br></pre></td></tr></tbody></table></figure><p>localhost:8080/abc ===  去静态资源文件夹里面找abc</p><p>==3）、欢迎页； 静态资源文件夹下的所有index.html页面；被”/**”映射；==</p><p>​    localhost:8080/   找index页面</p><p>==4）、所有的 **/favicon.ico  都是在静态资源文件下找；==</p><h2 id="3、模板引擎"><a href="#3、模板引擎" class="headerlink" title="3、模板引擎"></a>3、模板引擎</h2><p>JSP、Velocity、Freemarker、Thymeleaf</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/template-engine.png"></p><p>SpringBoot推荐的Thymeleaf；</p><p>语法更简单，功能更强大；</p><h3 id="1、引入thymeleaf；"><a href="#1、引入thymeleaf；" class="headerlink" title="1、引入thymeleaf；"></a>1、引入thymeleaf；</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          2.1.6</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">切换thymeleaf版本</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.9.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 布局功能的支持程序  thymeleaf3主程序  layout2以上版本 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- thymeleaf2   layout1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2、Thymeleaf使用"><a href="#2、Thymeleaf使用" class="headerlink" title="2、Thymeleaf使用"></a>2、Thymeleaf使用</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = "spring.thymeleaf")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafProperties</span> {</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_ENCODING</span> <span class="operator">=</span> Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">MimeType</span> <span class="variable">DEFAULT_CONTENT_TYPE</span> <span class="operator">=</span> MimeType.valueOf(<span class="string">"text/html"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PREFIX</span> <span class="operator">=</span> <span class="string">"classpath:/templates/"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_SUFFIX</span> <span class="operator">=</span> <span class="string">".html"</span>;</span><br><span class="line">  <span class="comment">//</span></span><br></pre></td></tr></tbody></table></figure><p>只要我们把HTML页面放在classpath:/templates/，thymeleaf就能自动渲染；</p><p>使用：</p><p>1、导入thymeleaf的名称空间</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>2、使用thymeleaf语法；</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>成功！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--th:text 将div里面的文本内容设置为 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">"${hello}"</span>&gt;</span>这是显示欢迎信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3、语法规则"><a href="#3、语法规则" class="headerlink" title="3、语法规则"></a>3、语法规则</h3><p>1）、th:text；改变当前元素里面的文本内容；</p><p>​    th：任意html属性；来替换原生属性的值</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/2018-02-04_123955.png"></p><p>2）、表达式？</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Simple</span> <span class="string">expressions:（表达式语法）</span></span><br><span class="line">    <span class="attr">Variable</span> <span class="string">Expressions: ${...}：获取变量值；OGNL；</span></span><br><span class="line">    <span class="attr">1）、获取对象的属性、调用方法</span></span><br><span class="line">    <span class="attr">2）、使用内置的基本对象：</span></span><br><span class="line"><span class="comment">    #ctx : the context object.</span></span><br><span class="line"><span class="comment">    #vars: the context variables.</span></span><br><span class="line"><span class="comment">                #locale : the context locale.</span></span><br><span class="line"><span class="comment">                #request : (only in Web Contexts) the HttpServletRequest object.</span></span><br><span class="line"><span class="comment">                #response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line"><span class="comment">                #session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line"><span class="comment">                #servletContext : (only in Web Contexts) the ServletContext object.</span></span><br><span class="line">                </span><br><span class="line">                <span class="attr">${session.foo}</span></span><br><span class="line">            <span class="attr">3）、内置的一些工具对象：</span></span><br><span class="line"><span class="comment">#execInfo : information about the template being processed.</span></span><br><span class="line"><span class="comment">#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they would be obtained using #{…} syntax.</span></span><br><span class="line"><span class="comment">#uris : methods for escaping parts of URLs/URIs</span></span><br><span class="line"><span class="comment">#conversions : methods for executing the configured conversion service (if any).</span></span><br><span class="line"><span class="comment">#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span></span><br><span class="line"><span class="comment">#calendars : analogous to #dates , but for java.util.Calendar objects.</span></span><br><span class="line"><span class="comment">#numbers : methods for formatting numeric objects.</span></span><br><span class="line"><span class="comment">#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span></span><br><span class="line"><span class="comment">#objects : methods for objects in general.</span></span><br><span class="line"><span class="comment">#bools : methods for boolean evaluation.</span></span><br><span class="line"><span class="comment">#arrays : methods for arrays.</span></span><br><span class="line"><span class="comment">#lists : methods for lists.</span></span><br><span class="line"><span class="comment">#sets : methods for sets.</span></span><br><span class="line"><span class="comment">#maps : methods for maps.</span></span><br><span class="line"><span class="comment">#aggregates : methods for creating aggregates on arrays or collections.</span></span><br><span class="line"><span class="comment">#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration).</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Selection</span> <span class="string">Variable Expressions: *{...}：选择表达式：和${}在功能上是一样；</span></span><br><span class="line">    <span class="attr">补充：配合</span> <span class="string">th:object="${session.user}：</span></span><br><span class="line">   <span class="attr">&lt;div</span> <span class="string">th:object="${session.user}"&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Name</span>: <span class="string">&lt;span th:text="*{firstName}"&gt;Sebastian&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Surname</span>: <span class="string">&lt;span th:text="*{lastName}"&gt;Pepper&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Nationality</span>: <span class="string">&lt;span th:text="*{nationality}"&gt;Saturn&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">Message</span> <span class="string">Expressions: #{...}：获取国际化内容</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">URL Expressions: @{...}：定义URL；</span></span><br><span class="line">    <span class="attr">@{/order/process(execId</span>=<span class="string">${execId},execType='FAST')}</span></span><br><span class="line">    <span class="attr">Fragment</span> <span class="string">Expressions: ~{...}：片段引用表达式</span></span><br><span class="line">    <span class="attr">&lt;div</span> <span class="string">th:insert="~{commons :: main}"&gt;...&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">Literals（字面量）</span></span><br><span class="line">      <span class="attr">Text</span> <span class="string">literals: 'one text' , 'Another one!' ,…</span></span><br><span class="line">      <span class="attr">Number</span> <span class="string">literals: 0 , 34 , 3.0 , 12.3 ,…</span></span><br><span class="line">      <span class="attr">Boolean</span> <span class="string">literals: true , false</span></span><br><span class="line">      <span class="attr">Null</span> <span class="string">literal: null</span></span><br><span class="line">      <span class="attr">Literal</span> <span class="string">tokens: one , sometext , main ,…</span></span><br><span class="line"><span class="attr">Text</span> <span class="string">operations:（文本操作）</span></span><br><span class="line">    <span class="attr">String</span> <span class="string">concatenation: +</span></span><br><span class="line">    <span class="attr">Literal</span> <span class="string">substitutions: |The name is ${name}|</span></span><br><span class="line"><span class="attr">Arithmetic</span> <span class="string">operations:（数学运算）</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: + , - , * , / , %</span></span><br><span class="line">    <span class="attr">Minus</span> <span class="string">sign (unary operator): -</span></span><br><span class="line"><span class="attr">Boolean</span> <span class="string">operations:（布尔运算）</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: and , or</span></span><br><span class="line">    <span class="attr">Boolean</span> <span class="string">negation (unary operator): ! , not</span></span><br><span class="line"><span class="attr">Comparisons</span> <span class="string">and equality:（比较运算）</span></span><br><span class="line">    <span class="attr">Comparators</span>: <span class="string">&gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span></span><br><span class="line">    <span class="attr">Equality</span> <span class="string">operators: == , != ( eq , ne )</span></span><br><span class="line"><span class="attr">Conditional</span> <span class="string">operators:条件运算（三元运算符）</span></span><br><span class="line">    <span class="attr">If-then</span>: <span class="string">(if) ? (then)</span></span><br><span class="line">    <span class="attr">If-then-else</span>: <span class="string">(if) ? (then) : (else)</span></span><br><span class="line">    <span class="attr">Default</span>: <span class="string">(value) ?: (defaultvalue)</span></span><br><span class="line"><span class="attr">Special</span> <span class="string">tokens:</span></span><br><span class="line">    <span class="attr">No-Operation</span>: <span class="string">_ </span></span><br></pre></td></tr></tbody></table></figure><h2 id="4、SpringMVC自动配置"><a href="#4、SpringMVC自动配置" class="headerlink" title="4、SpringMVC自动配置"></a>4、SpringMVC自动配置</h2><p><a href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications">https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications</a></p><h3 id="1-Spring-MVC-auto-configuration"><a href="#1-Spring-MVC-auto-configuration" class="headerlink" title="1. Spring MVC auto-configuration"></a>1. Spring MVC auto-configuration</h3><p>Spring Boot 自动配置好了SpringMVC</p><p>以下是SpringBoot对SpringMVC的默认配置:<strong>==（WebMvcAutoConfiguration）==</strong></p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p><ul><li>自动配置了ViewResolver（视图解析器：根据方法的返回值得到视图对象（View），视图对象决定如何渲染（转发？重定向？））</li><li>ContentNegotiatingViewResolver：组合所有的视图解析器的；</li><li>==如何定制：我们可以自己给容器中添加一个视图解析器；自动的将其组合进来；==</li></ul></li><li><p>Support for serving static resources, including support for WebJars (see below).静态资源文件夹路径,webjars</p></li><li><p>Static <code>index.html</code> support. 静态首页访问</p></li><li><p>Custom <code>Favicon</code> support (see below).  favicon.ico</p></li><li><p>自动注册了 of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p><ul><li>Converter：转换器；  public String hello(User user)：类型转换使用Converter</li><li><code>Formatter</code>  格式化器；  2017.12.17===Date；</li></ul></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "spring.mvc", name = "date-format")</span><span class="comment">//在文件中配置日期格式化的规则</span></span><br><span class="line"><span class="keyword">public</span> Formatter&lt;Date&gt; <span class="title function_">dateFormatter</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DateFormatter</span>(<span class="built_in">this</span>.mvcProperties.getDateFormat());<span class="comment">//日期格式化组件</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    ==自己添加的格式化器转换器，我们只需要放在容器中即可==</p><ul><li><p>Support for <code>HttpMessageConverters</code> (see below).</p><ul><li><p>HttpMessageConverter：SpringMVC用来转换Http请求和响应的；User—Json；</p></li><li><p><code>HttpMessageConverters</code> 是从容器中确定；获取所有的HttpMessageConverter；</p><p>==自己给容器中添加HttpMessageConverter，只需要将自己的组件注册容器中（@Bean,@Component）==</p></li></ul></li><li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).定义错误代码生成规则</p></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p><p>==我们可以配置一个ConfigurableWebBindingInitializer来替换默认的；（添加到容器）==</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">初始化WebDataBinder；</span><br><span class="line">请求数据=====JavaBean；</span><br></pre></td></tr></tbody></table></figure></li></ul><p><strong>org.springframework.boot.autoconfigure.web：web的所有自动场景；</strong></p><p>If you want to keep Spring Boot MVC features, and you just want to add additional <a href="https://docs.spring.io/spring/docs/4.3.14.RELEASE/spring-framework-reference/htmlsingle#mvc">MVC configuration</a> (interceptors, formatters, view controllers etc.) you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurerAdapter</code>, but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code> or <code>ExceptionHandlerExceptionResolver</code> you can declare a <code>WebMvcRegistrationsAdapter</code> instance providing such components.</p><p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>.</p><h3 id="2、扩展SpringMVC"><a href="#2、扩展SpringMVC" class="headerlink" title="2、扩展SpringMVC"></a>2、扩展SpringMVC</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">"/hello"</span> <span class="attr">view-name</span>=<span class="string">"success"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/hello"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><strong>==编写一个配置类（@Configuration），是WebMvcConfigurerAdapter类型；不能标注@EnableWebMvc==</strong>;</p><p>既保留了所有的自动配置，也能用我们扩展的配置；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>原理：</p><p>​    1）、WebMvcAutoConfiguration是SpringMVC的自动配置类</p><p>​    2）、在做其他自动配置时会导入；@Import(<strong>EnableWebMvcConfiguration</strong>.class)</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">DelegatingWebMvcConfiguration</span> {</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebMvcConfigurerComposite</span> <span class="variable">configurers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerComposite</span>();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//从容器中获取所有的WebMvcConfigurer</span></span><br><span class="line">     <span class="meta">@Autowired(required = false)</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> {</span><br><span class="line">         <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) {</span><br><span class="line">             <span class="built_in">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">           <span class="comment">//一个参考实现；将所有的WebMvcConfigurer相关配置都来一起调用；  </span></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">// public void addViewControllers(ViewControllerRegistry registry) {</span></span><br><span class="line">             <span class="comment">//    for (WebMvcConfigurer delegate : this.delegates) {</span></span><br><span class="line">              <span class="comment">//       delegate.addViewControllers(registry);</span></span><br><span class="line">              <span class="comment">//   }</span></span><br><span class="line">             }</span><br><span class="line">         }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    3）、容器中所有的WebMvcConfigurer都会一起起作用；</p><p>​    4）、我们的配置类也会被调用；</p><p>​    效果：SpringMVC的自动配置和我们的扩展配置都会起作用；</p><h3 id="3、全面接管SpringMVC；"><a href="#3、全面接管SpringMVC；" class="headerlink" title="3、全面接管SpringMVC；"></a>3、全面接管SpringMVC；</h3><p>SpringBoot对SpringMVC的自动配置不需要了，所有都是我们自己配置；所有的SpringMVC的自动配置都失效了</p><p><strong>我们需要在配置类中添加@EnableWebMvc即可；</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>原理：</p><p>为什么@EnableWebMvc自动配置就失效了；</p><p>1）@EnableWebMvc的核心</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(DelegatingWebMvcConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc {</span><br></pre></td></tr></tbody></table></figure><p>2）、</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> {</span><br></pre></td></tr></tbody></table></figure><p>3）、</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, DispatcherServlet.class,</span></span><br><span class="line"><span class="meta">WebMvcConfigurerAdapter.class })</span></span><br><span class="line"><span class="comment">//容器中没有这个组件的时候，这个自动配置类才生效</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter({ DispatcherServletAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">ValidationAutoConfiguration.class })</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> {</span><br></pre></td></tr></tbody></table></figure><p>4）、@EnableWebMvc将WebMvcConfigurationSupport组件导入进来；</p><p>5）、导入的WebMvcConfigurationSupport只是SpringMVC最基本的功能；</p><h2 id="5、如何修改SpringBoot的默认配置"><a href="#5、如何修改SpringBoot的默认配置" class="headerlink" title="5、如何修改SpringBoot的默认配置"></a>5、如何修改SpringBoot的默认配置</h2><p>模式：</p><p>​    1）、SpringBoot在自动配置很多组件的时候，先看容器中有没有用户自己配置的（@Bean、@Component）如果有就用用户配置的，如果没有，才自动配置；如果有些组件可以有多个（ViewResolver）将用户配置的和自己默认的组合起来；</p><p>​    2）、在SpringBoot中会有非常多的xxxConfigurer帮助我们进行扩展配置</p><p>​    3）、在SpringBoot中会有很多的xxxCustomizer帮助我们进行定制配置</p><h2 id="6、RestfulCRUD"><a href="#6、RestfulCRUD" class="headerlink" title="6、RestfulCRUD"></a>6、RestfulCRUD</h2><h3 id="1）、默认访问首页"><a href="#1）、默认访问首页" class="headerlink" title="1）、默认访问首页"></a>1）、默认访问首页</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="comment">//@EnableWebMvc   不要接管SpringMVC</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//所有的WebMvcConfigurerAdapter组件都会一起起作用</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//将组件注册在容器</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title function_">webMvcConfigurerAdapter</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">WebMvcConfigurerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerAdapter</span>() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">                registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">                registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        <span class="keyword">return</span> adapter;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="2）、国际化"><a href="#2）、国际化" class="headerlink" title="2）、国际化"></a>2）、国际化</h3><p><strong>1）、编写国际化配置文件；</strong></p><p>2）、使用ResourceBundleMessageSource管理国际化资源文件</p><p>3）、在页面使用fmt:message取出国际化内容</p><p>步骤：</p><p>1）、编写国际化配置文件，抽取页面需要显示的国际化消息</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211130721.png"></p><p>2）、SpringBoot自动配置好了管理国际化资源文件的组件；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = "spring.messages")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageSourceAutoConfiguration</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Comma-separated list of basenames (essentially a fully-qualified classpath</span></span><br><span class="line"><span class="comment"> * location), each following the ResourceBundle convention with relaxed support for</span></span><br><span class="line"><span class="comment"> * slash based locations. If it doesn't contain a package qualifier (such as</span></span><br><span class="line"><span class="comment"> * "org.mypackage"), it will be resolved from the classpath root.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">basename</span> <span class="operator">=</span> <span class="string">"messages"</span>;  </span><br><span class="line">    <span class="comment">//我们的配置文件可以直接放在类路径下叫messages.properties；</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageSource <span class="title function_">messageSource</span><span class="params">()</span> {</span><br><span class="line"><span class="type">ResourceBundleMessageSource</span> <span class="variable">messageSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceBundleMessageSource</span>();</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.basename)) {</span><br><span class="line">            <span class="comment">//设置国际化资源文件的基础名（去掉语言国家代码的）</span></span><br><span class="line">messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">StringUtils.trimAllWhitespace(<span class="built_in">this</span>.basename)));</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.encoding != <span class="literal">null</span>) {</span><br><span class="line">messageSource.setDefaultEncoding(<span class="built_in">this</span>.encoding.name());</span><br><span class="line">}</span><br><span class="line">messageSource.setFallbackToSystemLocale(<span class="built_in">this</span>.fallbackToSystemLocale);</span><br><span class="line">messageSource.setCacheSeconds(<span class="built_in">this</span>.cacheSeconds);</span><br><span class="line">messageSource.setAlwaysUseMessageFormat(<span class="built_in">this</span>.alwaysUseMessageFormat);</span><br><span class="line"><span class="keyword">return</span> messageSource;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>3）、去页面获取国际化的值；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211134506.png"></p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>  <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Signin Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/bootstrap.min.css"</span> <span class="attr">th:href</span>=<span class="string">"@{/webjars/bootstrap/4.0.0/css/bootstrap.css}"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/signin.css"</span> <span class="attr">th:href</span>=<span class="string">"@{/asserts/css/signin.css}"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-signin"</span> <span class="attr">action</span>=<span class="string">"dashboard.html"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"mb-4"</span> <span class="attr">th:src</span>=<span class="string">"@{/asserts/img/bootstrap-solid.svg}"</span> <span class="attr">src</span>=<span class="string">"asserts/img/bootstrap-solid.svg"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"72"</span> <span class="attr">height</span>=<span class="string">"72"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h3 mb-3 font-weight-normal"</span> <span class="attr">th:text</span>=<span class="string">"#{login.tip}"</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#{login.username}"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">th:placeholder</span>=<span class="string">"#{login.username}"</span> <span class="attr">required</span>=<span class="string">""</span> <span class="attr">autofocus</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#{login.password}"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">th:placeholder</span>=<span class="string">"#{login.password}"</span> <span class="attr">required</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox mb-3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"remember-me"</span>/&gt;</span> [[#{login.remember}]]</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-lg btn-primary btn-block"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">th:text</span>=<span class="string">"#{login.btn}"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"mt-5 mb-3 text-muted"</span>&gt;</span>© 2017-2018<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>效果：根据浏览器语言设置的信息切换了国际化；</p><p>原理：</p><p>​    国际化Locale（区域信息对象）；LocaleResolver（获取区域信息对象）；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "spring.mvc", name = "locale")</span></span><br><span class="line"><span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.mvcProperties</span><br><span class="line">.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FixedLocaleResolver</span>(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line">}</span><br><span class="line"><span class="type">AcceptHeaderLocaleResolver</span> <span class="variable">localeResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AcceptHeaderLocaleResolver</span>();</span><br><span class="line">localeResolver.setDefaultLocale(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line"><span class="keyword">return</span> localeResolver;</span><br><span class="line">}</span><br><span class="line">默认的就是根据请求头带来的区域信息获取Locale进行国际化</span><br></pre></td></tr></tbody></table></figure><p>4）、点击链接切换国际化</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 可以在连接上携带区域信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title class_">LocaleResolver</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Locale <span class="title function_">resolveLocale</span><span class="params">(HttpServletRequest request)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">l</span> <span class="operator">=</span> request.getParameter(<span class="string">"l"</span>);</span><br><span class="line">        <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span> Locale.getDefault();</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(l)){</span><br><span class="line">            String[] split = l.split(<span class="string">"_"</span>);</span><br><span class="line">            locale = <span class="keyword">new</span> <span class="title class_">Locale</span>(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyLocaleResolver</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="3）、登陆"><a href="#3）、登陆" class="headerlink" title="3）、登陆"></a>3）、登陆</h3><p>开发期间模板引擎页面修改以后，要实时生效</p><p>1）、禁用模板引擎的缓存</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 禁用缓存</span><br><span class="line">spring.thymeleaf.cache=false </span><br></pre></td></tr></tbody></table></figure><p>2）、页面修改完成以后ctrl+f9：重新编译；</p><p>登陆错误消息的显示</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: red"</span> <span class="attr">th:text</span>=<span class="string">"${msg}"</span> <span class="attr">th:if</span>=<span class="string">"${not #strings.isEmpty(msg)}"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4）、拦截器进行登陆检查"><a href="#4）、拦截器进行登陆检查" class="headerlink" title="4）、拦截器进行登陆检查"></a>4）、拦截器进行登陆检查</h3><p>拦截器</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登陆检查，</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> {</span><br><span class="line">    <span class="comment">//目标方法执行之前</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">"loginUser"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>){</span><br><span class="line">            <span class="comment">//未登陆，返回登陆页面</span></span><br><span class="line">            request.setAttribute(<span class="string">"msg"</span>,<span class="string">"没有权限请先登陆"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/index.html"</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//已登陆，放行请求</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>注册拦截器</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有的WebMvcConfigurerAdapter组件都会一起起作用</span></span><br><span class="line">  <span class="meta">@Bean</span> <span class="comment">//将组件注册在容器</span></span><br><span class="line">  <span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title function_">webMvcConfigurerAdapter</span><span class="params">()</span>{</span><br><span class="line">      <span class="type">WebMvcConfigurerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerAdapter</span>() {</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">              registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">              registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">              registry.addViewController(<span class="string">"/main.html"</span>).setViewName(<span class="string">"dashboard"</span>);</span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">          <span class="comment">//注册拦截器</span></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> {</span><br><span class="line">              <span class="comment">//super.addInterceptors(registry);</span></span><br><span class="line">              <span class="comment">//静态资源；  *.css , *.js</span></span><br><span class="line">              <span class="comment">//SpringBoot已经做好了静态资源映射</span></span><br><span class="line">              registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginHandlerInterceptor</span>()).addPathPatterns(<span class="string">"/**"</span>)</span><br><span class="line">                      .excludePathPatterns(<span class="string">"/index.html"</span>,<span class="string">"/"</span>,<span class="string">"/user/login"</span>);</span><br><span class="line">          }</span><br><span class="line">      };</span><br><span class="line">      <span class="keyword">return</span> adapter;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><h3 id="5）、CRUD-员工列表"><a href="#5）、CRUD-员工列表" class="headerlink" title="5）、CRUD-员工列表"></a>5）、CRUD-员工列表</h3><p>实验要求：</p><p>1）、RestfulCRUD：CRUD满足Rest风格；</p><p>URI：  /资源名称/资源标识       HTTP请求方式区分对资源CRUD操作</p><table><thead><tr><th></th><th>普通CRUD（uri来区分操作）</th><th>RestfulCRUD</th></tr></thead><tbody><tr><td>查询</td><td>getEmp</td><td>emp—GET</td></tr><tr><td>添加</td><td>addEmp?xxx</td><td>emp—POST</td></tr><tr><td>修改</td><td>updateEmp?id=xxx&amp;xxx=xx</td><td>emp/{id}—PUT</td></tr><tr><td>删除</td><td>deleteEmp?id=1</td><td>emp/{id}—DELETE</td></tr></tbody></table><p>2）、实验的请求架构;</p><table><thead><tr><th>实验功能</th><th>请求URI</th><th>请求方式</th></tr></thead><tbody><tr><td>查询所有员工</td><td>emps</td><td>GET</td></tr><tr><td>查询某个员工(来到修改页面)</td><td>emp/1</td><td>GET</td></tr><tr><td>来到添加页面</td><td>emp</td><td>GET</td></tr><tr><td>添加员工</td><td>emp</td><td>POST</td></tr><tr><td>来到修改页面（查出员工进行信息回显）</td><td>emp/1</td><td>GET</td></tr><tr><td>修改员工</td><td>emp</td><td>PUT</td></tr><tr><td>删除员工</td><td>emp/1</td><td>DELETE</td></tr></tbody></table><p>3）、员工列表：</p><h4 id="thymeleaf公共页面元素抽取"><a href="#thymeleaf公共页面元素抽取" class="headerlink" title="thymeleaf公共页面元素抽取"></a>thymeleaf公共页面元素抽取</h4><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1、抽取公共片段</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2、引入公共片段</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"~{footer :: copy}"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">~{templatename::selector}：模板名::选择器</span><br><span class="line">~{templatename::fragmentname}:模板名::片段名</span><br><span class="line"></span><br><span class="line">3、默认效果：</span><br><span class="line">insert的公共片段在div标签中</span><br><span class="line">如果使用th:insert等属性进行引入，可以不用写~{}：</span><br><span class="line">行内写法可以加上：[[~{}]];[(~{})]；</span><br></pre></td></tr></tbody></table></figure><p>三种引入公共片段的th属性：</p><p><strong>th:insert</strong>：将公共片段整个插入到声明引入的元素中</p><p><strong>th:replace</strong>：将声明引入的元素替换为公共片段</p><p><strong>th:include</strong>：将被引入的片段的内容包含进这个标签中</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">引入方式</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">效果</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>引入片段的时候传入参数： </p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"col-md-2 d-none d-md-block bg-light sidebar"</span> <span class="attr">id</span>=<span class="string">"sidebar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-sticky"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav flex-column"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link active"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">th:class</span>=<span class="string">"${activeUri=='main.html'?'nav-link active':'nav-link'}"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">th:href</span>=<span class="string">"@{/main.html}"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">width</span>=<span class="string">"24"</span> <span class="attr">height</span>=<span class="string">"24"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 24 24"</span> <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">stroke</span>=<span class="string">"currentColor"</span> <span class="attr">stroke-width</span>=<span class="string">"2"</span> <span class="attr">stroke-linecap</span>=<span class="string">"round"</span> <span class="attr">stroke-linejoin</span>=<span class="string">"round"</span> <span class="attr">class</span>=<span class="string">"feather feather-home"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">"9 22 9 12 15 12 15 22"</span>&gt;</span><span class="tag">&lt;/<span class="name">polyline</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">                    Dashboard <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入侧边栏;传入参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"commons/bar::#sidebar(activeUri='emps')"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6）、CRUD-员工添加"><a href="#6）、CRUD-员工添加" class="headerlink" title="6）、CRUD-员工添加"></a>6）、CRUD-员工添加</h3><p>添加页面</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>  <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>男<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>  <span class="attr">value</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>4<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>5<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>提交的数据格式不对：生日：日期；</p><p>2017-12-12；2017/12/12；2017.12.12；</p><p>日期的格式化；SpringMVC将页面提交的值需要转换为指定的类型;</p><p>2017-12-12—Date； 类型转换，格式化;</p><p>默认日期是按照/的方式；</p><h3 id="7）、CRUD-员工修改"><a href="#7）、CRUD-员工修改" class="headerlink" title="7）、CRUD-员工修改"></a>7）、CRUD-员工修改</h3><p>修改添加二合一表单</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--需要区分是员工修改还是添加；--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@{/emp}"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--发送put请求修改员工数据--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">1、SpringMVC中配置HiddenHttpMethodFilter;（SpringBoot自动配置好的）</span></span><br><span class="line"><span class="comment">2、页面创建一个post表单</span></span><br><span class="line"><span class="comment">3、创建一个input项，name="_method";值就是我们指定的请求方式</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"put"</span> <span class="attr">th:if</span>=<span class="string">"${emp!=null}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">th:if</span>=<span class="string">"${emp!=null}"</span> <span class="attr">th:value</span>=<span class="string">"${emp.id}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"${emp!=null}?${emp.lastName}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span> <span class="attr">th:value</span>=<span class="string">"${emp!=null}?${emp.email}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">th:checked</span>=<span class="string">"${emp!=null}?${emp.gender==1}"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>男<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">th:checked</span>=<span class="string">"${emp!=null}?${emp.gender==0}"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--提交的是部门的id--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">name</span>=<span class="string">"department.id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:selected</span>=<span class="string">"${emp!=null}?${dept.id == emp.department.id}"</span> <span class="attr">th:value</span>=<span class="string">"${dept.id}"</span> <span class="attr">th:each</span>=<span class="string">"dept:${depts}"</span> <span class="attr">th:text</span>=<span class="string">"${dept.departmentName}"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"birth"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"${emp!=null}?${#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">th:text</span>=<span class="string">"${emp!=null}?'修改':'添加'"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8）、CRUD-员工删除"><a href="#8）、CRUD-员工删除" class="headerlink" title="8）、CRUD-员工删除"></a>8）、CRUD-员工删除</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">"emp:${emps}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${emp.id}"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>[[${emp.lastName}]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${emp.email}"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${emp.gender}==0?'女':'男'"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${emp.department.departmentName}"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')}"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-primary"</span> <span class="attr">th:href</span>=<span class="string">"@{/emp/}+${emp.id}"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:attr</span>=<span class="string">"del_uri=@{/emp/}+${emp.id}"</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-danger deleteBtn"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">".deleteBtn"</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>){</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//删除当前员工的</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">"#deleteEmpForm"</span>).<span class="title function_">attr</span>(<span class="string">"action"</span>,$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">"del_uri"</span>)).<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">    });</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="7、错误处理机制"><a href="#7、错误处理机制" class="headerlink" title="7、错误处理机制"></a>7、错误处理机制</h2><h3 id="1）、SpringBoot默认的错误处理机制"><a href="#1）、SpringBoot默认的错误处理机制" class="headerlink" title="1）、SpringBoot默认的错误处理机制"></a>1）、SpringBoot默认的错误处理机制</h3><p>默认效果：</p><p>​        1）、浏览器，返回一个默认的错误页面</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/../../../../Downloads/baiduyun/%25E6%2596%2587%25E6%25A1%25A3/Spring%2520Boot%2520%25E7%25AC%2594%25E8%25AE%25B0/images/%25E6%2590%259C%25E7%258B%2597%25E6%2588%25AA%25E5%259B%25BE20180226173408.png"></p><p>  浏览器发送请求的请求头：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180347.png"></p><p>​        2）、如果是其他客户端，默认响应一个json数据</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226173527.png"></p><p>​        <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180504.png"></p><p>原理：</p><p>​    可以参照ErrorMvcAutoConfiguration；错误处理的自动配置；</p><pre><code>  给容器中添加了以下组件</code></pre><p>​    1、DefaultErrorAttributes：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">帮我们在页面共享信息；</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes,</span></span><br><span class="line"><span class="params"><span class="type">boolean</span> includeStackTrace)</span> {</span><br><span class="line">Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String, Object&gt;();</span><br><span class="line">errorAttributes.put(<span class="string">"timestamp"</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">addStatus(errorAttributes, requestAttributes);</span><br><span class="line">addErrorDetails(errorAttributes, requestAttributes, includeStackTrace);</span><br><span class="line">addPath(errorAttributes, requestAttributes);</span><br><span class="line"><span class="keyword">return</span> errorAttributes;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    2、BasicErrorController：处理默认/error请求</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping("${server.error.path:${error.path:/error}}")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicErrorController</span> <span class="keyword">extends</span> <span class="title class_">AbstractErrorController</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(produces = "text/html")</span><span class="comment">//产生html类型的数据；浏览器发送的请求来到这个方法处理</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">errorHtml</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">HttpServletResponse response)</span> {</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line">Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">response.setStatus(status.value());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//去哪个页面作为错误页面；包含页面地址和页面内容</span></span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolveErrorView(request, response, status, model);</span><br><span class="line"><span class="keyword">return</span> (modelAndView == <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">"error"</span>, model) : modelAndView);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span>    <span class="comment">//产生json数据，其他客户端来到这个方法处理；</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">error</span><span class="params">(HttpServletRequest request)</span> {</span><br><span class="line">Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;Map&lt;String, Object&gt;&gt;(body, status);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    3、ErrorPageCustomizer：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value("${error.path:/error}")</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">"/error"</span>;  系统出现错误以后来到error请求进行处理；（web.xml注册的错误页面规则）</span><br></pre></td></tr></tbody></table></figure><p>​    4、DefaultErrorViewResolver：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status,</span></span><br><span class="line"><span class="params">Map&lt;String, Object&gt; model)</span> {</span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolve(String.valueOf(status), model);</span><br><span class="line"><span class="keyword">if</span> (modelAndView == <span class="literal">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) {</span><br><span class="line">modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> modelAndView;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ModelAndView <span class="title function_">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> {</span><br><span class="line">        <span class="comment">//默认SpringBoot可以去找到一个页面？  error/404</span></span><br><span class="line"><span class="type">String</span> <span class="variable">errorViewName</span> <span class="operator">=</span> <span class="string">"error/"</span> + viewName;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模板引擎可以解析这个页面地址就用模板引擎解析</span></span><br><span class="line"><span class="type">TemplateAvailabilityProvider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="built_in">this</span>.templateAvailabilityProviders</span><br><span class="line">.getProvider(errorViewName, <span class="built_in">this</span>.applicationContext);</span><br><span class="line"><span class="keyword">if</span> (provider != <span class="literal">null</span>) {</span><br><span class="line">            <span class="comment">//模板引擎可用的情况下返回到errorViewName指定的视图地址</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(errorViewName, model);</span><br><span class="line">}</span><br><span class="line">        <span class="comment">//模板引擎不可用，就在静态资源文件夹下找errorViewName对应的页面   error/404.html</span></span><br><span class="line"><span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    步骤：</p><p>​        一但系统出现4xx或者5xx之类的错误；ErrorPageCustomizer就会生效（定制错误的响应规则）；就会来到/error请求；就会被<strong>BasicErrorController</strong>处理；</p><p>​        1）响应页面；去哪个页面是由<strong>DefaultErrorViewResolver</strong>解析得到的；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">      HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model)</span> {</span><br><span class="line">    <span class="comment">//所有的ErrorViewResolver得到ModelAndView</span></span><br><span class="line">   <span class="keyword">for</span> (ErrorViewResolver resolver : <span class="built_in">this</span>.errorViewResolvers) {</span><br><span class="line">      <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolver.resolveErrorView(request, status, model);</span><br><span class="line">      <span class="keyword">if</span> (modelAndView != <span class="literal">null</span>) {</span><br><span class="line">         <span class="keyword">return</span> modelAndView;</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="2）、如果定制错误响应："><a href="#2）、如果定制错误响应：" class="headerlink" title="2）、如果定制错误响应："></a>2）、如果定制错误响应：</h3><h4 id="1）、如何定制错误的页面；"><a href="#1）、如何定制错误的页面；" class="headerlink" title="1）、如何定制错误的页面；"></a><strong>1）、如何定制错误的页面；</strong></h4><p>​            <strong>1）、有模板引擎的情况下；error/状态码;</strong> 【将错误页面命名为  错误状态码.html 放在模板引擎文件夹里面的 error文件夹下】，发生此状态码的错误就会来到  对应的页面；</p><p>​            我们可以使用4xx和5xx作为错误页面的文件名来匹配这种类型的所有错误，精确优先（优先寻找精确的状态码.html）；        </p><p>​            页面能获取的信息；</p><p>​                timestamp：时间戳</p><p>​                status：状态码</p><p>​                error：错误提示</p><p>​                exception：异常对象</p><p>​                message：异常消息</p><p>​                errors：JSR303数据校验的错误都在这里</p><p>​            2）、没有模板引擎（模板引擎找不到这个错误页面），静态资源文件夹下找；</p><p>​            3）、以上都没有错误页面，就是默认来到SpringBoot默认的错误提示页面；</p><h4 id="2）、如何定制错误的json数据；"><a href="#2）、如何定制错误的json数据；" class="headerlink" title="2）、如何定制错误的json数据；"></a>2）、如何定制错误的json数据；</h4><p>​        1）、自定义异常处理&amp;返回定制json数据；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExceptionHandler</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">handleException</span><span class="params">(Exception e)</span>{</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//没有自适应效果...</span></span><br></pre></td></tr></tbody></table></figure><p>​        2）、转发到/error进行自适应响应效果处理</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">handleException</span><span class="params">(Exception e, HttpServletRequest request)</span>{</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//传入我们自己的错误状态码  4xx 5xx，否则就不会进入定制错误页面的解析流程</span></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Integer statusCode = (Integer) request</span></span><br><span class="line"><span class="comment">        .getAttribute("javax.servlet.error.status_code");</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">500</span>);</span><br><span class="line">       map.put(<span class="string">"code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">       map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">       <span class="comment">//转发到/error</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure><h4 id="3）、将我们的定制数据携带出去；"><a href="#3）、将我们的定制数据携带出去；" class="headerlink" title="3）、将我们的定制数据携带出去；"></a>3）、将我们的定制数据携带出去；</h4><p>出现错误以后，会来到/error请求，会被BasicErrorController处理，响应出去可以获取的数据是由getErrorAttributes得到的（是AbstractErrorController（ErrorController）规定的方法）；</p><p>​    1、完全来编写一个ErrorController的实现类【或者是编写AbstractErrorController的子类】，放在容器中；</p><p>​    2、页面上能用的数据，或者是json返回能用的数据都是通过errorAttributes.getErrorAttributes得到；</p><p>​            容器中DefaultErrorAttributes.getErrorAttributes()；默认进行数据处理的；</p><p>自定义ErrorAttributes</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给容器中加入我们自己定义的ErrorAttributes</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title class_">DefaultErrorAttributes</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes, <span class="type">boolean</span> includeStackTrace)</span> {</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="built_in">super</span>.getErrorAttributes(requestAttributes, includeStackTrace);</span><br><span class="line">        map.put(<span class="string">"company"</span>,<span class="string">"atguigu"</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>最终的效果：响应是自适应的，可以通过定制ErrorAttributes改变需要返回的内容，</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180228135513.png"></p><h2 id="8、配置嵌入式Servlet容器"><a href="#8、配置嵌入式Servlet容器" class="headerlink" title="8、配置嵌入式Servlet容器"></a>8、配置嵌入式Servlet容器</h2><p>SpringBoot默认使用Tomcat作为嵌入式的Servlet容器；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180301142915.png"></p><p>问题？</p><h3 id="1）、如何定制和修改Servlet容器的相关配置；"><a href="#1）、如何定制和修改Servlet容器的相关配置；" class="headerlink" title="1）、如何定制和修改Servlet容器的相关配置；"></a>1）、如何定制和修改Servlet容器的相关配置；</h3><p>1、修改和server有关的配置（ServerProperties【也是EmbeddedServletContainerCustomizer】）；</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="attr">server.context-path</span>=<span class="string">/crud</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.tomcat.uri-encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">//通用的Servlet容器设置</span></span><br><span class="line"><span class="attr">server.xxx</span></span><br><span class="line"><span class="attr">//Tomcat的设置</span></span><br><span class="line"><span class="attr">server.tomcat.xxx</span></span><br></pre></td></tr></tbody></table></figure><p>2、编写一个<strong>EmbeddedServletContainerCustomizer</strong>：嵌入式的Servlet容器的定制器；来修改Servlet容器的配置</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  <span class="comment">//一定要将这个定制器加入到容器中</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedServletContainerCustomizer <span class="title function_">embeddedServletContainerCustomizer</span><span class="params">()</span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedServletContainerCustomizer</span>() {</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定制嵌入式的Servlet容器相关的规则</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(ConfigurableEmbeddedServletContainer container)</span> {</span><br><span class="line">            container.setPort(<span class="number">8083</span>);</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="2）、注册Servlet三大组件【Servlet、Filter、Listener】"><a href="#2）、注册Servlet三大组件【Servlet、Filter、Listener】" class="headerlink" title="2）、注册Servlet三大组件【Servlet、Filter、Listener】"></a>2）、注册Servlet三大组件【Servlet、Filter、Listener】</h3><p>由于SpringBoot默认是以jar包的方式启动嵌入式的Servlet容器来启动SpringBoot的web应用，没有web.xml文件。</p><p>注册三大组件用以下方式</p><p>ServletRegistrationBean</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册三大组件</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">myServlet</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">MyServlet</span>(),<span class="string">"/myServlet"</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>FilterRegistrationBean</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">FilterRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">    registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">MyFilter</span>());</span><br><span class="line">    registrationBean.setUrlPatterns(Arrays.asList(<span class="string">"/hello"</span>,<span class="string">"/myServlet"</span>));</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ServletListenerRegistrationBean</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title function_">myListener</span><span class="params">()</span>{</span><br><span class="line">    ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MyListener</span>());</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>SpringBoot帮我们自动SpringMVC的时候，自动的注册SpringMVC的前端控制器；DIspatcherServlet；</p><p>DispatcherServletAutoConfiguration中：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(value = DispatcherServlet.class, name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">dispatcherServletRegistration</span><span class="params">(</span></span><br><span class="line"><span class="params">      DispatcherServlet dispatcherServlet)</span> {</span><br><span class="line">   <span class="type">ServletRegistrationBean</span> <span class="variable">registration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(</span><br><span class="line">         dispatcherServlet, <span class="built_in">this</span>.serverProperties.getServletMapping());</span><br><span class="line">    <span class="comment">//默认拦截： /  所有请求；包静态资源，但是不拦截jsp请求；   /*会拦截jsp</span></span><br><span class="line">    <span class="comment">//可以通过server.servletPath来修改SpringMVC前端控制器默认拦截的请求路径</span></span><br><span class="line">    </span><br><span class="line">   registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);</span><br><span class="line">   registration.setLoadOnStartup(</span><br><span class="line">         <span class="built_in">this</span>.webMvcProperties.getServlet().getLoadOnStartup());</span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.multipartConfig != <span class="literal">null</span>) {</span><br><span class="line">      registration.setMultipartConfig(<span class="built_in">this</span>.multipartConfig);</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">return</span> registration;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>2）、SpringBoot能不能支持其他的Servlet容器；</p><h3 id="3）、替换为其他嵌入式Servlet容器"><a href="#3）、替换为其他嵌入式Servlet容器" class="headerlink" title="3）、替换为其他嵌入式Servlet容器"></a>3）、替换为其他嵌入式Servlet容器</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302114401.png"></p><p>默认支持：</p><p>Tomcat（默认使用）</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   引入web模块默认就是使用嵌入式的Tomcat作为Servlet容器；</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>Jetty</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>Undertow</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4）、嵌入式Servlet容器自动配置原理；"><a href="#4）、嵌入式Servlet容器自动配置原理；" class="headerlink" title="4）、嵌入式Servlet容器自动配置原理；"></a>4）、嵌入式Servlet容器自动配置原理；</h3><p>EmbeddedServletContainerAutoConfiguration：嵌入式的Servlet容器自动配置？</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@Import(BeanPostProcessorsRegistrar.class)</span></span><br><span class="line"><span class="comment">//导入BeanPostProcessorsRegistrar：Spring注解版；给容器中导入一些组件</span></span><br><span class="line"><span class="comment">//导入了EmbeddedServletContainerCustomizerBeanPostProcessor：</span></span><br><span class="line"><span class="comment">//后置处理器：bean初始化前后（创建完对象，还没赋值赋值）执行初始化工作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddedServletContainerAutoConfiguration</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, Tomcat.class })</span><span class="comment">//判断当前是否引入了Tomcat依赖；</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span><span class="comment">//判断当前容器没有用户自己定义EmbeddedServletContainerFactory：嵌入式的Servlet容器工厂；作用：创建嵌入式的Servlet容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedTomcat</span> {</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TomcatEmbeddedServletContainerFactory <span class="title function_">tomcatEmbeddedServletContainerFactory</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatEmbeddedServletContainerFactory</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nested configuration if Jetty is being used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, Server.class, Loader.class,</span></span><br><span class="line"><span class="meta">WebAppContext.class })</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedJetty</span> {</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> JettyEmbeddedServletContainerFactory <span class="title function_">jettyEmbeddedServletContainerFactory</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyEmbeddedServletContainerFactory</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nested configuration if Undertow is being used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, Undertow.class, SslClientAuthMode.class })</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedUndertow</span> {</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UndertowEmbeddedServletContainerFactory <span class="title function_">undertowEmbeddedServletContainerFactory</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UndertowEmbeddedServletContainerFactory</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>1）、EmbeddedServletContainerFactory（嵌入式Servlet容器工厂）</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmbeddedServletContainerFactory</span> {</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取嵌入式的Servlet容器</span></span><br><span class="line">   EmbeddedServletContainer <span class="title function_">getEmbeddedServletContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">         ServletContextInitializer... initializers)</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144835.png"></p><p>2）、EmbeddedServletContainer：（嵌入式的Servlet容器）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144910.png"></p><p>3）、以<strong>TomcatEmbeddedServletContainerFactory</strong>为例</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedServletContainer <span class="title function_">getEmbeddedServletContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">      ServletContextInitializer... initializers)</span> {</span><br><span class="line">    <span class="comment">//创建一个Tomcat</span></span><br><span class="line">   <span class="type">Tomcat</span> <span class="variable">tomcat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tomcat</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置Tomcat的基本环节</span></span><br><span class="line">   <span class="type">File</span> <span class="variable">baseDir</span> <span class="operator">=</span> (<span class="built_in">this</span>.baseDirectory != <span class="literal">null</span> ? <span class="built_in">this</span>.baseDirectory</span><br><span class="line">         : createTempDir(<span class="string">"tomcat"</span>));</span><br><span class="line">   tomcat.setBaseDir(baseDir.getAbsolutePath());</span><br><span class="line">   <span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Connector</span>(<span class="built_in">this</span>.protocol);</span><br><span class="line">   tomcat.getService().addConnector(connector);</span><br><span class="line">   customizeConnector(connector);</span><br><span class="line">   tomcat.setConnector(connector);</span><br><span class="line">   tomcat.getHost().setAutoDeploy(<span class="literal">false</span>);</span><br><span class="line">   configureEngine(tomcat.getEngine());</span><br><span class="line">   <span class="keyword">for</span> (Connector additionalConnector : <span class="built_in">this</span>.additionalTomcatConnectors) {</span><br><span class="line">      tomcat.getService().addConnector(additionalConnector);</span><br><span class="line">   }</span><br><span class="line">   prepareContext(tomcat.getHost(), initializers);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将配置好的Tomcat传入进去，返回一个EmbeddedServletContainer；并且启动Tomcat服务器</span></span><br><span class="line">   <span class="keyword">return</span> getTomcatEmbeddedServletContainer(tomcat);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4）、我们对嵌入式容器的配置修改是怎么生效？</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerProperties、EmbeddedServletContainerCustomizer</span><br></pre></td></tr></tbody></table></figure><p><strong>EmbeddedServletContainerCustomizer</strong>：定制器帮我们修改了Servlet容器的配置？</p><p>怎么修改的原理？</p><p>5）、容器中导入了<strong>EmbeddedServletContainerCustomizerBeanPostProcessor</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化之前</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span></span><br><span class="line">      <span class="keyword">throws</span> BeansException {</span><br><span class="line">    <span class="comment">//如果当前初始化的是一个ConfigurableEmbeddedServletContainer类型的组件</span></span><br><span class="line">   <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> ConfigurableEmbeddedServletContainer) {</span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      postProcessBeforeInitialization((ConfigurableEmbeddedServletContainer) bean);</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">return</span> bean;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">postProcessBeforeInitialization</span><span class="params">(</span></span><br><span class="line"><span class="params">ConfigurableEmbeddedServletContainer bean)</span> {</span><br><span class="line">    <span class="comment">//获取所有的定制器，调用每一个定制器的customize方法来给Servlet容器进行属性赋值；</span></span><br><span class="line">    <span class="keyword">for</span> (EmbeddedServletContainerCustomizer customizer : getCustomizers()) {</span><br><span class="line">        customizer.customize(bean);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Collection&lt;EmbeddedServletContainerCustomizer&gt; <span class="title function_">getCustomizers</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.customizers == <span class="literal">null</span>) {</span><br><span class="line">        <span class="comment">// Look up does not include the parent context</span></span><br><span class="line">        <span class="built_in">this</span>.customizers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;EmbeddedServletContainerCustomizer&gt;(</span><br><span class="line">            <span class="built_in">this</span>.beanFactory</span><br><span class="line">            <span class="comment">//从容器中获取所有这葛类型的组件：EmbeddedServletContainerCustomizer</span></span><br><span class="line">            <span class="comment">//定制Servlet容器，给容器中可以添加一个EmbeddedServletContainerCustomizer类型的组件</span></span><br><span class="line">            .getBeansOfType(EmbeddedServletContainerCustomizer.class,</span><br><span class="line">                            <span class="literal">false</span>, <span class="literal">false</span>)</span><br><span class="line">            .values());</span><br><span class="line">        Collections.sort(<span class="built_in">this</span>.customizers, AnnotationAwareOrderComparator.INSTANCE);</span><br><span class="line">        <span class="built_in">this</span>.customizers = Collections.unmodifiableList(<span class="built_in">this</span>.customizers);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.customizers;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">ServerProperties也是定制器</span><br></pre></td></tr></tbody></table></figure><p>步骤：</p><p>1）、SpringBoot根据导入的依赖情况，给容器中添加相应的EmbeddedServletContainerFactory【TomcatEmbeddedServletContainerFactory】</p><p>2）、容器中某个组件要创建对象就会惊动后置处理器；EmbeddedServletContainerCustomizerBeanPostProcessor；</p><p>只要是嵌入式的Servlet容器工厂，后置处理器就工作；</p><p>3）、后置处理器，从容器中获取所有的<strong>EmbeddedServletContainerCustomizer</strong>，调用定制器的定制方法</p><p>###5）、嵌入式Servlet容器启动原理；</p><p>什么时候创建嵌入式的Servlet容器工厂？什么时候获取嵌入式的Servlet容器并启动Tomcat；</p><p>获取嵌入式的Servlet容器工厂：</p><p>1）、SpringBoot应用启动运行run方法</p><p>2）、refreshContext(context);SpringBoot刷新IOC容器【创建IOC容器对象，并初始化容器，创建容器中的每一个组件】；如果是web应用创建<strong>AnnotationConfigEmbeddedWebApplicationContext</strong>，否则：<strong>AnnotationConfigApplicationContext</strong></p><p>3）、refresh(context);<strong>刷新刚才创建好的ioc容器；</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException {</span><br><span class="line">   <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) {</span><br><span class="line">      <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">      prepareRefresh();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">      <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">      prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">         <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">         postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">         invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">         registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">         initMessageSource();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">         initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">         onRefresh();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">         registerListeners();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">         finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">         finishRefresh();</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">catch</span> (BeansException ex) {</span><br><span class="line">         <span class="keyword">if</span> (logger.isWarnEnabled()) {</span><br><span class="line">            logger.warn(<span class="string">"Exception encountered during context initialization - "</span> +</span><br><span class="line">                  <span class="string">"cancelling refresh attempt: "</span> + ex);</span><br><span class="line">         }</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">         destroyBeans();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Reset 'active' flag.</span></span><br><span class="line">         cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">         <span class="keyword">throw</span> ex;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">finally</span> {</span><br><span class="line">         <span class="comment">// Reset common introspection caches in Spring's core, since we</span></span><br><span class="line">         <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">         resetCommonCaches();</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4）、  onRefresh(); web的ioc容器重写了onRefresh方法</p><p>5）、webioc容器会创建嵌入式的Servlet容器；<strong>createEmbeddedServletContainer</strong>();</p><p><strong>6）、获取嵌入式的Servlet容器工厂：</strong></p><p>EmbeddedServletContainerFactory containerFactory = getEmbeddedServletContainerFactory();</p><p>​    从ioc容器中获取EmbeddedServletContainerFactory 组件；<strong>TomcatEmbeddedServletContainerFactory</strong>创建对象，后置处理器一看是这个对象，就获取所有的定制器来先定制Servlet容器的相关配置；</p><p>7）、<strong>使用容器工厂获取嵌入式的Servlet容器</strong>：this.embeddedServletContainer = containerFactory      .getEmbeddedServletContainer(getSelfInitializer());</p><p>8）、嵌入式的Servlet容器创建对象并启动Servlet容器；</p><p><strong>先启动嵌入式的Servlet容器，再将ioc容器中剩下没有创建出的对象获取出来；</strong></p><p><strong>==IOC容器启动创建嵌入式的Servlet容器==</strong></p><h2 id="9、使用外置的Servlet容器"><a href="#9、使用外置的Servlet容器" class="headerlink" title="9、使用外置的Servlet容器"></a>9、使用外置的Servlet容器</h2><p>嵌入式Servlet容器：应用打成可执行的jar</p><p>​        优点：简单、便携；</p><p>​        缺点：默认不支持JSP、优化定制比较复杂（使用定制器【ServerProperties、自定义EmbeddedServletContainerCustomizer】，自己编写嵌入式Servlet容器的创建工厂【EmbeddedServletContainerFactory】）；</p><p>外置的Servlet容器：外面安装Tomcat—应用war包的方式打包；</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1）、必须创建一个war项目；（利用idea创建好目录结构）</p><p>2）、将嵌入式的Tomcat指定为provided；</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>3）、必须编写一个<strong>SpringBootServletInitializer</strong>的子类，并调用configure方法</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletInitializer</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span> {</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder application)</span> {</span><br><span class="line">       <span class="comment">//传入SpringBoot应用的主程序</span></span><br><span class="line">      <span class="keyword">return</span> application.sources(SpringBoot04WebJspApplication.class);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4）、启动服务器就可以使用；</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>jar包：执行SpringBoot主类的main方法，启动ioc容器，创建嵌入式的Servlet容器；</p><p>war包：启动服务器，<strong>服务器启动SpringBoot应用</strong>【SpringBootServletInitializer】，启动ioc容器；</p><p>servlet3.0（Spring注解版）：</p><p>8.2.4 Shared libraries / runtimes pluggability：</p><p>规则：</p><p>​    1）、服务器启动（web应用启动）会创建当前web应用里面每一个jar包里面ServletContainerInitializer实例：</p><p>​    2）、ServletContainerInitializer的实现放在jar包的META-INF/services文件夹下，有一个名为javax.servlet.ServletContainerInitializer的文件，内容就是ServletContainerInitializer的实现类的全类名</p><p>​    3）、还可以使用@HandlesTypes，在应用启动的时候加载我们感兴趣的类；</p><p>流程：</p><p>1）、启动Tomcat</p><p>2）、org\springframework\spring-web\4.3.14.RELEASE\spring-web-4.3.14.RELEASE.jar!\META-INF\services\javax.servlet.ServletContainerInitializer：</p><p>Spring的web模块里面有这个文件：<strong>org.springframework.web.SpringServletContainerInitializer</strong></p><p>3）、SpringServletContainerInitializer将@HandlesTypes(WebApplicationInitializer.class)标注的所有这个类型的类都传入到onStartup方法的Set&lt;Class&lt;?&gt;&gt;；为这些WebApplicationInitializer类型的类创建实例；</p><p>4）、每一个WebApplicationInitializer都调用自己的onStartup；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302221835.png"></p><p>5）、相当于我们的SpringBootServletInitializer的类会被创建对象，并执行onStartup方法</p><p>6）、SpringBootServletInitializer实例执行onStartup的时候会createRootApplicationContext；创建容器</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">(</span></span><br><span class="line"><span class="params">      ServletContext servletContext)</span> {</span><br><span class="line">    <span class="comment">//1、创建SpringApplicationBuilder</span></span><br><span class="line">   <span class="type">SpringApplicationBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> createSpringApplicationBuilder();</span><br><span class="line">   <span class="type">StandardServletEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardServletEnvironment</span>();</span><br><span class="line">   environment.initPropertySources(servletContext, <span class="literal">null</span>);</span><br><span class="line">   builder.environment(environment);</span><br><span class="line">   builder.main(getClass());</span><br><span class="line">   <span class="type">ApplicationContext</span> <span class="variable">parent</span> <span class="operator">=</span> getExistingRootWebApplicationContext(servletContext);</span><br><span class="line">   <span class="keyword">if</span> (parent != <span class="literal">null</span>) {</span><br><span class="line">      <span class="built_in">this</span>.logger.info(<span class="string">"Root context already created (using as parent)."</span>);</span><br><span class="line">      servletContext.setAttribute(</span><br><span class="line">            WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="literal">null</span>);</span><br><span class="line">      builder.initializers(<span class="keyword">new</span> <span class="title class_">ParentContextApplicationContextInitializer</span>(parent));</span><br><span class="line">   }</span><br><span class="line">   builder.initializers(</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">ServletContextApplicationContextInitializer</span>(servletContext));</span><br><span class="line">   builder.contextClass(AnnotationConfigEmbeddedWebApplicationContext.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//调用configure方法，子类重写了这个方法，将SpringBoot的主程序类传入了进来</span></span><br><span class="line">   builder = configure(builder);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用builder创建一个Spring应用</span></span><br><span class="line">   <span class="type">SpringApplication</span> <span class="variable">application</span> <span class="operator">=</span> builder.build();</span><br><span class="line">   <span class="keyword">if</span> (application.getSources().isEmpty() &amp;&amp; AnnotationUtils</span><br><span class="line">         .findAnnotation(getClass(), Configuration.class) != <span class="literal">null</span>) {</span><br><span class="line">      application.getSources().add(getClass());</span><br><span class="line">   }</span><br><span class="line">   Assert.state(!application.getSources().isEmpty(),</span><br><span class="line">         <span class="string">"No SpringApplication sources have been defined. Either override the "</span></span><br><span class="line">               + <span class="string">"configure method or add an @Configuration annotation"</span>);</span><br><span class="line">   <span class="comment">// Ensure error pages are registered</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.registerErrorPageFilter) {</span><br><span class="line">      application.getSources().add(ErrorPageFilterConfiguration.class);</span><br><span class="line">   }</span><br><span class="line">    <span class="comment">//启动Spring应用</span></span><br><span class="line">   <span class="keyword">return</span> run(application);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>7）、Spring的应用就启动并且创建IOC容器</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> {</span><br><span class="line">   <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">FailureAnalyzers</span> <span class="variable">analyzers</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">   <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> {</span><br><span class="line">      <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(</span><br><span class="line">            args);</span><br><span class="line">      <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">      <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">      analyzers = <span class="keyword">new</span> <span class="title class_">FailureAnalyzers</span>(context);</span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//刷新IOC容器</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">      listeners.finished(context, <span class="literal">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) {</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>==启动Servlet容器，再启动SpringBoot应用==</strong></p><h1 id="五、Docker"><a href="#五、Docker" class="headerlink" title="五、Docker"></a>五、Docker</h1><h2 id="1、简介-1"><a href="#1、简介-1" class="headerlink" title="1、简介"></a>1、简介</h2><p><strong>Docker</strong>是一个开源的应用容器引擎；是一个轻量级容器技术；</p><p>Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；</p><p>运行中的这个镜像称为容器，容器启动是非常快速的。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145450.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145531.png"></p><h2 id="2、核心概念"><a href="#2、核心概念" class="headerlink" title="2、核心概念"></a>2、核心概念</h2><p>docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；</p><p>docker客户端(Client)：连接docker主机进行操作；</p><p>docker仓库(Registry)：用来保存各种打包好的软件镜像；</p><p>docker镜像(Images)：软件打包好的镜像；放在docker仓库中；</p><p>docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303165113.png"></p><p>使用Docker的步骤：</p><p>1）、安装Docker</p><p>2）、去Docker仓库找到这个软件对应的镜像；</p><p>3）、使用Docker运行这个镜像，这个镜像就会生成一个Docker容器；</p><p>4）、对容器的启动停止就是对软件的启动停止；</p><h2 id="3、安装Docker"><a href="#3、安装Docker" class="headerlink" title="3、安装Docker"></a>3、安装Docker</h2><h4 id="1）、安装linux虚拟机"><a href="#1）、安装linux虚拟机" class="headerlink" title="1）、安装linux虚拟机"></a>1）、安装linux虚拟机</h4><p>​    1）、VMWare、VirtualBox（安装）；</p><p>​    2）、导入虚拟机文件centos7-atguigu.ova；</p><p>​    3）、双击启动linux虚拟机;使用  root/ 123456登陆</p><p>​    4）、使用客户端连接linux服务器进行命令操作；</p><p>​    5）、设置虚拟机网络；</p><p>​        桥接网络===选好网卡====接入网线；</p><p>​    6）、设置好网络以后使用命令重启虚拟机的网络</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></tbody></table></figure><p>​    7）、查看linux的ip地址</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></tbody></table></figure><p>​    8）、使用客户端连接linux；</p><h4 id="2）、在linux虚拟机上安装docker"><a href="#2）、在linux虚拟机上安装docker" class="headerlink" title="2）、在linux虚拟机上安装docker"></a>2）、在linux虚拟机上安装docker</h4><p>步骤：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1、检查内核版本，必须是3.10及以上</span><br><span class="line">uname -r</span><br><span class="line">2、安装docker</span><br><span class="line">yum install docker</span><br><span class="line">3、输入y确认安装</span><br><span class="line">4、启动docker</span><br><span class="line">[root@localhost ~]# systemctl start docker</span><br><span class="line">[root@localhost ~]# docker -v</span><br><span class="line">Docker version 1.12.6, build 3e8e77d/1.12.6</span><br><span class="line">5、开机启动docker</span><br><span class="line">[root@localhost ~]# systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">6、停止docker</span><br><span class="line">systemctl stop docker</span><br></pre></td></tr></tbody></table></figure><h2 id="4、Docker常用命令-amp-操作"><a href="#4、Docker常用命令-amp-操作" class="headerlink" title="4、Docker常用命令&amp;操作"></a>4、Docker常用命令&amp;操作</h2><h3 id="1）、镜像操作"><a href="#1）、镜像操作" class="headerlink" title="1）、镜像操作"></a>1）、镜像操作</h3><table><thead><tr><th>操作</th><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>检索</td><td>docker  search 关键字  eg：docker  search redis</td><td>我们经常去docker  hub上检索镜像的详细信息，如镜像的TAG。</td></tr><tr><td>拉取</td><td>docker pull 镜像名:tag</td><td>:tag是可选的，tag表示标签，多为软件的版本，默认是latest</td></tr><tr><td>列表</td><td>docker images</td><td>查看所有本地镜像</td></tr><tr><td>删除</td><td>docker rmi image-id</td><td>删除指定的本地镜像</td></tr></tbody></table><p><a href="https://hub.docker.com/">https://hub.docker.com/</a></p><h3 id="2）、容器操作"><a href="#2）、容器操作" class="headerlink" title="2）、容器操作"></a>2）、容器操作</h3><p>软件镜像（QQ安装程序）—-运行镜像—-产生一个容器（正在运行的软件，运行的QQ）；</p><p>步骤：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1、搜索镜像</span><br><span class="line">[root@localhost ~]# docker search tomcat</span><br><span class="line">2、拉取镜像</span><br><span class="line">[root@localhost ~]# docker pull tomcat</span><br><span class="line">3、根据镜像启动容器</span><br><span class="line">docker run --name mytomcat -d tomcat:latest</span><br><span class="line">4、docker ps  </span><br><span class="line">查看运行中的容器</span><br><span class="line">5、 停止运行中的容器</span><br><span class="line">docker stop  容器的id</span><br><span class="line">6、查看所有的容器</span><br><span class="line">docker ps -a</span><br><span class="line">7、启动容器</span><br><span class="line">docker start 容器id</span><br><span class="line">8、删除一个容器</span><br><span class="line"> docker rm 容器id</span><br><span class="line">9、启动一个做了端口映射的tomcat</span><br><span class="line">[root@localhost ~]# docker run -d -p 8888:8080 tomcat</span><br><span class="line">-d：后台运行</span><br><span class="line">-p: 将主机的端口映射到容器的一个端口    主机端口:容器内部的端口</span><br><span class="line"></span><br><span class="line">10、为了演示简单关闭了linux的防火墙</span><br><span class="line">service firewalld status ；查看防火墙状态</span><br><span class="line">service firewalld stop：关闭防火墙</span><br><span class="line">11、查看容器的日志</span><br><span class="line">docker logs container-name/container-id</span><br><span class="line"></span><br><span class="line">更多命令参看</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/docker/</span><br><span class="line">可以参考每一个镜像的文档</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="3）、安装MySQL示例"><a href="#3）、安装MySQL示例" class="headerlink" title="3）、安装MySQL示例"></a>3）、安装MySQL示例</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></tbody></table></figure><p>错误的启动</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -d mysql</span><br><span class="line">42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846</span><br><span class="line"></span><br><span class="line">mysql退出了</span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES</span><br><span class="line">42f09819908b        mysql               "docker-entrypoint.sh"   34 seconds ago      Exited (1) 33 seconds ago                            mysql01</span><br><span class="line">538bde63e500        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       compassionate_</span><br><span class="line">goldstine</span><br><span class="line">c4f1ac60b3fc        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       lonely_fermi</span><br><span class="line">81ec743a5271        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//错误日志</span><br><span class="line">[root@localhost ~]# docker logs 42f09819908b</span><br><span class="line">error: database is uninitialized and password option is not specified </span><br><span class="line">  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD；这个三个参数必须指定一个</span><br></pre></td></tr></tbody></table></figure><p>正确的启动</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b874c56bec49        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 3 seconds        3306/tcp            mysql01</span><br></pre></td></tr></tbody></table></figure><p>做了端口映射</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -p 3306:3306 --name mysql02 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">ad10e4bc5c6a        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp   mysql02</span><br></pre></td></tr></tbody></table></figure><p>几个其他的高级操作</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql03 -v /conf/mysql:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line">把主机的/conf/mysql文件夹挂载到 mysqldocker容器的/etc/mysql/conf.d文件夹里面</span><br><span class="line">改mysql的配置文件就只需要把mysql配置文件放在自定义的文件夹下（/conf/mysql）</span><br><span class="line"></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br><span class="line">指定mysql的一些配置参数</span><br></pre></td></tr></tbody></table></figure><h1 id="六、SpringBoot与数据访问"><a href="#六、SpringBoot与数据访问" class="headerlink" title="六、SpringBoot与数据访问"></a>六、SpringBoot与数据访问</h1><h2 id="1、JDBC"><a href="#1、JDBC" class="headerlink" title="1、JDBC"></a>1、JDBC</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.15.22:3306/jdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></tbody></table></figure><p>效果：</p><p>​    默认是用org.apache.tomcat.jdbc.pool.DataSource作为数据源；</p><p>​    数据源的相关配置都在DataSourceProperties里面；</p><p>自动配置原理：</p><p>org.springframework.boot.autoconfigure.jdbc：</p><p>1、参考DataSourceConfiguration，根据配置创建数据源，默认使用Tomcat连接池；可以使用spring.datasource.type指定自定义的数据源类型；</p><p>2、SpringBoot默认可以支持；</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.jdbc.pool.DataSource、HikariDataSource、BasicDataSource、</span><br></pre></td></tr></tbody></table></figure><p>3、自定义数据源类型</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generic DataSource configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = "spring.datasource.type")</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Generic</span> {</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(DataSourceProperties properties)</span> {</span><br><span class="line">       <span class="comment">//使用DataSourceBuilder创建数据源，利用反射创建响应type的数据源，并且绑定相关属性</span></span><br><span class="line">      <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4、<strong>DataSourceInitializer：ApplicationListener</strong>；</p><p>​    作用：</p><p>​        1）、runSchemaScripts();运行建表语句；</p><p>​        2）、runDataScripts();运行插入数据的sql语句；</p><p>默认只需要将文件命名为：</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schema-*.sql、data-*.sql</span></span><br><span class="line"><span class="attr">默认规则：schema.sql，schema-all.sql；</span></span><br><span class="line"><span class="attr">可以使用</span>   <span class="string"></span></span><br><span class="line"><span class="attr">schema</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">-</span> <span class="string">classpath:department.sql</span></span><br><span class="line">      <span class="attr">指定位置</span></span><br></pre></td></tr></tbody></table></figure><p>5、操作数据库：自动配置了JdbcTemplate操作数据库</p><h2 id="2、整合Druid数据源"><a href="#2、整合Druid数据源" class="headerlink" title="2、整合Druid数据源"></a>2、整合Druid数据源</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">导入druid数据源</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = "spring.datasource")</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druid</span><span class="params">()</span>{</span><br><span class="line">       <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置Druid的监控</span></span><br><span class="line">    <span class="comment">//1、配置一个管理后台的Servlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">StatViewServlet</span>(), <span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        initParams.put(<span class="string">"loginUsername"</span>,<span class="string">"admin"</span>);</span><br><span class="line">        initParams.put(<span class="string">"loginPassword"</span>,<span class="string">"123456"</span>);</span><br><span class="line">        initParams.put(<span class="string">"allow"</span>,<span class="string">""</span>);<span class="comment">//默认就是允许所有访问</span></span><br><span class="line">        initParams.put(<span class="string">"deny"</span>,<span class="string">"192.168.15.21"</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、配置一个web监控的filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webStatFilter</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> <span class="title class_">WebStatFilter</span>());</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">"exclusions"</span>,<span class="string">"*.js,*.css,/druid/*"</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line"></span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  bean;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="3、整合MyBatis"><a href="#3、整合MyBatis" class="headerlink" title="3、整合MyBatis"></a>3、整合MyBatis</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180305194443.png"></p><p>步骤：</p><p>​    1）、配置数据源相关属性（见上一节Druid）</p><p>​    2）、给数据库建表</p><p>​    3）、创建JavaBean</p><h3 id="4）、注解版"><a href="#4）、注解版" class="headerlink" title="4）、注解版"></a>4）、注解版</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指定这是一个操作数据库的mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select("select * from department where id=#{id}")</span></span><br><span class="line">    <span class="keyword">public</span> Department <span class="title function_">getDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete("delete from department where id=#{id}")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true,keyProperty = "id")</span></span><br><span class="line">    <span class="meta">@Insert("insert into department(departmentName) values(#{departmentName})")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertDept</span><span class="params">(Department department)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update("update department set departmentName=#{departmentName} where id=#{id}")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateDept</span><span class="params">(Department department)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>问题：</p><p>自定义MyBatis的配置规则；给容器中添加一个ConfigurationCustomizer；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConfigurationCustomizer <span class="title function_">configurationCustomizer</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConfigurationCustomizer</span>(){</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(Configuration configuration)</span> {</span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="literal">true</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用MapperScan批量扫描所有的Mapper接口；</span><br><span class="line"><span class="meta">@MapperScan(value = "com.atguigu.springboot.mapper")</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBoot06DataMybatisApplication</span> {</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">SpringApplication.run(SpringBoot06DataMybatisApplication.class, args);</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="5）、配置文件版"><a href="#5）、配置文件版" class="headerlink" title="5）、配置文件版"></a>5）、配置文件版</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span> <span class="string">指定全局配置文件的位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>  <span class="string">指定sql映射文件的位置</span></span><br></pre></td></tr></tbody></table></figure><p>更多使用参照</p><p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p><h2 id="4、整合SpringData-JPA"><a href="#4、整合SpringData-JPA" class="headerlink" title="4、整合SpringData JPA"></a>4、整合SpringData JPA</h2><h3 id="1）、SpringData简介"><a href="#1）、SpringData简介" class="headerlink" title="1）、SpringData简介"></a>1）、SpringData简介</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306105412.png"></p><h3 id="2）、整合SpringData-JPA"><a href="#2）、整合SpringData-JPA" class="headerlink" title="2）、整合SpringData JPA"></a>2）、整合SpringData JPA</h3><p>JPA:ORM（Object Relational Mapping）；</p><p>1）、编写一个实体类（bean）和数据表进行映射，并且配置好映射关系；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用JPA注解配置映射关系</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//告诉JPA这是一个实体类（和数据表映射的类）</span></span><br><span class="line"><span class="meta">@Table(name = "tbl_user")</span> <span class="comment">//@Table来指定和哪个数据表对应;如果省略默认表名就是user；</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//这是一个主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><span class="comment">//自增主键</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = "last_name",length = 50)</span> <span class="comment">//这是和数据表对应的一个列</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="meta">@Column</span> <span class="comment">//省略默认列名就是属性名</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br></pre></td></tr></tbody></table></figure><p>2）、编写一个Dao接口来操作实体类对应的数据表（Repository）</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承JpaRepository来完成对数据库的操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User,Integer&gt; {</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>3）、基本的配置JpaProperties</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"> <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line"><span class="comment">#     更新或者创建数据表结构</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="comment">#    控制台显示SQL</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure><h1 id="七、启动配置原理"><a href="#七、启动配置原理" class="headerlink" title="七、启动配置原理"></a>七、启动配置原理</h1><p>几个重要的事件回调机制</p><p>配置在META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><p><strong>SpringApplicationRunListener</strong></p><p>只需要放在ioc容器中</p><p><strong>ApplicationRunner</strong></p><p><strong>CommandLineRunner</strong></p><p>启动流程：</p><h2 id="1、创建SpringApplication对象"><a href="#1、创建SpringApplication对象" class="headerlink" title="1、创建SpringApplication对象"></a><strong>1、创建SpringApplication对象</strong></h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">initialize(sources);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(Object[] sources)</span> {</span><br><span class="line">    <span class="comment">//保存主配置类</span></span><br><span class="line">    <span class="keyword">if</span> (sources != <span class="literal">null</span> &amp;&amp; sources.length &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="built_in">this</span>.sources.addAll(Arrays.asList(sources));</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//判断当前是否一个web应用</span></span><br><span class="line">    <span class="built_in">this</span>.webEnvironment = deduceWebEnvironment();</span><br><span class="line">    <span class="comment">//从类路径下找到META-INF/spring.factories配置的所有ApplicationContextInitializer；然后保存起来</span></span><br><span class="line">    setInitializers((Collection) getSpringFactoriesInstances(</span><br><span class="line">        ApplicationContextInitializer.class));</span><br><span class="line">    <span class="comment">//从类路径下找到ETA-INF/spring.factories配置的所有ApplicationListener</span></span><br><span class="line">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">    <span class="comment">//从多个配置类中找到有main方法的主配置类</span></span><br><span class="line">    <span class="built_in">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145727.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145855.png"></p><h2 id="2、运行run方法"><a href="#2、运行run方法" class="headerlink" title="2、运行run方法"></a>2、运行run方法</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> {</span><br><span class="line">   <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">FailureAnalyzers</span> <span class="variable">analyzers</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//获取SpringApplicationRunListeners；从类路径下META-INF/spring.factories</span></span><br><span class="line">   <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">    <span class="comment">//回调所有的获取SpringApplicationRunListener.starting()方法</span></span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> {</span><br><span class="line">       <span class="comment">//封装命令行参数</span></span><br><span class="line">      <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(</span><br><span class="line">            args);</span><br><span class="line">      <span class="comment">//准备环境</span></span><br><span class="line">      <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">       <span class="comment">//创建环境完成后回调SpringApplicationRunListener.environmentPrepared()；表示环境准备完成</span></span><br><span class="line">       </span><br><span class="line">      <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//创建ApplicationContext；决定创建web的ioc还是普通的ioc</span></span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">       </span><br><span class="line">      analyzers = <span class="keyword">new</span> <span class="title class_">FailureAnalyzers</span>(context);</span><br><span class="line">       <span class="comment">//准备上下文环境;将environment保存到ioc中；而且applyInitializers()；</span></span><br><span class="line">       <span class="comment">//applyInitializers()：回调之前保存的所有的ApplicationContextInitializer的initialize方法</span></span><br><span class="line">       <span class="comment">//回调所有的SpringApplicationRunListener的contextPrepared()；</span></span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       <span class="comment">//prepareContext运行完成以后回调所有的SpringApplicationRunListener的contextLoaded（）；</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">//s刷新容器；ioc容器初始化（如果是web应用还会创建嵌入式的Tomcat）；Spring注解版</span></span><br><span class="line">       <span class="comment">//扫描，创建，加载所有组件的地方；（配置类，组件，自动配置）</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">       <span class="comment">//从ioc容器中获取所有的ApplicationRunner和CommandLineRunner进行回调</span></span><br><span class="line">       <span class="comment">//ApplicationRunner先回调，CommandLineRunner再回调</span></span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">       <span class="comment">//所有的SpringApplicationRunListener回调finished方法</span></span><br><span class="line">      listeners.finished(context, <span class="literal">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) {</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      }</span><br><span class="line">       <span class="comment">//整个SpringBoot应用启动完成以后返回启动的ioc容器；</span></span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="3、事件监听机制"><a href="#3、事件监听机制" class="headerlink" title="3、事件监听机制"></a>3、事件监听机制</h2><p>配置在META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span>&lt;ConfigurableApplicationContext&gt; {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> {</span><br><span class="line">        System.out.println(<span class="string">"ApplicationContextInitializer...initialize..."</span>+applicationContext);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p><strong>SpringApplicationRunListener</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloSpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">//必须有的构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloSpringApplicationRunListener</span><span class="params">(SpringApplication application, String[] args)</span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...starting..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableEnvironment environment)</span> {</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> environment.getSystemProperties().get(<span class="string">"os.name"</span>);</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...environmentPrepared.."</span>+o);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> {</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...contextPrepared..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> {</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...contextLoaded..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">finished</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> {</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...finished..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>配置（META-INF/spring.factories）</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.atguigu.springboot.listener.HelloApplicationContextInitializer</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.boot.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.atguigu.springboot.listener.HelloSpringApplicationRunListener</span></span><br></pre></td></tr></tbody></table></figure><p>只需要放在ioc容器中</p><p><strong>ApplicationRunner</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        System.out.println(<span class="string">"ApplicationRunner...run...."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>CommandLineRunner</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        System.out.println(<span class="string">"CommandLineRunner...run..."</span>+ Arrays.asList(args));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1 id="八、自定义starter"><a href="#八、自定义starter" class="headerlink" title="八、自定义starter"></a>八、自定义starter</h1><p>starter：</p><p>​    1、这个场景需要使用到的依赖是什么？</p><p>​    2、如何编写自动配置</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//指定这个类是一个配置类</span></span><br><span class="line"><span class="meta">@ConditionalOnXXX</span>  <span class="comment">//在指定条件成立的情况下自动配置类生效</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>  <span class="comment">//指定自动配置类的顺序</span></span><br><span class="line"><span class="meta">@Bean</span>  <span class="comment">//给容器中添加组件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationPropertie</span>结合相关xxxProperties类来绑定相关的配置</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span> <span class="comment">//让xxxProperties生效加入到容器中</span></span><br><span class="line"></span><br><span class="line">自动配置类要能加载</span><br><span class="line">将需要启动就加载的自动配置类，配置在META-INF/spring.factories</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br></pre></td></tr></tbody></table></figure><p>​    3、模式：</p><p>启动器只用来做依赖导入；</p><p>专门来写一个自动配置模块；</p><p>启动器依赖自动配置；别人只需要引入启动器（starter）</p><p>mybatis-spring-boot-starter；自定义启动器名-spring-boot-starter</p><p>步骤：</p><p>1）、启动器模块</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--启动器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--引入自动配置模块--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>2）、自动配置模块</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--引入spring-boot-starter；所有starter的基本配置--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "atguigu.hello")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProperties</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrefix</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrefix</span><span class="params">(String prefix)</span> {</span><br><span class="line">        <span class="built_in">this</span>.prefix = prefix;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSuffix</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuffix</span><span class="params">(String suffix)</span> {</span><br><span class="line">        <span class="built_in">this</span>.suffix = suffix;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span> {</span><br><span class="line"></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HelloProperties <span class="title function_">getHelloProperties</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> helloProperties;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHelloProperties</span><span class="params">(HelloProperties helloProperties)</span> {</span><br><span class="line">        <span class="built_in">this</span>.helloProperties = helloProperties;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHellAtguigu</span><span class="params">(String name)</span>{</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix()+<span class="string">"-"</span> +name + helloProperties.getSuffix();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//web应用才生效</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceAutoConfiguration</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">HelloService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">        service.setHelloProperties(helloProperties);</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h1 id="更多SpringBoot整合示例"><a href="#更多SpringBoot整合示例" class="headerlink" title="更多SpringBoot整合示例"></a>更多SpringBoot整合示例</h1><p><a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples">https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples</a></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Java </tag>
        
            
            
        <tag> 后端 </tag>
        
            
            
        <tag> Spring </tag>
        
            
            
        <tag> SpringBoot </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Java学习笔记-基础篇</title>
      
      
      <link href="/cn/posts/53914/"/>
      
      
      <url>/cn/posts/53914/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="Java程序怎么样运行的"><a href="#Java程序怎么样运行的" class="headerlink" title="Java程序怎么样运行的"></a><strong>Java程序怎么样运行的</strong></h2><p>Java 程序从源代码到运行一般有下面 3 步：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/2020080614124077.png" alt="在这里插入图片描述"><br>我们需要格外注意的是 .class-&gt;机器码 这一步。在这一步 JVM 类加载器首先加载字节码文件，然后通过解释器逐行解释执行，这种方式的执行速度会相对比较慢。而且，有些方法和代码块是经常需要被调用的(也就是所谓的热点代码)，所以后面引进了 JIT 编译器，而 JIT 属于运行时编译。当 JIT 编译器完成第一次编译后，其会将字节码对应的机器码保存下来，下次可以直接使用。而我们知道，机器码的运行效率肯定是高于 Java 解释器的。这也解释了我们为什么经常会说 Java 是编译与解释共存的语言。</p><blockquote><p>HotSpot 采用了惰性评估(Lazy Evaluation)的做法，根据二八定律，消耗大部分系统资源的只有那一小部分的代码（热点代码），而这也就是 JIT 所需要编译的部分。JVM 会根据代码每次被执行的情况收集信息并相应地做出一些优化，因此执行的次数越多，它的速度就越快。JDK 9 引入了一种新的编译模式 AOT(Ahead of Time Compilation)，它是直接将字节码编译成机器码，这样就避免了 JIT 预热等各方面的开销。JDK 支持分层编译和 AOT 协作使用。但是 ，AOT 编译器的编译质量是肯定比不上 JIT 编译器的。</p></blockquote><p>总结：</p><p>Java 虚拟机（JVM）是运行 Java 字节码的虚拟机。JVM 有针对不同系统的特定实现（Windows，Linux，macOS），目的是使用相同的字节码，它们都会给出相同的结果。字节码和不同系统的 JVM 实现是 Java 语言“一次编译，随处可以运行”的关键所在。</p><h2 id="为什么说-Java-语言“编译与解释并存”？"><a href="#为什么说-Java-语言“编译与解释并存”？" class="headerlink" title="为什么说 Java 语言“编译与解释并存”？"></a>为什么说 Java 语言“编译与解释并存”？</h2><p>高级编程语言按照程序的执行方式分为编译型和解释型两种。简单来说，编译型语言是指编译器针对特定的操作系统将源代码一次性翻译成可被该平台执行的机器码；解释型语言是指解释器对源程序逐行解释成特定平台的机器码并立即执行。比如，你想阅读一本英文名著，你可以找一个英文翻译人员帮助你阅读， 有两种选择方式，你可以先等翻译人员将全本的英文名著（也就是源码）都翻译成汉语，再去阅读，也可以让翻译人员翻译一段，你在旁边阅读一段，慢慢把书读完。</p><p>Java 语言既具有编译型语言的特征，也具有解释型语言的特征，因为 Java 程序要经过先编译，后解释两个步骤，由 Java 编写的程序需要先经过编译步骤，生成字节码（*.class 文件），这种字节码必须由 Java 解释器来解释执行。因此，我们可以认为 Java 语言编译与解释并存</p><h2 id="java与C语言在字符串结束符上的区别"><a href="#java与C语言在字符串结束符上的区别" class="headerlink" title="java与C语言在字符串结束符上的区别"></a>java与C语言在字符串结束符上的区别</h2><p>在C语言中字符串或字符数组最后都会有一个额外的字符‘\0’来表示结束，而在java语言中没有结束符这一概念。<br>参考：<a href="https://blog.csdn.net/sszgg2006/article/details/49148189">https://blog.csdn.net/sszgg2006/article/details/49148189</a></p><blockquote><p><strong>java中无需结束符的原因</strong><br>Java里面一切都是对象，是对象的话，字符串肯定就有长度，即然有长度，编译器就可以确定要输出的字符个数，当然也就没有必要去浪费那1字节的空间用以标明字符串的结束了。比如，数组对象里有一个属性length,就是数组的长度，String类里面有方法length()可以确定字符串的长度，因此对于输出函数来说，有直接的大小可以判断字符串的边界，编译器就没必要再去浪费一个空间标识字符串的结束。</p></blockquote><p><strong>java字符串末尾空字符的处理</strong></p><p>java和c通信的时候，由于c中的char中有结束符的，所以当java收到C发来的字符串时，后面往往会有若干空字符，如果不做处理的话，java会对其一并输出，为了将空字符处理掉不输出，可以采用如下两种方法：</p><p>方法一:</p><p>调用java字符串的trim()方法，该方法会将字符串前后的空字符读去掉。</p><p>方法二：自己实现去掉尾部空字符的方法</p><h2 id="字符型常量和字符串常量的区别"><a href="#字符型常量和字符串常量的区别" class="headerlink" title="字符型常量和字符串常量的区别?"></a>字符型常量和字符串常量的区别?</h2><p>形式上: 字符常量是单引号引起的一个字符; 字符串常量是双引号引起的若干个字符<br>含义上: 字符常量相当于一个整型值( ASCII 值),可以参加表达式运算; 字符串常量代表一个地址值(该字符串在内存中存放位置)<br>占内存大小 字符常量只占 2 个字节; 字符串常量占若干个字节 (<strong>注意： char 在 Java 中占两个字节</strong>)</p><blockquote><p>java 编程思想第四版：2.2.2 节<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806142232905.png" alt="在这里插入图片描述"><br>JVM内部使用的是UTF-16编码。不管代码文件中char使用的是什么编码，都将被JVM转化为UTF-16而且只用两个字节，也就是说Java中的char占用两个字节，只能表示Unicode中第一层（BMP）中的字符，对于其他字符会报错：Invalid Character Constant, 而String中是可以的。<br>如果一个抽象的字符在 UTF-16 编码下占 4 字节，显然它是不能放到 char 中的。换言之， char 中只能放 UTF-16 编码下只占 2 字节的那些字符。</p></blockquote><p>String.getBytes()是一个用于将String的内码转换为指定的外码的方法。无参数版使用平台的默认编码作为外码，有参数版使用参数指定的编码作为外码；将String的内容用外码编码好，结果放在一个新byte[]返回。<br>getBytes 实际是做编码转换，你应该显式传入一个参数来指定编码，否则它会使用缺省编码来转换。</p><blockquote><p>“字”在 GBK 编码下占 2 字节，在 UTF-16 编码下也占 2 字节，在 UTF-8 编码下占 3 字节，在 UTF-32 编码下占 4 字</p></blockquote><blockquote><p>“ new String(“字”).getBytes().length 返回的是3 ”，这说明缺省编码是 UTF-8. 如果你显式地传入一个参数，比如这样“ new String(“字”).getBytes(“GBK”).length ”，那么返回就是 2.</p></blockquote><p>你可以在启动 JVM 时设置一个缺省编码，</p><blockquote><p>假设你的类叫 Main，那么在命令行中用 java 执行这个类时可以通过 file.encoding 参数设置一个缺省编码。 比如这样：java -Dfile.encoding=GBK Main 这时，你再执行不带参数的 getBytes() 方法时，new String(“字”).getBytes().length 返回的就是 2 了，因为现在缺省编码变成 GBK 了。 当然，如果这时你显式地指定编码，new String(“字”).getBytes(“UTF-8”).length 返回的则依旧是 3.</p></blockquote><p>否则，会使用所在操作系统环境下的缺省编码。</p><blockquote><p>通常，Windows 系统下是 GBK，Linux 和 Mac 是 UTF-8. 但有一点要注意，在 Windows 下使用 IDE 来运行时，比如 Eclipse，如果你的工程的缺省编码是 UTF-8，在 IDE 中运行你的程序时，会加上上述的 -Dfile.encoding=UTF-8 参数，这时，即便你在 Windows 下，缺省编码也是 UTF-8，而不是 GBK。</p></blockquote><p>总结:char在Java占两字节,大于两字节的不能存.在String里,每个字符大小不同。</p><h2 id="Java中有哪些常见的关键字？"><a href="#Java中有哪些常见的关键字？" class="headerlink" title="Java中有哪些常见的关键字？"></a>Java中有哪些常见的关键字？</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806143410908.png" alt="在这里插入图片描述"></p><h2 id="Java泛型，以及类型擦除，常用的通配符"><a href="#Java泛型，以及类型擦除，常用的通配符" class="headerlink" title="Java泛型，以及类型擦除，常用的通配符"></a>Java泛型，以及类型擦除，常用的通配符</h2><p>Java 泛型（generics）是 JDK 5 中引入的一个新特性, 泛型提供了编译时类型安全检测机制，该机制允许程序员在编译时检测到非法的类型。泛型的本质是参数化类型，也就是说所操作的数据类型被指定为一个参数。</p><h3 id="Java泛型类型擦除以及类型擦除带来的问题"><a href="#Java泛型类型擦除以及类型擦除带来的问题" class="headerlink" title="Java泛型类型擦除以及类型擦除带来的问题"></a>Java泛型类型擦除以及类型擦除带来的问题</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806152854603.png" alt="在这里插入图片描述"></p><p><a href="https://www.cnblogs.com/wuqinglong/p/9456193.html">https://www.cnblogs.com/wuqinglong/p/9456193.html</a><br>大家都知道，Java的泛型是伪泛型，这是因为Java在编译期间，所有的泛型信息都会被擦掉，正确理解泛型概念的首要前提是理解类型擦除。Java的泛型基本上都是在编译器这个层次上实现的，在生成的字节码中是不包含泛型中的类型信息的，使用泛型的时候加上类型参数，在编译器编译的时候会去掉，这个过程成为类型擦除。</p><blockquote><p>原始类型 就是擦除去了泛型信息，最后在字节码中的类型变量的真正类型，无论何时定义一个泛型，相应的原始类型都会被自动提供，类型变量擦除，并使用其限定类型（无限定的变量用Object）替换。</p></blockquote><p>如在代码中定义List<object>和List<string>等类型，在编译后都会变成List，JVM看到的只是List，而由泛型附加的类型信息对JVM是看不到的。Java编译器会在编译时尽可能的发现可能出错的地方，但是仍然无法在运行时刻出现的类型转换异常的情况，类型擦除也是Java的泛型与C++模板机制实现方式之间的重要区别。</string></object></p><blockquote><p>在程序中定义了一个ArrayList泛型类型实例化为Integer对象，如果直接调用add()方法，那么只能存储整数数据，不过当我们利用反射调用add()方法的时候，却可以存储字符串，这说明了Integer泛型实例在编译之后被擦除掉了，只保留了原始类型。</p></blockquote><p>在调用泛型方法时，可以指定泛型，也可以不指定泛型。</p><ul><li>在不指定泛型的情况下，泛型变量的类型为该方法中的几种类型的同一父类的最小级，直到Object</li><li>在指定泛型的情况下，该方法的几种类型必须是该泛型的实例的类型或者其子类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {  </span><br><span class="line"></span><br><span class="line">        <span class="comment">/**不指定泛型的时候*/</span>  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//这两个参数都是Integer，所以T为Integer类型  </span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">f</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="number">1.2</span>); <span class="comment">//这两个参数一个是Integer，以风格是Float，所以取同一父类的最小级，为Number  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="string">"asd"</span>); <span class="comment">//这两个参数一个是Integer，以风格是Float，所以取同一父类的最小级，为Object  </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**指定泛型的时候*/</span>  </span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Test.&lt;Integer&gt;add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//指定了Integer，所以只能为Integer类型或者其子类  </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Test.&lt;Integer&gt;add(<span class="number">1</span>, <span class="number">2.2</span>); <span class="comment">//编译错误，指定了Integer，不能为Float  </span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">c</span> <span class="operator">=</span> Test.&lt;Number&gt;add(<span class="number">1</span>, <span class="number">2.2</span>); <span class="comment">//指定为Number，所以可以为Integer和Float  </span></span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//这是一个简单的泛型方法  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">add</span><span class="params">(T x,T y)</span>{  </span><br><span class="line">        <span class="keyword">return</span> y;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其实在泛型类中，不指定泛型的时候，也差不多，只不过这个时候的泛型为Object，就比如ArrayList中，如果不指定泛型，那么这个ArrayList可以存储任意的对象。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {  </span><br><span class="line">    <span class="type">ArrayList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br><span class="line">    list.add(<span class="number">1</span>);  </span><br><span class="line">    list.add(<span class="string">"121"</span>);  </span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Date</span>());  </span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure><h4 id="类型擦除引起的问题及解决方法"><a href="#类型擦除引起的问题及解决方法" class="headerlink" title="类型擦除引起的问题及解决方法"></a>类型擦除引起的问题及解决方法</h4><h5 id="3-1-先检查，再编译以及编译的对象和引用传递问题"><a href="#3-1-先检查，再编译以及编译的对象和引用传递问题" class="headerlink" title="3-1.先检查，再编译以及编译的对象和引用传递问题"></a>3-1.先检查，再编译以及编译的对象和引用传递问题</h5><p>Q: 既然说类型变量会在编译的时候擦除掉，那为什么我们往 ArrayList 创建的对象中添加整数会报错呢？不是说泛型变量String会在编译的时候变为Object类型吗？为什么不能存别的类型呢？既然类型擦除了，如何保证我们只能使用泛型变量限定的类型呢？</p><p>A: Java编译器是通过先检查代码中泛型的类型，然后在进行类型擦除，再进行编译。</p><p>那么，这个类型检查是针对谁的呢？我们先看看参数化类型和原始类型的兼容。</p><p>以 ArrayList举例子，以前的写法:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ArrayList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br></pre></td></tr></tbody></table></figure><p>现在的写法:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br></pre></td></tr></tbody></table></figure><p>如果是与以前的代码兼容，各种引用传值之间，必然会出现如下的情况：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(); <span class="comment">//第一种 情况</span></span><br><span class="line"><span class="type">ArrayList</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">//第二种 情况</span></span><br></pre></td></tr></tbody></table></figure><p>这样是没有错误的，不过会有个编译时警告。</p><p>不过在第一种情况，可以实现与完全使用泛型参数一样的效果，第二种则没有效果。</p><p>因为类型检查就是编译时完成的，new ArrayList()只是在内存中开辟了一个存储空间，可以存储任何类型对象，而真正设计类型检查的是它的引用，因为我们是使用它引用list1来调用它的方法，比如说调用add方法，所以list1引用能完成泛型类型的检查。而引用list2没有使用泛型，所以不行。</p><p>举例子：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {  </span><br><span class="line"></span><br><span class="line">        ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br><span class="line">        list1.add(<span class="string">"1"</span>); <span class="comment">//编译通过  </span></span><br><span class="line">        list1.add(<span class="number">1</span>); <span class="comment">//编译错误  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> list1.get(<span class="number">0</span>); <span class="comment">//返回类型就是String  </span></span><br><span class="line"></span><br><span class="line">        <span class="type">ArrayList</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">        list2.add(<span class="string">"1"</span>); <span class="comment">//编译通过  </span></span><br><span class="line">        list2.add(<span class="number">1</span>); <span class="comment">//编译通过  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> list2.get(<span class="number">0</span>); <span class="comment">//返回类型就是Object  </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().add(<span class="string">"11"</span>); <span class="comment">//编译通过  </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().add(<span class="number">22</span>); <span class="comment">//编译错误  </span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().get(<span class="number">0</span>); <span class="comment">//返回类型就是String  </span></span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure><p>通过上面的例子，我们可以明白，类型检查就是针对引用的，谁是一个引用，用这个引用调用泛型方法，就会对这个引用调用的方法进行类型检测，而无关它真正引用的对象。</p><p>泛型中参数话类型为什么不考虑继承关系？</p><p>在Java中，像下面形式的引用传递是不允许的:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;(); <span class="comment">//编译错误  </span></span><br><span class="line">ArrayList&lt;Object&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">//编译错误</span></span><br><span class="line">我们先看第一种情况，将第一种情况拓展成下面的形式：</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Object&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">Object</span>());  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">Object</span>());  </span><br><span class="line">ArrayList&lt;String&gt; list2 = list1; <span class="comment">//编译错误</span></span><br></pre></td></tr></tbody></table></figure><p>实际上，在第4行代码的时候，就会有编译错误。那么，我们先假设它编译没错。那么当我们使用list2引用用get()方法取值的时候，返回的都是String类型的对象（上面提到了，类型检测是根据引用来决定的），可是它里面实际上已经被我们存放了Object类型的对象，这样就会有ClassCastException了。所以为了避免这种极易出现的错误，Java不允许进行这样的引用传递。（这也是泛型出现的原因，就是为了解决类型转换的问题，我们不能违背它的初衷）。</p><p>再看第二种情况，将第二种情况拓展成下面的形式：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">String</span>());  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">String</span>());</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Object&gt; list2 = list1; <span class="comment">//编译错误</span></span><br></pre></td></tr></tbody></table></figure><p>没错，这样的情况比第一种情况好的多，最起码，在我们用list2取值的时候不会出现ClassCastException，因为是从String转换为Object。可是，这样做有什么意义呢，泛型出现的原因，就是为了解决类型转换的问题。我们使用了泛型，到头来，还是要自己强转，违背了泛型设计的初衷。所以java不允许这么干。再说，你如果又用list2往里面add()新的对象，那么到时候取得时候，我怎么知道我取出来的到底是String类型的，还是Object类型的呢？</p><p>所以，要格外注意，泛型中的引用传递的问题。</p><h5 id="3-2-自动类型转换"><a href="#3-2-自动类型转换" class="headerlink" title="3-2.自动类型转换"></a>3-2.自动类型转换</h5><p>因为类型擦除的问题，所以所有的泛型类型变量最后都会被替换为原始类型。</p><p>既然都被替换为原始类型，那么为什么我们在获取的时候，不需要进行强制类型转换呢？</p><p>看下ArrayList.get()方法：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> {  </span><br><span class="line"></span><br><span class="line">    RangeCheck(index);  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (E) elementData[index];  </span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>可以看到，在return之前，会根据泛型变量进行强转。假设泛型类型变量为Date，虽然泛型信息会被擦除掉，但是会将(E) elementData[index]，编译为(Date)elementData[index]。所以我们不用自己进行强转。当存取一个泛型域时也会自动插入强制类型转换。假设Pair类的value域是public的，那么表达式：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> pair.value;</span><br></pre></td></tr></tbody></table></figure><p>也会自动地在结果字节码中插入强制类型转换。</p><h5 id="3-3-类型擦除与多态的冲突和解决方法"><a href="#3-3-类型擦除与多态的冲突和解决方法" class="headerlink" title="3-3.类型擦除与多态的冲突和解决方法"></a>3-3.类型擦除与多态的冲突和解决方法</h5><p>现在有这样一个泛型类：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; {  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T value;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> {  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后我们想要一个子类继承它。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DateInter</span> <span class="keyword">extends</span> <span class="title class_">Pair</span>&lt;Date&gt; {  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> {  </span><br><span class="line">        <span class="built_in">super</span>.setValue(value);  </span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>在这个子类中，我们设定父类的泛型类型为Pair<date>，在子类中，我们覆盖了父类的两个方法，我们的原意是这样的：将父类的泛型类型限定为Date，那么父类里面的两个方法的参数都为Date类型。</date></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">    <span class="keyword">return</span> value;  </span><br><span class="line">}  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> {  </span><br><span class="line">    <span class="built_in">this</span>.value = value;  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>所以，我们在子类中重写这两个方法一点问题也没有，实际上，从他们的@Override标签中也可以看到，一点问题也没有，实际上是这样的吗？</p><p>分析：实际上，类型擦除后，父类的的泛型类型全部变为了原始类型Object，所以父类编译之后会变成下面的样子：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span> {  </span><br><span class="line">    <span class="keyword">private</span> Object value;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object  value)</span> {  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    }  </span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure><p>再看子类的两个重写的方法的类型：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> {  </span><br><span class="line">    <span class="built_in">super</span>.setValue(value);  </span><br><span class="line">}  </span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>先来分析setValue方法，父类的类型是Object，而子类的类型是Date，参数类型不一样，这如果是在普通的继承关系中，根本就不会是重写，而是重载。<br>　　<br>我们在一个main方法测试一下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException {  </span><br><span class="line">        <span class="type">DateInter</span> <span class="variable">dateInter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateInter</span>();  </span><br><span class="line">        dateInter.setValue(<span class="keyword">new</span> <span class="title class_">Date</span>());                  </span><br><span class="line">        dateInter.setValue(<span class="keyword">new</span> <span class="title class_">Object</span>()); <span class="comment">//编译错误  </span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>如果是重载，那么子类中两个setValue方法，一个是参数Object类型，一个是Date类型，可是我们发现，根本就没有这样的一个子类继承自父类的Object类型参数的方法。所以说，确实是重写了，而不是重载了。</p><p>为什么会这样呢？</p><p>原因是这样的，我们传入父类的泛型类型是Date，Pair<date>，我们的本意是将泛型类变为如下：</date></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span> {  </span><br><span class="line">    <span class="keyword">private</span> Date value;  </span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    }  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> {  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后再子类中重写参数类型为Date的那两个方法，实现继承中的多态。</p><p>可是由于种种原因，虚拟机并不能将泛型类型变为Date，只能将类型擦除掉，变为原始类型Object。这样，我们的本意是进行重写，实现多态。可是类型擦除后，只能变为了重载。这样，类型擦除就和多态有了冲突。JVM知道你的本意吗？知道！！！可是它能直接实现吗，不能！！！如果真的不能的话，那我们怎么去重写我们想要的Date类型参数的方法啊。</p><p>于是JVM采用了一个特殊的方法，来完成这项功能，那就是桥方法。</p><p>首先，我们用javap -c className的方式反编译下DateInter子类的字节码，结果如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">com</span>.tao.test.DateInter <span class="keyword">extends</span> <span class="title class_">com</span>.tao.test.Pair&lt;java.util.Date&gt; {  </span><br><span class="line">  com.tao.test.DateInter();  </span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: invokespecial #<span class="number">8</span>                  <span class="comment">// Method com/tao/test/Pair."&lt;init&gt;":()V  </span></span><br><span class="line">       <span class="number">4</span>: <span class="keyword">return</span>  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(java.util.Date)</span>;  <span class="comment">//我们重写的setValue方法  </span></span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: aload_1  </span><br><span class="line">       <span class="number">2</span>: invokespecial #<span class="number">16</span>                 <span class="comment">// Method com/tao/test/Pair.setValue:(Ljava/lang/Object;)V  </span></span><br><span class="line">       <span class="number">5</span>: <span class="keyword">return</span>  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.util.Date <span class="title function_">getValue</span><span class="params">()</span>;    <span class="comment">//我们重写的getValue方法  </span></span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: invokespecial #<span class="number">23</span>                 <span class="comment">// Method com/tao/test/Pair.getValue:()Ljava/lang/Object;  </span></span><br><span class="line">       <span class="number">4</span>: checkcast     #<span class="number">26</span>                 <span class="comment">// class java/util/Date  </span></span><br><span class="line">       <span class="number">7</span>: areturn  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.lang.Object <span class="title function_">getValue</span><span class="params">()</span>;     <span class="comment">//编译时由编译器生成的巧方法  </span></span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: invokevirtual #<span class="number">28</span>                 <span class="comment">// Method getValue:()Ljava/util/Date 去调用我们重写的getValue方法;  </span></span><br><span class="line">       <span class="number">4</span>: areturn  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(java.lang.Object)</span>;   <span class="comment">//编译时由编译器生成的巧方法  </span></span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: aload_1  </span><br><span class="line">       <span class="number">2</span>: checkcast     #<span class="number">26</span>                 <span class="comment">// class java/util/Date  </span></span><br><span class="line">       <span class="number">5</span>: invokevirtual #<span class="number">30</span>                 <span class="comment">// Method setValue:(Ljava/util/Date; 去调用我们重写的setValue方法)V  </span></span><br><span class="line">       <span class="number">8</span>: <span class="keyword">return</span>  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>从编译的结果来看，我们本意重写setValue和getValue方法的子类，竟然有4个方法，其实不用惊奇，最后的两个方法，就是编译器自己生成的桥方法。可以看到桥方法的参数类型都是Object，也就是说，子类中真正覆盖父类两个方法的就是这两个我们看不到的桥方法。而打在我们自己定义的setvalue和getValue方法上面的@Oveerride只不过是假象。而桥方法的内部实现，就只是去调用我们自己重写的那两个方法。</p><p>所以，虚拟机巧妙的使用了桥方法，来解决了类型擦除和多态的冲突。</p><p>不过，要提到一点，这里面的setValue和getValue这两个桥方法的意义又有不同。</p><p>setValue方法是为了解决类型擦除与多态之间的冲突。</p><p>而getValue却有普遍的意义，怎么说呢，如果这是一个普通的继承关系：</p><p>那么父类的setValue方法如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ObjectgetValue</span><span class="params">()</span> {  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>而子类重写的方法是：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其实这在普通的类继承中也是普遍存在的重写，这就是协变。<br><a href="https://extremegtr.github.io/2016/07/11/Covariance-And-Contravariance-In-Java/">https://extremegtr.github.io/2016/07/11/Covariance-And-Contravariance-In-Java/</a></p><blockquote><p>协变 / 共变（covariance）指的是子类型关系在类型变换的作用下保持原样。<br>不可变（invariance） 表示子类型关系在类型变换的作用下，既没有协变的效果，也没有逆变的效果。<br>逆变 / 反变（contravariance）指的是子类型关系在类型变换的作用下发生逆转。<br>双变（bivariance）表示子类型关系在类型变换的作用下同时拥有协变与逆变2种效果。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806151224399.png" alt="在这里插入图片描述"><br>Java支持协变数组，你可能会问Java支持逆变数组吗？答案是：Java不支持逆变数组。<br><a href="https://codingnote.com/2020/03/08/java-covariant-contravariant-invariant/">https://codingnote.com/2020/03/08/java-covariant-contravariant-invariant/</a><br><a href="https://extremegtr.github.io/2016/05/30/JavaSE-study-advanced-generics/#u901A_u914D_u7B26_uFF08Wildcard_uFF09">https://extremegtr.github.io/2016/05/30/JavaSE-study-advanced-generics/#u901A_u914D_u7B26_uFF08Wildcard_uFF09</a><br>Java下限通配符实现逆变<br>由于Java泛型的不可变性，generateIntegers() 生成的List<integer>不能放到输入参数output指定的List<number>中。那么有没有办法把 List<integer> 放到List<number>中呢？<br>答案是使用下限通配符来实现逆变。<br>正如大家所熟知的一个概念：在Java中，所有类型的父类型都是Object类型，方法的形参类型是Object，那这个方法就能接受任何类型的参数传递进来。这个推论正是实现该需求的关键所在。<br>根据上面的推导，我们可能会这么认为：既然Object是所有类型的父类型，那么List<object>肯定是所有List参数化类型的父类型。但事实却不是这样的，即2个类型实参之间具有子类型关系，但使用它们对同一泛型进行参数化后的类型并没有保持这种子类型关系。与上文描述一致。<br>List<object>表示的只是它能够存储任意元素类型，而并没有表示它是所有参数化类型的父类型。所以这种解决方案是完全行不通的。</object></object></number></integer></number></integer></p></blockquote><p>并且，还有一点也许会有疑问，子类中的桥方法Object getValue()和Date getValue()是同 时存在的，可是如果是常规的两个方法，他们的方法签名是一样的，也就是说虚拟机根本不能分别这两个方法。如果是我们自己编写Java代码，这样的代码是无法通过编译器的检查的，但是虚拟机却是允许这样做的，因为虚拟机通过参数类型和返回类型来确定一个方法，所以编译器为了实现泛型的多态允许自己做这个看起来“不合法”的事情，然后交给虚拟器去区别。</p><p>总结：</p><p>   在Java中，数组具有协变性，简单点来说就是子类型数组可以赋值给父类型数组进行使用，比如将Integer数组赋值给Object数组，这样来使用数组不会有警告甚至报错，但会存在运行时出错的风险，所以数组的协变性是具有瑕疵的，虽然它能这么用，但我们必须为此而承受一定风险。</p><p>Java泛型就不可以做出像数组这样的行为，因为泛型没有内建的协变类型，Java泛型具有不可变性（不具备协变性和逆变性）。但是，为了兼容遗留代码而被保留下来的原生类型确实可以做出这样的行为，但同时我们也非常清楚使用它就像使用数组的协变性一样意味着代码变得不再安全。</p><p>　　所以，制定Java标准的那群人想出了个法子使得泛型像数组一样具有这些特性，同时这种代替原生类型的方案必须是绝对安全的：他们通过给泛型增加通配符特性使得泛型在参数化后具有协变性或逆变性。</p><h5 id="3-4-泛型类型变量不能是基本数据类型"><a href="#3-4-泛型类型变量不能是基本数据类型" class="headerlink" title="3-4.泛型类型变量不能是基本数据类型"></a>3-4.泛型类型变量不能是基本数据类型</h5><p>不能用类型参数替换基本类型。就比如，没有ArrayList<double>，只有ArrayList<double>。因为当类型擦除后，ArrayList的原始类型变为Object，但是Object类型不能存储double值，只能引用Double的值。</double></double></p><h5 id="3-5-编译时集合的instanceof"><a href="#3-5-编译时集合的instanceof" class="headerlink" title="3-5.编译时集合的instanceof"></a>3-5.编译时集合的instanceof</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br></pre></td></tr></tbody></table></figure><p>因为类型擦除之后，ArrayList<string>只剩下原始类型，泛型信息String不存在了。</string></p><p>那么，编译时进行类型查询的时候使用下面的方法是错误的</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( arrayList <span class="keyword">instanceof</span> ArrayList&lt;String&gt;)</span><br></pre></td></tr></tbody></table></figure><h5 id="3-6-泛型在静态方法和静态类中的问题"><a href="#3-6-泛型在静态方法和静态类中的问题" class="headerlink" title="3-6.泛型在静态方法和静态类中的问题"></a>3-6.泛型在静态方法和静态类中的问题</h5><p>泛型类中的静态方法和静态变量不可以使用泛型类所声明的泛型类型参数</p><p>举例说明：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span>&lt;T&gt; {    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> T one;   <span class="comment">//编译错误    </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  T <span class="title function_">show</span><span class="params">(T one)</span>{ <span class="comment">//编译错误    </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;    </span><br><span class="line">    }    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>因为泛型类中的泛型参数的实例化是在定义对象的时候指定的，而静态变量和静态方法不需要使用对象来调用。对象都没有创建，如何确定这个泛型参数是何种类型，所以当然是错误的。</p><p>但是要注意区分下面的一种情况：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span>&lt;T&gt; {    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T &gt;T <span class="title function_">show</span><span class="params">(T one)</span>{ <span class="comment">//这是正确的    </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;    </span><br><span class="line">    }    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>因为这是一个泛型方法，在泛型方法中使用的T是自己在方法中定义的 T，而不是泛型类中的T。</p><p>==和equals的区别</p><p>== : 它的作用是判断两个对象的地址是不是相等。即判断两个对象是不是同一个对象。(基本数据类型==比较的是值，引用数据类型==比较的是内存地址)<br>equals() 方法存在两种使用情况：</p><ul><li><p>情况 1：类没有覆盖 equals()方法。则通过equals()比较该类的两个对象时，等价于通过“==”比较这两个对象。使用的默认是 Object类equals()方法。</p></li><li><p>情况 2：类覆盖了 equals()方法。一般，我们都覆盖 equals()方法来两个对象的内容相等；若它们的内容相等，则返回 true(即，认为这两个对象相等)。</p></li><li><p>String 中的 equals 方法是被重写过的，因为 Object 的 equals 方法是比较的对象的内存地址，而 String 的 equals 方法比较的是对象的值。</p></li><li><p>当创建 String 类型的对象时，虚拟机会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用。如果没有就在常量池中重新创建一个 String 对象。</p></li></ul><h2 id="hashCode-与-equals"><a href="#hashCode-与-equals" class="headerlink" title="hashCode()与 equals()"></a>hashCode()与 equals()</h2><h3 id="hashCode-介绍"><a href="#hashCode-介绍" class="headerlink" title="hashCode()介绍:"></a>hashCode()介绍:</h3><p>hashCode() 的作用是获取哈希码，也称为散列码；它实际上是返回一个 int 整数。这个哈希码的作用是确定该对象在哈希表中的索引位置。hashCode()定义在 JDK 的 Object 类中，这就意味着 Java 中的任何类都包含有 hashCode() 函数。另外需要注意的是： Object 的 hashcode 方法是本地方法，也就是用 c 语言或 c++ 实现的，该方法通常用来将对象的 内存地址 转换为整数之后返回。</p><blockquote><p>散列表存储的是键值对(key-value)，它的特点是：能根据“键”快速的检索出对应的“值”。这其中就利用到了散列码！（可以快速找到所需要的对象）</p></blockquote><h3 id="为什么要有-hashCode？"><a href="#为什么要有-hashCode？" class="headerlink" title="为什么要有 hashCode？"></a>为什么要有 hashCode？</h3><p>我们以“HashSet 如何检查重复”为例子来说明为什么要有 hashCode？</p><p>当你把对象加入 HashSet 时，HashSet 会先计算对象的 hashcode 值来判断对象加入的位置，同时也会与其他已经加入的对象的 hashcode 值作比较，如果没有相符的 hashcode，HashSet 会假设对象没有重复出现。但是如果发现有相同 hashcode 值的对象，这时会调用 equals（）方法来检查 hashcode 相等的对象是否真的相同。如果两者相同，HashSet 就不会让其加入操作成功。如果不同的话，就会重新散列到其他位置。（Head fist java》第二版）。这样我们就大大减少了 equals 的次数，相应就大大提高了执行速度。</p><p>为什么重写 equals 时必须重写 hashCode 方法？</p><p>如果两个对象相等，则 hashcode 一定也是相同的。两个对象相等,对两个对象分别调用 equals 方法都返回 true。但是，两个对象有相同的 hashcode 值，它们也不一定是相等的 。因此，equals 方法被覆盖过，则 hashCode 方法也必须被覆盖。</p><blockquote><p>hashCode()的默认行为是对堆上的对象产生独特值。如果没有重写 hashCode()，则该 class 的两个对象无论如何都不会相等（即使这两个对象指向相同的数据）</p></blockquote><p>String类对hashcode的重写</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a hash code for this string. The hash code for a</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> String} object is computed as</span></span><br><span class="line"><span class="comment"> * &lt;blockquote&gt;&lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;&lt;/blockquote&gt;</span></span><br><span class="line"><span class="comment"> * using {<span class="doctag">@code</span> int} arithmetic, where {<span class="doctag">@code</span> s[i]} is the</span></span><br><span class="line"><span class="comment"> * &lt;i&gt;i&lt;/i&gt;th character of the string, {<span class="doctag">@code</span> n} is the length of</span></span><br><span class="line"><span class="comment"> * the string, and {<span class="doctag">@code</span> ^} indicates exponentiation.</span></span><br><span class="line"><span class="comment"> * (The hash value of the empty string is zero.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  a hash code value for this object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> hash;</span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="type">char</span> val[] = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; value.length; i++) {</span><br><span class="line">            h = <span class="number">31</span> * h + val[i];</span><br><span class="line">        }</span><br><span class="line">        hash = h;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>在《Effective Java》第 42 页就有对 hashCode 为什么采用 31 做了说明：之所以使用 31， 是因为他是一个奇素数。如果乘数是偶数，并且乘法溢出的话，信息就会丢失，因为与2相乘等价于移位运算（低位补0）。使用素数的好处并不很明显，但是习惯上使用素数来计算散列结果。 31 有个很好的性能，即用移位和减法来代替乘法，可以得到更好的性能： 31 * i == (i &lt;&lt; 5）- i， 现代的 VM 可以自动完成这种优化。这个公式可以很简单的推导出来。<br>31可以由31 * i ==  (i &lt;&lt; 5) - i来表示，现在很多虚拟机里面都有做相关优化，使用31的原因可能是为了更好的分配hash地址，并且31只占用5bits！在java乘法中如果数字相乘过大会导致溢出的问题，从而导致数据的丢失，而31则是素数（质数）而且不是很长的数字，最终它被选择为相乘的系数的原因。</p></blockquote><h2 id="Java中的几种基本数据类型"><a href="#Java中的几种基本数据类型" class="headerlink" title="Java中的几种基本数据类型"></a>Java中的几种基本数据类型</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806154245121.png" alt="在这里插入图片描述"><br>注意：</p><ul><li>Java 里使用 long 类型的数据一定要在数值后面加上 L，否则将作为整型解析：</li><li>char a = ‘h’char :单引号，String a = “hello” :双引号</li></ul><p>Java 基本类型的包装类的大部分都实现了常量池技术，即 Byte,Short,Integer,Long,Character,Boolean；前面 4 种包装类默认创建了数值[-128，127] 的相应类型的缓存数据，Character创建了数值在[0,127]范围的缓存数据，Boolean 直接返回True Or False。如果超出对应范围仍然会去创建新的对象。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">valueOf</span><span class="params">(<span class="type">boolean</span> b)</span> {</span><br><span class="line">    <span class="keyword">return</span> (b ? TRUE : FALSE);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CharacterCache</span> {         </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">CharacterCache</span><span class="params">()</span>{}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Character cache[] = <span class="keyword">new</span> <span class="title class_">Character</span>[<span class="number">127</span> + <span class="number">1</span>];          </span><br><span class="line">    <span class="keyword">static</span> {             </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; cache.length; i++)                 </span><br><span class="line">            cache[i] = <span class="keyword">new</span> <span class="title class_">Character</span>((<span class="type">char</span>)i);         </span><br><span class="line">    }   </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*此方法将始终缓存-128 到 127（包括端点）范围内的值，并可以缓存此范围之外的其他值。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span> {</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line">            <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(i);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><blockquote><p>常量池是为了避免频繁的创建和销毁对象而影响系统性能，其实现了对象的共享。<br>例如字符串常量池，在编译阶段就把所有的字符串文字放到一个常量池中。<br>（1）节省内存空间：常量池中所有相同的字符串常量被合并，只占用一个空间。<br>（2）节省运行时间：比较字符串时，==比equals()快。对于两个引用变量，只用==判断引用是否相等，也就可以判断实际值是否相等。 </p></blockquote><blockquote><p>为啥把缓存设置为[-128，127]区间？<br>1.技术规范。JLS7 5.1.7：If the value p being boxed is an integer literal of type int between -128 and 127 inclusive (§3.10.1), or the boolean literal true or false (§3.10.3), or a character literal between ‘\u0000’ and ‘\u007f’ inclusive (§3.10.4), then let a and b be the results of any two boxing conversions of p . It is always the case that a == b .<br>2.性能和资源之间的权衡（当然也可以调整缓存的正向最大值，自己看 IntegerCache 类的实现）。</p><p><strong>如果超出了范围，会从堆区new一个Integer对象来存放值。</strong></p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">12</span>);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">a2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">12</span>);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">b1</span> <span class="operator">=</span> -<span class="number">129</span>;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">b2</span> <span class="operator">=</span> -<span class="number">129</span>;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">c2</span> <span class="operator">=</span> -<span class="number">128</span>;</span><br><span class="line">     System.out.println(a1 == a2);   <span class="comment">//false</span></span><br><span class="line">     System.out.println(b1==b2);     <span class="comment">//false </span></span><br><span class="line">     System.out.println(c1 == c2);   <span class="comment">//false</span></span><br></pre></td></tr></tbody></table></figure><p><strong>两种浮点数类型的包装类 Float,Double 并没有实现常量池技术。</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">33</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">33</span>;</span><br><span class="line">System.out.println(i1 == i2);<span class="comment">// 输出 true</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">i11</span> <span class="operator">=</span> <span class="number">333</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i22</span> <span class="operator">=</span> <span class="number">333</span>;</span><br><span class="line">System.out.println(i11 == i22);<span class="comment">// 输出 false</span></span><br><span class="line"><span class="type">Double</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">1.2</span>;</span><br><span class="line"><span class="type">Double</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">1.2</span>;</span><br><span class="line">System.out.println(i3 == i4);<span class="comment">// 输出 false</span></span><br></pre></td></tr></tbody></table></figure><h2 id="方法（函数）"><a href="#方法（函数）" class="headerlink" title="方法（函数）"></a>方法（函数）</h2><p>Java 程序设计语言总是采用按值调用。也就是说，方法得到的是所有参数值的一个拷贝，也就是说，方法不能修改传递给它的任何参数变量的内容。<br>在 swap 方法中，a、b 的值进行交换，并不会影响到 num1、num2。因为，a、b 中的值，只是从 num1、num2 的复制过来的。也就是说，a、b 相当于 num1、num2 的副本，副本的内容无论怎么修改，都不会影响到原件本身。</p><p>而对象引用作为参数就不一样</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="type">int</span>[] arr = { <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> };</span><br><span class="line">    System.out.println(arr[<span class="number">0</span>]);</span><br><span class="line">    change(arr);</span><br><span class="line">    System.out.println(arr[<span class="number">0</span>]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span>[] array)</span> {</span><br><span class="line">    <span class="comment">// 将数组的第一个元素变为0</span></span><br><span class="line">    array[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>结果：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></tbody></table></figure><p>array 被初始化 arr 的拷贝也就是一个对象的引用，也就是说 array 和 arr 指向的是同一个数组对象。 因此，外部对引用对象的改变会反映到所对应的对象上。</p><p>我们已经看到，实现一个改变对象参数状态的方法并不是一件难事。理由很简单，方法得到的是对象引用的拷贝，对象引用及其他的拷贝同时引用同一个对象。</p><p>很多程序设计语言（特别是，C++和 Pascal)提供了两种参数传递的方式：值调用和引用调用。有些程序员认为 Java 程序设计语言对对象采用的是引用调用，实际上，这种理解是不对的。由于这种误解具有一定的普遍性，所以下面给出一个反例来详细地阐述一下这个问题。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"小张"</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"小李"</span>);</span><br><span class="line">        Test.swap(s1, s2);</span><br><span class="line">        System.out.println(<span class="string">"s1:"</span> + s1.getName());</span><br><span class="line">        System.out.println(<span class="string">"s2:"</span> + s2.getName());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(Student x, Student y)</span> {</span><br><span class="line">        <span class="type">Student</span> <span class="variable">temp</span> <span class="operator">=</span> x;</span><br><span class="line">        x = y;</span><br><span class="line">        y = temp;</span><br><span class="line">        System.out.println(<span class="string">"x:"</span> + x.getName());</span><br><span class="line">        System.out.println(<span class="string">"y:"</span> + y.getName());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>结果：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x:小李</span><br><span class="line">y:小张</span><br><span class="line">s1:小张</span><br><span class="line">s2:小李</span><br></pre></td></tr></tbody></table></figure><p>解析：</p><p>交换之前：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806155803123.png" alt="在这里插入图片描述"></p><p>交换之后：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806155808662.png" alt="在这里插入图片描述"></p><p>通过上面两张图可以很清晰的看出： 方法并没有改变存储在变量 s1 和 s2 中的对象引用。swap 方法的参数 x 和 y 被初始化为两个对象引用的拷贝，这个方法交换的是这两个拷贝</p><p><strong>总结</strong></p><p>Java 程序设计语言对对象采用的不是引用调用，实际上，对象引用是按 值传递的。</p><p>下面再总结一下 Java 中方法参数的使用情况：</p><ul><li>一个方法不能修改一个基本数据类型的参数（即数值型或布尔型）。</li><li>一个方法可以改变一个对象参数的状态。</li><li>一个方法不能让对象参数引用一个新的对象。</li></ul><p><strong>参考：</strong></p><p>《Java 核心技术卷 Ⅰ》基础知识第十版第四章 4.5 小节</p><h2 id="重载和重写"><a href="#重载和重写" class="headerlink" title="重载和重写"></a>重载和重写</h2><p>重载就是同样的一个方法能够根据输入数据的不同，做出不同的处理</p><p>重写就是当子类继承自父类的相同方法，输入数据一样，但要做出有别于父类的响应时，你就要覆盖父类方法<br>《Java 核心技术》中是这么说的<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/202008061601321.png" alt="在这里插入图片描述"></p><p><strong>综上</strong>：重载就是同一个类中多个同名方法根据不同的传参来执行不同的逻辑处理。</p><p>重写发生在运行期，是子类对父类的允许访问的方法的实现过程进行重新编写。</p><ul><li>返回值类型、方法名、参数列表必须相同，抛出的异常范围小于等于父类，访问修饰符范围大于等于父类。</li><li>如果父类方法访问修饰符为 private/final/static 则子类就不能重写该方法，但是被 static 修饰的方法能够被再次声明。</li><li>构造方法无法被重写</li></ul><p><strong>综上</strong>：重写就是子类对父类方法的重新改造，外部样子不能改变，内部逻辑可以改变</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806160323274.png" alt="在这里插入图片描述"></p><h2 id="深拷贝-vs-浅拷贝"><a href="#深拷贝-vs-浅拷贝" class="headerlink" title="深拷贝 vs 浅拷贝"></a>深拷贝 vs 浅拷贝</h2><p>浅拷贝：对基本数据类型进行值传递，对引用数据类型进行引用传递般的拷贝，此为浅拷贝。<br>深拷贝：对基本数据类型进行值传递，对引用数据类型，创建一个新的对象，并复制其内容，此为深拷贝。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806160355775.png" alt="在这里插入图片描述"></p>]]>