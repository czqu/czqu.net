{"title":"IDEA docker部署springboot项目","slug":"draft/springboot-docker-idea","date":"2020-11-17T02:13:51.000Z","updated":"2020-11-17T02:13:51.000Z","comments":true,"path":"api/articles/draft/springboot-docker-idea.json","excerpt":"一、docker服务器侧监听配置centos7安装配置docker参考《centos下docker安装》 1vim /usr/lib/systemd/system/docker.service，配置完端口，下面的idea中才能连接成功。 默认使用2375端口监听，如果开有防火墙，需要把端口添加到例外。 1ExecStart=``/usr/bin/dockerd` `-H fd:``//` `--containerd=``/run/containerd/containerd``.sock -H tcp:``//0``.0.0.0:2375 二、插件安装和配置 配置docker连接，一定要显示Connection succcessful： 三、springboot项目，增加docker插件和Dockerfile配置 依赖包和配置 123456789101112131415161718192021222324252627282930313233&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;com.spotify&lt;","covers":["/cn/posts/27992/27832-20200311095157924-52880106.png","/cn/posts/27992/27832-20200311095752524-2049075091.png","/cn/posts/27992/copycode.gif","/cn/posts/27992/copycode.gif","/cn/posts/27992/copycode.gif","/cn/posts/27992/copycode.gif","/cn/posts/27992/27832-20200311202127728-810429757.png","/cn/posts/27992/27832-20200311100136847-977682787.png","/cn/posts/27992/copycode.gif","/cn/posts/27992/copycode.gif"],"content":"<h4 id=\"一、docker服务器侧监听配置\"><a href=\"#一、docker服务器侧监听配置\" class=\"headerlink\" title=\"一、docker服务器侧监听配置\"></a>一、docker服务器侧监听配置</h4><p>centos7安装配置docker参考《<a href=\"https://www.cnblogs.com/zhouyu629/p/12447051.html\">centos下docker安装</a>》</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/lib/systemd/system/docker.service，配置完端口，下面的idea中才能连接成功。</span><br></pre></td></tr></tbody></table></figure>\n\n<p> 默认使用2375端口监听，如果开有防火墙，需要把端口添加到例外。</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ExecStart=``/usr/bin/dockerd` `-H fd:``//` `--containerd=``/run/containerd/containerd``.sock -H tcp:``//0``.0.0.0:2375</span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"二、插件安装和配置\"><a href=\"#二、插件安装和配置\" class=\"headerlink\" title=\"二、插件安装和配置\"></a>二、插件安装和配置</h4><p> <img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/27832-20200311095157924-52880106.png\" alt=\"img\"></p>\n<p>配置docker连接，一定要显示Connection succcessful：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/27832-20200311095752524-2049075091.png\" alt=\"img\"></p>\n<h4 id=\"三、springboot项目，增加docker插件和Dockerfile配置\"><a href=\"#三、springboot项目，增加docker插件和Dockerfile配置\" class=\"headerlink\" title=\"三、springboot项目，增加docker插件和Dockerfile配置\"></a>三、springboot项目，增加docker插件和Dockerfile配置</h4><ol>\n<li>依赖包和配置</li>\n</ol>\n<p><a href=\"javascript:void(0);\"><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;build&gt;</span><br><span class=\"line\">        &lt;plugins&gt;</span><br><span class=\"line\">            &lt;plugin&gt;</span><br><span class=\"line\">                &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class=\"line\">                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">                &lt;version&gt; 1.2.1&lt;/version&gt;</span><br><span class=\"line\">                &lt;executions&gt;</span><br><span class=\"line\">                    &lt;execution&gt;</span><br><span class=\"line\">                        &lt;id&gt;build-image&lt;/id&gt;</span><br><span class=\"line\">                        &lt;phase&gt;package&lt;/phase&gt;</span><br><span class=\"line\">                        &lt;goals&gt;</span><br><span class=\"line\">                            &lt;goal&gt;build&lt;/goal&gt;</span><br><span class=\"line\">                        &lt;/goals&gt;</span><br><span class=\"line\">                    &lt;/execution&gt;</span><br><span class=\"line\">                &lt;/executions&gt;</span><br><span class=\"line\">                &lt;configuration&gt;</span><br><span class=\"line\">                    &lt;imageName&gt;${project.artifactId}&lt;/imageName&gt;</span><br><span class=\"line\">                    &lt;imageTags&gt;</span><br><span class=\"line\">                        &lt;imageTag&gt;latest&lt;/imageTag&gt;</span><br><span class=\"line\">                    &lt;/imageTags&gt;</span><br><span class=\"line\">                    &lt;dockerDirectory&gt;${project.basedir}&lt;/dockerDirectory&gt;</span><br><span class=\"line\">                    &lt;dockerHost&gt;http://10.245.202.222:2375&lt;/dockerHost&gt;</span><br><span class=\"line\">                    &lt;resources&gt;</span><br><span class=\"line\">                        &lt;resource&gt;</span><br><span class=\"line\">                            &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class=\"line\">                            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;</span><br><span class=\"line\">                            &lt;include&gt;${project.build.finalName}&lt;/include&gt;</span><br><span class=\"line\">                        &lt;/resource&gt;</span><br><span class=\"line\">                    &lt;/resources&gt;</span><br><span class=\"line\">                &lt;/configuration&gt;</span><br><span class=\"line\">            &lt;/plugin&gt;</span><br><span class=\"line\">        &lt;/plugins&gt;</span><br><span class=\"line\">    &lt;/build&gt;</span><br></pre></td></tr></tbody></table></figure>\n\n<p><a href=\"javascript:void(0);\"><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<p>我一开始建了一个docker的文件夹，将dockerfile放到那里，实践证明不行，不允许往上层路径寻找jar包。</p>\n<p>\\2. Dockerfile配置</p>\n<p><a href=\"javascript:void(0);\"><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#指定基础镜像，在其上进行定制</span><br><span class=\"line\">FROM java:8</span><br><span class=\"line\"></span><br><span class=\"line\">#维护者信息</span><br><span class=\"line\">MAINTAINER zhouyu &lt;zhouyu629@qq.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">#这里的 /tmp 目录就会在运行时自动挂载为匿名卷，任何向 /tmp 中写入的信息都不会记录进容器存储层。</span><br><span class=\"line\">VOLUME /tmp</span><br><span class=\"line\"></span><br><span class=\"line\">#复制上下文目录下的target/demo-1.0.0.jar 到容器里</span><br><span class=\"line\">COPY target/freemarker-page-demo-1.0-SNAPSHOT.jar demo-1.0.0.jar</span><br><span class=\"line\"></span><br><span class=\"line\">#bash方式执行，使demo-1.0.0.jar可访问</span><br><span class=\"line\">#RUN新建立一层，在其上执行这些命令，执行结束后， commit 这一层的修改，构成新的镜像。</span><br><span class=\"line\">RUN bash -c \"touch /demo-1.0.0.jar\"</span><br><span class=\"line\"></span><br><span class=\"line\">#声明运行时容器提供服务端口，这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务</span><br><span class=\"line\">EXPOSE 8080</span><br><span class=\"line\"></span><br><span class=\"line\">#指定容器启动程序及参数   &lt;ENTRYPOINT&gt; \"&lt;CMD&gt;\"</span><br><span class=\"line\">ENTRYPOINT [\"java\",\"-jar\",\"demo-1.0.0.jar\"]</span><br></pre></td></tr></tbody></table></figure>\n\n<p><a href=\"javascript:void(0);\"><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<p>执行mvn package成功</p>\n<p> \\3. 创建容器</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/27832-20200311202127728-810429757.png\" alt=\"img\"></p>\n<p> <img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/27832-20200311100136847-977682787.png\" alt=\"img\"></p>\n<p>注意bind ports，我这里是8080:8088，前面是服务器向外暴露的端口号，8088则是application.yml里配置的应用端口号，我这里对应的tomcat端口号。</p>\n<h4 id=\"四、主要问题解决\"><a href=\"#四、主要问题解决\" class=\"headerlink\" title=\"四、主要问题解决\"></a>四、主要问题解决</h4><p>1.xxxx-1.0-SNAPSHOT.jar中没有主清单属性 ，造成发布失败。</p>\n<p>主要是因为springboot没有配置maven package插件，pom中新增plugin</p>\n<p><a href=\"javascript:void(0);\"><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<figure class=\"highlight xml\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>repackage<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p><a href=\"javascript:void(0);\"><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<ol start=\"2\">\n<li>容器时间和宿主时间不一致</li>\n</ol>\n<p>在Dockerfile最后一行增加：</p>\n<figure class=\"highlight shell\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">设置时区</span></span><br><span class=\"line\">RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\</span><br><span class=\"line\">  &amp;&amp; echo 'Asia/Shanghai' &gt;/etc/timezone \\</span><br></pre></td></tr></tbody></table></figure>\n\n","more":"<h4 id=\"一、docker服务器侧监听配置\"><a href=\"#一、docker服务器侧监听配置\" class=\"headerlink\" title=\"一、docker服务器侧监听配置\"></a>一、docker服务器侧监听配置</h4><p>centos7安装配置docker参考《<a href=\"https://www.cnblogs.com/zhouyu629/p/12447051.html\">centos下docker安装</a>》</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /usr/lib/systemd/system/docker.service，配置完端口，下面的idea中才能连接成功。</span><br></pre></td></tr></table></figure>\n\n<p> 默认使用2375端口监听，如果开有防火墙，需要把端口添加到例外。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ExecStart=``/usr/bin/dockerd` `-H fd:``//` `--containerd=``/run/containerd/containerd``.sock -H tcp:``//0``.0.0.0:2375</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"二、插件安装和配置\"><a href=\"#二、插件安装和配置\" class=\"headerlink\" title=\"二、插件安装和配置\"></a>二、插件安装和配置</h4><p> <img src=\"/cn/posts/27992/27832-20200311095157924-52880106.png\" alt=\"img\"></p>\n<p>配置docker连接，一定要显示Connection succcessful：</p>\n<p><img src=\"/cn/posts/27992/27832-20200311095752524-2049075091.png\" alt=\"img\"></p>\n<h4 id=\"三、springboot项目，增加docker插件和Dockerfile配置\"><a href=\"#三、springboot项目，增加docker插件和Dockerfile配置\" class=\"headerlink\" title=\"三、springboot项目，增加docker插件和Dockerfile配置\"></a>三、springboot项目，增加docker插件和Dockerfile配置</h4><ol>\n<li>依赖包和配置</li>\n</ol>\n<p><a href=\"javascript:void(0);\"><img src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;build&gt;</span><br><span class=\"line\">        &lt;plugins&gt;</span><br><span class=\"line\">            &lt;plugin&gt;</span><br><span class=\"line\">                &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class=\"line\">                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">                &lt;version&gt; 1.2.1&lt;/version&gt;</span><br><span class=\"line\">                &lt;executions&gt;</span><br><span class=\"line\">                    &lt;execution&gt;</span><br><span class=\"line\">                        &lt;id&gt;build-image&lt;/id&gt;</span><br><span class=\"line\">                        &lt;phase&gt;package&lt;/phase&gt;</span><br><span class=\"line\">                        &lt;goals&gt;</span><br><span class=\"line\">                            &lt;goal&gt;build&lt;/goal&gt;</span><br><span class=\"line\">                        &lt;/goals&gt;</span><br><span class=\"line\">                    &lt;/execution&gt;</span><br><span class=\"line\">                &lt;/executions&gt;</span><br><span class=\"line\">                &lt;configuration&gt;</span><br><span class=\"line\">                    &lt;imageName&gt;$&#123;project.artifactId&#125;&lt;/imageName&gt;</span><br><span class=\"line\">                    &lt;imageTags&gt;</span><br><span class=\"line\">                        &lt;imageTag&gt;latest&lt;/imageTag&gt;</span><br><span class=\"line\">                    &lt;/imageTags&gt;</span><br><span class=\"line\">                    &lt;dockerDirectory&gt;$&#123;project.basedir&#125;&lt;/dockerDirectory&gt;</span><br><span class=\"line\">                    &lt;dockerHost&gt;http://10.245.202.222:2375&lt;/dockerHost&gt;</span><br><span class=\"line\">                    &lt;resources&gt;</span><br><span class=\"line\">                        &lt;resource&gt;</span><br><span class=\"line\">                            &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class=\"line\">                            &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt;</span><br><span class=\"line\">                            &lt;include&gt;$&#123;project.build.finalName&#125;&lt;/include&gt;</span><br><span class=\"line\">                        &lt;/resource&gt;</span><br><span class=\"line\">                    &lt;/resources&gt;</span><br><span class=\"line\">                &lt;/configuration&gt;</span><br><span class=\"line\">            &lt;/plugin&gt;</span><br><span class=\"line\">        &lt;/plugins&gt;</span><br><span class=\"line\">    &lt;/build&gt;</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"javascript:void(0);\"><img src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<p>我一开始建了一个docker的文件夹，将dockerfile放到那里，实践证明不行，不允许往上层路径寻找jar包。</p>\n<p>\\2. Dockerfile配置</p>\n<p><a href=\"javascript:void(0);\"><img src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#指定基础镜像，在其上进行定制</span><br><span class=\"line\">FROM java:8</span><br><span class=\"line\"></span><br><span class=\"line\">#维护者信息</span><br><span class=\"line\">MAINTAINER zhouyu &lt;zhouyu629@qq.com&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">#这里的 /tmp 目录就会在运行时自动挂载为匿名卷，任何向 /tmp 中写入的信息都不会记录进容器存储层。</span><br><span class=\"line\">VOLUME /tmp</span><br><span class=\"line\"></span><br><span class=\"line\">#复制上下文目录下的target/demo-1.0.0.jar 到容器里</span><br><span class=\"line\">COPY target/freemarker-page-demo-1.0-SNAPSHOT.jar demo-1.0.0.jar</span><br><span class=\"line\"></span><br><span class=\"line\">#bash方式执行，使demo-1.0.0.jar可访问</span><br><span class=\"line\">#RUN新建立一层，在其上执行这些命令，执行结束后， commit 这一层的修改，构成新的镜像。</span><br><span class=\"line\">RUN bash -c &quot;touch /demo-1.0.0.jar&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#声明运行时容器提供服务端口，这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务</span><br><span class=\"line\">EXPOSE 8080</span><br><span class=\"line\"></span><br><span class=\"line\">#指定容器启动程序及参数   &lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</span><br><span class=\"line\">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;demo-1.0.0.jar&quot;]</span><br></pre></td></tr></table></figure>\n\n<p><a href=\"javascript:void(0);\"><img src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<p>执行mvn package成功</p>\n<p> \\3. 创建容器</p>\n<p><img src=\"/cn/posts/27992/27832-20200311202127728-810429757.png\" alt=\"img\"></p>\n<p> <img src=\"/cn/posts/27992/27832-20200311100136847-977682787.png\" alt=\"img\"></p>\n<p>注意bind ports，我这里是8080:8088，前面是服务器向外暴露的端口号，8088则是application.yml里配置的应用端口号，我这里对应的tomcat端口号。</p>\n<h4 id=\"四、主要问题解决\"><a href=\"#四、主要问题解决\" class=\"headerlink\" title=\"四、主要问题解决\"></a>四、主要问题解决</h4><p>1.xxxx-1.0-SNAPSHOT.jar中没有主清单属性 ，造成发布失败。</p>\n<p>主要是因为springboot没有配置maven package插件，pom中新增plugin</p>\n<p><a href=\"javascript:void(0);\"><img src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>repackage<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><a href=\"javascript:void(0);\"><img src=\"/cn/posts/27992/copycode.gif\" alt=\"复制代码\"></a></p>\n<ol start=\"2\">\n<li>容器时间和宿主时间不一致</li>\n</ol>\n<p>在Dockerfile最后一行增加：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">设置时区</span></span><br><span class=\"line\">RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\</span><br><span class=\"line\">  &amp;&amp; echo &#x27;Asia/Shanghai&#x27; &gt;/etc/timezone \\</span><br></pre></td></tr></table></figure>\n\n","categories":[],"tags":[{"name":"后端","path":"api/tags/后端.json"},{"name":"springboot","path":"api/tags/springboot.json"},{"name":"java","path":"api/tags/java.json"}]}