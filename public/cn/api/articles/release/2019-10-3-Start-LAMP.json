{"title":"ubuntu 18.04下搭建LAMP环境","slug":"release/2019-10-3-Start-LAMP","date":"2019-10-03T02:00:00.000Z","updated":"2019-10-03T02:00:00.000Z","comments":true,"path":"api/articles/release/2019-10-3-Start-LAMP.json","excerpt":"前言： Linux 操作系统在服务器领域具有广泛的应用。Web 服务是服务器领域中应用最广泛的服务，常见 Web 服务有 WAMP（Windows+Apache+MySQL+PHP）和 LAMP（Linux+Apache+MySQL+PHP）架构，其中 Apache 是全世界最流行的 Web 服务软件，此外，Web 服务软件 nginx，因其具有优秀的性能也受到越来越多的用户欢迎。本文中，演示在 Linux 环境下搭建支持 PHP 等网页的 Web 服务平台，即LAMP。Linux 环境下搭建 Web 服务器有三种方式，一是在安装操作系统时勾选相应服务组件；二是从网上下载或从 ISO 系统镜像包中拷贝安装包手动安装；三是在在连接网络的的情况下在线安装。本文以阿里云 Ubuntu 18.04 64 位操作系统为例安装LAMP，并用PHP实现简单的图片上传功能。 1.安装 Apache 服务器1apt update &amp;&amp; apt install apache2 安装完成后需要手动启动 apache 服务 测试 Apache，在浏览器输入服务器IP 地址，如下图所示，说明 A","covers":["/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvWmljTzIxYm9DSnd5RkhrLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvT3Q1cG5QUWtxNzZyU2VHLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvNXlMeHRpVUJtQ2FwVFBZLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcW1FWlh0RFI4aHJIV04zLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvdmRJMmg4VHk5YWJZM0NTLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvbXZKYTlYeGhEbzJWQVQxLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcVdjWlFyQzZQQlViRmY0LnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvM3RTeXBpamJIN01lc0ZuLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvSXBjT043b2tHOW1hVDVoLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvaEpQRlpMOGJ4d05JaWdPLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvQzRvWWNCeHVoZUw3MzY4LnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvZXoyUUFEVm5VQ1BybG1iLnBuZw.png","/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcveWk4UDRaN0dqYk1ZNXZYLnBuZw.png"],"content":"<blockquote>\n<p>前言：</p>\n<p>Linux 操作系统在服务器领域具有广泛的应用。Web 服务是服务器领域中应<br>用最广泛的服务，常见 Web 服务有 WAMP（Windows+Apache+MySQL+PHP）和 LAMP<br>（Linux+Apache+MySQL+PHP）架构，其中 Apache 是全世界最流行的 Web 服务软<br>件，此外，Web 服务软件 nginx，因其具有优秀的性能也受到越来越多的用户欢<br>迎。本文中，演示在 Linux 环境下搭建支持 PHP 等网页的 Web 服务平台，即<br>LAMP。<br>Linux 环境下搭建 Web 服务器有三种方式，一是在安装操作系统时勾选相应<br>服务组件；二是从网上下载或从 ISO 系统镜像包中拷贝安装包手动安装；三是在<br>在连接网络的的情况下在线安装。<br>本文以阿里云 Ubuntu 18.04 64 位操作系统为例安装LAMP，并用PHP实现简单的图片上传功能。</p>\n</blockquote>\n<h5 id=\"1-安装-Apache-服务器\"><a href=\"#1-安装-Apache-服务器\" class=\"headerlink\" title=\"1.安装 Apache 服务器\"></a>1.安装 Apache 服务器</h5><figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update &amp;&amp; apt install apache2</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvWmljTzIxYm9DSnd5RkhrLnBuZw.png\" alt=\"image-20200607185107131\"></p>\n<p><strong>安装完成后需要手动启动 apache 服务</strong></p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvT3Q1cG5QUWtxNzZyU2VHLnBuZw.png\" alt=\"image-20200607185314919\"></p>\n<p><strong>测试 Apache，在浏览器输入服务器IP 地址，如下图所示，说明 Apache 安装成功。（阿里云等需要在云控制面板打开80端口才能访问）</strong></p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvNXlMeHRpVUJtQ2FwVFBZLnBuZw.png\" alt=\"image-20200607185759748\"></p>\n<blockquote>\n<p>以上页面详细介绍了 debian 发行版 Linux 中 Apache 基本信息，其中：</p>\n<p>Apache 根目录：<br>/var/www/html<br>Apache 配置目录和文件：<br>/etc/apache2：Apache 主配置目录， Apache 所有配置文件均在此目录下；<br>/etc/apache2/apache2.conf：主配置文件，可配置 Apache 全局配置；<br>/etc/apache2/ports.conf：端口配置文件。默认情况下，当启用提供 SSL<br>功能的模块时，Apache 监听端口 80，并在端口 443 上进行监听。<br>其它文件略。<br>Apache 日志文件：<br>/var/log/apache2/access.log:服务请求日志；<br>/var/log/apache2/error.log：服务错误日志。<br>Apache 基本操作：<br>服务启动：/etc/init.d/apache2 start<br>服务停止：/etc/init.d/apache2 stop<br>服务重启：/etc/init.d/apache2 restart<br>部分 Linux 安装 Apache 后可能出现服务正常运行，相应端口正常打开，但<br>其它主机无法访问情况，此现象一般是因为系统防火墙未开放相应服务端口。  </p>\n<p><strong>以修改端口为例修改配置文件</strong></p>\n<p>首先打开/etc/apache2/ports.conf文件,然后修改Listen的内容,最后需要重启apache生效</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;/etc/init.d/apache2 restart</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcW1FWlh0RFI4aHJIV04zLnBuZw.png\" alt=\"image-20200607210454251\"></p>\n</blockquote>\n<p><strong>阿里云安全组配置</strong></p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvdmRJMmg4VHk5YWJZM0NTLnBuZw.png\" alt=\"image-20200607185719368\"></p>\n<h5 id=\"2-安装-MySQL-MariaDB\"><a href=\"#2-安装-MySQL-MariaDB\" class=\"headerlink\" title=\"2.安装 MySQL/MariaDB\"></a>2.安装 MySQL/MariaDB</h5><blockquote>\n<p>本示例采用 MariaDB 代替 MySQL。MariaDB 是 MySQL 的一个分支，现由开源<br>社区维护，采用 GPL 授权许可，其大部分语法与 MySQL 都相同。因 MySQL 被 Oracle<br>收购后有闭源的风险，大部分 Linux 组织均从其套件清单删除了 MySQL，并以<br>MariaDB 代替 MySQL，若一定要使用 MySQL，可通过下载安装包的方式手动安装<br>MySQL。  </p>\n</blockquote>\n<p><strong>安装 MariaDB 服务</strong>  </p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt install mariadb-server</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt install mariadb-client</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvbXZKYTlYeGhEbzJWQVQxLnBuZw.png\" alt=\"image-20200607190537515\"></p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcVdjWlFyQzZQQlViRmY0LnBuZw.png\" alt=\"image-20200607190604824\"></p>\n<p><strong>配置 Mariadb 的安全选项:</strong>  </p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> mysql_secure_installation</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvM3RTeXBpamJIN01lc0ZuLnBuZw.png\" alt=\"image-20200607190923711\"></p>\n<blockquote>\n<p>此时系统会提示输入数据库 root 用户密码，因系统并未设置相应密码，此<br>时直接按提示回车即可。若提示错误，则 sudo /etc/init.d/mysql restart 命<br>令重启 mysql 服务并重新执行安全选项命令。<br>随后数据库会提示以下安全设置信息，一般设置数据库 root 用户密码即可，<br>其它选项按回车选择默认：<br>1、Enter current password for root (enter for none): 输入当前 root<br>的密码(因新数据库无密码，回车即可)；<br>2、Set root password? [Y/n] 回车，默认为输入 Y；<br>3、New password: 输入新密码；<br>4、Re-enter new password 确认密码；<br>5、Remove anonymous users? [Y/n] 移除匿名用户；<br>6、Disallow root login remotely? [Y/n] 禁止 root 远程登录；<br>7、Remove test database and access to it? [Y/n] 移除测试数据库；<br>8、Reload privilege tables now? [Y/n] 重新加载权限表。</p>\n</blockquote>\n<p><strong>测试数据库，如图所示，若进入数据库则表示数据库安装成功。</strong> </p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span>  mysql -u root -p</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvSXBjT043b2tHOW1hVDVoLnBuZw.png\" alt=\"image-20200607193447164\"></p>\n<h5 id=\"3-安装PHP\"><a href=\"#3-安装PHP\" class=\"headerlink\" title=\"3.安装PHP\"></a>3.安装PHP</h5><blockquote>\n<p>安装 PHP 除了 PHP 应用程序外，还需安装 PHP 与 Apache、MySQL/MariaDB<br>相关扩展包，扩展包需与软件对应，本例中安装 php7.3 版本，对应扩展包可通<br>过以下命令模糊查询。  </p>\n<p>sudo apt-cache search php7</p>\n</blockquote>\n<p>从 查 询 结 果 可 知 ， php7.2 对 应 Apache 、 MySQL 扩 展 包 分 别 为 ：<br> libapahe2-mod-php7.2，php7.2-mysql。如下图所示为安装 PHP 相关软件包。</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt-get install php7.2 libapache2-mod-php7.2 php7.2-mysql</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvaEpQRlpMOGJ4d05JaWdPLnBuZw.png\" alt=\"image-20200607203901229\"></p>\n<p><strong>PHP 安装完毕后需重启 Apache</strong></p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/apache2 restart</span><br></pre></td></tr></tbody></table></figure>\n\n<h5 id=\"4-测试-PHP-页面\"><a href=\"#4-测试-PHP-页面\" class=\"headerlink\" title=\"4.测试 PHP 页面\"></a>4.测试 PHP 页面</h5><p>编辑测试文件，如下图所示，在“/var/www/html”目录下新建“test.php”文件，并输入如下图所示的测试代码  </p>\n<figure class=\"highlight php\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">phpinfo</span>();<span class=\"meta\">?&gt;</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>在浏览器中输入测试页面地址，并确认已安装组件,例如：</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://127.0.0.1/test.php</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvQzRvWWNCeHVoZUw3MzY4LnBuZw.png\" alt=\"image-20200607205042380\"></p>\n<h5 id=\"5-创建文件上传页面\"><a href=\"#5-创建文件上传页面\" class=\"headerlink\" title=\"5.创建文件上传页面\"></a>5.创建文件上传页面</h5><p>文件上传功能由上传文件的 HTML 表单和文件上传脚本构成。<br>在“/var/www/html”目录下创建“upload.html”文件，编辑表单  </p>\n<figure class=\"highlight html\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- upload.html --&gt;</span><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">\"upload.php\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"post\"</span><span class=\"attr\">enctype</span>=<span class=\"string\">\"multipart/form-data\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">\"file\"</span>&gt;</span>Filename:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"file\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"file\"</span> /&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"submit\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"submit\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"Submit\"</span> /&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>在“/var/www/html”目录下创建 “upload.php” 脚本文件，编写文件上传功能代码  </p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- upload.php --&gt;&lt;?php// 允许上传的图片后缀$allowedExts = array(\"gif\", \"jpeg\", \"jpg\", \"png\");$temp = explode(\".\", $_FILES[\"file\"][\"name\"]);echo $_FILES[\"file\"][\"size\"];$extension = end($temp);     // 获取文件后缀名if ((($_FILES[\"file\"][\"type\"] == \"image/gif\")|| ($_FILES[\"file\"][\"type\"] == \"image/jpeg\")|| ($_FILES[\"file\"][\"type\"] == \"image/jpg\")|| ($_FILES[\"file\"][\"type\"] == \"image/pjpeg\")|| ($_FILES[\"file\"][\"type\"] == \"image/x-png\")|| ($_FILES[\"file\"][\"type\"] == \"image/png\"))&amp;&amp; ($_FILES[\"file\"][\"size\"] &lt; 204800)   // 小于 200 kb&amp;&amp; in_array($extension, $allowedExts)){    if ($_FILES[\"file\"][\"error\"] &gt; 0)    {        echo \"错误：: \" . $_FILES[\"file\"][\"error\"] . \"&lt;br&gt;\";    }    else    {        echo \"上传文件名: \" . $_FILES[\"file\"][\"name\"] . \"&lt;br&gt;\";        echo \"文件类型: \" . $_FILES[\"file\"][\"type\"] . \"&lt;br&gt;\";        echo \"文件大小: \" . ($_FILES[\"file\"][\"size\"] / 1024) . \" kB&lt;br&gt;\";        echo \"文件临时存储的位置: \" . $_FILES[\"file\"][\"tmp_name\"] . \"&lt;br&gt;\";                // 判断当前目录下的 upload 目录是否存在该文件        if (file_exists(\"upload/\" . $_FILES[\"file\"][\"name\"]))        {            echo $_FILES[\"file\"][\"name\"] . \" 文件已经存在。 \";        }        else        {            // 如果 upload 目录不存在该文件则将文件上传到 upload 目录下            move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], \"upload/\" . $_FILES[\"file\"][\"name\"]);            echo \"文件存储在: \" . \"upload/\" . $_FILES[\"file\"][\"name\"];        }    }}else{    echo \"非法的文件格式\";}?&gt;</span><br></pre></td></tr></tbody></table></figure>\n\n<p>在目录下创建“upload”目录，用于保存上传的图片。  </p>\n<p>如下图所示，为上传文件页面。  </p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvZXoyUUFEVm5VQ1BybG1iLnBuZw.png\" alt=\"image-20200607210025657\"></p>\n<p>上传成功的提示：<br><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcveWk4UDRaN0dqYk1ZNXZYLnBuZw.png\" alt=\"image-20200607210110052\"></p>\n","more":"<blockquote>\n<p>前言：</p>\n<p>Linux 操作系统在服务器领域具有广泛的应用。Web 服务是服务器领域中应<br>用最广泛的服务，常见 Web 服务有 WAMP（Windows+Apache+MySQL+PHP）和 LAMP<br>（Linux+Apache+MySQL+PHP）架构，其中 Apache 是全世界最流行的 Web 服务软<br>件，此外，Web 服务软件 nginx，因其具有优秀的性能也受到越来越多的用户欢<br>迎。本文中，演示在 Linux 环境下搭建支持 PHP 等网页的 Web 服务平台，即<br>LAMP。<br>Linux 环境下搭建 Web 服务器有三种方式，一是在安装操作系统时勾选相应<br>服务组件；二是从网上下载或从 ISO 系统镜像包中拷贝安装包手动安装；三是在<br>在连接网络的的情况下在线安装。<br>本文以阿里云 Ubuntu 18.04 64 位操作系统为例安装LAMP，并用PHP实现简单的图片上传功能。</p>\n</blockquote>\n<h5 id=\"1-安装-Apache-服务器\"><a href=\"#1-安装-Apache-服务器\" class=\"headerlink\" title=\"1.安装 Apache 服务器\"></a>1.安装 Apache 服务器</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update &amp;&amp; apt install apache2</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvWmljTzIxYm9DSnd5RkhrLnBuZw.png\" alt=\"image-20200607185107131\"></p>\n<p><strong>安装完成后需要手动启动 apache 服务</strong></p>\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvT3Q1cG5QUWtxNzZyU2VHLnBuZw.png\" alt=\"image-20200607185314919\"></p>\n<p><strong>测试 Apache，在浏览器输入服务器IP 地址，如下图所示，说明 Apache 安装成功。（阿里云等需要在云控制面板打开80端口才能访问）</strong></p>\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvNXlMeHRpVUJtQ2FwVFBZLnBuZw.png\" alt=\"image-20200607185759748\"></p>\n<blockquote>\n<p>以上页面详细介绍了 debian 发行版 Linux 中 Apache 基本信息，其中：</p>\n<p>Apache 根目录：<br>/var/www/html<br>Apache 配置目录和文件：<br>/etc/apache2：Apache 主配置目录， Apache 所有配置文件均在此目录下；<br>/etc/apache2/apache2.conf：主配置文件，可配置 Apache 全局配置；<br>/etc/apache2/ports.conf：端口配置文件。默认情况下，当启用提供 SSL<br>功能的模块时，Apache 监听端口 80，并在端口 443 上进行监听。<br>其它文件略。<br>Apache 日志文件：<br>/var/log/apache2/access.log:服务请求日志；<br>/var/log/apache2/error.log：服务错误日志。<br>Apache 基本操作：<br>服务启动：/etc/init.d/apache2 start<br>服务停止：/etc/init.d/apache2 stop<br>服务重启：/etc/init.d/apache2 restart<br>部分 Linux 安装 Apache 后可能出现服务正常运行，相应端口正常打开，但<br>其它主机无法访问情况，此现象一般是因为系统防火墙未开放相应服务端口。  </p>\n<p><strong>以修改端口为例修改配置文件</strong></p>\n<p>首先打开/etc/apache2/ports.conf文件,然后修改Listen的内容,最后需要重启apache生效</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;/etc/init.d/apache2 restart</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcW1FWlh0RFI4aHJIV04zLnBuZw.png\" alt=\"image-20200607210454251\"></p>\n</blockquote>\n<p><strong>阿里云安全组配置</strong></p>\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvdmRJMmg4VHk5YWJZM0NTLnBuZw.png\" alt=\"image-20200607185719368\"></p>\n<h5 id=\"2-安装-MySQL-MariaDB\"><a href=\"#2-安装-MySQL-MariaDB\" class=\"headerlink\" title=\"2.安装 MySQL/MariaDB\"></a>2.安装 MySQL/MariaDB</h5><blockquote>\n<p>本示例采用 MariaDB 代替 MySQL。MariaDB 是 MySQL 的一个分支，现由开源<br>社区维护，采用 GPL 授权许可，其大部分语法与 MySQL 都相同。因 MySQL 被 Oracle<br>收购后有闭源的风险，大部分 Linux 组织均从其套件清单删除了 MySQL，并以<br>MariaDB 代替 MySQL，若一定要使用 MySQL，可通过下载安装包的方式手动安装<br>MySQL。  </p>\n</blockquote>\n<p><strong>安装 MariaDB 服务</strong>  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt install mariadb-server</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> apt install mariadb-client</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvbXZKYTlYeGhEbzJWQVQxLnBuZw.png\" alt=\"image-20200607190537515\"></p>\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcVdjWlFyQzZQQlViRmY0LnBuZw.png\" alt=\"image-20200607190604824\"></p>\n<p><strong>配置 Mariadb 的安全选项:</strong>  </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> mysql_secure_installation</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvM3RTeXBpamJIN01lc0ZuLnBuZw.png\" alt=\"image-20200607190923711\"></p>\n<blockquote>\n<p>此时系统会提示输入数据库 root 用户密码，因系统并未设置相应密码，此<br>时直接按提示回车即可。若提示错误，则 sudo /etc/init.d/mysql restart 命<br>令重启 mysql 服务并重新执行安全选项命令。<br>随后数据库会提示以下安全设置信息，一般设置数据库 root 用户密码即可，<br>其它选项按回车选择默认：<br>1、Enter current password for root (enter for none): 输入当前 root<br>的密码(因新数据库无密码，回车即可)；<br>2、Set root password? [Y/n] 回车，默认为输入 Y；<br>3、New password: 输入新密码；<br>4、Re-enter new password 确认密码；<br>5、Remove anonymous users? [Y/n] 移除匿名用户；<br>6、Disallow root login remotely? [Y/n] 禁止 root 远程登录；<br>7、Remove test database and access to it? [Y/n] 移除测试数据库；<br>8、Reload privilege tables now? [Y/n] 重新加载权限表。</p>\n</blockquote>\n<p><strong>测试数据库，如图所示，若进入数据库则表示数据库安装成功。</strong> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span>  mysql -u root -p</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvSXBjT043b2tHOW1hVDVoLnBuZw.png\" alt=\"image-20200607193447164\"></p>\n<h5 id=\"3-安装PHP\"><a href=\"#3-安装PHP\" class=\"headerlink\" title=\"3.安装PHP\"></a>3.安装PHP</h5><blockquote>\n<p>安装 PHP 除了 PHP 应用程序外，还需安装 PHP 与 Apache、MySQL/MariaDB<br>相关扩展包，扩展包需与软件对应，本例中安装 php7.3 版本，对应扩展包可通<br>过以下命令模糊查询。  </p>\n<p>sudo apt-cache search php7</p>\n</blockquote>\n<p>从 查 询 结 果 可 知 ， php7.2 对 应 Apache 、 MySQL 扩 展 包 分 别 为 ：<br> libapahe2-mod-php7.2，php7.2-mysql。如下图所示为安装 PHP 相关软件包。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> apt-get install php7.2 libapache2-mod-php7.2 php7.2-mysql</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvaEpQRlpMOGJ4d05JaWdPLnBuZw.png\" alt=\"image-20200607203901229\"></p>\n<p><strong>PHP 安装完毕后需重启 Apache</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/apache2 restart</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-测试-PHP-页面\"><a href=\"#4-测试-PHP-页面\" class=\"headerlink\" title=\"4.测试 PHP 页面\"></a>4.测试 PHP 页面</h5><p>编辑测试文件，如下图所示，在“/var/www/html”目录下新建“test.php”文件，并输入如下图所示的测试代码  </p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">phpinfo</span>();<span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在浏览器中输入测试页面地址，并确认已安装组件,例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://127.0.0.1/test.php</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvQzRvWWNCeHVoZUw3MzY4LnBuZw.png\" alt=\"image-20200607205042380\"></p>\n<h5 id=\"5-创建文件上传页面\"><a href=\"#5-创建文件上传页面\" class=\"headerlink\" title=\"5.创建文件上传页面\"></a>5.创建文件上传页面</h5><p>文件上传功能由上传文件的 HTML 表单和文件上传脚本构成。<br>在“/var/www/html”目录下创建“upload.html”文件，编辑表单  </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- upload.html --&gt;</span><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">form</span> <span class=\"attr\">action</span>=<span class=\"string\">&quot;upload.php&quot;</span> <span class=\"attr\">method</span>=<span class=\"string\">&quot;post&quot;</span><span class=\"attr\">enctype</span>=<span class=\"string\">&quot;multipart/form-data&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">&quot;file&quot;</span>&gt;</span>Filename:<span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;file&quot;</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;file&quot;</span> /&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">br</span> /&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;submit&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;Submit&quot;</span> /&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>在“/var/www/html”目录下创建 “upload.php” 脚本文件，编写文件上传功能代码  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- upload.php --&gt;&lt;?php// 允许上传的图片后缀$allowedExts = array(&quot;gif&quot;, &quot;jpeg&quot;, &quot;jpg&quot;, &quot;png&quot;);$temp = explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]);echo $_FILES[&quot;file&quot;][&quot;size&quot;];$extension = end($temp);     // 获取文件后缀名if ((($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/gif&quot;)|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/jpeg&quot;)|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/jpg&quot;)|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/pjpeg&quot;)|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/x-png&quot;)|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/png&quot;))&amp;&amp; ($_FILES[&quot;file&quot;][&quot;size&quot;] &lt; 204800)   // 小于 200 kb&amp;&amp; in_array($extension, $allowedExts))&#123;    if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)    &#123;        echo &quot;错误：: &quot; . $_FILES[&quot;file&quot;][&quot;error&quot;] . &quot;&lt;br&gt;&quot;;    &#125;    else    &#123;        echo &quot;上传文件名: &quot; . $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot;&lt;br&gt;&quot;;        echo &quot;文件类型: &quot; . $_FILES[&quot;file&quot;][&quot;type&quot;] . &quot;&lt;br&gt;&quot;;        echo &quot;文件大小: &quot; . ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024) . &quot; kB&lt;br&gt;&quot;;        echo &quot;文件临时存储的位置: &quot; . $_FILES[&quot;file&quot;][&quot;tmp_name&quot;] . &quot;&lt;br&gt;&quot;;                // 判断当前目录下的 upload 目录是否存在该文件        if (file_exists(&quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]))        &#123;            echo $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot; 文件已经存在。 &quot;;        &#125;        else        &#123;            // 如果 upload 目录不存在该文件则将文件上传到 upload 目录下            move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]);            echo &quot;文件存储在: &quot; . &quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;];        &#125;    &#125;&#125;else&#123;    echo &quot;非法的文件格式&quot;;&#125;?&gt;</span><br></pre></td></tr></table></figure>\n\n<p>在目录下创建“upload”目录，用于保存上传的图片。  </p>\n<p>如下图所示，为上传文件页面。  </p>\n<p><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvZXoyUUFEVm5VQ1BybG1iLnBuZw.png\" alt=\"image-20200607210025657\"></p>\n<p>上传成功的提示：<br><img src=\"/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcveWk4UDRaN0dqYk1ZNXZYLnBuZw.png\" alt=\"image-20200607210110052\"></p>\n","categories":[],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"后端","path":"api/tags/后端.json"}]}