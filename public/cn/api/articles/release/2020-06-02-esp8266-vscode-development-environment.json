{"title":"使用vscode快速搭建单片机开发环境","slug":"release/2020-06-02-esp8266-vscode-development-environment","date":"2020-06-09T16:00:00.000Z","updated":"2020-06-09T16:00:00.000Z","comments":true,"path":"api/articles/release/2020-06-02-esp8266-vscode-development-environment.json","excerpt":"摘要：本文主要介绍了如何搭建以Visual Studio Code 和 PlatformIO为基础的单片机开发环境，并以esp8266开发板为例，通过在OLED显示屏上显示文字的一个例子介绍如何开发一个单片机程序。 本文主要使用的环境： 单片机开发板:Esp8266(CH340G) Visual Studio Code：1.45.1 PlatformIO：Core 4.3.4 Home 3.2.2 U8g2：2.28.6 一、硬件部分首先就是去某宝买一个esp8266开发板和显示屏，这里我买的是这个（不贴链接，不然有打广告嫌疑，自己去搜哈，有些卖家不送杜邦线的，可以提前问问） 按照卖家的说明将显示屏和开发板连接好 二、软件部分1. 安装Visual Studio Code 和 PlatformIOvscode: https://code.visualstudio.com/ 安装完成vscode启动，扩展页面下搜索platformio即可找到,选择第一个Platformio IDE，安装即可（这里需要耐心等待一会） 安装完成，等待vscode重新加载后，左下角会多一个小房子图标，点击后即","covers":["/cn/posts/23513/10007.png","/cn/posts/23513/100002354.png","/cn/posts/23513/4363463.png","/cn/posts/23513/4363463456t.png","/cn/posts/23513/54y7457.png","/cn/posts/23513/5475476574767.png","/cn/posts/23513/135424.png","/cn/posts/23513/1537453.png","/cn/posts/23513/4535.png","/cn/posts/23513/10254.png","/cn/posts/23513/45374583783.png"],"content":"<blockquote>\n<p>摘要：本文主要介绍了如何搭建以Visual Studio Code 和 PlatformIO为基础的单片机开发环境，并以esp8266开发板为例，通过在OLED显示屏上显示文字的一个例子介绍如何开发一个单片机程序。</p>\n</blockquote>\n<p>本文主要使用的环境：</p>\n<blockquote>\n<p>单片机开发板:Esp8266(CH340G)</p>\n<p>Visual Studio Code：1.45.1</p>\n<p>PlatformIO：Core  4.3.4   Home  3.2.2</p>\n<p>U8g2：2.28.6</p>\n</blockquote>\n<h4 id=\"一、硬件部分\"><a href=\"#一、硬件部分\" class=\"headerlink\" title=\"一、硬件部分\"></a>一、硬件部分</h4><p>首先就是去某宝买一个esp8266开发板和显示屏，这里我买的是这个（不贴链接，不然有打广告嫌疑，自己去搜哈，有些卖家不送杜邦线的，可以提前问问）</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/10007.png\" alt=\"image-20200609001347090\"></p>\n<p>按照卖家的说明将显示屏和开发板连接好</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/100002354.png\" alt=\"image-20200609001656314\"></p>\n<h4 id=\"二、软件部分\"><a href=\"#二、软件部分\" class=\"headerlink\" title=\"二、软件部分\"></a>二、软件部分</h4><h5 id=\"1-安装Visual-Studio-Code-和-PlatformIO\"><a href=\"#1-安装Visual-Studio-Code-和-PlatformIO\" class=\"headerlink\" title=\"1. 安装Visual Studio Code 和 PlatformIO\"></a>1. 安装Visual Studio Code 和 PlatformIO</h5><p>vscode: <a href=\"https://code.visualstudio.com/\">https://code.visualstudio.com/</a></p>\n<p>安装完成vscode启动，扩展页面下搜索platformio即可找到,选择第一个Platformio IDE，安装即可（这里需要耐心等待一会）</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/4363463.png\" alt=\"image-20200609004134896\"></p>\n<p>安装完成，等待vscode重新加载后，左下角会多一个小房子图标，点击后即可显示Platformio IDE主界面</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/4363463456t.png\" alt=\"image-20200608225407247\"></p>\n<h5 id=\"2-安装显示库\"><a href=\"#2-安装显示库\" class=\"headerlink\" title=\"2.安装显示库\"></a>2.安装显示库</h5><p>如图点击主界面右侧侧边栏Libraies选项卡，然后直接搜索U8G2然后点击进去，里面有个安装按钮，点一下即可：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/54y7457.png\" alt=\"image-20200608230257339\"></p>\n<h5 id=\"3-开始我们的第一个程序\"><a href=\"#3-开始我们的第一个程序\" class=\"headerlink\" title=\"3. 开始我们的第一个程序\"></a>3. 开始我们的第一个程序</h5><p>   选择新建工程:</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/5475476574767.png\" alt=\"image-20200608225916996\"></p>\n<p>​    </p>\n<pre><code>选择板子类型和框架然后点完成，这里我的设置如下图：\n</code></pre>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/135424.png\" alt=\"image-20200608225858345\"></p>\n<pre><code>然后即可在main.cpp编辑你的代码：\n</code></pre>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/1537453.png\" alt=\"image-20200608230108817\"></p>\n<p>这里我们输入如下代码</p>\n<figure class=\"highlight cpp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Arduino.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;U8g2lib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> bmp_x 64</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> bmp_y 64</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SSD1306_SDA 5</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SSD1306_SLK 4</span></span><br><span class=\"line\"><span class=\"function\">U8G2_SSD1306_128X64_NONAME_F_SW_I2C <span class=\"title\">u8g2</span><span class=\"params\">(U8G2_R0, SSD1306_SLK, SSD1306_SDA)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\">  u8g<span class=\"number\">2.</span><span class=\"built_in\">begin</span>();</span><br><span class=\"line\">  u8g<span class=\"number\">2.</span><span class=\"built_in\">enableUTF8Print</span>();\t\t<span class=\"comment\">// 打开utf-8支持</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>{</span><br><span class=\"line\"> u8g<span class=\"number\">2.</span><span class=\"built_in\">setFont</span>(u8g2_font_wqy12_t_gb2312);  <span class=\"comment\">// 设置字体</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  u8g<span class=\"number\">2.</span><span class=\"built_in\">setFontDirection</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  u8g<span class=\"number\">2.f</span>irstPage();</span><br><span class=\"line\">  <span class=\"keyword\">do</span> {</span><br><span class=\"line\">    u8g<span class=\"number\">2.</span><span class=\"built_in\">setCursor</span>(<span class=\"number\">0</span>, <span class=\"number\">15</span>);</span><br><span class=\"line\">    u8g<span class=\"number\">2.</span><span class=\"built_in\">print</span>(<span class=\"string\">\"中国\"</span>);</span><br><span class=\"line\">    u8g<span class=\"number\">2.</span><span class=\"built_in\">drawUTF8</span>(<span class=\"number\">0</span>,<span class=\"number\">40</span>,<span class=\"string\">\"我爱你\"</span>);\t\t</span><br><span class=\"line\">    </span><br><span class=\"line\">  } <span class=\"keyword\">while</span> ( u8g<span class=\"number\">2.</span><span class=\"built_in\">nextPage</span>() );</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">1000</span>);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>代码解释：</p>\n<p>(1).void setup() 函数里的内容启动时会执行一次以后不再执行，一般用于初始化。void loop()函数里的内容将会在机器通电时循环执行，一般用于干正事。</p>\n<p>(2).u8g2.begin()：U8g2的构造函数。可以理解为初始化。</p>\n<p>(3).5、6、7行与你的显示屏有关</p>\n<blockquote>\n<p>具体参见：</p>\n<p><a href=\"https://blog.csdn.net/weixin_30510153/article/details/96227475\">https://blog.csdn.net/weixin_30510153/article/details/96227475</a><br><a href=\"https://github.com/olikraus/u8g2/wiki/gallery\">https://github.com/olikraus/u8g2/wiki/gallery</a></p>\n</blockquote>\n<p>(4).u8g2.setFontDirection()，用于设置方向 可选参数:0123</p>\n<p>(5).u8g2.firstPage()/nextPage()：循环刷新显示，保持这样就好，把你要输出的内容放在这里面就行。</p>\n<p>(6).u8g2.setCursor(x, y) 设置打印功能的光标位置，也就是设置你在上绘制图形或文字的起始位置。</p>\n<p>(7).delay(1000)会使单片机延迟1000个时钟周期也就是暂停一段时间啥也不干留给显示屏处理数据，设置太短会来不及写到屏幕上。</p>\n<h5 id=\"4-连接板子到电脑，然后编译并刷写到板子上\"><a href=\"#4-连接板子到电脑，然后编译并刷写到板子上\" class=\"headerlink\" title=\"4.连接板子到电脑，然后编译并刷写到板子上\"></a>4.连接板子到电脑，然后编译并刷写到板子上</h5><p>如下图，可以先点编译再点旁边的上传，也可以直接点上传</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/4535.png\" alt=\"image-20200609000955186\"></p>\n<p>当你看到下图时，说明刷写成功了，没成功的仔细检查一下设备连线，还有就是看看你的代码，显示屏设置对不对。</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/10254.png\" alt=\"image-20200609001057699\"></p>\n<h4 id=\"三、成果展示\"><a href=\"#三、成果展示\" class=\"headerlink\" title=\"三、成果展示\"></a>三、成果展示</h4><p>刷写成功后，OLED显示屏应该可以成功显示出我们设置的内容了</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/cn/posts/23513/45374583783.png\" alt=\"image-20200609002205245\"></p>\n<blockquote>\n<p>附其他U8G2库常用函数</p>\n<p>1.指令</p>\n<figure class=\"highlight cpp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">clearDisplay</span>();    <span class=\"comment\">// 清除显示数据及屏幕</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">clearBuffer</span>();    <span class=\"comment\">// 清Buffer缓冲区的数据</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">sendBuffer</span>();    <span class=\"comment\">// 将Buffer帧缓冲区的内容发送到显示器,发送刷新消息</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">sendF</span>(<span class=\"string\">\"c\"</span>, <span class=\"number\">0x0a7</span>);    <span class=\"comment\">// 向显示控制器发送特殊命令</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setPowerSave</span>(<span class=\"number\">0</span>)    <span class=\"comment\">// 开关省电模式</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>2.设置</p>\n<figure class=\"highlight cpp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">enableUTF8Print</span>();    <span class=\"comment\">//设置启用UTF-8支持</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">disableUTF8Print</span>();    <span class=\"comment\">//设置停用UTF-8支持</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setContrast</span>();    <span class=\"comment\">//设置显示屏亮度/对比度(0-255)</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setBusClock</span>();    <span class=\"comment\">//设置连接速度(IIC:200000-400000/SPI:1000000-8000000),在begin()之前调用</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//设置字体</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setFontMode</span>(<span class=\"number\">0</span>);    <span class=\"comment\">//定义字体背景模式,仅u8g2_xxx_tX字体支持,默认0,禁用透明</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setFontDirection</span>(<span class=\"number\">0</span>); <span class=\"comment\">//旋转当前显示 参数:0123</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setFont</span>(u8g2_font_unifont_t_chinese1);    <span class=\"comment\">//设置字体</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setFontPosCenter</span>();    <span class=\"comment\">//设置字体基线Center/Baseline/Bottom/Top</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//设置颜色</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setDrawColor</span>(<span class=\"number\">1</span>); <span class=\"comment\">//设置颜色,0透显,1实显,2XOR (drawCircle,drawDisc,drawEllipse和drawFilledEllipse不支持XOR模式)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//设置光标位置</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">home</span>();    <span class=\"comment\">//设置光标回初始位置</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setCursor</span>(x, y); <span class=\"comment\">//设置打印功能的光标位置</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setBitmapMode</span>(<span class=\"number\">0</span>);    <span class=\"comment\">//设置是否开启位图函数背景色</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>3.简单绘制</p>\n<figure class=\"highlight cpp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawStr</span>(x, y, <span class=\"string\">\"文本\"</span>); <span class=\"comment\">// 绘制文本字符,不能绘制编码大于或等于256,绘制文本前需定义字体.y轴向上绘制</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawUTF8</span>(x, y,<span class=\"string\">\"字符\"</span>);    <span class=\"comment\">// 绘制一个编码为UTF-8的字符串.注意1.编译器支持2.代码编辑器支持</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawGlyph</span>(x, y, HEX);    <span class=\"comment\">// 绘制特殊文本图标(需联合特殊字体)</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">print</span>();    <span class=\"comment\">// 打印文本字符(需要联合光标位置setCursor,setFont)支持变量和F()</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>4.高级绘制</p>\n<figure class=\"highlight cpp\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawPixel</span>(x, y); <span class=\"comment\">// 在xy位置绘制一个像素.</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawHLine</span>(x, y, w); <span class=\"comment\">// 绘制水平线 w长度</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawVLine</span>(x, y, h);    <span class=\"comment\">// 绘制垂直线 h高度</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawLine</span>(x1, y1, x2, y2);    <span class=\"comment\">// 画自由线 x1y1点1 x2y2点2</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawBox</span>(x, y, w, h); <span class=\"comment\">// 绘制矩形，画填充矩形w,h,宽度,高度 2 u8g2.drawFrame(x, y, w, h); // 画空心矩形w,h,宽度,高度</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawRFrame</span>(x,y,w,h,r); <span class=\"comment\">//绘制圆角矩形，要求w &gt;= 2*(r+1);h &gt;= 2*(r+1);否则未定义2*(r+1)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 正或椭圆</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawCircle</span>(圆心x, 圆心y, 半径rad, 部分位置U8G2_DRAW_ALL);    <span class=\"comment\">// 画空心圆 rad半径 直径为 2rad+1</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawEllipse</span>(圆心x, 圆心y, 椭圆长度x, 椭圆宽度y, 部分位置U8G2_DRAW_ALL)    <span class=\"comment\">//画空心椭圆 长度和宽度均为整个圆的1/2</span></span><br><span class=\"line\">U8G2_DRAW_ALL    <span class=\"comment\">/*替换参数:</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_ALL 全部</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_UPPER_RIGHT 上右</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_UPPER_LEFT 上左</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_LOWER_RIGHT 下右</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_LOWER_LEFT 下左*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawTriangle</span>(x1,y1,x2,y2,x3,y3); <span class=\"comment\">//绘制多边形，三个点的坐标,实心</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawXBM</span>( x, y, w, h, bits);    <span class=\"comment\">//绘制位图，bits是位图资源表,setBitmapMode(1)切换为旧模式</span></span><br></pre></td></tr></tbody></table></figure>\n\n</blockquote>\n","more":"<blockquote>\n<p>摘要：本文主要介绍了如何搭建以Visual Studio Code 和 PlatformIO为基础的单片机开发环境，并以esp8266开发板为例，通过在OLED显示屏上显示文字的一个例子介绍如何开发一个单片机程序。</p>\n</blockquote>\n<p>本文主要使用的环境：</p>\n<blockquote>\n<p>单片机开发板:Esp8266(CH340G)</p>\n<p>Visual Studio Code：1.45.1</p>\n<p>PlatformIO：Core  4.3.4   Home  3.2.2</p>\n<p>U8g2：2.28.6</p>\n</blockquote>\n<h4 id=\"一、硬件部分\"><a href=\"#一、硬件部分\" class=\"headerlink\" title=\"一、硬件部分\"></a>一、硬件部分</h4><p>首先就是去某宝买一个esp8266开发板和显示屏，这里我买的是这个（不贴链接，不然有打广告嫌疑，自己去搜哈，有些卖家不送杜邦线的，可以提前问问）</p>\n<p><img src=\"/cn/posts/23513/10007.png\" alt=\"image-20200609001347090\"></p>\n<p>按照卖家的说明将显示屏和开发板连接好</p>\n<p><img src=\"/cn/posts/23513/100002354.png\" alt=\"image-20200609001656314\"></p>\n<h4 id=\"二、软件部分\"><a href=\"#二、软件部分\" class=\"headerlink\" title=\"二、软件部分\"></a>二、软件部分</h4><h5 id=\"1-安装Visual-Studio-Code-和-PlatformIO\"><a href=\"#1-安装Visual-Studio-Code-和-PlatformIO\" class=\"headerlink\" title=\"1. 安装Visual Studio Code 和 PlatformIO\"></a>1. 安装Visual Studio Code 和 PlatformIO</h5><p>vscode: <a href=\"https://code.visualstudio.com/\">https://code.visualstudio.com/</a></p>\n<p>安装完成vscode启动，扩展页面下搜索platformio即可找到,选择第一个Platformio IDE，安装即可（这里需要耐心等待一会）</p>\n<p><img src=\"/cn/posts/23513/4363463.png\" alt=\"image-20200609004134896\"></p>\n<p>安装完成，等待vscode重新加载后，左下角会多一个小房子图标，点击后即可显示Platformio IDE主界面</p>\n<p><img src=\"/cn/posts/23513/4363463456t.png\" alt=\"image-20200608225407247\"></p>\n<h5 id=\"2-安装显示库\"><a href=\"#2-安装显示库\" class=\"headerlink\" title=\"2.安装显示库\"></a>2.安装显示库</h5><p>如图点击主界面右侧侧边栏Libraies选项卡，然后直接搜索U8G2然后点击进去，里面有个安装按钮，点一下即可：</p>\n<p><img src=\"/cn/posts/23513/54y7457.png\" alt=\"image-20200608230257339\"></p>\n<h5 id=\"3-开始我们的第一个程序\"><a href=\"#3-开始我们的第一个程序\" class=\"headerlink\" title=\"3. 开始我们的第一个程序\"></a>3. 开始我们的第一个程序</h5><p>   选择新建工程:</p>\n<p><img src=\"/cn/posts/23513/5475476574767.png\" alt=\"image-20200608225916996\"></p>\n<p>​    </p>\n<pre><code>选择板子类型和框架然后点完成，这里我的设置如下图：\n</code></pre>\n<p><img src=\"/cn/posts/23513/135424.png\" alt=\"image-20200608225858345\"></p>\n<pre><code>然后即可在main.cpp编辑你的代码：\n</code></pre>\n<p><img src=\"/cn/posts/23513/1537453.png\" alt=\"image-20200608230108817\"></p>\n<p>这里我们输入如下代码</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Arduino.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;U8g2lib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> bmp_x 64</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> bmp_y 64</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SSD1306_SDA 5</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SSD1306_SLK 4</span></span><br><span class=\"line\"><span class=\"function\">U8G2_SSD1306_128X64_NONAME_F_SW_I2C <span class=\"title\">u8g2</span><span class=\"params\">(U8G2_R0, SSD1306_SLK, SSD1306_SDA)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  u8g<span class=\"number\">2.</span><span class=\"built_in\">begin</span>();</span><br><span class=\"line\">  u8g<span class=\"number\">2.</span><span class=\"built_in\">enableUTF8Print</span>();\t\t<span class=\"comment\">// 打开utf-8支持</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"> u8g<span class=\"number\">2.</span><span class=\"built_in\">setFont</span>(u8g2_font_wqy12_t_gb2312);  <span class=\"comment\">// 设置字体</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  u8g<span class=\"number\">2.</span><span class=\"built_in\">setFontDirection</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">  u8g<span class=\"number\">2.f</span>irstPage();</span><br><span class=\"line\">  <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">    u8g<span class=\"number\">2.</span><span class=\"built_in\">setCursor</span>(<span class=\"number\">0</span>, <span class=\"number\">15</span>);</span><br><span class=\"line\">    u8g<span class=\"number\">2.</span><span class=\"built_in\">print</span>(<span class=\"string\">&quot;中国&quot;</span>);</span><br><span class=\"line\">    u8g<span class=\"number\">2.</span><span class=\"built_in\">drawUTF8</span>(<span class=\"number\">0</span>,<span class=\"number\">40</span>,<span class=\"string\">&quot;我爱你&quot;</span>);\t\t</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125; <span class=\"keyword\">while</span> ( u8g<span class=\"number\">2.</span><span class=\"built_in\">nextPage</span>() );</span><br><span class=\"line\">  <span class=\"built_in\">delay</span>(<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码解释：</p>\n<p>(1).void setup() 函数里的内容启动时会执行一次以后不再执行，一般用于初始化。void loop()函数里的内容将会在机器通电时循环执行，一般用于干正事。</p>\n<p>(2).u8g2.begin()：U8g2的构造函数。可以理解为初始化。</p>\n<p>(3).5、6、7行与你的显示屏有关</p>\n<blockquote>\n<p>具体参见：</p>\n<p><a href=\"https://blog.csdn.net/weixin_30510153/article/details/96227475\">https://blog.csdn.net/weixin_30510153/article/details/96227475</a><br><a href=\"https://github.com/olikraus/u8g2/wiki/gallery\">https://github.com/olikraus/u8g2/wiki/gallery</a></p>\n</blockquote>\n<p>(4).u8g2.setFontDirection()，用于设置方向 可选参数:0123</p>\n<p>(5).u8g2.firstPage()/nextPage()：循环刷新显示，保持这样就好，把你要输出的内容放在这里面就行。</p>\n<p>(6).u8g2.setCursor(x, y) 设置打印功能的光标位置，也就是设置你在上绘制图形或文字的起始位置。</p>\n<p>(7).delay(1000)会使单片机延迟1000个时钟周期也就是暂停一段时间啥也不干留给显示屏处理数据，设置太短会来不及写到屏幕上。</p>\n<h5 id=\"4-连接板子到电脑，然后编译并刷写到板子上\"><a href=\"#4-连接板子到电脑，然后编译并刷写到板子上\" class=\"headerlink\" title=\"4.连接板子到电脑，然后编译并刷写到板子上\"></a>4.连接板子到电脑，然后编译并刷写到板子上</h5><p>如下图，可以先点编译再点旁边的上传，也可以直接点上传</p>\n<p><img src=\"/cn/posts/23513/4535.png\" alt=\"image-20200609000955186\"></p>\n<p>当你看到下图时，说明刷写成功了，没成功的仔细检查一下设备连线，还有就是看看你的代码，显示屏设置对不对。</p>\n<p><img src=\"/cn/posts/23513/10254.png\" alt=\"image-20200609001057699\"></p>\n<h4 id=\"三、成果展示\"><a href=\"#三、成果展示\" class=\"headerlink\" title=\"三、成果展示\"></a>三、成果展示</h4><p>刷写成功后，OLED显示屏应该可以成功显示出我们设置的内容了</p>\n<p><img src=\"/cn/posts/23513/45374583783.png\" alt=\"image-20200609002205245\"></p>\n<blockquote>\n<p>附其他U8G2库常用函数</p>\n<p>1.指令</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">clearDisplay</span>();    <span class=\"comment\">// 清除显示数据及屏幕</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">clearBuffer</span>();    <span class=\"comment\">// 清Buffer缓冲区的数据</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">sendBuffer</span>();    <span class=\"comment\">// 将Buffer帧缓冲区的内容发送到显示器,发送刷新消息</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">sendF</span>(<span class=\"string\">&quot;c&quot;</span>, <span class=\"number\">0x0a7</span>);    <span class=\"comment\">// 向显示控制器发送特殊命令</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setPowerSave</span>(<span class=\"number\">0</span>)    <span class=\"comment\">// 开关省电模式</span></span><br></pre></td></tr></table></figure>\n\n<p>2.设置</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">enableUTF8Print</span>();    <span class=\"comment\">//设置启用UTF-8支持</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">disableUTF8Print</span>();    <span class=\"comment\">//设置停用UTF-8支持</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setContrast</span>();    <span class=\"comment\">//设置显示屏亮度/对比度(0-255)</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setBusClock</span>();    <span class=\"comment\">//设置连接速度(IIC:200000-400000/SPI:1000000-8000000),在begin()之前调用</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//设置字体</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setFontMode</span>(<span class=\"number\">0</span>);    <span class=\"comment\">//定义字体背景模式,仅u8g2_xxx_tX字体支持,默认0,禁用透明</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setFontDirection</span>(<span class=\"number\">0</span>); <span class=\"comment\">//旋转当前显示 参数:0123</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setFont</span>(u8g2_font_unifont_t_chinese1);    <span class=\"comment\">//设置字体</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setFontPosCenter</span>();    <span class=\"comment\">//设置字体基线Center/Baseline/Bottom/Top</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//设置颜色</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setDrawColor</span>(<span class=\"number\">1</span>); <span class=\"comment\">//设置颜色,0透显,1实显,2XOR (drawCircle,drawDisc,drawEllipse和drawFilledEllipse不支持XOR模式)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//设置光标位置</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">home</span>();    <span class=\"comment\">//设置光标回初始位置</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setCursor</span>(x, y); <span class=\"comment\">//设置打印功能的光标位置</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">setBitmapMode</span>(<span class=\"number\">0</span>);    <span class=\"comment\">//设置是否开启位图函数背景色</span></span><br></pre></td></tr></table></figure>\n\n<p>3.简单绘制</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawStr</span>(x, y, <span class=\"string\">&quot;文本&quot;</span>); <span class=\"comment\">// 绘制文本字符,不能绘制编码大于或等于256,绘制文本前需定义字体.y轴向上绘制</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawUTF8</span>(x, y,<span class=\"string\">&quot;字符&quot;</span>);    <span class=\"comment\">// 绘制一个编码为UTF-8的字符串.注意1.编译器支持2.代码编辑器支持</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawGlyph</span>(x, y, HEX);    <span class=\"comment\">// 绘制特殊文本图标(需联合特殊字体)</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">print</span>();    <span class=\"comment\">// 打印文本字符(需要联合光标位置setCursor,setFont)支持变量和F()</span></span><br></pre></td></tr></table></figure>\n\n<p>4.高级绘制</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawPixel</span>(x, y); <span class=\"comment\">// 在xy位置绘制一个像素.</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawHLine</span>(x, y, w); <span class=\"comment\">// 绘制水平线 w长度</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawVLine</span>(x, y, h);    <span class=\"comment\">// 绘制垂直线 h高度</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawLine</span>(x1, y1, x2, y2);    <span class=\"comment\">// 画自由线 x1y1点1 x2y2点2</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawBox</span>(x, y, w, h); <span class=\"comment\">// 绘制矩形，画填充矩形w,h,宽度,高度 2 u8g2.drawFrame(x, y, w, h); // 画空心矩形w,h,宽度,高度</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawRFrame</span>(x,y,w,h,r); <span class=\"comment\">//绘制圆角矩形，要求w &gt;= 2*(r+1);h &gt;= 2*(r+1);否则未定义2*(r+1)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 正或椭圆</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawCircle</span>(圆心x, 圆心y, 半径rad, 部分位置U8G2_DRAW_ALL);    <span class=\"comment\">// 画空心圆 rad半径 直径为 2rad+1</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawEllipse</span>(圆心x, 圆心y, 椭圆长度x, 椭圆宽度y, 部分位置U8G2_DRAW_ALL)    <span class=\"comment\">//画空心椭圆 长度和宽度均为整个圆的1/2</span></span><br><span class=\"line\">U8G2_DRAW_ALL    <span class=\"comment\">/*替换参数:</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_ALL 全部</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_UPPER_RIGHT 上右</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_UPPER_LEFT 上左</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_LOWER_RIGHT 下右</span></span><br><span class=\"line\"><span class=\"comment\">U8G2_DRAW_LOWER_LEFT 下左*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawTriangle</span>(x1,y1,x2,y2,x3,y3); <span class=\"comment\">//绘制多边形，三个点的坐标,实心</span></span><br><span class=\"line\">u8g<span class=\"number\">2.</span><span class=\"built_in\">drawXBM</span>( x, y, w, h, bits);    <span class=\"comment\">//绘制位图，bits是位图资源表,setBitmapMode(1)切换为旧模式</span></span><br></pre></td></tr></table></figure>\n\n</blockquote>\n","categories":[],"tags":[{"name":"cpp","path":"api/tags/cpp.json"},{"name":"esp8266","path":"api/tags/esp8266.json"},{"name":"单片机","path":"api/tags/单片机.json"},{"name":"vscode","path":"api/tags/vscode.json"}]}