{"title":"Wireshark Basic Usage","slug":"release/2020-4-1-basic use of wireshark","date":"2023-03-04T00:56:00.000Z","updated":"2023-03-04T00:56:00.000Z","comments":true,"path":"api/articles/release/2020-4-1-basic use of wireshark.json","excerpt":"一、IntroductionWireshark is currently one of the most widely used network packet analysis software in the world. The function of network packet analysis software is to listen to network packets and display the most detailed network packet information as much as possible. Wireshark uses Winpcap as the interface to directly exchange data packets with the network card. The following figure shows the initial interface after successfully installing Winpcap and Wireshark: In the initial interface of Wi","covers":["/posts/20069/image-20200608181205658.png","/posts/20069/image-20200608181307861.png","/posts/20069/image-20200608173101731.png","/posts/20069/image-20200608174203428.png","/posts/20069/image-20200608173431410.png","/posts/20069/JSYW201709050_01100.jpg","/posts/20069/image-20200608174410800.png","/posts/20069/image-20200608174514228.png","/posts/20069/image-20200608174532582.png","/posts/20069/image-20200608174737348.png","/posts/20069/image-20200608174816396.png","/posts/20069/image-20200608175505369.png","/posts/20069/image-20200608175705185.png"],"content":"<h2 id=\"一、Introduction\"><a href=\"#一、Introduction\" class=\"headerlink\" title=\"一、Introduction\"></a>一、Introduction</h2><p>Wireshark is currently one of the most widely used network packet analysis software in the world. The function of network packet analysis software is to listen to network packets and display the most detailed network packet information as much as possible. Wireshark uses Winpcap as the interface to directly exchange data packets with the network card.</p>\n<p>The following figure shows the initial interface after successfully installing Winpcap and Wireshark:</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608181205658.png\" alt=\"image-20200608181205658\"></p>\n<p>In the initial interface of Wireshark, the fluctuating line represents the fluctuation of the information transmitted by the network card. Click the start icon in the upper left corner to enter the packet capture page shown in the following figure:</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608181307861.png\" alt=\"image-20200608181307861\"></p>\n<h2 id=\"二、Packet-Capture-and-Analysis\"><a href=\"#二、Packet-Capture-and-Analysis\" class=\"headerlink\" title=\"二、Packet Capture and Analysis\"></a>二、Packet Capture and Analysis</h2><p>This example demonstrates packet capture using the curl and ping commands.<br>Start capturing with Wireshark, and then, as shown in the following figure, use the curl and ping commands in the terminal to interact with the target address:</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608173101731.png\" alt=\"image-20200608173101731\"></p>\n<p>​                </p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608174203428.png\" alt=\"image-20200608174203428\"></p>\n<blockquote>\n<p> From the response packets of ping, we can see that we received 7 response packets. The IP address of Baidu here is 14.215.177.39.</p>\n</blockquote>\n<p>Returning to Wireshark, filter the packets by IP address in the filter, as shown in the following figure is the result of filtering the packets. The filter command is:</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip.addr ==14.215.177.39 </span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608173431410.png\" alt=\"image-20200608173431410\"></p>\n<h3 id=\"1-TCP-Three-Way-Handshake-Analysis\"><a href=\"#1-TCP-Three-Way-Handshake-Analysis\" class=\"headerlink\" title=\"1.TCP Three-Way Handshake Analysis\"></a>1.TCP Three-Way Handshake Analysis</h3><p>Viewing the packets, in the above figure, packets 1-3 are using the TCP protocol, and packet 4 is using the HTTP protocol, which is a clear sign of the TCP three-way handshake. The first three packets are the process of the TCP three-way handshake. The following figure shows the detailed packet contents of the TCP three-way handshake, which can be compared with the packet flag bits of the TCP three-way handshake.</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/JSYW201709050_01100.jpg\" alt=\"img\"></p>\n<h3 id=\"2-ICMP-Protocol-Analysis\"><a href=\"#2-ICMP-Protocol-Analysis\" class=\"headerlink\" title=\"2.ICMP Protocol Analysis\"></a>2.ICMP Protocol Analysis</h3><p>The ping command belongs to the ICMP protocol. Viewing the ICMP packets in the filtered packets, we can observe 14 packets. As mentioned earlier, 7 response packets were received for the ping destination address.</p>\n<p>ICMP packets have two modes: request and response. See the following figure for details:：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608174410800.png\" alt=\"image-20200608174410800\"></p>\n<p><strong>The ICMP Request and Reply message formats are as follows:</strong></p>\n<p>Request：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608174514228.png\" alt=\"image-20200608174514228\"></p>\n<p> Reply：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608174532582.png\" alt=\"image-20200608174532582\"></p>\n<blockquote>\n<p>Type indicates the type of ICMP message, 8 for request messages and 0 for reply messages;</p>\n<p>Code = 0;</p>\n<p>CheckSum is the checksum from the ICMP header (starting with Type) to the end of the data (ending with the entire packet);</p>\n<p>Identifier is the identifier set by the host, usually set to the process ID. The identifier in the response message is the same as the identifier in the original message;</p>\n<p>Sequence Number is the sequence number set by the host, usually set to an increasing sequence starting from 0. The sequence number in the response message is the same as the sequence number in the original message;</p>\n<p>Data is the data set by the host. The data in the response message is the same as the data in the original message;</p>\n<p>Note: The Identifier and Sequence Number fields are divided into [BE] and [LE]. [BE] is for Linux content, and [LE] is for Windows content. Since this experiment was conducted in a Linux environment, only the [BE] content needs to be viewed.</p>\n</blockquote>\n<p>Request Message Header ：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608174737348.png\" alt=\"image-20200608174737348\"></p>\n<p>Reply Message Header：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608174816396.png\" alt=\"image-20200608174816396\"></p>\n<h2 id=\"三、Introduction-to-Wireshark-filters\"><a href=\"#三、Introduction-to-Wireshark-filters\" class=\"headerlink\" title=\"三、Introduction to Wireshark filters\"></a>三、Introduction to Wireshark filters</h2><p>One of the core features of Wireshark is the use of filters. There are three states for display filters: red, yellow, and green. Red means that the display filter expression is incorrect, yellow means that the filter expression can filter packets but may result in unpredictable results, and green means that the filter expression is correct.</p>\n<p>Wireshark filters are divided into two types: display filters and capture filters. Display filters filter captured packets based on filtering rules, while capture filters only capture packets that meet the filtering rules that have been set in advance.</p>\n<p><strong>Capture Filter：</strong></p>\n<p>As shown in the following figure is the capture filter settings. ：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608175505369.png\" alt=\"image-20200608175505369\">  </p>\n<p>The reason for setting a capture filter is to target situations where the network traffic is very large, such as several gigabytes per second, and most of the traffic is not the data that the analyst is interested in. In this case, a capture filter can be used to capture only the specified data. Useless data can not only interfere with analysis, but also waste storage space and copying time.</p>\n<p><strong>Display filter：</strong></p>\n<p>The following image shows the setting of a display filter ：</p>\n<p><img src= \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\" data-lazy-src=\"/posts/20069/image-20200608175705185.png\" alt=\"image-20200608175705185\"></p>\n<blockquote>\n<p>Common syntax of display filters:</p>\n<ol>\n<li><p>Protocol filter, such as http, icmp, etc;</p>\n</li>\n<li><p>Filter by specific port: tcp.port eq 80, displays packets with port 80 whether it is a source or destination port. To filter by the source port, use tcp.srcport eq 80, and to filter by the destination port, use tcp.dstport eq 80;</p>\n</li>\n<li><p>Filter by source IP address: ip.src eq 192.168.1.107, and to filter by the destination, use ip.dst eq 192.168.1.107. To filter by both source and destination, use ip.addr eq 192.168.1.107. MAC address filtering follows the same logic;</p>\n</li>\n<li><p>Filter packets containing a specific string domain name, such as http.host contains “moe”;</p>\n</li>\n<li><p>Multiple filter conditions can be used together, for example, to simultaneously filter for http protocol and port 80, use http &amp;&amp; tcp.port == 80. Combination symbols include AND/&amp;&amp;, OR/||, and NOT/!;</p>\n</li>\n</ol>\n<p>The syntax of capture filters is slightly different from display filters, and some examples are as follows:</p>\n<ol>\n<li>Filter by specific protocol: http</li>\n<li>Filter by specific port: port 80</li>\n<li>Filter by specific IP address: host 192.168.0.115</li>\n<li>Filter by specific domain name: host <a href=\"http://www.example.com/\">www.example.com</a></li>\n</ol>\n</blockquote>\n","more":"<h2 id=\"一、Introduction\"><a href=\"#一、Introduction\" class=\"headerlink\" title=\"一、Introduction\"></a>一、Introduction</h2><p>Wireshark is currently one of the most widely used network packet analysis software in the world. The function of network packet analysis software is to listen to network packets and display the most detailed network packet information as much as possible. Wireshark uses Winpcap as the interface to directly exchange data packets with the network card.</p>\n<p>The following figure shows the initial interface after successfully installing Winpcap and Wireshark:</p>\n<p><img src=\"/posts/20069/image-20200608181205658.png\" alt=\"image-20200608181205658\"></p>\n<p>In the initial interface of Wireshark, the fluctuating line represents the fluctuation of the information transmitted by the network card. Click the start icon in the upper left corner to enter the packet capture page shown in the following figure:</p>\n<p><img src=\"/posts/20069/image-20200608181307861.png\" alt=\"image-20200608181307861\"></p>\n<h2 id=\"二、Packet-Capture-and-Analysis\"><a href=\"#二、Packet-Capture-and-Analysis\" class=\"headerlink\" title=\"二、Packet Capture and Analysis\"></a>二、Packet Capture and Analysis</h2><p>This example demonstrates packet capture using the curl and ping commands.<br>Start capturing with Wireshark, and then, as shown in the following figure, use the curl and ping commands in the terminal to interact with the target address:</p>\n<p><img src=\"/posts/20069/image-20200608173101731.png\" alt=\"image-20200608173101731\"></p>\n<p>​                </p>\n<p><img src=\"/posts/20069/image-20200608174203428.png\" alt=\"image-20200608174203428\"></p>\n<blockquote>\n<p> From the response packets of ping, we can see that we received 7 response packets. The IP address of Baidu here is 14.215.177.39.</p>\n</blockquote>\n<p>Returning to Wireshark, filter the packets by IP address in the filter, as shown in the following figure is the result of filtering the packets. The filter command is:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip.addr ==14.215.177.39 </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/posts/20069/image-20200608173431410.png\" alt=\"image-20200608173431410\"></p>\n<h3 id=\"1-TCP-Three-Way-Handshake-Analysis\"><a href=\"#1-TCP-Three-Way-Handshake-Analysis\" class=\"headerlink\" title=\"1.TCP Three-Way Handshake Analysis\"></a>1.TCP Three-Way Handshake Analysis</h3><p>Viewing the packets, in the above figure, packets 1-3 are using the TCP protocol, and packet 4 is using the HTTP protocol, which is a clear sign of the TCP three-way handshake. The first three packets are the process of the TCP three-way handshake. The following figure shows the detailed packet contents of the TCP three-way handshake, which can be compared with the packet flag bits of the TCP three-way handshake.</p>\n<p><img src=\"/posts/20069/JSYW201709050_01100.jpg\" alt=\"img\"></p>\n<h3 id=\"2-ICMP-Protocol-Analysis\"><a href=\"#2-ICMP-Protocol-Analysis\" class=\"headerlink\" title=\"2.ICMP Protocol Analysis\"></a>2.ICMP Protocol Analysis</h3><p>The ping command belongs to the ICMP protocol. Viewing the ICMP packets in the filtered packets, we can observe 14 packets. As mentioned earlier, 7 response packets were received for the ping destination address.</p>\n<p>ICMP packets have two modes: request and response. See the following figure for details:：</p>\n<p><img src=\"/posts/20069/image-20200608174410800.png\" alt=\"image-20200608174410800\"></p>\n<p><strong>The ICMP Request and Reply message formats are as follows:</strong></p>\n<p>Request：</p>\n<p><img src=\"/posts/20069/image-20200608174514228.png\" alt=\"image-20200608174514228\"></p>\n<p> Reply：</p>\n<p><img src=\"/posts/20069/image-20200608174532582.png\" alt=\"image-20200608174532582\"></p>\n<blockquote>\n<p>Type indicates the type of ICMP message, 8 for request messages and 0 for reply messages;</p>\n<p>Code = 0;</p>\n<p>CheckSum is the checksum from the ICMP header (starting with Type) to the end of the data (ending with the entire packet);</p>\n<p>Identifier is the identifier set by the host, usually set to the process ID. The identifier in the response message is the same as the identifier in the original message;</p>\n<p>Sequence Number is the sequence number set by the host, usually set to an increasing sequence starting from 0. The sequence number in the response message is the same as the sequence number in the original message;</p>\n<p>Data is the data set by the host. The data in the response message is the same as the data in the original message;</p>\n<p>Note: The Identifier and Sequence Number fields are divided into [BE] and [LE]. [BE] is for Linux content, and [LE] is for Windows content. Since this experiment was conducted in a Linux environment, only the [BE] content needs to be viewed.</p>\n</blockquote>\n<p>Request Message Header ：</p>\n<p><img src=\"/posts/20069/image-20200608174737348.png\" alt=\"image-20200608174737348\"></p>\n<p>Reply Message Header：</p>\n<p><img src=\"/posts/20069/image-20200608174816396.png\" alt=\"image-20200608174816396\"></p>\n<h2 id=\"三、Introduction-to-Wireshark-filters\"><a href=\"#三、Introduction-to-Wireshark-filters\" class=\"headerlink\" title=\"三、Introduction to Wireshark filters\"></a>三、Introduction to Wireshark filters</h2><p>One of the core features of Wireshark is the use of filters. There are three states for display filters: red, yellow, and green. Red means that the display filter expression is incorrect, yellow means that the filter expression can filter packets but may result in unpredictable results, and green means that the filter expression is correct.</p>\n<p>Wireshark filters are divided into two types: display filters and capture filters. Display filters filter captured packets based on filtering rules, while capture filters only capture packets that meet the filtering rules that have been set in advance.</p>\n<p><strong>Capture Filter：</strong></p>\n<p>As shown in the following figure is the capture filter settings. ：</p>\n<p><img src=\"/posts/20069/image-20200608175505369.png\" alt=\"image-20200608175505369\">  </p>\n<p>The reason for setting a capture filter is to target situations where the network traffic is very large, such as several gigabytes per second, and most of the traffic is not the data that the analyst is interested in. In this case, a capture filter can be used to capture only the specified data. Useless data can not only interfere with analysis, but also waste storage space and copying time.</p>\n<p><strong>Display filter：</strong></p>\n<p>The following image shows the setting of a display filter ：</p>\n<p><img src=\"/posts/20069/image-20200608175705185.png\" alt=\"image-20200608175705185\"></p>\n<blockquote>\n<p>Common syntax of display filters:</p>\n<ol>\n<li><p>Protocol filter, such as http, icmp, etc;</p>\n</li>\n<li><p>Filter by specific port: tcp.port eq 80, displays packets with port 80 whether it is a source or destination port. To filter by the source port, use tcp.srcport eq 80, and to filter by the destination port, use tcp.dstport eq 80;</p>\n</li>\n<li><p>Filter by source IP address: ip.src eq 192.168.1.107, and to filter by the destination, use ip.dst eq 192.168.1.107. To filter by both source and destination, use ip.addr eq 192.168.1.107. MAC address filtering follows the same logic;</p>\n</li>\n<li><p>Filter packets containing a specific string domain name, such as http.host contains “moe”;</p>\n</li>\n<li><p>Multiple filter conditions can be used together, for example, to simultaneously filter for http protocol and port 80, use http &amp;&amp; tcp.port == 80. Combination symbols include AND/&amp;&amp;, OR/||, and NOT/!;</p>\n</li>\n</ol>\n<p>The syntax of capture filters is slightly different from display filters, and some examples are as follows:</p>\n<ol>\n<li>Filter by specific protocol: http</li>\n<li>Filter by specific port: port 80</li>\n<li>Filter by specific IP address: host 192.168.0.115</li>\n<li>Filter by specific domain name: host <a href=\"http://www.example.com/\">www.example.com</a></li>\n</ol>\n</blockquote>\n","categories":[],"tags":[{"name":"Information Security","path":"api/tags/Information Security.json"}]}