{"title":"The issue of SSL certificate being unable to issue due to the CNAME record pointing to Vercel affecting the CAA record.","slug":"release/vercel导致的SSL证书无法签发的问题_en","date":"2023-03-04T00:14:00.000Z","updated":"2023-03-05T07:36:00.000Z","comments":true,"path":"api/articles/release/vercel导致的SSL证书无法签发的问题_en.json","excerpt":"SolutionThe most drastic solution is to directly pause all DNS related to Vercel.Or, first pause the resolution of the second-level domain to Vercel, that is, pause example.com-&gt;Vercel,and then pause the Vercel of the affected subdomain, that is, pause a.example.com-&gt;Vercel. ProblemToday, Alibaba Cloud informed me that an SSL certificate for one of my domains was about to expire. As an experienced developer, I opened the Alibaba Cloud console to apply for a new certificate. However, someth","covers":null,"content":"<h3 id=\"Solution\"><a href=\"#Solution\" class=\"headerlink\" title=\"Solution\"></a>Solution</h3><p>The most drastic solution is to directly pause all DNS related to Vercel.<br>Or, first pause the resolution of the second-level domain to Vercel, that is, pause example.com-&gt;Vercel,<br>and then pause the Vercel of the affected subdomain, that is, pause a.example.com-&gt;Vercel.</p>\n<h3 id=\"Problem\"><a href=\"#Problem\" class=\"headerlink\" title=\"Problem\"></a>Problem</h3><p>Today, Alibaba Cloud informed me that an SSL certificate for one of my domains was about to expire. As an experienced developer, I opened the Alibaba Cloud console to apply for a new certificate.</p>\n<p>However, something strange happened. Previously, the certificate could be issued within a minute, but this time it took a long time and it still didn’t work. I decided to take a nap and try again later.</p>\n<p>When I woke up and opened the Alibaba Cloud console, I found that it still wasn’t successful. At this point, I still suspected that it was Alibaba Cloud’s problem. So I applied again using Freessl, but it still wasn’t successful in the afternoon. The result of the test using <a href=\"https://myssl.com/\">myssl.com</a> is as follows:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Region</th>\n<th align=\"left\">Match</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">China</td>\n<td align=\"left\">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td>\n</tr>\n<tr>\n<td align=\"left\">Hong Kong</td>\n<td align=\"left\">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td>\n</tr>\n<tr>\n<td align=\"left\">United States</td>\n<td align=\"left\">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td>\n</tr>\n</tbody></table>\n<p>I haven’t set up any CAA records! </p>\n<p>I thought it couldn’t be a DNS cache issue, right?</p>\n<p> But I still went to the Alibaba Cloud console to temporarily stop resolving all DNS records. As a result, it actually worked! After investigation, I found that the problem was caused by the CNAME record pointing to Vercel. How could Vercel have the permission to set CAA records for me?!</p>\n<h3 id=\"Reason\"><a href=\"#Reason\" class=\"headerlink\" title=\"Reason\"></a>Reason</h3><p>After some searching, I finally figured out the reason, which was caused by the CAA record.</p>\n<blockquote>\n<p> CAA (Certificate Authority Authorization) is a new additional field that can be added to DNS records to create CAA resource records through DNS mechanism, which can limit the connection between the domain name issuing the certificate and the CA (certificate authority). Unauthorized third parties attempting to obtain SSL/TLS certificates for the domain name through other CAs will be rejected. By setting a CAA record for the domain name, website owners can authorize specific CAs to issue certificates for their domain name, thereby preventing HTTPS certificate errors and improving website security.</p>\n</blockquote>\n<p>An additional piece of knowledge is that CNAME records can affect CAA records：</p>\n<p>CAA record checking continues for CNAME records pointing to a different domain. In this example, <a href=\"http://www.example.com/\">www.example.com</a> points to <a href=\"http://www.example.net/\">www.example.net</a>, which also has CAA records:</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Example 7 / www.example.com)</span><br><span class=\"line\">Domain   Record type  Flags  Tag      Value   </span><br><span class=\"line\">www.example.com.   CNAME www.example.net</span><br><span class=\"line\">www.example.net.   CAA           0      issue   \";\"</span><br><span class=\"line\"></span><br><span class=\"line\">(Result: CAA failed)</span><br></pre></td></tr></tbody></table></figure>\n\n<p>The first record redirects the CAA check to <a href=\"http://www.example.net/\">www.example.net</a>. This CAA record can prevent any CA from issuing a certificate, so the certificate authority cannot issue a certificate for <a href=\"http://www.example.com/\">www.example.com</a>.</p>\n<p>If the domain being pointed to (<a href=\"http://www.example.net/\">www.example.net</a>) does not have a CAA record, then the CAA record check will climb up to the parent domain (example.com).</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Example 8 / www.example.com)</span><br><span class=\"line\">Domain   Record type  Flags  Tag      Value   </span><br><span class=\"line\">www.example.com.   CNAME www.example.net</span><br><span class=\"line\">example.com.   CAA           0      issue   \"amazon.com\"</span><br><span class=\"line\"></span><br><span class=\"line\">(Result: CAA passed)</span><br></pre></td></tr></tbody></table></figure>\n\n<p>In plain language, it means that because we set a CNAME record to point to Vercel, and Vercel set a CAA record, it affected our domain’s CAA record. After using a tool to check, we confirmed that this was indeed the case.：</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">{</span><br><span class=\"line\">  \"canIssue\": false,</span><br><span class=\"line\">  \"status\": \"IssueMismatch\",</span><br><span class=\"line\">  \"domain\": \"czqu.net\",</span><br><span class=\"line\">  \"queryAt\": \"Sep 30, 2021 11:21:55 AM\",</span><br><span class=\"line\">  \"elapsed\": 1,</span><br><span class=\"line\">  \"caaRecordSet\": [</span><br><span class=\"line\">    {</span><br><span class=\"line\">      \"domain\": \"czqu.net\",</span><br><span class=\"line\">      \"caaRecords\": [</span><br><span class=\"line\">        {</span><br><span class=\"line\">          \"issuerCritical\": 0,</span><br><span class=\"line\">          \"tag\": \"issue\",</span><br><span class=\"line\">          \"value\": \"letsencrypt.org\",</span><br><span class=\"line\">          \"type\": 257,</span><br><span class=\"line\">          \"dclass\": 1,</span><br><span class=\"line\">          \"ttl\": 60</span><br><span class=\"line\">        },</span><br><span class=\"line\">        {</span><br><span class=\"line\">          \"issuerCritical\": 0,</span><br><span class=\"line\">          \"tag\": \"issue\",</span><br><span class=\"line\">          \"value\": \"globalsign.com\",</span><br><span class=\"line\">          \"type\": 257,</span><br><span class=\"line\">          \"dclass\": 1,</span><br><span class=\"line\">          \"ttl\": 60</span><br><span class=\"line\">        }</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    }</span><br><span class=\"line\">  ]</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n","more":"<h3 id=\"Solution\"><a href=\"#Solution\" class=\"headerlink\" title=\"Solution\"></a>Solution</h3><p>The most drastic solution is to directly pause all DNS related to Vercel.<br>Or, first pause the resolution of the second-level domain to Vercel, that is, pause example.com-&gt;Vercel,<br>and then pause the Vercel of the affected subdomain, that is, pause a.example.com-&gt;Vercel.</p>\n<h3 id=\"Problem\"><a href=\"#Problem\" class=\"headerlink\" title=\"Problem\"></a>Problem</h3><p>Today, Alibaba Cloud informed me that an SSL certificate for one of my domains was about to expire. As an experienced developer, I opened the Alibaba Cloud console to apply for a new certificate.</p>\n<p>However, something strange happened. Previously, the certificate could be issued within a minute, but this time it took a long time and it still didn’t work. I decided to take a nap and try again later.</p>\n<p>When I woke up and opened the Alibaba Cloud console, I found that it still wasn’t successful. At this point, I still suspected that it was Alibaba Cloud’s problem. So I applied again using Freessl, but it still wasn’t successful in the afternoon. The result of the test using <a href=\"https://myssl.com/\">myssl.com</a> is as follows:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Region</th>\n<th align=\"left\">Match</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">China</td>\n<td align=\"left\">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td>\n</tr>\n<tr>\n<td align=\"left\">Hong Kong</td>\n<td align=\"left\">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td>\n</tr>\n<tr>\n<td align=\"left\">United States</td>\n<td align=\"left\">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td>\n</tr>\n</tbody></table>\n<p>I haven’t set up any CAA records! </p>\n<p>I thought it couldn’t be a DNS cache issue, right?</p>\n<p> But I still went to the Alibaba Cloud console to temporarily stop resolving all DNS records. As a result, it actually worked! After investigation, I found that the problem was caused by the CNAME record pointing to Vercel. How could Vercel have the permission to set CAA records for me?!</p>\n<h3 id=\"Reason\"><a href=\"#Reason\" class=\"headerlink\" title=\"Reason\"></a>Reason</h3><p>After some searching, I finally figured out the reason, which was caused by the CAA record.</p>\n<blockquote>\n<p> CAA (Certificate Authority Authorization) is a new additional field that can be added to DNS records to create CAA resource records through DNS mechanism, which can limit the connection between the domain name issuing the certificate and the CA (certificate authority). Unauthorized third parties attempting to obtain SSL/TLS certificates for the domain name through other CAs will be rejected. By setting a CAA record for the domain name, website owners can authorize specific CAs to issue certificates for their domain name, thereby preventing HTTPS certificate errors and improving website security.</p>\n</blockquote>\n<p>An additional piece of knowledge is that CNAME records can affect CAA records：</p>\n<p>CAA record checking continues for CNAME records pointing to a different domain. In this example, <a href=\"http://www.example.com/\">www.example.com</a> points to <a href=\"http://www.example.net/\">www.example.net</a>, which also has CAA records:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Example 7 / www.example.com)</span><br><span class=\"line\">Domain   Record type  Flags  Tag      Value   </span><br><span class=\"line\">www.example.com.   CNAME www.example.net</span><br><span class=\"line\">www.example.net.   CAA           0      issue   &quot;;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">(Result: CAA failed)</span><br></pre></td></tr></table></figure>\n\n<p>The first record redirects the CAA check to <a href=\"http://www.example.net/\">www.example.net</a>. This CAA record can prevent any CA from issuing a certificate, so the certificate authority cannot issue a certificate for <a href=\"http://www.example.com/\">www.example.com</a>.</p>\n<p>If the domain being pointed to (<a href=\"http://www.example.net/\">www.example.net</a>) does not have a CAA record, then the CAA record check will climb up to the parent domain (example.com).</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(Example 8 / www.example.com)</span><br><span class=\"line\">Domain   Record type  Flags  Tag      Value   </span><br><span class=\"line\">www.example.com.   CNAME www.example.net</span><br><span class=\"line\">example.com.   CAA           0      issue   &quot;amazon.com&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">(Result: CAA passed)</span><br></pre></td></tr></table></figure>\n\n<p>In plain language, it means that because we set a CNAME record to point to Vercel, and Vercel set a CAA record, it affected our domain’s CAA record. After using a tool to check, we confirmed that this was indeed the case.：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;canIssue&quot;: false,</span><br><span class=\"line\">  &quot;status&quot;: &quot;IssueMismatch&quot;,</span><br><span class=\"line\">  &quot;domain&quot;: &quot;czqu.net&quot;,</span><br><span class=\"line\">  &quot;queryAt&quot;: &quot;Sep 30, 2021 11:21:55 AM&quot;,</span><br><span class=\"line\">  &quot;elapsed&quot;: 1,</span><br><span class=\"line\">  &quot;caaRecordSet&quot;: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;domain&quot;: &quot;czqu.net&quot;,</span><br><span class=\"line\">      &quot;caaRecords&quot;: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          &quot;issuerCritical&quot;: 0,</span><br><span class=\"line\">          &quot;tag&quot;: &quot;issue&quot;,</span><br><span class=\"line\">          &quot;value&quot;: &quot;letsencrypt.org&quot;,</span><br><span class=\"line\">          &quot;type&quot;: 257,</span><br><span class=\"line\">          &quot;dclass&quot;: 1,</span><br><span class=\"line\">          &quot;ttl&quot;: 60</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          &quot;issuerCritical&quot;: 0,</span><br><span class=\"line\">          &quot;tag&quot;: &quot;issue&quot;,</span><br><span class=\"line\">          &quot;value&quot;: &quot;globalsign.com&quot;,</span><br><span class=\"line\">          &quot;type&quot;: 257,</span><br><span class=\"line\">          &quot;dclass&quot;: 1,</span><br><span class=\"line\">          &quot;ttl&quot;: 60</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":[{"name":"Backend Development","path":"api/tags/Backend Development.json"},{"name":"Trap","path":"api/tags/Trap.json"}]}